/**
 * Minified by jsDelivr using UglifyJS v3.4.4.
 * Original file: /npm/@magenta/music@1.1.11/dist/magentamusic.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).mm=e()}}(function(){var define,module,exports;return function o(a,s,u){function l(n,e){if(!s[n]){if(!a[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(c)return c(n,!0);var r=new Error("Cannot find module '"+n+"'");throw r.code="MODULE_NOT_FOUND",r}var i=s[n]={exports:{}};a[n][0].call(i.exports,function(e){var t=a[n][1][e];return l(t||e)},i,i.exports,o,a,s,u)}return s[n].exports}for(var c="function"==typeof require&&require,e=0;e<u.length;e++)l(u[e]);return l}({1:[function(e,t,n){"use strict";t.exports=function(e,t){var n=new Array(arguments.length-1),o=0,r=2,a=!0;for(;r<arguments.length;)n[o++]=arguments[r++];return new Promise(function(r,i){n[o]=function(e){if(a)if(a=!1,e)i(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];r.apply(null,t)}};try{e.apply(t||null,n)}catch(e){a&&(a=!1,i(e))}})}},{}],2:[function(e,t,n){"use strict";var r=n;r.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;1<--t%4&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var l=new Array(64),u=new Array(123),i=0;i<64;)u[l[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;r.encode=function(e,t,n){for(var r,i=null,o=[],a=0,s=0;t<n;){var u=e[t++];switch(s){case 0:o[a++]=l[u>>2],r=(3&u)<<4,s=1;break;case 1:o[a++]=l[r|u>>4],r=(15&u)<<2,s=2;break;case 2:o[a++]=l[r|u>>6],o[a++]=l[63&u],s=0}8191<a&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0)}return s&&(o[a++]=l[r],o[a++]=61,1===s&&(o[a++]=61)),i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))};var c="invalid encoding";r.decode=function(e,t,n){for(var r,i=n,o=0,a=0;a<e.length;){var s=e.charCodeAt(a++);if(61===s&&1<o)break;if(void 0===(s=u[s]))throw Error(c);switch(o){case 0:r=s,o=1;break;case 1:t[n++]=r<<2|(48&s)>>4,r=s,o=2;break;case 2:t[n++]=(15&r)<<4|(60&s)>>2,r=s,o=3;break;case 3:t[n++]=(3&r)<<6|s,o=0}}if(1===o)throw Error(c);return n-i},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},{}],3:[function(e,t,n){"use strict";function r(){this._listeners={}}(t.exports=r).prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},r.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},r.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this}},{}],4:[function(e,t,n){"use strict";function r(s){return"undefined"!=typeof Float32Array?function(){var r=new Float32Array([-0]),i=new Uint8Array(r.buffer),e=128===i[3];function t(e,t,n){r[0]=e,t[n]=i[0],t[n+1]=i[1],t[n+2]=i[2],t[n+3]=i[3]}function n(e,t,n){r[0]=e,t[n]=i[3],t[n+1]=i[2],t[n+2]=i[1],t[n+3]=i[0]}function o(e,t){return i[0]=e[t],i[1]=e[t+1],i[2]=e[t+2],i[3]=e[t+3],r[0]}function a(e,t){return i[3]=e[t],i[2]=e[t+1],i[1]=e[t+2],i[0]=e[t+3],r[0]}s.writeFloatLE=e?t:n,s.writeFloatBE=e?n:t,s.readFloatLE=e?o:a,s.readFloatBE=e?a:o}():function(){function e(e,t,n,r){var i=t<0?1:0;if(i&&(t=-t),0===t)e(0<1/t?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(34028234663852886e22<t)e((i<<31|2139095040)>>>0,n,r);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,n,r)}}function t(e,t,n){var r=e(t,n),i=2*(r>>31)+1,o=r>>>23&255,a=8388607&r;return 255===o?a?NaN:i*(1/0):0===o?1401298464324817e-60*i*a:i*Math.pow(2,o-150)*(a+8388608)}s.writeFloatLE=e.bind(null,i),s.writeFloatBE=e.bind(null,o),s.readFloatLE=t.bind(null,a),s.readFloatBE=t.bind(null,u)}(),"undefined"!=typeof Float64Array?function(){var r=new Float64Array([-0]),i=new Uint8Array(r.buffer),e=128===i[7];function t(e,t,n){r[0]=e,t[n]=i[0],t[n+1]=i[1],t[n+2]=i[2],t[n+3]=i[3],t[n+4]=i[4],t[n+5]=i[5],t[n+6]=i[6],t[n+7]=i[7]}function n(e,t,n){r[0]=e,t[n]=i[7],t[n+1]=i[6],t[n+2]=i[5],t[n+3]=i[4],t[n+4]=i[3],t[n+5]=i[2],t[n+6]=i[1],t[n+7]=i[0]}function o(e,t){return i[0]=e[t],i[1]=e[t+1],i[2]=e[t+2],i[3]=e[t+3],i[4]=e[t+4],i[5]=e[t+5],i[6]=e[t+6],i[7]=e[t+7],r[0]}function a(e,t){return i[7]=e[t],i[6]=e[t+1],i[5]=e[t+2],i[4]=e[t+3],i[3]=e[t+4],i[2]=e[t+5],i[1]=e[t+6],i[0]=e[t+7],r[0]}s.writeDoubleLE=e?t:n,s.writeDoubleBE=e?n:t,s.readDoubleLE=e?o:a,s.readDoubleBE=e?a:o}():function(){function e(e,t,n,r,i,o){var a=r<0?1:0;if(a&&(r=-r),0===r)e(0,i,o+t),e(0<1/r?0:2147483648,i,o+n);else if(isNaN(r))e(0,i,o+t),e(2146959360,i,o+n);else if(17976931348623157e292<r)e(0,i,o+t),e((a<<31|2146435072)>>>0,i,o+n);else{var s;if(r<22250738585072014e-324)e((s=r/5e-324)>>>0,i,o+t),e((a<<31|s/4294967296)>>>0,i,o+n);else{var u=Math.floor(Math.log(r)/Math.LN2);1024===u&&(u=1023),e(4503599627370496*(s=r*Math.pow(2,-u))>>>0,i,o+t),e((a<<31|u+1023<<20|1048576*s&1048575)>>>0,i,o+n)}}}function t(e,t,n,r,i){var o=e(r,i+t),a=e(r,i+n),s=2*(a>>31)+1,u=a>>>20&2047,l=4294967296*(1048575&a)+o;return 2047===u?l?NaN:s*(1/0):0===u?5e-324*s*l:s*Math.pow(2,u-1075)*(l+4503599627370496)}s.writeDoubleLE=e.bind(null,i,0,4),s.writeDoubleBE=e.bind(null,o,4,0),s.readDoubleLE=t.bind(null,a,0,4),s.readDoubleBE=t.bind(null,u,4,0)}(),s}function i(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function o(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function a(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function u(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}t.exports=r(r)},{}],5:[function(require,module,exports){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},{}],6:[function(e,t,n){"use strict";t.exports=function(n,r,e){var i=e||8192,o=i>>>1,a=null,s=i;return function(e){if(e<1||o<e)return n(e);i<s+e&&(a=n(i),s=0);var t=r.call(a,s,s+=e);return 7&s&&(s=1+(7|s)),t}}},{}],7:[function(e,t,n){"use strict";var r=n;r.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},r.read=function(e,t,n){if(n-t<1)return"";for(var r,i=null,o=[],a=0;t<n;)(r=e[t++])<128?o[a++]=r:191<r&&r<224?o[a++]=(31&r)<<6|63&e[t++]:239<r&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[a++]=55296+(r>>10),o[a++]=56320+(1023&r)):o[a++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],8191<a&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))},r.write=function(e,t,n){for(var r,i,o=n,a=0;a<e.length;++a)(r=e.charCodeAt(a))<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(a+1)))?(r=65536+((1023&r)<<10)+(1023&i),++a,t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128);return n-o}},{}],8:[function(e,t,n){"use strict";var r,i,o,a=e("protobufjs/minimal"),s=a.Reader,u=a.util,l=a.roots.default||(a.roots.default={});l.tensorflow=((o={}).Any=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.typeUrl="",e.prototype.value=u.newBuffer([]),e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.Any;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.typeUrl=e.string();break;case 2:r.value=e.bytes();break;default:e.skipType(7&i)}}return r},e}(),o.DataType=(r={},(i=Object.create(r))[r[0]="DT_INVALID"]=0,i[r[1]="DT_FLOAT"]=1,i[r[2]="DT_DOUBLE"]=2,i[r[3]="DT_INT32"]=3,i[r[4]="DT_UINT8"]=4,i[r[5]="DT_INT16"]=5,i[r[6]="DT_INT8"]=6,i[r[7]="DT_STRING"]=7,i[r[8]="DT_COMPLEX64"]=8,i[r[9]="DT_INT64"]=9,i[r[10]="DT_BOOL"]=10,i[r[11]="DT_QINT8"]=11,i[r[12]="DT_QUINT8"]=12,i[r[13]="DT_QINT32"]=13,i[r[14]="DT_BFLOAT16"]=14,i[r[101]="DT_FLOAT_REF"]=101,i[r[102]="DT_DOUBLE_REF"]=102,i[r[103]="DT_INT32_REF"]=103,i[r[104]="DT_UINT8_REF"]=104,i[r[105]="DT_INT16_REF"]=105,i[r[106]="DT_INT8_REF"]=106,i[r[107]="DT_STRING_REF"]=107,i[r[108]="DT_COMPLEX64_REF"]=108,i[r[109]="DT_INT64_REF"]=109,i[r[110]="DT_BOOL_REF"]=110,i[r[111]="DT_QINT8_REF"]=111,i[r[112]="DT_QUINT8_REF"]=112,i[r[113]="DT_QINT32_REF"]=113,i[r[114]="DT_BFLOAT16_REF"]=114,i),o.TensorShape=function(){function e(e){if(this.dim=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.dim=u.emptyArray,e.prototype.unknownRank=!1,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.TensorShape;e.pos<n;){var i=e.uint32();switch(i>>>3){case 2:r.dim&&r.dim.length||(r.dim=[]),r.dim.push(l.tensorflow.TensorShape.Dim.decode(e,e.uint32()));break;case 3:r.unknownRank=e.bool();break;default:e.skipType(7&i)}}return r},e.Dim=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.size=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.name="",e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.TensorShape.Dim;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.size=e.int64();break;case 2:r.name=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),o.Tensor=function(){function e(e){if(this.floatVal=[],this.doubleVal=[],this.intVal=[],this.stringVal=[],this.scomplexVal=[],this.int64Val=[],this.boolVal=[],this.uint32Val=[],this.uint64Val=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.dtype=0,e.prototype.tensorShape=null,e.prototype.versionNumber=0,e.prototype.tensorContent=u.newBuffer([]),e.prototype.floatVal=u.emptyArray,e.prototype.doubleVal=u.emptyArray,e.prototype.intVal=u.emptyArray,e.prototype.stringVal=u.emptyArray,e.prototype.scomplexVal=u.emptyArray,e.prototype.int64Val=u.emptyArray,e.prototype.boolVal=u.emptyArray,e.prototype.uint32Val=u.emptyArray,e.prototype.uint64Val=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.Tensor;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.dtype=e.int32();break;case 2:r.tensorShape=l.tensorflow.TensorShape.decode(e,e.uint32());break;case 3:r.versionNumber=e.int32();break;case 4:r.tensorContent=e.bytes();break;case 5:if(r.floatVal&&r.floatVal.length||(r.floatVal=[]),2==(7&i))for(var o=e.uint32()+e.pos;e.pos<o;)r.floatVal.push(e.float());else r.floatVal.push(e.float());break;case 6:if(r.doubleVal&&r.doubleVal.length||(r.doubleVal=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.doubleVal.push(e.double());else r.doubleVal.push(e.double());break;case 7:if(r.intVal&&r.intVal.length||(r.intVal=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.intVal.push(e.int32());else r.intVal.push(e.int32());break;case 8:r.stringVal&&r.stringVal.length||(r.stringVal=[]),r.stringVal.push(e.bytes());break;case 9:if(r.scomplexVal&&r.scomplexVal.length||(r.scomplexVal=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.scomplexVal.push(e.float());else r.scomplexVal.push(e.float());break;case 10:if(r.int64Val&&r.int64Val.length||(r.int64Val=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.int64Val.push(e.int64());else r.int64Val.push(e.int64());break;case 11:if(r.boolVal&&r.boolVal.length||(r.boolVal=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.boolVal.push(e.bool());else r.boolVal.push(e.bool());break;case 16:if(r.uint32Val&&r.uint32Val.length||(r.uint32Val=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.uint32Val.push(e.uint32());else r.uint32Val.push(e.uint32());break;case 17:if(r.uint64Val&&r.uint64Val.length||(r.uint64Val=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.uint64Val.push(e.uint64());else r.uint64Val.push(e.uint64());break;default:e.skipType(7&i)}}return r},e}(),o.AttrValue=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.list=null,e.prototype.s=u.newBuffer([]),e.prototype.i=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.f=0,e.prototype.b=!1,e.prototype.type=0,e.prototype.shape=null,e.prototype.tensor=null,e.prototype.placeholder="",e.prototype.func=null,Object.defineProperty(e.prototype,"value",{get:u.oneOfGetter(t=["list","s","i","f","b","type","shape","tensor","placeholder","func"]),set:u.oneOfSetter(t)}),e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.AttrValue;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.list=l.tensorflow.AttrValue.ListValue.decode(e,e.uint32());break;case 2:r.s=e.bytes();break;case 3:r.i=e.int64();break;case 4:r.f=e.float();break;case 5:r.b=e.bool();break;case 6:r.type=e.int32();break;case 7:r.shape=l.tensorflow.TensorShape.decode(e,e.uint32());break;case 8:r.tensor=l.tensorflow.Tensor.decode(e,e.uint32());break;case 9:r.placeholder=e.string();break;case 10:r.func=l.tensorflow.NameAttrList.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e.ListValue=function(){function e(e){if(this.s=[],this.i=[],this.f=[],this.b=[],this.type=[],this.shape=[],this.tensor=[],this.func=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.s=u.emptyArray,e.prototype.i=u.emptyArray,e.prototype.f=u.emptyArray,e.prototype.b=u.emptyArray,e.prototype.type=u.emptyArray,e.prototype.shape=u.emptyArray,e.prototype.tensor=u.emptyArray,e.prototype.func=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.AttrValue.ListValue;e.pos<n;){var i=e.uint32();switch(i>>>3){case 2:r.s&&r.s.length||(r.s=[]),r.s.push(e.bytes());break;case 3:if(r.i&&r.i.length||(r.i=[]),2==(7&i))for(var o=e.uint32()+e.pos;e.pos<o;)r.i.push(e.int64());else r.i.push(e.int64());break;case 4:if(r.f&&r.f.length||(r.f=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.f.push(e.float());else r.f.push(e.float());break;case 5:if(r.b&&r.b.length||(r.b=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.b.push(e.bool());else r.b.push(e.bool());break;case 6:if(r.type&&r.type.length||(r.type=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)r.type.push(e.int32());else r.type.push(e.int32());break;case 7:r.shape&&r.shape.length||(r.shape=[]),r.shape.push(l.tensorflow.TensorShape.decode(e,e.uint32()));break;case 8:r.tensor&&r.tensor.length||(r.tensor=[]),r.tensor.push(l.tensorflow.Tensor.decode(e,e.uint32()));break;case 9:r.func&&r.func.length||(r.func=[]),r.func.push(l.tensorflow.NameAttrList.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e}(),e}(),o.NameAttrList=function(){function e(e){if(this.attr={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.name="",e.prototype.attr=u.emptyObject,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n,r=void 0===t?e.len:e.pos+t,i=new l.tensorflow.NameAttrList;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:i.name=e.string();break;case 2:e.skip().pos++,i.attr===u.emptyObject&&(i.attr={}),n=e.string(),e.pos++,i.attr[n]=l.tensorflow.AttrValue.decode(e,e.uint32());break;default:e.skipType(7&o)}}return i},e}(),o.NodeDef=function(){function e(e){if(this.input=[],this.attr={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.name="",e.prototype.op="",e.prototype.input=u.emptyArray,e.prototype.device="",e.prototype.attr=u.emptyObject,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n,r=void 0===t?e.len:e.pos+t,i=new l.tensorflow.NodeDef;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:i.name=e.string();break;case 2:i.op=e.string();break;case 3:i.input&&i.input.length||(i.input=[]),i.input.push(e.string());break;case 4:i.device=e.string();break;case 5:e.skip().pos++,i.attr===u.emptyObject&&(i.attr={}),n=e.string(),e.pos++,i.attr[n]=l.tensorflow.AttrValue.decode(e,e.uint32());break;default:e.skipType(7&o)}}return i},e}(),o.VersionDef=function(){function e(e){if(this.badConsumers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.producer=0,e.prototype.minConsumer=0,e.prototype.badConsumers=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.VersionDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.producer=e.int32();break;case 2:r.minConsumer=e.int32();break;case 3:if(r.badConsumers&&r.badConsumers.length||(r.badConsumers=[]),2==(7&i))for(var o=e.uint32()+e.pos;e.pos<o;)r.badConsumers.push(e.int32());else r.badConsumers.push(e.int32());break;default:e.skipType(7&i)}}return r},e}(),o.GraphDef=function(){function e(e){if(this.node=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.node=u.emptyArray,e.prototype.versions=null,e.prototype.library=null,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.GraphDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.node&&r.node.length||(r.node=[]),r.node.push(l.tensorflow.NodeDef.decode(e,e.uint32()));break;case 4:r.versions=l.tensorflow.VersionDef.decode(e,e.uint32());break;case 2:r.library=l.tensorflow.FunctionDefLibrary.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e}(),o.CollectionDef=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.nodeList=null,e.prototype.bytesList=null,e.prototype.int64List=null,e.prototype.floatList=null,e.prototype.anyList=null,Object.defineProperty(e.prototype,"kind",{get:u.oneOfGetter(t=["nodeList","bytesList","int64List","floatList","anyList"]),set:u.oneOfSetter(t)}),e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.CollectionDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.nodeList=l.tensorflow.CollectionDef.NodeList.decode(e,e.uint32());break;case 2:r.bytesList=l.tensorflow.CollectionDef.BytesList.decode(e,e.uint32());break;case 3:r.int64List=l.tensorflow.CollectionDef.Int64List.decode(e,e.uint32());break;case 4:r.floatList=l.tensorflow.CollectionDef.FloatList.decode(e,e.uint32());break;case 5:r.anyList=l.tensorflow.CollectionDef.AnyList.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e.NodeList=function(){function e(e){if(this.value=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.value=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.CollectionDef.NodeList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.value&&r.value.length||(r.value=[]),r.value.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),e.BytesList=function(){function e(e){if(this.value=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.value=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.CollectionDef.BytesList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.value&&r.value.length||(r.value=[]),r.value.push(e.bytes());break;default:e.skipType(7&i)}}return r},e}(),e.Int64List=function(){function e(e){if(this.value=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.value=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.CollectionDef.Int64List;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:if(r.value&&r.value.length||(r.value=[]),2==(7&i))for(var o=e.uint32()+e.pos;e.pos<o;)r.value.push(e.int64());else r.value.push(e.int64());break;default:e.skipType(7&i)}}return r},e}(),e.FloatList=function(){function e(e){if(this.value=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.value=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.CollectionDef.FloatList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:if(r.value&&r.value.length||(r.value=[]),2==(7&i))for(var o=e.uint32()+e.pos;e.pos<o;)r.value.push(e.float());else r.value.push(e.float());break;default:e.skipType(7&i)}}return r},e}(),e.AnyList=function(){function e(e){if(this.value=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.value=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.CollectionDef.AnyList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.value&&r.value.length||(r.value=[]),r.value.push(l.tensorflow.Any.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e}(),e}(),o.SaverDef=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t,n;return e.prototype.filenameTensorName="",e.prototype.saveTensorName="",e.prototype.restoreOpName="",e.prototype.maxToKeep=0,e.prototype.sharded=!1,e.prototype.keepCheckpointEveryNHours=0,e.prototype.version=0,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.SaverDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.filenameTensorName=e.string();break;case 2:r.saveTensorName=e.string();break;case 3:r.restoreOpName=e.string();break;case 4:r.maxToKeep=e.int32();break;case 5:r.sharded=e.bool();break;case 6:r.keepCheckpointEveryNHours=e.float();break;case 7:r.version=e.int32();break;default:e.skipType(7&i)}}return r},e.CheckpointFormatVersion=(t={},(n=Object.create(t))[t[0]="LEGACY"]=0,n[t[1]="V1"]=1,n[t[2]="V2"]=2,n),e}(),o.TensorInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.name="",e.prototype.cooSparse=null,e.prototype.dtype=0,e.prototype.tensorShape=null,Object.defineProperty(e.prototype,"encoding",{get:u.oneOfGetter(t=["name","cooSparse"]),set:u.oneOfSetter(t)}),e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.TensorInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.name=e.string();break;case 4:r.cooSparse=l.tensorflow.TensorInfo.CooSparse.decode(e,e.uint32());break;case 2:r.dtype=e.int32();break;case 3:r.tensorShape=l.tensorflow.TensorShape.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e.CooSparse=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.valuesTensorName="",e.prototype.indicesTensorName="",e.prototype.denseShapeTensorName="",e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.TensorInfo.CooSparse;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.valuesTensorName=e.string();break;case 2:r.indicesTensorName=e.string();break;case 3:r.denseShapeTensorName=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),o.SignatureDef=function(){function e(e){if(this.inputs={},this.outputs={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.inputs=u.emptyObject,e.prototype.outputs=u.emptyObject,e.prototype.methodName="",e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n,r=void 0===t?e.len:e.pos+t,i=new l.tensorflow.SignatureDef;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:e.skip().pos++,i.inputs===u.emptyObject&&(i.inputs={}),n=e.string(),e.pos++,i.inputs[n]=l.tensorflow.TensorInfo.decode(e,e.uint32());break;case 2:e.skip().pos++,i.outputs===u.emptyObject&&(i.outputs={}),n=e.string(),e.pos++,i.outputs[n]=l.tensorflow.TensorInfo.decode(e,e.uint32());break;case 3:i.methodName=e.string();break;default:e.skipType(7&o)}}return i},e}(),o.AssetFileDef=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.tensorInfo=null,e.prototype.filename="",e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.AssetFileDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.tensorInfo=l.tensorflow.TensorInfo.decode(e,e.uint32());break;case 2:r.filename=e.string();break;default:e.skipType(7&i)}}return r},e}(),o.OpDef=function(){function e(e){if(this.inputArg=[],this.outputArg=[],this.attr=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.name="",e.prototype.inputArg=u.emptyArray,e.prototype.outputArg=u.emptyArray,e.prototype.attr=u.emptyArray,e.prototype.deprecation=null,e.prototype.summary="",e.prototype.description="",e.prototype.isCommutative=!1,e.prototype.isAggregate=!1,e.prototype.isStateful=!1,e.prototype.allowsUninitializedInput=!1,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.OpDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.name=e.string();break;case 2:r.inputArg&&r.inputArg.length||(r.inputArg=[]),r.inputArg.push(l.tensorflow.OpDef.ArgDef.decode(e,e.uint32()));break;case 3:r.outputArg&&r.outputArg.length||(r.outputArg=[]),r.outputArg.push(l.tensorflow.OpDef.ArgDef.decode(e,e.uint32()));break;case 4:r.attr&&r.attr.length||(r.attr=[]),r.attr.push(l.tensorflow.OpDef.AttrDef.decode(e,e.uint32()));break;case 8:r.deprecation=l.tensorflow.OpDef.OpDeprecation.decode(e,e.uint32());break;case 5:r.summary=e.string();break;case 6:r.description=e.string();break;case 18:r.isCommutative=e.bool();break;case 16:r.isAggregate=e.bool();break;case 17:r.isStateful=e.bool();break;case 19:r.allowsUninitializedInput=e.bool();break;default:e.skipType(7&i)}}return r},e.ArgDef=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.name="",e.prototype.description="",e.prototype.type=0,e.prototype.typeAttr="",e.prototype.numberAttr="",e.prototype.typeListAttr="",e.prototype.isRef=!1,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.OpDef.ArgDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.name=e.string();break;case 2:r.description=e.string();break;case 3:r.type=e.int32();break;case 4:r.typeAttr=e.string();break;case 5:r.numberAttr=e.string();break;case 6:r.typeListAttr=e.string();break;case 16:r.isRef=e.bool();break;default:e.skipType(7&i)}}return r},e}(),e.AttrDef=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.name="",e.prototype.type="",e.prototype.defaultValue=null,e.prototype.description="",e.prototype.hasMinimum=!1,e.prototype.minimum=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.allowedValues=null,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.OpDef.AttrDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.name=e.string();break;case 2:r.type=e.string();break;case 3:r.defaultValue=l.tensorflow.AttrValue.decode(e,e.uint32());break;case 4:r.description=e.string();break;case 5:r.hasMinimum=e.bool();break;case 6:r.minimum=e.int64();break;case 7:r.allowedValues=l.tensorflow.AttrValue.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e}(),e.OpDeprecation=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.version=0,e.prototype.explanation="",e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.OpDef.OpDeprecation;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.version=e.int32();break;case 2:r.explanation=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),o.OpList=function(){function e(e){if(this.op=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.op=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.OpList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.op&&r.op.length||(r.op=[]),r.op.push(l.tensorflow.OpDef.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e}(),o.MetaGraphDef=function(){function e(e){if(this.collectionDef={},this.signatureDef={},this.assetFileDef=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.metaInfoDef=null,e.prototype.graphDef=null,e.prototype.saverDef=null,e.prototype.collectionDef=u.emptyObject,e.prototype.signatureDef=u.emptyObject,e.prototype.assetFileDef=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n,r=void 0===t?e.len:e.pos+t,i=new l.tensorflow.MetaGraphDef;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:i.metaInfoDef=l.tensorflow.MetaGraphDef.MetaInfoDef.decode(e,e.uint32());break;case 2:i.graphDef=l.tensorflow.GraphDef.decode(e,e.uint32());break;case 3:i.saverDef=l.tensorflow.SaverDef.decode(e,e.uint32());break;case 4:e.skip().pos++,i.collectionDef===u.emptyObject&&(i.collectionDef={}),n=e.string(),e.pos++,i.collectionDef[n]=l.tensorflow.CollectionDef.decode(e,e.uint32());break;case 5:e.skip().pos++,i.signatureDef===u.emptyObject&&(i.signatureDef={}),n=e.string(),e.pos++,i.signatureDef[n]=l.tensorflow.SignatureDef.decode(e,e.uint32());break;case 6:i.assetFileDef&&i.assetFileDef.length||(i.assetFileDef=[]),i.assetFileDef.push(l.tensorflow.AssetFileDef.decode(e,e.uint32()));break;default:e.skipType(7&o)}}return i},e.MetaInfoDef=function(){function e(e){if(this.tags=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.metaGraphVersion="",e.prototype.strippedOpList=null,e.prototype.anyInfo=null,e.prototype.tags=u.emptyArray,e.prototype.tensorflowVersion="",e.prototype.tensorflowGitVersion="",e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.MetaGraphDef.MetaInfoDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.metaGraphVersion=e.string();break;case 2:r.strippedOpList=l.tensorflow.OpList.decode(e,e.uint32());break;case 3:r.anyInfo=l.tensorflow.Any.decode(e,e.uint32());break;case 4:r.tags&&r.tags.length||(r.tags=[]),r.tags.push(e.string());break;case 5:r.tensorflowVersion=e.string();break;case 6:r.tensorflowGitVersion=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),o.SavedModel=function(){function e(e){if(this.metaGraphs=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.savedModelSchemaVersion=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.metaGraphs=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.SavedModel;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.savedModelSchemaVersion=e.int64();break;case 2:r.metaGraphs&&r.metaGraphs.length||(r.metaGraphs=[]),r.metaGraphs.push(l.tensorflow.MetaGraphDef.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e}(),o.FunctionDefLibrary=function(){function e(e){if(this.function=[],this.gradient=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.function=u.emptyArray,e.prototype.gradient=u.emptyArray,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.FunctionDefLibrary;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.function&&r.function.length||(r.function=[]),r.function.push(l.tensorflow.FunctionDef.decode(e,e.uint32()));break;case 2:r.gradient&&r.gradient.length||(r.gradient=[]),r.gradient.push(l.tensorflow.GradientDef.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e}(),o.FunctionDef=function(){function e(e){if(this.attr={},this.nodeDef=[],this.ret={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.signature=null,e.prototype.attr=u.emptyObject,e.prototype.nodeDef=u.emptyArray,e.prototype.ret=u.emptyObject,e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n,r=void 0===t?e.len:e.pos+t,i=new l.tensorflow.FunctionDef;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:i.signature=l.tensorflow.OpDef.decode(e,e.uint32());break;case 5:e.skip().pos++,i.attr===u.emptyObject&&(i.attr={}),n=e.string(),e.pos++,i.attr[n]=l.tensorflow.AttrValue.decode(e,e.uint32());break;case 3:i.nodeDef&&i.nodeDef.length||(i.nodeDef=[]),i.nodeDef.push(l.tensorflow.NodeDef.decode(e,e.uint32()));break;case 4:e.skip().pos++,i.ret===u.emptyObject&&(i.ret={}),n=e.string(),e.pos++,i.ret[n]=e.string();break;default:e.skipType(7&o)}}return i},e}(),o.GradientDef=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.functionName="",e.prototype.gradientFunc="",e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new l.tensorflow.GradientDef;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.functionName=e.string();break;case 2:r.gradientFunc=e.string();break;default:e.skipType(7&i)}}return r},e}(),o),t.exports=l},{"protobufjs/minimal":48}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){this.weightMap=e,this.tensorArrayMap=t,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return e.prototype.newFrame=function(e,t){return{id:e,frameName:t,iterationId:0}},Object.defineProperty(e.prototype,"currentContext",{get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),e.prototype.generateCurrentContextIds=function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e},e.prototype.contextIdforContexts=function(e){return e?e.map(function(e){return 0===e.id&&0===e.iterationId?"":e.frameName+"-"+e.iterationId}).join("/"):""},e.prototype.enterFrame=function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},e.prototype.exitFrame=function(){if(!(this.contexts&&1<this.contexts.length))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},e.prototype.nextIteration=function(){if(!(this.contexts&&0<this.contexts.length))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},e.prototype.getWeight=function(e){return this.weightMap[e]},e.prototype.addTensorArray=function(e){this.tensorArrayMap[e.id]=e},e.prototype.getTensorArray=function(e){return this.tensorArrayMap[e]},e}();n.ExecutionContext=r},{}],10:[function(e,t,n){"use strict";var o=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},a=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("@tensorflow/tfjs-core"),i=e("../data/compiled_api"),u=e("../operations/operation_mapper"),l=e("./graph_executor"),c=function(){function e(e,t,n){this.modelUrl=e,this.weightManifestUrl=t,this.requestOption=n,this.version="n/a"}return Object.defineProperty(e.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),e.prototype.findIOHandler=function(){var e=[this.modelUrl,this.weightManifestUrl];if(this.requestOption)this.handler=s.io.browserHTTPRequest(e,this.requestOption);else{var t=s.io.getLoadHandlers(e);if(0===t.length)t.push(s.io.browserHTTPRequest(e,this.requestOption));else if(1<t.length)throw new Error("Found more than one ("+t.length+") load handlers for URL '"+[e]+"'");this.handler=t[0]}},e.prototype.load=function(){return o(this,void 0,void 0,function(){var t,n,r;return a(this,function(e){switch(e.label){case 0:if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,this.handler.load()];case 1:return t=e.sent(),n=i.tensorflow.GraphDef.decode(new Uint8Array(t.modelTopology)),this.version=n.versions.producer+"."+n.versions.minConsumer,r=s.io.decodeWeights(t.weightData,t.weightSpecs),this.executor=new l.GraphExecutor(u.OperationMapper.Instance.transformGraph(n)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),[2,!0]}})})},e.prototype.predict=function(e,t){return this.execute(e,this.outputNodes)},e.prototype.constructTensorMap=function(e){var r=e instanceof s.Tensor?[e]:e;if(r.length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the frozen model has "+this.inputNodes.length+" placeholders, while there are "+r.length+" input tensors.");return this.inputNodes.reduce(function(e,t,n){return e[t]=r[n],e},{})},e.prototype.execute=function(e,t){if(t=t||this.outputNodes,(e instanceof s.Tensor||Array.isArray(e))&&(e=this.constructTensorMap(e)),this.executor.isControlFlowModel||this.executor.isDynamicShapeModel)throw new Error("The model contains control flow or dynamic shape ops, please use executeAsync method");var n=this.executor.execute(this.convertTensorMapToTensorsMap(e),t),r=Object.keys(n);return Array.isArray(t)&&1<t.length?t.map(function(e){return n[e]}):n[r[0]]},e.prototype.executeAsync=function(r,i){return o(this,void 0,void 0,function(){var t,n;return a(this,function(e){switch(e.label){case 0:if(!this.executor.isControlFlowModel&&!this.executor.isDynamicShapeModel)throw new Error("The model does not contain control flow or dynamic shape ops, please use execute method for better performance.");return i=i||this.outputNodes,(r instanceof s.Tensor||Array.isArray(r))&&(r=this.constructTensorMap(r)),[4,this.executor.executeAsync(this.convertTensorMapToTensorsMap(r),i)];case 1:return t=e.sent(),n=Object.keys(t),[2,Array.isArray(i)&&1<i.length?i.map(function(e){return t[e]}):t[n[0]]]}})})},e.prototype.convertTensorMapToTensorsMap=function(n){return Object.keys(n).reduce(function(e,t){return e[t]=[n[t]],e},{})},e.prototype.dispose=function(){this.executor.dispose()},e}();n.FrozenModel=c,n.loadFrozenModel=function(n,r,i){return o(this,void 0,void 0,function(){var t;return a(this,function(e){switch(e.label){case 0:return[4,(t=new c(n,r,i)).load()];case 1:return e.sent(),[2,t]}})})}},{"../data/compiled_api":8,"../operations/operation_mapper":46,"./graph_executor":11,"@tensorflow/tfjs-core":66}],11:[function(e,t,n){"use strict";var p=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},h=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=e("@tensorflow/tfjs-core"),f=e("../operations/executors/utils"),d=e("../operations/operation_executor"),m=e("./execution_context"),i=function(){function e(e){this.graph=e,this.compiledOrder=[],this._weightMap={},this.placeholders=e.placeholders,this._outputs=e.outputs,this.compile()}return Object.defineProperty(e.prototype,"weightMap",{get:function(){return this._weightMap},set:function(t){var e=Object.keys(t).map(function(e){return t[e].map(function(e){return e.id})});this.weightIds=[].concat.apply([],e),this._weightMap=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputs",{get:function(){return this.placeholders.map(function(e){return{name:e.name,shape:e.params.shape?e.params.shape.value:void 0,dtype:e.params.dtype?e.params.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputs",{get:function(){return this._outputs.map(function(e){return{name:e.name,shape:e.params.shape?e.params.shape.value:void 0,dtype:e.params.dtype?e.params.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputNodes",{get:function(){return this.placeholders.map(function(e){return e.name})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outputNodes",{get:function(){return this.outputs.map(function(e){return e.name})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isControlFlowModel",{get:function(){return this.graph.withControlFlow},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDynamicShapeModel",{get:function(){return this.graph.withDynamicShape},enumerable:!0,configurable:!0}),e.prototype.compile=function(){if(!this.graph.withControlFlow&&!this.graph.withDynamicShape)for(var t=this.graph.inputs.slice(),n={};0<t.length;){var e=t.pop();n[e.name]=!0,this.compiledOrder.push(e),e.children.forEach(function(e){!n[e.name]&&e.inputNames.every(function(e){var t=f.getNodeNameAndIndex(e)[0];return n[t]})&&t.push(e)})}},e.prototype.execute=function(t,r){var i=this;this.checkInput(t),this.checkInputShapeAndType(t);var o={};return a.tidy(function(){var n=new m.ExecutionContext(i._weightMap,o),e=i.compiledOrder.reduce(function(e,t){return e[t.name]=d.executeOp(t,e,n),e},p({},i.weightMap,t));return i.findOutputs(e,n,r)})},e.prototype.executeAsync=function(l,c){return r(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u=this;return h(this,function(e){switch(e.label){case 0:return this.checkInput(l),this.checkInputShapeAndType(l),t={},n=new m.ExecutionContext(this._weightMap,t),[4,this.executeWithControlFlow(l,n)];case 1:return r=e.sent(),i=this.findOutputs(r,n,c),o=Object.keys(i).map(function(e){return i[e].id}),a=Object.keys(l).map(function(e){return l[e].map(function(e){return e.id})}),s=[].concat.apply([],a),Object.keys(r).forEach(function(e){r[e].forEach(function(e){e&&-1===o.indexOf(e.id)&&-1===s.indexOf(e.id)&&-1===u.weightIds.indexOf(e.id)&&e.dispose()})}),[2,i]}})})},e.prototype.executeWithControlFlow=function(l,c){return r(this,void 0,void 0,function(){var n,r,i,t,o,a,s,u;return h(this,function(e){switch(e.label){case 0:n=this.graph.inputs.map(function(e){return{node:e,contexts:c.currentContext}}),r=p({},this.weightMap,l),i={},e.label=1;case 1:return 0<n.length?(t=n.pop(),c.currentContext=t.contexts,o="","enter"===t.node.op&&f.getParamValue("isConstant",t.node,r,c)&&(o=f.getNodeNameAndIndex(t.node.name,c)[0]),a=d.executeOp(t.node,r,c),o||(o=f.getNodeNameAndIndex(t.node.name,c)[0]),s=r,u=o,[4,a]):[3,3];case 2:return s[u]=e.sent(),t.node.children.forEach(function(e){var t=f.getNodeNameAndIndex(e.name,c)[0];i[t]||("merge"===e.op?e.inputNames.some(function(e){return!!f.getTensor(e,r,c)})&&(i[t]=!0,n.push({contexts:c.currentContext,node:e})):e.inputNames.every(function(e){return!!f.getTensor(e,r,c)})&&(i[t]=!0,n.push({contexts:c.currentContext,node:e})))}),[3,1];case 3:return[2,r]}})})},e.prototype.findOutputs=function(n,r,e){return!e||e instanceof Array||(e=[e]),(e||this.graph.outputs.map(function(e){return e.name})).reduce(function(e,t){return e[t]=f.getTensor(t,n,r),e},{})},e.prototype.dispose=function(){var t=this;Object.keys(this.weightMap).forEach(function(e){return t.weightMap[e].forEach(function(e){return e.dispose()})})},e.prototype.checkInputShapeAndType=function(i){this.placeholders.forEach(function(e){var t=i[e.name][0];if(e.params.shape&&e.params.shape.value){var n=e.params.shape.value,r=n.length===t.shape.length&&t.shape.every(function(e,t){return-1===n[t]||n[t]===e});a.util.assert(r,"The shape of dict['"+e.name+"'] provided in model.execute(dict) must be ["+n+"], but was ["+t.shape+"]")}e.params.dtype&&e.params.dtype.value&&a.util.assert(t.dtype===e.params.dtype.value,"The dtype of dict['"+e.name+"'] provided in model.execute(dict) must be "+e.params.dtype.value+", but was "+t.dtype)})},e.prototype.checkInput=function(e){var t=this,n=Object.keys(e),r=[],i=[];if(this.inputNodes.forEach(function(e){-1===n.indexOf(e)&&r.push(e)}),n.forEach(function(e){-1===t.inputNodes.indexOf(e)&&i.push(e)}),0<r.length)throw new Error("The dict provided in model.execute(dict) has the keys ["+n+"], but is missing the required keys: ["+r+"].");if(0<i.length)throw new Error("The dict provided in model.execute(dict) has unused keys: ["+i+"]. Please provide only the following keys: ["+this.inputNodes+"].")},e}();n.GraphExecutor=i},{"../operations/executors/utils":29,"../operations/operation_executor":45,"./execution_context":9,"@tensorflow/tfjs-core":66}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var c=e("@tensorflow/tfjs-core"),r=function(){function s(e,t,n,r,i,o,a){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=a,this.tensors=[],this.closed_=!1,this.id=s.nextId++}return Object.defineProperty(s.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),s.prototype.clearAndClose=function(){this.tensors.forEach(function(e){return e.tensor.dispose()}),this.tensors=[],this.closed_=!0},s.prototype.size=function(){return this.tensors.length},s.prototype.read=function(e){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||e>=this.tensors.length)throw new Error("Tried to read from index "+e+", but array size is: "+this.tensors.length);var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+e+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor},s.prototype.readMany=function(e){var t=this;return e.map(function(e){return t.read(e)})},s.prototype.write=function(e,t){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index "+e+", but array is not resizeable and size is: "+this.maxSize);var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+",\n          because the value dtype is "+t.dtype+", but TensorArray dtype is "+this.dtype+".");if(0===this.size()&&0===this.elementShape.length&&(this.elementShape=t.shape),c.util.assertShapesMatch(this.elementShape,t.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+e+"."),n&&n.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been read.");if(n&&n.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been written.");n.tensor=t,n.written=!0,this.tensors[e]=n},s.prototype.writeMany=function(e,n){var r=this;if(e.length!==n.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+e.length+" is not the same as tensors size: "+n.length+".");e.forEach(function(e,t){return r.write(e,n[t])})},s.prototype.gather=function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+t);if(!e){e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return c.tensor([],[0].concat(this.elementShape));var r=this.readMany(e);return c.util.assertShapesMatch(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),c.stack(r,0)},s.prototype.concat=function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+e);if(0===this.size())return c.tensor([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return c.util.assertShapesMatch(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+r[0].shape+")"),c.concat(r,0)},s.prototype.scatter=function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+e.length+" vs. "+t.shape[0]);var n=Math.max.apply(Math,e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size ("+n+"  vs. "+this.maxSize+")");this.writeMany(e,c.unstack(t,0))},s.prototype.split=function(r,i){var o=this;if(i.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+i.dtype);var a=0,s=r.map(function(e){return a+=e});if(a!==i.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        "+a+", and tensor's shape is: "+i.shape);if(!this.dynamicSize&&r.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+r.length+"), and the TensorArray is not marked as dynamically resizeable");var u=0===a?0:i.size/a,l=[];c.tidy(function(){i=i.reshape([1,a,u]);for(var e=0;e<r.length;++e){var t=[0,0===e?0:s[e-1],0],n=[1,r[e],u];l[e]=c.slice(i,t,n).reshape(o.elementShape)}return l});for(var e=[],t=0;t<r.length;t++)e[t]=t;this.writeMany(e,l)},s.nextId=0,s}();n.TensorArray=r},{"@tensorflow/tfjs-core":66}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./executor/frozen_model");n.FrozenModel=r.FrozenModel,n.loadFrozenModel=r.loadFrozenModel;var i=e("./version");n.version_converter=i.version},{"./executor/frozen_model":10,"./version":47}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"add":return[r.add(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"addN":return[r.addN(i.getParamValue("tensors",e,t,n))];case"mod":return[r.mod(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"mul":return[r.mul(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"div":return[r.div(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"floorDiv":return[r.floorDiv(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"sub":return[r.sub(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"minimum":return[r.minimum(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"maximum":return[r.maximum(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"pow":return[r.pow(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"squaredDifference":return[r.squaredDifference(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="arithmetic"},{"./utils":29,"@tensorflow/tfjs-core":66}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"abs":return[r.abs(i.getParamValue("x",e,t,n))];case"acos":return[r.acos(i.getParamValue("x",e,t,n))];case"acosh":return[r.acosh(i.getParamValue("x",e,t,n))];case"asin":return[r.asin(i.getParamValue("x",e,t,n))];case"asinh":return[r.asinh(i.getParamValue("x",e,t,n))];case"atan":return[r.atan(i.getParamValue("x",e,t,n))];case"atanh":return[r.atanh(i.getParamValue("x",e,t,n))];case"ceil":return[r.ceil(i.getParamValue("x",e,t,n))];case"cos":return[r.cos(i.getParamValue("x",e,t,n))];case"cosh":return[r.cosh(i.getParamValue("x",e,t,n))];case"elu":return[r.elu(i.getParamValue("x",e,t,n))];case"erf":return[r.erf(i.getParamValue("x",e,t,n))];case"exp":return[r.exp(i.getParamValue("x",e,t,n))];case"expm1":return[r.expm1(i.getParamValue("x",e,t,n))];case"floor":return[r.floor(i.getParamValue("x",e,t,n))];case"log":return[r.log(i.getParamValue("x",e,t,n))];case"log1p":return[r.log1p(i.getParamValue("x",e,t,n))];case"neg":return[r.neg(i.getParamValue("x",e,t,n))];case"reciprocal":return[r.reciprocal(i.getParamValue("x",e,t,n))];case"relu":return[r.relu(i.getParamValue("x",e,t,n))];case"round":return[r.round(i.getParamValue("x",e,t,n))];case"selu":return[r.selu(i.getParamValue("x",e,t,n))];case"sigmoid":return[r.sigmoid(i.getParamValue("x",e,t,n))];case"sin":return[r.sin(i.getParamValue("x",e,t,n))];case"sign":return[r.sign(i.getParamValue("x",e,t,n))];case"sinh":return[r.sinh(i.getParamValue("x",e,t,n))];case"softplus":return[r.softplus(i.getParamValue("x",e,t,n))];case"sqrt":return[r.sqrt(i.getParamValue("x",e,t,n))];case"square":return[r.square(i.getParamValue("x",e,t,n))];case"tanh":return[r.tanh(i.getParamValue("x",e,t,n))];case"tan":return[r.tan(i.getParamValue("x",e,t,n))];case"clipByValue":return[r.clipByValue(i.getParamValue("x",e,t,n),i.getParamValue("clipValueMin",e,t,n),i.getParamValue("clipValueMax",e,t,n))];case"rsqrt":return[r.div(r.scalar(1,"float32"),r.sqrt(i.getTensor(e.inputNames[0],t,n)))];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="basic_math"},{"./utils":29,"@tensorflow/tfjs-core":66}],16:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},q=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var V=e("@tensorflow/tfjs-core"),j=e("../../executor/tensor_array"),B=e("./utils");n.executeOp=function(D,L,F){return r(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,l,c,p,h,f,d,m,y,g,v,b,_,w,S,x,T,P,N,A,O,k,E,I,M,C,R,z;return q(this,function(e){switch(e.label){case 0:switch(D.op){case"loopCond":return[3,1];case"switch":return[3,2];case"merge":return[3,4];case"enter":return[3,5];case"exit":return[3,6];case"nextIteration":return[3,7];case"tensorArray":return[3,8];case"tensorArrayWrite":return[3,9];case"tensorArrayRead":return[3,10];case"tensorArrayGather":return[3,11];case"tensorArrayScatter":return[3,12];case"tensorArrayConcat":return[3,13];case"tensorArraySplit":return[3,14];case"tensorArraySize":return[3,15];case"tensorArrayClose":return[3,16]}return[3,17];case 1:return[2,[B.getParamValue("pred",D,L,F)]];case 2:return t=B.getParamValue("pred",D,L,F),n=B.getParamValue("data",D,L,F),[4,t.data()];case 3:return[2,e.sent()[0]?[void 0,n]:[n,void 0]];case 4:return[2,(r=D.inputNames.find(function(e){return void 0!==B.getTensor(e,L,F)}))?[B.getTensor(r,L,F)]:void 0];case 5:return i=B.getParamValue("frameName",D,L,F),o=B.getParamValue("tensor",D,L,F),F.enterFrame(i),[2,[o]];case 6:return a=B.getParamValue("tensor",D,L,F),F.exitFrame(),[2,[a]];case 7:return s=B.getParamValue("tensor",D,L,F),F.nextIteration(),[2,[s]];case 8:return u=B.getParamValue("size",D,L,F),l=B.getParamValue("dtype",D,L,F),c=B.getParamValue("elementShape",D,L,F),p=B.getParamValue("dynamicSize",D,L,F),h=B.getParamValue("clearAfterRead",D,L,F),f=B.getParamValue("identicalElementShapes",D,L,F),d=B.getParamValue("name",D,L,F),m=new j.TensorArray(d,l,u,c,f,p,h),F.addTensorArray(m),[2,[V.scalar(m.id),V.scalar(1)]];case 9:return y=B.getParamValue("tensorArrayId",D,L,F),g=B.getParamValue("index",D,L,F),v=B.getParamValue("tensor",D,L,F),F.getTensorArray(y).write(g,v),[2,[V.scalar(1)]];case 10:return b=B.getParamValue("tensorArrayId",D,L,F),_=B.getParamValue("index",D,L,F),[2,[F.getTensorArray(b).read(_)]];case 11:return w=B.getParamValue("tensorArrayId",D,L,F),S=B.getParamValue("indices",D,L,F),x=B.getParamValue("dtype",D,L,F),[2,[F.getTensorArray(w).gather(S,x)]];case 12:return T=B.getParamValue("tensorArrayId",D,L,F),P=B.getParamValue("indices",D,L,F),N=B.getParamValue("tensor",D,L,F),F.getTensorArray(T).scatter(P,N),[2,[V.scalar(1)]];case 13:return A=B.getParamValue("tensorArrayId",D,L,F),O=F.getTensorArray(A),k=B.getParamValue("dtype",D,L,F),[2,[O.concat(k)]];case 14:return E=B.getParamValue("tensorArrayId",D,L,F),I=B.getParamValue("tensor",D,L,F),M=B.getParamValue("lengths",D,L,F),F.getTensorArray(E).split(M,I),[2,[V.scalar(1)]];case 15:return C=B.getParamValue("tensorArrayId",D,L,F),R=F.getTensorArray(C),[2,[V.scalar(R.size(),"int32")]];case 16:return z=B.getParamValue("tensorArrayId",D,L,F),F.getTensorArray(z).clearAndClose(),[2,[]];case 17:throw TypeError("Node type "+D.op+" is not implemented")}})})},n.CATEGORY="control"},{"../../executor/tensor_array":12,"./utils":29,"@tensorflow/tfjs-core":66}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var c=e("@tensorflow/tfjs-core"),p=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"conv1d":var r=p.getParamValue("stride",e,t,n),i=p.getParamValue("pad",e,t,n),o=p.getParamValue("dataFormat",e,t,n).toUpperCase(),a=p.getParamValue("dilation",e,t,n);return[c.conv1d(p.getParamValue("x",e,t,n),p.getParamValue("filter",e,t,n),r,i,o,a)];case"conv2d":r=p.getParamValue("strides",e,t,n),i=p.getParamValue("pad",e,t,n),o=p.getParamValue("dataFormat",e,t,n).toUpperCase();var s=p.getParamValue("dilations",e,t,n);return[c.conv2d(p.getParamValue("x",e,t,n),p.getParamValue("filter",e,t,n),[r[1],r[2]],i,o,[s[0],s[1]])];case"conv2dTranspose":var u=p.getParamValue("outputShape",e,t,n);r=p.getParamValue("strides",e,t,n),i=p.getParamValue("pad",e,t,n);return[c.conv2dTranspose(p.getParamValue("x",e,t,n),p.getParamValue("filter",e,t,n),u,[r[1],r[2]],i)];case"depthwiseConv2d":r=p.getParamValue("strides",e,t,n),i=p.getParamValue("pad",e,t,n),s=p.getParamValue("dilations",e,t,n),o=p.getParamValue("dataFormat",e,t,n).toUpperCase();return[c.depthwiseConv2d(p.getParamValue("input",e,t,n),p.getParamValue("filter",e,t,n),[r[1],r[2]],i,o,[s[0],s[1]])];case"avgPool":r=p.getParamValue("strides",e,t,n),i=p.getParamValue("pad",e,t,n);var l=p.getParamValue("kernelSize",e,t,n);return[c.avgPool(p.getParamValue("x",e,t,n),[l[1],l[2]],[r[1],r[2]],i)];case"maxPool":r=p.getParamValue("strides",e,t,n),i=p.getParamValue("pad",e,t,n),l=p.getParamValue("kernelSize",e,t,n);return[c.maxPool(p.getParamValue("x",e,t,n),[l[1],l[2]],[r[1],r[2]],i)];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="convolution"},{"./utils":29,"@tensorflow/tfjs-core":66}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var v=e("@tensorflow/tfjs-core"),b=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"fill":var r=b.getParamValue("shape",e,t,n),i=b.getParamValue("dtype",e,t,n),o=b.getParamValue("value",e,t,n);return[v.fill(r,o,i)];case"linspace":var a=b.getParamValue("start",e,t,n),s=b.getParamValue("stop",e,t,n),u=b.getParamValue("num",e,t,n);return[v.linspace(a,s,u)];case"oneHot":var l=b.getParamValue("indices",e,t,n),c=b.getParamValue("depth",e,t,n),p=b.getParamValue("onValue",e,t,n),h=b.getParamValue("offValue",e,t,n);return[v.oneHot(l,c,p,h)];case"ones":return[v.ones(b.getParamValue("shape",e,t,n),b.getParamValue("dtype",e,t,n))];case"onesLike":return[v.onesLike(b.getParamValue("x",e,t,n))];case"randomUniform":return[v.randomUniform(b.getParamValue("shape",e,t,n),b.getParamValue("minval",e,t,n),b.getParamValue("maxval",e,t,n),b.getParamValue("dtype",e,t,n))];case"range":a=b.getParamValue("start",e,t,n);var f=b.getParamValue("stop",e,t,n),d=b.getParamValue("step",e,t,n);return[v.range(a,f,d,b.getParamValue("dtype",e,t,n))];case"truncatedNormal":r=b.getParamValue("shape",e,t,n);var m=b.getParamValue("mean",e,t,n),y=b.getParamValue("stdDev",e,t,n),g=b.getParamValue("seed",e,t,n);return[v.truncatedNormal(r,m,y,b.getParamValue("dtype",e,t,n),g)];case"zeros":return[v.zeros(b.getParamValue("shape",e,t,n),b.getParamValue("dtype",e,t,n))];case"zerosLike":return[v.zerosLike(b.getParamValue("x",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="creation"},{"./utils":29,"@tensorflow/tfjs-core":66}],19:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},l=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var c=e("@tensorflow/tfjs-core"),p=e("./utils");n.executeOp=function(a,s,u){return r(this,void 0,void 0,function(){var t,n,r,i,o;return l(this,function(e){switch(e.label){case 0:switch(a.op){case"nonMaxSuppression":return[3,1];case"whereAsync":return[3,3]}return[3,5];case 1:return t=p.getParamValue("boxes",a,s,u),n=p.getParamValue("scores",a,s,u),r=p.getParamValue("maxOutputSize",a,s,u),i=p.getParamValue("iouThreshold",a,s,u),o=p.getParamValue("scoreThreshold",a,s,u),[4,c.image.nonMaxSuppressionAsync(t,n,r,i,o)];case 2:return[2,[e.sent()]];case 3:return[4,c.whereAsync(p.getParamValue("condition",a,s,u))];case 4:return[2,[e.sent()]];case 5:throw TypeError("Node type "+a.op+" is not implemented")}})})},n.CATEGORY="dynamic"},{"./utils":29,"@tensorflow/tfjs-core":66}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var s=e("@tensorflow/tfjs-core"),u=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"topK":var r=u.getParamValue("x",e,t,n),i=u.getParamValue("k",e,t,n),o=u.getParamValue("sorted",e,t,n),a=s.topk(r,i,o);return[a.values,a.indices];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="evaluation"},{"./utils":29,"@tensorflow/tfjs-core":66}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var l=e("@tensorflow/tfjs-core"),c=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"const":return t[e.name];case"placeholder":var r=c.getParamValue("default",e,t,n);return[c.getTensor(e.name,t,n)||r];case"identity":case"stopGradient":case"fakeQuantWithMinMaxVars":return[c.getParamValue("x",e,t,n)];case"snapshot":return[c.getParamValue("x",e,t,n).clone()];case"shape":return[l.tensor1d(c.getParamValue("x",e,t,n).shape,"int32")];case"size":return[l.scalar(c.getParamValue("x",e,t,n).size,"int32")];case"rank":return[l.scalar(c.getParamValue("x",e,t,n).rank,"int32")];case"noop":return[];case"print":var i=c.getParamValue("x",e,t,n),o=c.getParamValue("data",e,t,n),a=c.getParamValue("message",e,t,n),s=c.getParamValue("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(a);for(var u=0;u<o.length;u++)console.log(Array.prototype.slice.call(o[0].dataSync()).slice(0,s));return[i];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="graph"},{"./utils":29,"@tensorflow/tfjs-core":66}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("@tensorflow/tfjs-core"),s=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"resizeBilinear":var r=s.getParamValue("images",e,t,n),i=s.getParamValue("size",e,t,n),o=s.getParamValue("alignCorners",e,t,n);return[a.image.resizeBilinear(r,[i[0],i[1]],o)];case"resizeNearestNeighbor":r=s.getParamValue("images",e,t,n),i=s.getParamValue("size",e,t,n),o=s.getParamValue("alignCorners",e,t,n);return[a.image.resizeNearestNeighbor(r,[i[0],i[1]],o)];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="image"},{"./utils":29,"@tensorflow/tfjs-core":66}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"equal":return[r.equal(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"notEqual":return[r.notEqual(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"greater":return[r.greater(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"greaterEqual":return[r.greaterEqual(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"less":return[r.less(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"lessEqual":return[r.lessEqual(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"logicalAnd":return[r.logicalAnd(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"logicalNot":return[r.logicalNot(i.getParamValue("a",e,t,n))];case"logicalOr":return[r.logicalOr(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];case"where":return[r.where(i.getParamValue("condition",e,t,n),i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="logical"},{"./utils":29,"@tensorflow/tfjs-core":66}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"matMul":return[r.matMul(i.getParamValue("a",e,t,n),i.getParamValue("b",e,t,n),i.getParamValue("transposeA",e,t,n),i.getParamValue("transposeB",e,t,n))];case"transpose":return[r.transpose(i.getParamValue("x",e,t,n),i.getParamValue("perm",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="matrices"},{"./utils":29,"@tensorflow/tfjs-core":66}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"batchNormalization":return[r.batchNormalization(i.getParamValue("x",e,t,n),i.getParamValue("mean",e,t,n),i.getParamValue("variance",e,t,n),i.getParamValue("epsilon",e,t,n),i.getParamValue("scale",e,t,n),i.getParamValue("offset",e,t,n))];case"localResponseNormalization":return[r.localResponseNormalization(i.getParamValue("x",e,t,n),i.getParamValue("radius",e,t,n),i.getParamValue("bias",e,t,n),i.getParamValue("alpha",e,t,n),i.getParamValue("beta",e,t,n))];case"softmax":return[r.softmax(i.getParamValue("x",e,t,n))];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="normalization"},{"./utils":29,"@tensorflow/tfjs-core":66}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"max":var r=a.getParamValue("axis",e,t,n),i=a.getParamValue("keepDims",e,t,n);return[o.max(a.getParamValue("x",e,t,n),r,i)];case"mean":r=a.getParamValue("axis",e,t,n),i=a.getParamValue("keepDims",e,t,n);return[o.mean(a.getParamValue("x",e,t,n),r,i)];case"min":r=a.getParamValue("axis",e,t,n),i=a.getParamValue("keepDims",e,t,n);return[o.min(a.getParamValue("x",e,t,n),r,i)];case"sum":r=a.getParamValue("axis",e,t,n),i=a.getParamValue("keepDims",e,t,n);return[o.sum(a.getParamValue("x",e,t,n),r,i)];case"all":r=a.getParamValue("axis",e,t,n),i=a.getParamValue("keepDims",e,t,n);return[o.all(a.getParamValue("x",e,t,n),r,i)];case"any":r=a.getParamValue("axis",e,t,n),i=a.getParamValue("keepDims",e,t,n);return[o.any(a.getParamValue("x",e,t,n),r,i)];case"argMax":r=a.getParamValue("axis",e,t,n);return[o.argMax(a.getParamValue("x",e,t,n),r)];case"argMin":r=a.getParamValue("axis",e,t,n);return[o.argMin(a.getParamValue("x",e,t,n),r)];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="reduction"},{"./utils":29,"@tensorflow/tfjs-core":66}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var _=e("@tensorflow/tfjs-core"),w=e("./utils");n.executeOp=function(o,a,s){switch(o.op){case"concat":var e=w.getParamValue("axis",o,a,s),t=w.getParamValue("tensors",o,a,s);return[_.concat(t,e)];case"gather":e=w.getParamValue("axis",o,a,s);var n=w.getParamValue("x",o,a,s),r=w.getParamValue("indices",o,a,s);return[_.gather(n,r,e)];case"reverse":e=w.getParamValue("axis",o,a,s),n=w.getParamValue("x",o,a,s);return[_.reverse(n,e)];case"slice":var i=w.getParamValue("begin",o,a,s),u=w.getParamValue("size",o,a,s);return[_.slice(w.getParamValue("x",o,a,s),i,u)];case"stridedSlice":i=w.getParamValue("begin",o,a,s);var l=w.getParamValue("end",o,a,s),c=w.getParamValue("strides",o,a,s),p=w.getParamValue("beginMask",o,a,s),h=w.getParamValue("endMask",o,a,s),f=w.getParamValue("ellipsisMask",o,a,s),d=w.getParamValue("newAxisMask",o,a,s),m=w.getParamValue("shrinkAxisMask",o,a,s),y=w.getParamValue("x",o,a,s);if(1===i.length&&1<y.shape.length)for(var g=1;g<y.shape.length;g++)i.push(0),l.push(y.shape[g]),c.push(c[0]);return[_.stridedSlice(y,i,l,c,p,h,f,d,m)];case"stack":return _.tidy(function(){var e=w.getParamValue("axis",o,a,s),t=w.getParamValue("tensors",o,a,s),n=t[0].shape,r=t[0].squeeze().shape,i=t.map(function(e){var t=_.util.arraysEqual(e.shape,n);if(!t&&!_.util.arraysEqual(e.squeeze().shape,r))throw new Error("the input tensors shape does not match");return t?e:e.reshape(n)});return[_.stack(i,e)]});case"unstack":return _.tidy(function(){var e=w.getParamValue("axis",o,a,s),t=w.getParamValue("tensor",o,a,s);return _.unstack(t,e)});case"tile":var v=w.getParamValue("reps",o,a,s);return[_.tile(w.getParamValue("x",o,a,s),v)];case"split":e=w.getParamValue("axis",o,a,s);var b=w.getParamValue("numOrSizeSplits",o,a,s);return _.split(w.getParamValue("x",o,a,s),b,e);default:throw TypeError("Node type "+o.op+" is not implemented")}},n.CATEGORY="slice_join"},{"./utils":29,"@tensorflow/tfjs-core":66}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var s=e("@tensorflow/tfjs-core"),u=e("./utils");n.executeOp=function(e,t,n){switch(e.op){case"cast":return[s.cast(u.getParamValue("x",e,t,n),u.getParamValue("dtype",e,t,n))];case"expandDims":var r=u.getParamValue("axis",e,t,n);return[s.expandDims(u.getParamValue("x",e,t,n),r)];case"squeeze":r=u.getParamValue("axis",e,t,n);return[s.squeeze(u.getParamValue("x",e,t,n),r)];case"reshape":return[s.reshape(u.getParamValue("x",e,t,n),u.getParamValue("shape",e,t,n))];case"pad":return[s.pad(u.getParamValue("x",e,t,n),u.split(u.getParamValue("padding",e,t,n),2),u.getParamValue("constantValue",e,t,n))];case"spaceToBatchND":var i=u.getParamValue("blockShape",e,t,n),o=u.split(u.getParamValue("paddings",e,t,n),2);return[s.spaceToBatchND(u.getParamValue("x",e,t,n),i,o)];case"batchToSpaceND":i=u.getParamValue("blockShape",e,t,n);var a=u.split(u.getParamValue("crops",e,t,n),2);return[s.batchToSpaceND(u.getParamValue("x",e,t,n),i,a)];default:throw TypeError("Node type "+e.op+" is not implemented")}},n.CATEGORY="transformation"},{"./utils":29,"@tensorflow/tfjs-core":66}],29:[function(e,t,n){"use strict";function a(e,t,n){var r=u(e),i=r[0],o=r[1],a=n.currentContextIds.find(function(e){return!!t[s(i,e)]});return void 0!==a?t[s(i,a)][o]:void 0}function s(e,t){return t?e+"-"+t:e}function u(e){var t=e.lastIndexOf(":");return-1===t?[e,0]:[e.substring(0,t),Number(e.substring(t+1))]}Object.defineProperty(n,"__esModule",{value:!0}),n.getParamValue=function(e,t,n,r){var i=t.params[e];if(i&&void 0!==i.inputIndex){if("tensor"===i.type)return a(t.inputNames[i.inputIndex],n,r);if("tensors"===i.type)return(0===i.inputIndex?0===i.inputParamLength?t.inputNames:t.inputNames.slice(i.inputIndex,-i.inputParamLength):t.inputNames.splice(i.inputIndex)).map(function(e){return a(e,n,r)});var o=Array.prototype.slice.call(a(t.inputNames.slice(i.inputIndex)[0],n,r).dataSync());return"number"===i.type?o[0]:o}return i&&i.value},n.getTensor=a,n.getNodeNameAndIndex=function(e,t){var n=u(e),r=n[0],i=n[1];return[s(r,t&&t.currentContextId),i]},n.parseNodeName=u,n.split=function(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}},{}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"Add",dlOpName:"add",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",dlOpName:"addN",category:"arithmetic",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",dlOpName:"add",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",dlOpName:"sub",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",dlOpName:"div",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",dlOpName:"div",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",dlOpName:"floorDiv",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",dlOpName:"mul",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",dlOpName:"maximum",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"}]},{tfOpName:"Minimum",dlOpName:"minimum",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"}]},{tfOpName:"Pow",dlOpName:"pow",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",dlOpName:"squaredDifference",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",dlOpName:"mod",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},{}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"Abs",dlOpName:"abs",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",dlOpName:"acos",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",dlOpName:"asin",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"atan",dlOpName:"atan",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",dlOpName:"ceil",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",dlOpName:"clipByValue",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"clip_value_min",dlParamName:"clipValueMin",type:"number"},{tfParamName:"clip_value_max",dlParamName:"clipValueMax",type:"number"}]},{tfOpName:"Cos",dlOpName:"cos",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",dlOpName:"cosh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",dlOpName:"elu",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",dlOpName:"exp",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",dlOpName:"floor",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",dlOpName:"log",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",dlOpName:"neg",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",dlOpName:"relu",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",dlOpName:"clipByValue",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0},{dlParamName:"clipValueMin",type:"number",defaultValue:0},{dlParamName:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",dlOpName:"selu",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",dlOpName:"sigmoid",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",dlOpName:"sin",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",dlOpName:"sinh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",dlOpName:"sqrt",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",dlOpName:"rsqrt",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",dlOpName:"square",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",dlOpName:"tan",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",dlOpName:"tanh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",dlOpName:"sign",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",dlOpName:"round",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",dlOpName:"expm1",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",dlOpName:"log1p",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",dlOpName:"reciprocal",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",dlOpName:"reciprocal",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",dlOpName:"softplus",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",dlOpName:"asinh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",dlOpName:"acosh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",dlOpName:"atanh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",dlOpName:"erf",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},{}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"LoopCond",dlOpName:"loopCond",category:"control",params:[{tfInputIndex:0,dlParamName:"pred",type:"tensor"}]},{tfOpName:"Switch",dlOpName:"switch",category:"control",params:[{tfInputIndex:0,dlParamName:"data",type:"tensor"},{tfInputIndex:1,dlParamName:"pred",type:"tensor"}]},{tfOpName:"Merge",dlOpName:"merge",category:"control",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensors",type:"tensors"}]},{tfOpName:"Enter",dlOpName:"enter",category:"control",params:[{tfInputIndex:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0},{tfParamName:"frame_name",dlParamName:"frameName",type:"string"},{tfParamName:"is_constant",dlParamName:"isConstant",type:"bool"}]},{tfOpName:"Exit",dlOpName:"exit",category:"control",params:[{tfInputIndex:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",dlOpName:"nextIteration",category:"control",params:[{tfInputIndex:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",dlOpName:"tensorArray",category:"control",params:[{tfInputIndex:0,dlParamName:"size",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"element_shape",dlParamName:"elementShape",type:"shape"},{tfParamName:"dynamic_size",dlParamName:"dynamicSize",type:"bool"},{tfParamName:"clear_after_read",dlParamName:"clearAfterRead",type:"bool"},{tfParamName:"identical_element_shapes",dlParamName:"identicalElementShapes",type:"bool"},{tfParamName:"tensor_array_name",dlParamName:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",dlOpName:"tensorArrayWrite",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"index",type:"number"},{tfInputIndex:2,dlParamName:"tensor",type:"tensor"},{tfInputIndex:3,dlParamName:"flowIn",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",dlOpName:"tensorArrayRead",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"index",type:"number"},{tfInputIndex:2,dlParamName:"flowIn",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",dlOpName:"tensorArrayGather",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"indices",type:"number[]"},{tfInputIndex:2,dlParamName:"flowIn",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"element_shape",dlParamName:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",dlOpName:"tensorArrayScatter",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"indices",type:"number[]"},{tfInputIndex:2,dlParamName:"tensor",type:"tensor"},{tfInputIndex:3,dlParamName:"flowIn",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",dlOpName:"tensorArrayConcat",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"flowIn",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"element_shape_except0",dlParamName:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",dlOpName:"tensorArraySplit",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"tensor",type:"tensor"},{tfInputIndex:2,dlParamName:"lengths",type:"number[]"},{tfInputIndex:3,dlParamName:"flowIn",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",dlOpName:"tensorArraySize",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",dlOpName:"tensorArrayClose",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"}]}]},{}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"AvgPool",dlOpName:"avgPool",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0},{tfParamName:"ksize",dlParamName:"kernelSize",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",dlOpName:"maxPool",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0},{tfParamName:"ksize",dlParamName:"kernelSize",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",dlOpName:"conv1d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"stride",dlParamName:"stride",type:"number"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NWC"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0},{tfParamName:"dilation",dlParamName:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",dlOpName:"conv2d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"useCudnnOnGpu",dlParamName:"useCudnnOnGpu",type:"bool"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NHWC"},{tfParamName:"dilations",dlParamName:"dilations",type:"number[]"}]},{tfOpName:"Conv2DBackpropInput",dlOpName:"conv2dTranspose",category:"convolution",params:[{tfInputIndex:2,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfInputIndex:0,dlParamName:"outputShape",type:"number[]"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",dlOpName:"depthwiseConv2d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"input",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NHWC"},{tfParamName:"dilations",dlParamName:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",dlOpName:"depthwiseConv2d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"input",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NHWC"},{tfParamName:"dilations",dlParamName:"dilations",type:"number[]"}]}]},{}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"Fill",dlOpName:"fill",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfInputIndex:1,dlParamName:"value",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",dlOpName:"linspace",category:"creation",params:[{tfInputIndex:0,dlParamName:"start",type:"number"},{tfInputIndex:1,dlParamName:"stop",type:"number"},{tfInputIndex:2,dlParamName:"num",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",dlOpName:"oneHot",category:"creation",params:[{tfInputIndex:0,dlParamName:"indices",type:"tensor"},{tfInputIndex:1,dlParamName:"depth",type:"number"},{tfInputIndex:2,dlParamName:"onValue",type:"number",defaultValue:1},{tfInputIndex:3,dlParamName:"offValue",type:"number",defaultValue:0},{tfParamName:"axis",dlParamName:"axis",type:"number",notSupported:!0},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",dlOpName:"ones",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",dlOpName:"onesLike",category:"creation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",dlOpName:"randomUniform",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"minval",dlParamName:"minval",type:"number",defaultValue:0},{tfParamName:"maxval",dlParamName:"maxval",type:"number",defaultValue:1},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"seed",dlParamName:"seed",type:"number",defaultValue:0},{tfParamName:"seed2",dlParamName:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfParamName:"T",dlParamName:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",dlOpName:"range",category:"creation",params:[{tfInputIndex:0,dlParamName:"start",type:"number"},{tfInputIndex:1,dlParamName:"stop",type:"number"},{tfInputIndex:2,dlParamName:"step",type:"number",defaultValue:0},{tfParamName:"Tidx",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"truncatedNormal",dlOpName:"truncatedNormal",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"means",dlParamName:"mean",type:"number",defaultValue:0},{tfParamName:"stddev",dlParamName:"stdDev",type:"number",defaultValue:1},{tfParamName:"seed",dlParamName:"seed",type:"number"},{tfParamName:"seed2",dlParamName:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"T",dlParamName:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",dlOpName:"zeros",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",dlOpName:"zerosLike",category:"creation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]}]},{}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"NonMaxSuppressionV2",dlOpName:"nonMaxSuppression",category:"dynamic",params:[{tfInputIndex:0,dlParamName:"boxes",type:"tensor"},{tfInputIndex:1,dlParamName:"scores",type:"tensor"},{tfInputIndex:2,dlParamName:"maxOutputSize",type:"number"},{tfInputIndex:3,dlParamName:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",dlOpName:"nonMaxSuppression",category:"dynamic",params:[{tfInputIndex:0,dlParamName:"boxes",type:"tensor"},{tfInputIndex:1,dlParamName:"scores",type:"tensor"},{tfInputIndex:2,dlParamName:"maxOutputSize",type:"number"},{tfInputIndex:3,dlParamName:"iouThreshold",type:"number"},{tfInputIndex:4,dlParamName:"scoreThreshold",type:"number"}]},{tfOpName:"Where",dlOpName:"whereAsync",category:"dynamic",params:[{tfInputIndex:0,dlParamName:"condition",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},{}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"TopKV2",dlOpName:"topK",category:"evaluation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"k",type:"number"},{tfParamName:"sorted",dlParamName:"sorted",type:"bool"}]}]},{}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"PlaceholderWithDefault",dlOpName:"placeholder",category:"graph",params:[{tfInputIndex:0,dlParamName:"default",type:"tensor"},{tfParamName:"shape",dlParamName:"shape",type:"shape"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",dlOpName:"placeholder",category:"graph",params:[{tfParamName:"shape",dlParamName:"shape",type:"shape"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"Const",dlOpName:"const",category:"graph"},{tfOpName:"Identity",dlOpName:"identity",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Snapshot",dlOpName:"snapshot",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Rank",dlOpName:"rank",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Size",dlOpName:"size",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Shape",dlOpName:"shape",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Print",dlOpName:"print",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,tfInputParamLength:1,dlParamName:"data",type:"tensors"},{tfParamName:"message",dlParamName:"message",type:"string"},{tfParamName:"first_n",dlParamName:"firstN",type:"number",notSupprted:!0},{tfParamName:"summarize",dlParamName:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",dlOpName:"noop",category:"graph",params:[]},{tfOpName:"StopGradient",dlOpName:"stopGradient",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",dlOpName:"fakeQuantWithMinMaxVars",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"min",dlParamName:"min",type:"number"},{tfParamName:"max",dlParamName:"max",type:"number"}]}]},{}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"ResizeBilinear",dlOpName:"resizeBilinear",category:"image",params:[{tfInputIndex:0,dlParamName:"images",type:"tensor"},{tfInputIndex:1,dlParamName:"size",type:"number[]"},{tfParamName:"align_corners",dlParamName:"alignCorners",type:"bool"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",dlOpName:"resizeNearestNeighbor",category:"image",params:[{tfInputIndex:0,dlParamName:"images",type:"tensor"},{tfInputIndex:1,dlParamName:"size",type:"number[]"},{tfParamName:"align_corners",dlParamName:"alignCorners",type:"bool"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},{}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"Equal",dlOpName:"equal",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",dlOpName:"notEqual",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",dlOpName:"greater",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",dlOpName:"greaterEqual",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",dlOpName:"less",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",dlOpName:"lessEqual",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",dlOpName:"logicalAnd",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",dlOpName:"logicalNot",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",dlOpName:"logicalOr",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",dlOpName:"where",category:"logical",params:[{tfInputIndex:0,dlParamName:"condition",type:"tensor"},{tfInputIndex:1,dlParamName:"a",type:"tensor"},{tfInputIndex:2,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},{}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"MatMul",dlOpName:"matMul",category:"matrices",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"transpose_a",dlParamName:"transposeA",type:"bool",defaultValue:!1},{tfParamName:"transpose_b",dlParamName:"transposeB",type:"bool",defaultValue:!1},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",dlOpName:"transpose",category:"matrices",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"perm",dlParamName:"perm",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},{}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"FusedBatchNorm",dlOpName:"batchNormalization",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"scale",type:"tensor"},{tfInputIndex:2,dlParamName:"offset",type:"tensor"},{tfInputIndex:3,dlParamName:"mean",type:"tensor"},{tfInputIndex:4,dlParamName:"variance",type:"tensor"},{tfParamName:"epsilon",dlParamName:"epsilon",type:"number",defaultValue:.001},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",dlOpName:"batchNormalization",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"scale",type:"tensor"},{tfInputIndex:2,dlParamName:"offset",type:"tensor"},{tfInputIndex:3,dlParamName:"mean",type:"tensor"},{tfInputIndex:4,dlParamName:"variance",type:"tensor"},{tfParamName:"epsilon",dlParamName:"epsilon",type:"number",defaultValue:.001},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",dlOpName:"localResponseNormalization",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"depth_radius",dlParamName:"radius",type:"number",defaultValue:5},{tfParamName:"bias",dlParamName:"bias",type:"number",defaultValue:1},{tfParamName:"alpha",dlParamName:"alpha",type:"number",defaultValue:1},{tfParamName:"beta",dlParamName:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",dlOpName:"softmax",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]}]},{}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"Max",dlOpName:"max",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Mean",dlOpName:"mean",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Min",dlOpName:"min",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Sum",dlOpName:"sum",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"All",dlOpName:"all",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Any",dlOpName:"any",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",dlOpName:"argMax",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number"}]},{tfOpName:"ArgMin",dlOpName:"argMin",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number"}]}]},{}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"ConcatV2",dlOpName:"concat",category:"slice_join",params:[{tfInputIndex:0,tfInputParamLength:1,dlParamName:"tensors",type:"tensors"},{tfInputIndex:-1,dlParamName:"axis",type:"number"}]},{tfOpName:"Concat",dlOpName:"concat",category:"slice_join",params:[{tfInputIndex:1,tfInputParamLength:1,dlParamName:"tensors",type:"tensors"},{tfInputIndex:0,dlParamName:"axis",type:"number"}]},{tfOpName:"GatherV2",dlOpName:"gather",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"indices",type:"tensor"},{tfParamName:"axis",dlParamName:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",dlOpName:"gather",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"indices",type:"tensor"},{tfParamName:"axis",dlParamName:"axis",type:"number",defaultValue:0},{tfParamName:"validate_indices",dlParamName:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",dlOpName:"reverse",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number"}]},{tfOpName:"ReverseV2",dlOpName:"reverse",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number"}]},{tfOpName:"Slice",dlOpName:"slice",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"begin",type:"number[]"},{tfInputIndex:2,dlParamName:"size",type:"number[]"}]},{tfOpName:"StridedSlice",dlOpName:"stridedSlice",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"begin",type:"number[]"},{tfInputIndex:2,dlParamName:"end",type:"number[]"},{tfInputIndex:3,dlParamName:"strides",type:"number[]"},{tfParamName:"begin_mask",dlParamName:"beginMask",type:"number",defaultValue:0},{tfParamName:"end_mask",dlParamName:"endMask",type:"number",defaultValue:0},{tfParamName:"new_axis_mask",dlParamName:"newAxisMask",type:"number",defaultValue:0},{tfParamName:"ellipsis_mask",dlParamName:"ellipsisMask",type:"number",defaultValue:0},{tfParamName:"shrink_axis_mask",dlParamName:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",dlOpName:"stack",category:"slice_join",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensors",type:"tensors"},{tfParamName:"axis",dlParamName:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",dlOpName:"unstack",category:"slice_join",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"axis",dlParamName:"axis",type:"number",defaultValue:0},{tfParamName:"num",dlParamName:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",dlOpName:"tile",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"reps",type:"number[]"}]},{tfOpName:"Split",dlOpName:"split",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"axis",type:"number",defaultValue:0},{tfInputIndex:1,dlParamName:"x",type:"tensor"},{tfParamName:"num_split",dlParamName:"numOrSizeSplits",type:"number",defaultValue:1}]}]},{}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.json=[{tfOpName:"Cast",dlOpName:"cast",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"SrcT",dlParamName:"sdtype",type:"dtype",notSupported:!0},{tfParamName:"DstT",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",dlOpName:"expandDims",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,tfParamNameDeprecated:"dim",dlParamName:"axis",type:"number"}]},{tfOpName:"Pad",dlOpName:"pad",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"padding",type:"number[]"},{tfParamName:"constant_value",dlParamName:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",dlOpName:"pad",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"padding",type:"number[]"},{tfInputIndex:2,dlParamName:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",dlOpName:"reshape",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"shape",type:"number[]"}]},{tfOpName:"Squeeze",dlOpName:"squeeze",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"axis",tfParamNameDeprecated:"squeeze_dims",dlParamName:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",dlOpName:"spaceToBatchND",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"blockShape",type:"number[]"},{tfInputIndex:2,dlParamName:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",dlOpName:"batchToSpaceND",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"blockShape",type:"number[]"},{tfInputIndex:2,dlParamName:"crops",type:"number[]"}]}]},{}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./executors/arithmetic_executor"),i=e("./executors/basic_math_executor"),o=e("./executors/control_executor"),a=e("./executors/convolution_executor"),s=e("./executors/creation_executor"),u=e("./executors/dynamic_executor"),l=e("./executors/evaluation_executor"),c=e("./executors/graph_executor"),p=e("./executors/image_executor"),h=e("./executors/logical_executor"),f=e("./executors/matrices_executor"),d=e("./executors/normalization_executor"),m=e("./executors/reduction_executor"),y=e("./executors/slice_join_executor"),g=e("./executors/transformation_executor");n.executeOp=function(e,t,n){switch(e.category){case"arithmetic":return r.executeOp(e,t,n);case"basic_math":return i.executeOp(e,t,n);case"control":return o.executeOp(e,t,n);case"convolution":return a.executeOp(e,t,n);case"creation":return s.executeOp(e,t,n);case"dynamic":return u.executeOp(e,t,n);case"evaluation":return l.executeOp(e,t,n);case"image":return p.executeOp(e,t,n);case"graph":return c.executeOp(e,t,n);case"logical":return h.executeOp(e,t,n);case"matrices":return f.executeOp(e,t,n);case"normalization":return d.executeOp(e,t,n);case"reduction":return m.executeOp(e,t,n);case"slice_join":return y.executeOp(e,t,n);case"transformation":return g.executeOp(e,t,n);default:throw TypeError("Node type "+e.op+" is not implemented")}}},{"./executors/arithmetic_executor":14,"./executors/basic_math_executor":15,"./executors/control_executor":16,"./executors/convolution_executor":17,"./executors/creation_executor":18,"./executors/dynamic_executor":19,"./executors/evaluation_executor":20,"./executors/graph_executor":21,"./executors/image_executor":22,"./executors/logical_executor":23,"./executors/matrices_executor":24,"./executors/normalization_executor":25,"./executors/reduction_executor":26,"./executors/slice_join_executor":27,"./executors/transformation_executor":28}],46:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../data/compiled_api"),l=e("./executors/utils"),r=e("./op_list/arithmetic"),o=e("./op_list/basic_math"),a=e("./op_list/control"),s=e("./op_list/convolution"),u=e("./op_list/creation"),c=e("./op_list/dynamic"),p=e("./op_list/evaluation"),h=e("./op_list/graph"),f=e("./op_list/image"),d=e("./op_list/logical"),m=e("./op_list/matrices"),y=e("./op_list/normalization"),g=e("./op_list/reduction"),v=e("./op_list/slice_join"),b=e("./op_list/transformation"),_=["Switch","Merge","Enter","Exit","NextIteration"],w=["NonMaxSuppressionV2","NonMaxSuppressionV3","Where"],S=function(){function e(){var e=[r,o,a,s,u,c,p,d,f,h,m,y,g,v,b],t=[].concat.apply([],e.map(function(e){return e.json}));this.opMappers=t.reduce(function(e,t){return e[t.tfOpName]=t,e},{})}return Object.defineProperty(e,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),e.prototype.isControlFlow=function(t){return _.some(function(e){return e===t.op})},e.prototype.isDynamicShape=function(t){return w.some(function(e){return e===t.op})},e.prototype.transformGraph=function(e){var n=this,t=e.node,r=!1,i=!1,o=[],a=t.reduce(function(e,t){return e[t.name]=n.mapNode(t),n.isControlFlow(t)&&(r=!0),n.isDynamicShape(t)&&(i=!0),"Placeholder"===t.op&&o.push(e[t.name]),e},{}),s=[],u=[];return Object.keys(a).forEach(function(e){var n=a[e];n.inputNames.forEach(function(e){var t=l.getNodeNameAndIndex(e)[0];n.inputs.push(a[t]),a[t].children.push(n)}),0===n.inputs.length&&s.push(n)}),Object.keys(a).forEach(function(e){var t=a[e];0===t.children.length&&u.push(t)}),{nodes:a,inputs:s,outputs:u,placeholders:o,withControlFlow:r,withDynamicShape:i}},e.prototype.mapNode=function(a){var s=this,e=this.opMappers[a.op];if(void 0===e)throw new Error("Tensorflow Op is not supported: "+a.op);var t={name:a.name,op:e.dlOpName,category:e.category,inputNames:(a.input||[]).map(function(e){return e.startsWith("^")?e.substr(1):e}),inputs:[],children:[],params:{}};return e.params&&(t.params=e.params.reduce(function(e,t){var n=t.tfInputIndex,r=t.tfInputParamLength,i=t.type,o=void 0;if(void 0===n)switch(t.type){case"string":void 0===(o=s.getStringParam(a.attr,t.tfParamName,t.defaultValue))&&t.tfParamNameDeprecated&&(o=s.getStringParam(a.attr,t.tfParamNameDeprecated,t.defaultValue));break;case"number":void 0===(o=s.getNumberParam(a.attr,t.tfParamName,t.defaultValue))&&t.tfParamNameDeprecated&&(o=s.getNumberParam(a.attr,t.tfParamNameDeprecated,t.defaultValue));break;case"number[]":void 0===(o=s.getNumericArrayParam(a.attr,t.tfParamName,t.defaultValue))&&t.tfParamNameDeprecated&&(o=s.getNumericArrayParam(a.attr,t.tfParamNameDeprecated,t.defaultValue));break;case"bool":void 0===(o=s.getBoolParam(a.attr,t.tfParamName,t.defaultValue))&&t.tfParamNameDeprecated&&(o=s.getBoolParam(a.attr,t.tfParamNameDeprecated,t.defaultValue));break;case"shape":void 0===(o=s.getTensorShapeParam(a.attr,t.tfParamName,t.defaultValue))&&t.tfParamNameDeprecated&&(o=s.getTensorShapeParam(a.attr,t.tfParamNameDeprecated,t.defaultValue));break;case"dtype":void 0===(o=s.getDtypeParam(a.attr,t.tfParamName,t.defaultValue))&&t.tfParamNameDeprecated&&(o=s.getDtypeParam(a.attr,t.tfParamNameDeprecated,t.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+t.type+" for op: "+a.op)}return e[t.dlParamName]={value:o,inputIndex:n,type:i,inputParamLength:r},e},{})),t},e.prototype.getStringParam=function(e,t,n,r){void 0===r&&(r=!1);var i=e[t];if(void 0!==i){var o=String.fromCharCode.apply(null,i.s);return r?o:o.toLowerCase()}return n},e.prototype.getBoolParam=function(e,t,n){var r=e[t];return r?r.b:n},e.prototype.getNumberParam=function(e,t,n){var r=e[t],i=r?r[r.value]:n;return"number"==typeof i?i:i.toInt()},e.prototype.getDtypeParam=function(e,t,n){var r=e[t];if(r&&r.type)switch(r.type){case i.tensorflow.DataType.DT_FLOAT:return"float32";case i.tensorflow.DataType.DT_INT32:return"int32";case i.tensorflow.DataType.DT_BOOL:return"bool";default:return n}return n},e.prototype.getTensorShapeParam=function(e,t,n){var r=e[t];return r&&r.shape?r.shape.dim.map(function(e){return"number"==typeof e.size?e.size:e.size.toInt()}):n},e.prototype.getNumericArrayParam=function(e,t,n){var r=e[t];return r?(r.list.f&&r.list.f.length?r.list.f:r.list.i).map(function(e){return"number"==typeof e?e:e.toInt()}):n},e}();n.OperationMapper=S},{"../data/compiled_api":8,"./executors/utils":29,"./op_list/arithmetic":30,"./op_list/basic_math":31,"./op_list/control":32,"./op_list/convolution":33,"./op_list/creation":34,"./op_list/dynamic":35,"./op_list/evaluation":36,"./op_list/graph":37,"./op_list/image":38,"./op_list/logical":39,"./op_list/matrices":40,"./op_list/normalization":41,"./op_list/reduction":42,"./op_list/slice_join":43,"./op_list/transformation":44}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.version="0.5.7"},{}],48:[function(e,t,n){"use strict";t.exports=e("./src/index-minimal")},{"./src/index-minimal":49}],49:[function(e,t,n){"use strict";var r=n;function i(){r.Reader._configure(r.BufferReader),r.util._configure()}r.build="minimal",r.Writer=e("./writer"),r.BufferWriter=e("./writer_buffer"),r.Reader=e("./reader"),r.BufferReader=e("./reader_buffer"),r.util=e("./util/minimal"),r.rpc=e("./rpc"),r.roots=e("./roots"),r.configure=i,r.Writer._configure(r.BufferWriter),i()},{"./reader":50,"./reader_buffer":51,"./roots":52,"./rpc":53,"./util/minimal":56,"./writer":57,"./writer_buffer":58}],50:[function(e,t,n){"use strict";t.exports=u;var r,i=e("./util/minimal"),o=i.LongBits,a=i.utf8;function s(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function u(e){this.buf=e,this.pos=0,this.len=e.length}var l,c="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new u(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new u(e);throw Error("illegal buffer")};function p(){var e=new o(0,0),t=0;if(!(4<this.len-this.pos)){for(;t<3;++t){if(this.pos>=this.len)throw s(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,4<this.len-this.pos){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw s(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function h(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw s(this,8);return new o(h(this.buf,this.pos+=4),h(this.buf,this.pos+=4))}u.create=i.Buffer?function(e){return(u.create=function(e){return i.Buffer.isBuffer(e)?new r(e):c(e)})(e)}:c,u.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,u.prototype.uint32=(l=4294967295,function(){if(l=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return l;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return l}),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},u.prototype.bool=function(){return 0!==this.uint32()},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return h(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|h(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},u.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},u.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw s(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},u.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},u.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw s(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},u._configure=function(e){r=e;var t=i.Long?"toLong":"toNumber";i.merge(u.prototype,{int64:function(){return p.call(this)[t](!1)},uint64:function(){return p.call(this)[t](!0)},sint64:function(){return p.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},{"./util/minimal":56}],51:[function(e,t,n){"use strict";t.exports=o;var r=e("./reader");(o.prototype=Object.create(r.prototype)).constructor=o;var i=e("./util/minimal");function o(e){r.call(this,e)}i.Buffer&&(o.prototype._slice=i.Buffer.prototype.slice),o.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len))}},{"./reader":50,"./util/minimal":56}],52:[function(e,t,n){"use strict";t.exports={}},{}],53:[function(e,t,n){"use strict";n.Service=e("./rpc/service")},{"./rpc/service":54}],54:[function(e,t,n){"use strict";t.exports=r;var s=e("../util/minimal");function r(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");s.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}((r.prototype=Object.create(s.EventEmitter.prototype)).constructor=r).prototype.rpcCall=function e(n,t,r,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return s.asPromise(e,a,n,t,r,i);if(a.rpcImpl)try{return a.rpcImpl(n,t[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(e,t){if(e)return a.emit("error",e,n),o(e);if(null!==t){if(!(t instanceof r))try{t=r[a.responseDelimited?"decodeDelimited":"decode"](t)}catch(e){return a.emit("error",e,n),o(e)}return a.emit("data",t,n),o(null,t)}a.end(!0)})}catch(e){return a.emit("error",e,n),void setTimeout(function(){o(e)},0)}else setTimeout(function(){o(Error("already ended"))},0)},r.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},{"../util/minimal":56}],55:[function(e,t,n){"use strict";t.exports=i;var r=e("../util/minimal");function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var o=i.zero=new i(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return o;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,4294967295<++n&&(n=0,4294967295<++r&&(r=0))),new i(n,r)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(r.isString(e)){if(!r.Long)return i.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):o},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var s=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?o:new i((s.call(e,0)|s.call(e,1)<<8|s.call(e,2)<<16|s.call(e,3)<<24)>>>0,(s.call(e,4)|s.call(e,5)<<8|s.call(e,6)<<16|s.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},{"../util/minimal":56}],56:[function(n,e,o){(function(e){"use strict";var r=o;function i(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function t(e){function n(e,t){if(!(this instanceof n))return new n(e,t);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,n):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),t&&i(this,t)}return(n.prototype=Object.create(Error.prototype)).constructor=n,Object.defineProperty(n.prototype,"name",{get:function(){return e}}),n.prototype.toString=function(){return this.name+": "+this.message},n}r.asPromise=n("@protobufjs/aspromise"),r.base64=n("@protobufjs/base64"),r.EventEmitter=n("@protobufjs/eventemitter"),r.float=n("@protobufjs/float"),r.inquire=n("@protobufjs/inquire"),r.utf8=n("@protobufjs/utf8"),r.pool=n("@protobufjs/pool"),r.LongBits=n("./longbits"),r.global="undefined"!=typeof window&&window||void 0!==e&&e||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isNode=Boolean(r.global.process&&r.global.process.versions&&r.global.process.versions.node),r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||0<(Array.isArray(n)?n.length:Object.keys(n).length))},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=i,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=t,r.ProtocolError=t("ProtocolError"),r.oneOfGetter=function(e){for(var n={},t=0;t<e.length;++t)n[e[t]]=1;return function(){for(var e=Object.keys(this),t=e.length-1;-1<t;--t)if(1===n[e[t]]&&void 0!==this[e[t]]&&null!==this[e[t]])return e[t]}},r.oneOfSetter=function(n){return function(e){for(var t=0;t<n.length;++t)n[t]!==e&&delete this[n[t]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var n=r.Buffer;n?(r._Buffer_from=n.from!==Uint8Array.from&&n.from||function(e,t){return new n(e,t)},r._Buffer_allocUnsafe=n.allocUnsafe||function(e){return new n(e)}):r._Buffer_from=r._Buffer_allocUnsafe=null}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./longbits":55,"@protobufjs/aspromise":1,"@protobufjs/base64":2,"@protobufjs/eventemitter":3,"@protobufjs/float":4,"@protobufjs/inquire":5,"@protobufjs/pool":6,"@protobufjs/utf8":7}],57:[function(e,t,n){"use strict";t.exports=p;var r,i=e("./util/minimal"),o=i.LongBits,a=i.base64,s=i.utf8;function u(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function l(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function p(){this.len=0,this.head=new u(l,0,0),this.tail=this.head,this.states=null}function h(e,t,n){t[n]=255&e}function f(e,t){this.len=e,this.next=void 0,this.val=t}function d(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function m(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}p.create=i.Buffer?function(){return(p.create=function(){return new r})()}:function(){return new p},p.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(p.alloc=i.pool(p.alloc,i.Array.prototype.subarray)),p.prototype._push=function(e,t,n){return this.tail=this.tail.next=new u(e,t,n),this.len+=t,this},(f.prototype=Object.create(u.prototype)).fn=function(e,t,n){for(;127<e;)t[n++]=127&e|128,e>>>=7;t[n]=e},p.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new f((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},p.prototype.int32=function(e){return e<0?this._push(d,10,o.fromNumber(e)):this.uint32(e)},p.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},p.prototype.int64=p.prototype.uint64=function(e){var t=o.from(e);return this._push(d,t.length(),t)},p.prototype.sint64=function(e){var t=o.from(e).zzEncode();return this._push(d,t.length(),t)},p.prototype.bool=function(e){return this._push(h,1,e?1:0)},p.prototype.sfixed32=p.prototype.fixed32=function(e){return this._push(m,4,e>>>0)},p.prototype.sfixed64=p.prototype.fixed64=function(e){var t=o.from(e);return this._push(m,4,t.lo)._push(m,4,t.hi)},p.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},p.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var y=i.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};p.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(h,1,0);if(i.isString(e)){var n=p.alloc(t=a.length(e));a.decode(e,n,0),e=n}return this.uint32(t)._push(y,t,e)},p.prototype.string=function(e){var t=s.length(e);return t?this.uint32(t)._push(s.write,t,e):this._push(h,1,0)},p.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new u(l,0,0),this.len=0,this},p.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new u(l,0,0),this.len=0),this},p.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},p.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},p._configure=function(e){r=e}},{"./util/minimal":56}],58:[function(e,t,n){"use strict";t.exports=a;var r=e("./writer");(a.prototype=Object.create(r.prototype)).constructor=a;var i=e("./util/minimal"),o=i.Buffer;function a(){r.call(this)}a.alloc=function(e){return(a.alloc=i._Buffer_allocUnsafe)(e)};var s=o&&o.prototype instanceof Uint8Array&&"set"===o.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]};function u(e,t,n){e.length<40?i.utf8.write(e,t,n):t.utf8Write(e,n)}a.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s,t,e),this},a.prototype.string=function(e){var t=o.byteLength(e);return this.uint32(t),t&&this._push(u,t,e),this}},{"./util/minimal":56,"./writer":57}],59:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:setImmediate;n.nextFrame=function(){return new Promise(function(e){return r(function(){return e()})})}},{}],60:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isMobile=function(){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}},{}],61:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},o=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var r=e("./profiler"),c=e("./tape"),p=e("./tensor"),u=e("./tensor_util"),h=e("./util"),f=e("./util"),a=function(){function e(e,t,n){this.backend=e,this.safeMode=t,this.debugMode=n,this.registeredVariables={},this.refCounter=new WeakMap,this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numDataBuffers=0,this.gradientScopeCount=0,this.customGradientDepth=0,this.keepTensors=new Set,this.activeScope={track:[],name:"default scope"},this.scopeStack=[this.activeScope],this.profiler=new r.Profiler(e)}return e.prototype.tidy=function(e,t,n){var r=this;void 0===n&&(n=!1);var i,o=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return r.startScope(o,n)},function(){return r.endScope(i,n)},function(){return(i=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.runKernel=function(e,t,n){var r,i=this,o=[],a=function(e){return o.push(e),e},s=this.activeScope.name;if(this.scopedRun(function(){return i.customGradientDepth++},function(){return i.customGradientDepth--},function(){r=i.debugMode()?i.profiler.profileKernel(s,function(){return e(i.backend,a)}):e(i.backend,a)}),this.shouldRecord()){var u={id:this.nextTapeNodeId++,name:s,inputs:t,output:Array.isArray(r)?r[0]:r};null!=n&&(u.gradient=function(e){return n(e,o)}),this.activeTape.push(u)}return r},e.prototype.registerTensor=function(e){var t=this.refCounter.has(e.dataId)?this.refCounter.get(e.dataId):0;this.numTensors++,0===t&&(this.numDataBuffers++,this.numBytes+=h.sizeFromShape(e.shape)*h.bytesPerElement(e.dtype),this.backend.register(e.dataId,e.shape,e.dtype)),this.refCounter.set(e.dataId,t+1),e instanceof p.Variable||this.track(e)},e.prototype.registerVariable=function(e){if(null!=this.registeredVariables[e.name])throw new Error("Variable with name "+e.name+" was already registered");this.registeredVariables[e.name]=e},e.prototype.disposeTensor=function(e){if(this.refCounter.has(e.dataId)){this.keepTensors.has(e.id)&&this.keepTensors.delete(e.id),this.numTensors--;var t=this.refCounter.get(e.dataId);t<=1?(this.refCounter.delete(e.dataId),this.backend.disposeData(e.dataId),this.numDataBuffers--,this.numBytes-=h.sizeFromShape(e.shape)*h.bytesPerElement(e.dtype)):this.refCounter.set(e.dataId,t-1)}},e.prototype.disposeVariables=function(){for(var e in this.registeredVariables){var t=this.registeredVariables[e];this.disposeTensor(t),delete this.registeredVariables[e]}},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.numTensors,e.numDataBuffers=this.numDataBuffers,e.numBytes=this.numBytes,e},e.prototype.shouldRecord=function(){return null!=this.activeTape&&0===this.customGradientDepth},e.prototype.addTapeNode=function(e,t,r){var n={};e.forEach(function(e,t){n[t]=e});var i={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:n,output:t,gradient:function(e){var t=r(e),n={};return t.forEach(function(e,t){n[t]=function(){return e}}),n}};this.activeTape.push(i)},e.prototype.keep=function(e){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {...}) to avoid memory leaks.");return this.keepTensors.add(e.id),e},e.prototype.startScope=function(e,t){void 0===t&&(t=!1),t&&0===this.gradientScopeCount&&(this.activeTape=[]),t&&this.gradientScopeCount++;var n={track:[],name:"unnamed scope"};e&&(n.name=e),this.scopeStack.push(n),this.activeScope=n},e.prototype.endScope=function(e,t){var n=this;void 0===t&&(t=!1),t&&(this.gradientScopeCount--,0===this.gradientScopeCount&&(this.activeTape=null));var r=new Set(this.keepTensors),i=u.getTensorsInContainer(e);i.forEach(function(e){return r.add(e.id)});for(var o=0;o<this.activeScope.track.length;o++){var a=this.activeScope.track[o];r.has(a.id)||(null!=this.activeTape?i.push(a):a.dispose())}var s=this.scopeStack.pop();this.activeScope=0===this.scopeStack.length?{track:[],name:"default scope"}:this.scopeStack[this.scopeStack.length-1],i.forEach(function(e){!n.keepTensors.has(e.id)&&u.isTensorInList(e,s.track)&&n.track(e)})},e.prototype.gradients=function(o,a,s,u){var l=this;return void 0===u&&(u=!1),h.assert(0<a.length,"gradients() received an empty list of xs."),this.tidy("gradients",function(){var e=o();h.assert(e instanceof p.Tensor,"The result y returned by f() must be a tensor.");var t=c.getFilteredNodesXToY(l.activeTape,a,e);if(!u&&0===t.length&&0<a.length)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");var n,r,i={};return i[e.id]=null==s?(n=e.shape,r=f.makeOnesTypedArray(f.sizeFromShape(n),"float32"),p.Tensor.make(n,{values:r})):s,c.backpropagateGradients(i,t),{value:e,grads:a.map(function(e){return i[e.id]})}},!0)},e.prototype.customGrad=function(o){var n=this;return h.assert(h.isFunction(o),"The f passed in customGrad(f) must be a function."),function(){for(var r,e,i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];if(h.assert(i.every(function(e){return e instanceof p.Tensor}),"The args passed in customGrad(f)(x1, x2,...) must all be tensors"),n.scopedRun(function(){return n.customGradientDepth++},function(){return n.customGradientDepth--},function(){e=n.tidy(o.name,function(){var e=o.apply(void 0,i),t=e.value,n=e.gradFunc;return h.assert(t instanceof p.Tensor,"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),h.assert(h.isFunction(n),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r=n,t},!0)}),n.shouldRecord()){n.addTapeNode(i,e,function(e){var t=r(e),n=Array.isArray(t)?t:[t];return h.assert(n.length===i.length,"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),h.assert(n.every(function(e){return e instanceof p.Tensor}),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."),n})}return e}},e.prototype.write=function(e,t){this.backend.write(e,t)},e.prototype.readSync=function(e){return this.backend.readSync(e)},e.prototype.read=function(e){return this.backend.read(e)},e.prototype.fromPixels=function(e,t){return this.backend.fromPixels(e,t)},e.prototype.time=function(r){return i(this,void 0,void 0,function(){var t,n;return o(this,function(e){switch(e.label){case 0:return t=f.now(),[4,this.backend.time(r)];case 1:return(n=e.sent()).wallMs=f.now()-t,[2,n]}})})},e.prototype.track=function(e){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {op();...}); to avoid memory leaks.");return this.activeScope.track.push(e),e},e}();n.Engine=a},{"./profiler":177,"./tape":179,"./tensor":180,"./tensor_util":182,"./util":187}],62:[function(u,e,l){(function(n){"use strict";Object.defineProperty(l,"__esModule",{value:!0});var e,r=u("./device_util"),i=u("./engine"),o=u("./environment_util"),t=u("./tensor"),a=u("./tensor_util"),s=function(){function e(e){this.features={},this.registry={},null!=e&&(this.features=e),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return e.setBackend=function(e,t){if(void 0===t&&(t=!1),!(e in l.ENV.registry))throw new Error("Backend name '"+e+"' not found in registry");l.ENV.initBackend(e,t)},e.getBackend=function(){return l.ENV.initDefaultBackend(),l.ENV.backendName},e.disposeVariables=function(){l.ENV.engine.disposeVariables()},e.memory=function(){return l.ENV.engine.memory()},e.tidy=function(e,t,n){return void 0===n&&(n=!1),l.ENV.engine.tidy(e,t,n)},e.dispose=function(e){a.getTensorsInContainer(e).forEach(function(e){return e.dispose()})},e.keep=function(e){return l.ENV.engine.keep(e)},e.time=function(e){return l.ENV.engine.time(e)},e.prototype.get=function(e){return e in this.features||(this.features[e]=this.evaluateFeature(e)),this.features[e]},e.prototype.getFeatures=function(){return this.features},e.prototype.set=function(e,t){this.features[e]=t},e.prototype.getBestBackendName=function(){var t=this;if(0===Object.keys(this.registry).length)throw new Error("No backend found in registry.");return Object.keys(this.registry).map(function(e){return{name:e,entry:t.registry[e]}}).sort(function(e,t){return t.entry.priority-e.entry.priority})[0].name},e.prototype.evaluateFeature=function(e){if("DEBUG"===e)return!1;if("IS_BROWSER"===e)return"undefined"!=typeof window;if("IS_NODE"===e)return void 0!==n&&void 0!==n.versions.node;if("IS_CHROME"===e)return o.isChrome();if("IS_TEST"===e)return!1;if("BACKEND"===e)return this.getBestBackendName();if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"===e){var t=this.get("WEBGL_VERSION");return 0===t?0:0<t?0:o.getWebGLDisjointQueryTimerVersion(t,this.get("IS_BROWSER"))}if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE"===e)return 0<this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")&&!r.isMobile();if("HAS_WEBGL"===e)return 0<this.get("WEBGL_VERSION");if("WEBGL_VERSION"===e)return o.isWebGLVersionEnabled(2,this.get("IS_BROWSER"))?2:o.isWebGLVersionEnabled(1,this.get("IS_BROWSER"))?1:0;if("WEBGL_RENDER_FLOAT32_ENABLED"===e)return o.isRenderToFloatTextureEnabled(this.get("WEBGL_VERSION"),this.get("IS_BROWSER"));if("WEBGL_DOWNLOAD_FLOAT_ENABLED"===e)return o.isDownloadFloatTextureEnabled(this.get("WEBGL_VERSION"),this.get("IS_BROWSER"));if("WEBGL_FENCE_API_ENABLED"===e)return o.isWebGLFenceEnabled(this.get("WEBGL_VERSION"),this.get("IS_BROWSER"));if("TEST_EPSILON"===e)return this.get("WEBGL_RENDER_FLOAT32_ENABLED")?.001:.1;throw new Error("Unknown feature "+e+".")},e.prototype.setFeatures=function(e){this.features=Object.assign({},e)},e.prototype.reset=function(){this.features=o.getFeaturesFromURL(),null!=this.globalEngine&&(this.globalEngine=null)},e.prototype.initBackend=function(e,t){var n=this;void 0===t&&(t=!1),this.backendName=e,this.backend=this.findBackend(e),this.globalEngine=new i.Engine(this.backend,t,function(){return n.get("DEBUG")})},e.prototype.findBackend=function(e){return e in this.registry?this.registry[e].backend:null},e.prototype.registerBackend=function(t,e,n,r){var i=this;if(void 0===n&&(n=1),t in this.registry)return console.warn(t+" backend was already registered. Reusing existing backend"),null!=r&&r(function(){return i.engine}),!1;try{var o=e();return this.registry[t]={backend:o,priority:n},!0}catch(e){return console.warn("Registration of backend "+t+" failed"),console.warn(e.stack||e.message),!1}},e.prototype.removeBackend=function(e){if(!(e in this.registry))throw new Error(e+" backend not found in registry");this.registry[e].backend.dispose(),delete this.registry[e]},Object.defineProperty(e.prototype,"engine",{get:function(){return this.initDefaultBackend(),this.globalEngine},enumerable:!0,configurable:!0}),e.prototype.initDefaultBackend=function(){null==this.globalEngine&&this.initBackend(this.get("BACKEND"),!1)},e}();l.Environment=s,l.ENV=(null==(e=function(){var e;if("undefined"!=typeof window)e=window;else{if(void 0===n)throw new Error("Could not find a global object");e=n}return e}()).ENV&&(e.ENV=new s(o.getFeaturesFromURL()),t.setTensorTracker(function(){return e.ENV.engine})),e.ENV)}).call(this,u("_process"))},{"./device_util":60,"./engine":61,"./environment_util":63,"./tensor":180,"./tensor_util":182,_process:246}],63:[function(e,t,n){"use strict";var r,i;Object.defineProperty(n,"__esModule",{value:!0}),(i=r=n.Type||(n.Type={}))[i.NUMBER=0]="NUMBER",i[i.BOOLEAN=1]="BOOLEAN",i[i.STRING=2]="STRING",n.URL_PROPERTIES=[{name:"DEBUG",type:r.BOOLEAN},{name:"IS_BROWSER",type:r.BOOLEAN},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:r.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:r.BOOLEAN},{name:"WEBGL_VERSION",type:r.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:r.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:r.BOOLEAN},{name:"WEBGL_FENCE_API_ENABLED",type:r.BOOLEAN},{name:"BACKEND",type:r.STRING}],n.isWebGLVersionEnabled=function(e,t){var n;try{n=s(e,t)}catch(e){return!1}return null!=n&&(u(n),!0)},n.getWebGLDisjointQueryTimerVersion=function(e,t){if(0===e)return 0;var n,r=s(e,t);return n=a(r,"EXT_disjoint_timer_query_webgl2")&&2===e?2:a(r,"EXT_disjoint_timer_query")?1:0,null!=r&&u(r),n},n.isRenderToFloatTextureEnabled=function(e,t){if(0===e)return!1;var n=s(e,t);if(1===e){if(!a(n,"OES_texture_float"))return!1}else if(!a(n,"EXT_color_buffer_float"))return!1;l(n,e);var r=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return u(n),r},n.isDownloadFloatTextureEnabled=function(e,t){if(0===e)return!1;var n=s(e,t);if(1===e){if(!a(n,"OES_texture_float"))return!1}else if(!a(n,"EXT_color_buffer_float"))return!1;l(n,e),n.readPixels(0,0,1,1,n.RGBA,n.FLOAT,new Float32Array(4));var r=n.getError()===n.NO_ERROR;return u(n),r},n.isWebGLFenceEnabled=function(e,t){if(2!==e)return!1;var n=s(e,t),r=null!=n.fenceSync;return u(n),r},n.isChrome=function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)};var o="tfjsflags";function a(e,t){return null!=e.getExtension(t)}function s(e,t){if(0===e||!t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=document.createElement("canvas");return 1===e?n.getContext("webgl")||n.getContext("experimental-webgl"):n.getContext("webgl2")}function u(e){if(null!=e){var t=e.getExtension("WEBGL_lose_context");if(null==t)throw new Error("Extension WEBGL_lose_context not supported on this browser.");t.loseContext()}}function l(e,t){var n=e.createFramebuffer(),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var i=2===t?e.RGBA32F:e.RGBA;e.texImage2D(e.TEXTURE_2D,0,i,1,1,0,e.RGBA,e.FLOAT,null),e.bindFramebuffer(e.FRAMEBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0)}function c(e){var a={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(e){for(var t,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];return t=a,n=i[0],r=i[1],t[decodeURIComponent(n)]=decodeURIComponent(r||""),i.join("=")}),a}n.getFeaturesFromURL=function(){var t={};if("undefined"==typeof window||void 0===window.location)return t;var e=c(window.location.search);if(o in e){var i={};e[o].split(",").forEach(function(e){var t=e.split(":"),n=t[0],r=t[1];i[n]=r}),n.URL_PROPERTIES.forEach(function(e){e.name in i&&(console.log("Setting feature override from URL "+e.name+": "+i[e.name]),e.type===r.NUMBER?t[e.name]=+i[e.name]:e.type===r.BOOLEAN?t[e.name]="true"===i[e.name]:e.type===r.STRING?t[e.name]=i[e.name]:console.warn("Unknown URL param: "+e.name+"."))})}return t},n.getQueryParams=c},{}],64:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./environment"),i=e("./gradients");n.customGrad=i.customGrad,n.grad=i.grad,n.grads=i.grads,n.valueAndGrad=i.valueAndGrad,n.valueAndGrads=i.valueAndGrads,n.variableGrads=i.variableGrads,n.tidy=r.Environment.tidy,n.keep=r.Environment.keep,n.dispose=r.Environment.dispose,n.time=r.Environment.time},{"./environment":62,"./gradients":65}],65:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=e("./environment"),l=e("./tensor"),c=e("./util");function a(e){if(0<e.filter(function(e){return null==e}).length)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}n.gradScope=function(e,t){return u.ENV.engine.tidy(e,t,!0)},n.grad=function(o){return c.assert(c.isFunction(o),"The f passed in grad(f) must be a function"),function(r,i){return c.assert(r instanceof l.Tensor,"The x passed in grad(f)(x) must be a tensor"),c.assert(null==i||i instanceof l.Tensor,"The dy passed in grad(f)(x, dy) must be a tensor"),u.ENV.engine.tidy(function(){var e=u.ENV.engine.gradients(function(){return o(r)},[r],i),t=e.value,n=e.grads;return null!=i&&c.assertShapesMatch(t.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),a(n),n[0]})}},n.grads=function(o){return c.assert(c.isFunction(o),"The f passed in grads(f) must be a function"),function(r,i){return c.assert(Array.isArray(r)&&r.every(function(e){return e instanceof l.Tensor}),"The args passed in grads(f)(args) must be an array of tensors"),c.assert(null==i||i instanceof l.Tensor,"The dy passed in grads(f)(args, dy) must be a tensor"),u.ENV.engine.tidy(function(){var e=u.ENV.engine.gradients(function(){return o.apply(void 0,r)},r,i),t=e.value,n=e.grads;return null!=i&&c.assertShapesMatch(t.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),a(n),n})}},n.valueAndGrad=function(o){return c.assert(c.isFunction(o),"The f passed in valueAndGrad(f) must be a function"),function(e,t){c.assert(e instanceof l.Tensor,"The x passed in valueAndGrad(f)(x) must be a tensor"),c.assert(null==t||t instanceof l.Tensor,"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");var n=u.ENV.engine.gradients(function(){return o(e)},[e],t),r=n.grads,i=n.value;return a(r),{grad:r[0],value:i}}},n.valueAndGrads=function(r){return c.assert(c.isFunction(r),"The f passed in valueAndGrads(f) must be a function"),function(e,t){c.assert(Array.isArray(e)&&e.every(function(e){return e instanceof l.Tensor}),"The args passed in valueAndGrads(f)(args) must be array of tensors"),c.assert(null==t||t instanceof l.Tensor,"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");var n=u.ENV.engine.gradients(function(){return r.apply(void 0,e)},e,t);return null!=t&&c.assertShapesMatch(n.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),a(n.grads),n}},n.variableGrads=function(e,t){if(c.assert(c.isFunction(e),"The f passed in variableGrads(f) must be a function"),c.assert(null==t||Array.isArray(t)&&t.every(function(e){return e instanceof l.Variable}),"The varList passed in variableGrads(f, varList) must be an array of variables"),null==t)for(var n in t=[],u.ENV.engine.registeredVariables)t.push(u.ENV.engine.registeredVariables[n]);var r=t.length;t=t.filter(function(e){return e.trainable}),c.assert(0<t.length,"variableGrads() expects at least one of the input variables to be trainable, but none of the "+r+" variables is trainable.");var i=u.ENV.engine.gradients(e,t,null,!0),o=i.value,a=i.grads;c.assert(a.some(function(e){return null!=e}),"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),c.assert(0===o.rank,"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+o.rank+" tensor");var s={};return t.forEach(function(e,t){null!=a[t]&&(s[e.name]=a[t])}),{value:o,grads:s}},n.customGrad=function(e){return u.ENV.engine.customGrad(e)}},{"./environment":62,"./tensor":180,"./util":187}],66:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),e("./kernels/backend_webgl"),e("./kernels/backend_cpu");var i=e("./browser_util");n.nextFrame=i.nextFrame;var o=e("./environment");n.environment=o;var a=e("./environment"),s=e("./io/io");n.io=s;var u=e("./serialization");n.serialization=u;var l=e("./tensor"),c=e("./test_util");n.test_util=c;var p=e("./util");n.util=p;var h=e("./version");n.version_core=h.version;var f=e("./webgl");n.webgl=f;var d=e("./optimizers/adadelta_optimizer");n.AdadeltaOptimizer=d.AdadeltaOptimizer;var m=e("./optimizers/adagrad_optimizer");n.AdagradOptimizer=m.AdagradOptimizer;var y=e("./optimizers/adam_optimizer");n.AdamOptimizer=y.AdamOptimizer;var g=e("./optimizers/adamax_optimizer");n.AdamaxOptimizer=g.AdamaxOptimizer;var v=e("./optimizers/momentum_optimizer");n.MomentumOptimizer=v.MomentumOptimizer;var b=e("./optimizers/optimizer");n.Optimizer=b.Optimizer;var _=e("./optimizers/rmsprop_optimizer");n.RMSPropOptimizer=_.RMSPropOptimizer;var w=e("./optimizers/sgd_optimizer");n.SGDOptimizer=w.SGDOptimizer;var S=e("./tensor");n.Tensor=S.Tensor,n.TensorBuffer=S.TensorBuffer,n.variable=S.variable,n.Variable=S.Variable;var x=e("./types");n.Rank=x.Rank,r(e("./ops/ops"));var T=e("./ops/loss_ops");n.Reduction=T.Reduction,r(e("./train")),r(e("./globals"));var P=e("./environment");n.ENV=P.ENV,n.Environment=P.Environment,n.setBackend=a.Environment.setBackend,n.getBackend=a.Environment.getBackend,n.disposeVariables=a.Environment.disposeVariables,n.memory=a.Environment.memory;var N=e("./ops/ops");l.setOpHandler(N)},{"./browser_util":59,"./environment":62,"./globals":64,"./io/io":70,"./kernels/backend_cpu":78,"./kernels/backend_webgl":80,"./ops/loss_ops":142,"./ops/ops":149,"./optimizers/adadelta_optimizer":167,"./optimizers/adagrad_optimizer":168,"./optimizers/adam_optimizer":169,"./optimizers/adamax_optimizer":170,"./optimizers/momentum_optimizer":171,"./optimizers/optimizer":172,"./optimizers/rmsprop_optimizer":175,"./optimizers/sgd_optimizer":176,"./serialization":178,"./tensor":180,"./test_util":184,"./train":185,"./types":186,"./util":187,"./version":188,"./webgl":189}],67:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},u=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../environment"),f=e("./io_utils"),o=e("./router_registry"),a=function(){function t(e){if(!i.ENV.get("IS_BROWSER"))throw new Error("triggerDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelTopologyFileName=e+".json",this.weightDataFileName=e+".weights.bin"}return t.prototype.save=function(s){return r(this,void 0,void 0,function(){var t,n,r,i,o,a;return u(this,function(e){if(t=window.URL.createObjectURL(new Blob([s.weightData],{type:"application/octet-stream"})),s.modelTopology instanceof ArrayBuffer)throw new Error("DownloadTrigger.save() does not support saving model topology in binary formats yet.");return n=[{paths:["./"+this.weightDataFileName],weights:s.weightSpecs}],r={modelTopology:s.modelTopology,weightsManifest:n},i=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(o=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=i,o.click(),null!=s.weightData&&((a=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=t,a.click()),[2,{modelArtifactsInfo:f.getModelArtifactsInfoForJSON(s)}]})})},t.URL_SCHEME="downloads://",t}();n.BrowserDownloads=a;var s=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return r(this,void 0,void 0,function(){var r,p,h=this;return u(this,function(e){return r=this.files[0],p=this.files.slice(1),[2,new Promise(function(l,c){var e=new FileReader;e.onload=function(e){var t=JSON.parse(e.target.result),i=t.modelTopology;if(null!=i){0===p.length&&l({modelTopology:i});var n=t.weightsManifest;if(null!=n){var o;try{o=h.checkManifestAndWeightFiles(n,p)}catch(e){return void c(e)}var a=[],s=[],u=[];n.forEach(function(e){e.paths.forEach(function(e){s.push(e),u.push(null)}),a.push.apply(a,e.weights)}),n.forEach(function(e){e.paths.forEach(function(r){var e=new FileReader;e.onload=function(e){var t=e.target.result,n=s.indexOf(r);u[n]=t,-1===u.indexOf(null)&&l({modelTopology:i,weightSpecs:a,weightData:f.concatenateArrayBuffers(u)})},e.onerror=function(e){c("Failed to weights data from file of path '"+r+"'.")},e.readAsArrayBuffer(o[r])})})}else c(new Error("weightManifest field is missing from file "+r.name))}else c(new Error("modelTopology field is missing from file "+r.name))},e.onerror=function(e){c("Failed to read model topology and weights manifest JSON from file '"+r.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},e.readAsText(r)})]})})},e.prototype.checkManifestAndWeightFiles=function(e,n){for(var r=[],i=n.map(function(e){return f.basename(e.name)}),o={},t=0,a=e;t<a.length;t++){a[t].paths.forEach(function(e){var t=f.basename(e);if(-1!==r.indexOf(t))throw new Error("Duplicate file basename found in weights manifest: '"+t+"'");if(r.push(t),-1===i.indexOf(t))throw new Error("Weight file with basename '"+t+"' is not provided.");o[e]=n[i.indexOf(t)]})}if(r.length!==n.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+n.length+").");return o},e}();function l(e){return void 0===e&&(e="model"),new a(e)}n.browserDownloadsRouter=function(e){return i.ENV.get("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(a.URL_SCHEME)?l(e.slice(a.URL_SCHEME.length)):null},o.IORouterRegistry.registerSaveRouter(n.browserDownloadsRouter),n.browserDownloads=l,n.browserFiles=function(e){return new s(e)}},{"../environment":62,"./io_utils":71,"./router_registry":75}],68:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},p=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../util"),h=e("./io_utils"),o=e("./router_registry"),f=e("./weights_loader"),a=function(){function e(e,t){if(this.DEFAULT_METHOD="POST","undefined"==typeof fetch)throw new Error("browserHTTPRequest is not supported outside the web browser without a fetch polyfill.");if(i.assert(null!=e&&0<e.length,"URL path for browserHTTPRequest must not be null, undefined or empty."),Array.isArray(e)&&i.assert(2===e.length,"URL paths for browserHTTPRequest must have a length of 2, (actual length is "+e.length+")."),this.path=e,null!=t&&null!=t.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t||{}}return e.prototype.save=function(o){return r(this,void 0,void 0,function(){var t,n,r,i;return p(this,function(e){switch(e.label){case 0:if(o.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:o.weightSpecs}],r={modelTopology:o.modelTopology,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=o.weightData&&t.body.append("model.weights.bin",new Blob([o.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,fetch(this.path,t)];case 1:if(200===(i=e.sent()).status)return[2,{modelArtifactsInfo:h.getModelArtifactsInfoForJSON(o),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},e.prototype.load=function(){return r(this,void 0,void 0,function(){return p(this,function(e){return[2,Array.isArray(this.path)?this.loadBinaryModel():this.loadJSONModel()]})})},e.prototype.loadBinaryTopology=function(){return r(this,void 0,void 0,function(){var t;return p(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,fetch(this.path[0],this.requestInit)];case 1:return[4,e.sent().arrayBuffer()];case 2:return[2,e.sent()];case 3:throw t=e.sent(),new Error(this.path[0]+" not found. "+t);case 4:return[2]}})})},e.prototype.loadBinaryModel=function(){return r(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u;return p(this,function(e){switch(e.label){case 0:return n=this.loadBinaryTopology(),[4,fetch(this.path[1],this.requestInit)];case 1:return r=e.sent(),[4,Promise.all([n,r])];case 2:return i=e.sent(),o=i[0],[4,i[1].json()];case 3:return null==(a=e.sent())?[3,5]:[4,this.loadWeights(a)];case 4:t=e.sent(),s=t[0],u=t[1],e.label=5;case 5:return[2,{modelTopology:o,weightSpecs:s,weightData:u}]}})})},e.prototype.loadJSONModel=function(){return r(this,void 0,void 0,function(){var t,n,r,i,o,a,s;return p(this,function(e){switch(e.label){case 0:return[4,fetch(this.path,this.requestInit)];case 1:return[4,e.sent().json()];case 2:if(n=e.sent(),r=n.modelTopology,i=n.weightsManifest,null==r&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,4]:(s=n.weightsManifest,[4,this.loadWeights(s)]);case 3:t=e.sent(),o=t[0],a=t[1],e.label=4;case 4:return[2,{modelTopology:r,weightSpecs:o,weightData:a}]}})})},e.prototype.loadWeights=function(c){return r(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,l;return p(this,function(e){switch(e.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=[],r=0,i=c;r<i.length;r++)o=i[r],n.push.apply(n,o.weights);return(a=t.substring(0,t.lastIndexOf("/"))).endsWith("/")||(a+="/"),s=[],c.forEach(function(e){e.paths.forEach(function(e){s.push(a+e)})}),u=[n],l=h.concatenateArrayBuffers,[4,f.loadWeightsAsArrayBuffer(s,this.requestInit)];case 1:return[2,u.concat([l.apply(void 0,[e.sent()])])]}})})},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function s(e){return null!=e.match(a.URL_SCHEME_REGEX)}function u(e,t){return new a(e,t)}n.BrowserHTTPRequest=a,n.httpRequestRouter=function(e){if("undefined"==typeof fetch)return null;return(Array.isArray(e)?e.every(function(e){return s(e)}):s(e))?u(e):null},o.IORouterRegistry.registerSaveRouter(n.httpRequestRouter),o.IORouterRegistry.registerLoadRouter(n.httpRequestRouter),n.browserHTTPRequest=u},{"../util":187,"./io_utils":71,"./router_registry":75,"./weights_loader":77}],69:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},i=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../environment"),f=e("./io_utils"),a=e("./model_management"),s=e("./router_registry"),d="tensorflowjs",m="models_store",y="model_info_store";function u(){if(!o.ENV.get("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function g(e){var t=e.result;t.createObjectStore(m,{keyPath:"modelPath"}),t.createObjectStore(y,{keyPath:"modelPath"})}n.deleteDatabase=function(){return r(this,void 0,void 0,function(){var r;return i(this,function(e){return r=u(),[2,new Promise(function(e,t){var n=r.deleteDatabase(d);n.onsuccess=function(){return e()},n.onerror=function(e){return t(e)}})]})})};var l=function(){function e(e){if(this.indexedDB=u(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(t){return r(this,void 0,void 0,function(){return i(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},e.prototype.load=function(){return r(this,void 0,void 0,function(){return i(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(e,p){var h=this;return new Promise(function(u,l){var c=h.indexedDB.open(d,1);c.onupgradeneeded=function(){return g(c)},c.onsuccess=function(){var r=c.result;if(null==p){var e=r.transaction(m,"readonly"),t=e.objectStore(m).get(h.modelPath);t.onsuccess=function(){if(null==t.result)return r.close(),l(new Error("Cannot find model with path '"+h.modelPath+"' in IndexedDB."));u(t.result.modelArtifacts)},t.onerror=function(e){return r.close(),l(t.error)},e.oncomplete=function(){return r.close()}}else{var i,o=f.getModelArtifactsInfoForJSON(p),a=r.transaction(y,"readwrite"),s=a.objectStore(y),n=s.put({modelPath:h.modelPath,modelArtifactsInfo:o});n.onsuccess=function(){var n=(i=r.transaction(m,"readwrite")).objectStore(m).put({modelPath:h.modelPath,modelArtifacts:p,modelArtifactsInfo:o});n.onsuccess=function(){return u({modelArtifactsInfo:o})},n.onerror=function(e){var t=(s=a.objectStore(y)).delete(h.modelPath);t.onsuccess=function(){return r.close(),l(n.error)},t.onerror=function(e){return r.close(),l(n.error)}}},n.onerror=function(e){return r.close(),l(n.error)},a.oncomplete=function(){null==i?r.close():i.oncomplete=function(){return r.close()}}}},c.onerror=function(e){return l(c.error)}})},e.URL_SCHEME="indexeddb://",e}();function c(e){return new l(e)}n.BrowserIndexedDB=l,n.indexedDBRouter=function(e){return o.ENV.get("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(l.URL_SCHEME)?c(e.slice(l.URL_SCHEME.length)):null},s.IORouterRegistry.registerSaveRouter(n.indexedDBRouter),s.IORouterRegistry.registerLoadRouter(n.indexedDBRouter),n.browserIndexedDB=c;var p=function(){function e(){this.indexedDB=u()}return e.prototype.listModels=function(){return r(this,void 0,void 0,function(){var t=this;return i(this,function(e){return[2,new Promise(function(o,n){var r=t.indexedDB.open(d,1);r.onupgradeneeded=function(){return g(r)},r.onsuccess=function(){var t=r.result,e=t.transaction(y,"readonly"),i=e.objectStore(y).getAll();i.onsuccess=function(){for(var e={},t=0,n=i.result;t<n.length;t++){var r=n[t];e[r.modelPath]=r.modelArtifactsInfo}o(e)},i.onerror=function(e){return t.close(),n(i.error)},e.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})]})})},e.prototype.removeModel=function(u){return r(this,void 0,void 0,function(){var n=this;return i(this,function(e){var t;return u=(t=u).startsWith(l.URL_SCHEME)?t.slice(l.URL_SCHEME.length):t,[2,new Promise(function(a,s){var t=n.indexedDB.open(d,1);t.onupgradeneeded=function(){return g(t)},t.onsuccess=function(){var n,r=t.result,e=r.transaction(y,"readwrite"),i=e.objectStore(y),o=i.get(u);o.onsuccess=function(){if(null==o.result)return r.close(),s(new Error("Cannot find model with path '"+u+"' in IndexedDB."));var e=i.delete(u),t=function(){var e=(n=r.transaction(m,"readwrite")).objectStore(m).delete(u);e.onsuccess=function(){return a(o.result.modelArtifactsInfo)},e.onerror=function(e){return s(o.error)}};e.onsuccess=t,e.onerror=function(e){return t(),r.close(),s(o.error)}},o.onerror=function(e){return r.close(),s(o.error)},e.oncomplete=function(){null==n?r.close():n.oncomplete=function(){return r.close()}}},t.onerror=function(e){return s(t.error)}})]})})},e}();if(n.BrowserIndexedDBManager=p,o.ENV.get("IS_BROWSER"))try{a.ModelStoreManagerRegistry.registerManager(l.URL_SCHEME,new p)}catch(e){}},{"../environment":62,"./io_utils":71,"./model_management":73,"./router_registry":75}],70:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),e("./indexed_db"),e("./local_storage");var r=e("./browser_files");n.browserFiles=r.browserFiles;var i=e("./browser_http");n.browserHTTPRequest=i.browserHTTPRequest;var o=e("./io_utils");n.concatenateArrayBuffers=o.concatenateArrayBuffers,n.decodeWeights=o.decodeWeights,n.encodeWeights=o.encodeWeights,n.getModelArtifactsInfoForJSON=o.getModelArtifactsInfoForJSON;var a=e("./passthrough");n.fromMemory=a.fromMemory,n.withSaveHandler=a.withSaveHandler;var s=e("./router_registry"),u=e("./weights_loader");n.loadWeights=u.loadWeights;var l=s.IORouterRegistry.registerSaveRouter;n.registerSaveRouter=l;var c=s.IORouterRegistry.registerLoadRouter;n.registerLoadRouter=c;var p=s.IORouterRegistry.getSaveHandlers;n.getSaveHandlers=p;var h=s.IORouterRegistry.getLoadHandlers;n.getLoadHandlers=h;var f=e("./model_management");n.copyModel=f.copyModel,n.listModels=f.listModels,n.moveModel=f.moveModel,n.removeModel=f.removeModel},{"./browser_files":67,"./browser_http":68,"./indexed_db":69,"./io_utils":71,"./local_storage":72,"./model_management":73,"./passthrough":74,"./router_registry":75,"./weights_loader":77}],71:[function(n,e,r){(function(o){"use strict";var e=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},a=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(r,"__esModule",{value:!0});var m=n("../ops/tensor_ops"),y=n("../util"),g=n("./types");function s(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach(function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)});var r=new Uint8Array(t),i=0;return n.forEach(function(e){r.set(new Uint8Array(e.buffer),i),i+=e.byteLength}),r.buffer}r.encodeWeights=function(o){return e(this,void 0,void 0,function(){var t,n,r,i;return a(this,function(e){switch(e.label){case 0:for(r in t=[],n=[],o){if("float32"!==(i=o[r]).dtype&&"int32"!==i.dtype&&"bool"!==i.dtype)throw new Error("Unsupported dtype in weight '"+r+"': "+i.dtype);t.push({name:r,shape:i.shape,dtype:i.dtype}),n.push(i.data())}return[4,Promise.all(n)];case 1:return[2,{data:s(e.sent()),specs:t}]}})})},r.decodeWeights=function(h,e){for(var f={},d=0,t=function(e){var t=e.name,n=e.dtype,r=e.shape,i=y.sizeFromShape(r),o=void 0;if("quantization"in e){var a=e.quantization;if("uint8"!==a.dtype&&"uint16"!==a.dtype)throw new Error("Weight "+e.name+" has unknown quantization dtype "+a.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var s=g.DTYPE_VALUE_SIZE_MAP[a.dtype],u=h.slice(d,d+i*s),l="uint8"===a.dtype?new Uint8Array(u):new Uint16Array(u);if("float32"===n)o=Float32Array.from(l,function(e){return e*a.scale+a.min});else{if("int32"!==n)throw new Error("Unsupported dtype in weight '"+t+"': "+n);o=Int32Array.from(l,function(e){return Math.round(e*a.scale+a.min)})}d+=i*s}else{var c=g.DTYPE_VALUE_SIZE_MAP[n];if(u=h.slice(d,d+i*c),"float32"===n)o=new Float32Array(u);else if("int32"===n)o=new Int32Array(u);else{if("bool"!==n)throw new Error("Unsupported dtype in weight '"+t+"': "+n);o=new Uint8Array(u)}d+=i*c}var p=void 0;if("float32"===n)p=m.tensor(o,r,"float32");else if("int32"===n)p=m.tensor(o,r,"int32");else{if("bool"!==n)throw new Error("Unsupported dtype in weight '"+t+"': "+n);p=m.tensor(o,r,"bool")}f[t]=p},n=0,r=e;n<r.length;n++)t(r[n]);return f},r.concatenateTypedArrays=s;var u=void 0!==o&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function t(e){return u?o.byteLength(e):new Blob([e]).size}r.stringByteLength=t,r.arrayBufferToBase64String=function(e){return u?o.from(e).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(e)))},r.base64StringToArrayBuffer=function(e){if(u){var t=o.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r.set([n.charCodeAt(i)],i);return r.buffer},r.concatenateArrayBuffers=function(e){var t=0;e.forEach(function(e){t+=e.byteLength});var n=new Uint8Array(t),r=0;return e.forEach(function(e){n.set(new Uint8Array(e),r),r+=e.byteLength}),n.buffer},r.basename=function(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]},r.getModelArtifactsInfoForJSON=function(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:t(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:t(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}}).call(this,n("buffer").Buffer)},{"../ops/tensor_ops":163,"../util":187,"./types":76,buffer:243}],72:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},s=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../environment"),i=e("../util"),u=e("./io_utils"),o=e("./model_management"),l=e("./router_registry"),c="/",p="tensorflowjs_models",h="info",f="model_topology",d="weight_specs",m="weight_data";function y(e){return{info:[p,e,h].join(c),topology:[p,e,f].join(c),weightSpecs:[p,e,d].join(c),weightData:[p,e,m].join(c)}}function g(e){var t=e.split(c);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(c)}n.purgeLocalStorageArtifacts=function(){if(!a.ENV.get("IS_BROWSER")||void 0===window.localStorage)throw new Error("purgeLocalStorageModels() cannot proceed because local storage is unavailable in the current environment.");for(var e=window.localStorage,t=[],n=0;n<e.length;++n){var r=e.key(n),i=p+c;if(r.startsWith(i)&&r.length>i.length){e.removeItem(r);var o=g(r);-1===t.indexOf(o)&&t.push(o)}}return t};var v=function(){function e(e){if(!a.ENV.get("IS_BROWSER")||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=y(this.modelPath)}return e.prototype.save=function(o){return r(this,void 0,void 0,function(){var t,n,r,i;return s(this,function(e){if(o.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(o.modelTopology),n=JSON.stringify(o.weightSpecs),r=u.getModelArtifactsInfoForJSON(o);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,u.arrayBufferToBase64String(o.weightData)),[2,{modelArtifactsInfo:r}]}catch(e){for(i in this.keys)this.LS.removeItem(this.keys[i]);throw new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]})})},e.prototype.load=function(){return r(this,void 0,void 0,function(){var t,n,r,i,o;return s(this,function(e){if(null==(t=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(n={},null==(r=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(n.modelTopology=r,null==(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(n.weightSpecs=i,null==(o=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return n.weightData=u.base64StringToArrayBuffer(o),[2,n]})})},e.URL_SCHEME="localstorage://",e}();function b(e){return new v(e)}n.BrowserLocalStorage=v,n.localStorageRouter=function(e){return a.ENV.get("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(v.URL_SCHEME)?b(e.slice(v.URL_SCHEME.length)):null},l.IORouterRegistry.registerSaveRouter(n.localStorageRouter),l.IORouterRegistry.registerLoadRouter(n.localStorageRouter),n.browserLocalStorage=b;var _=function(){function e(){i.assert(a.ENV.get("IS_BROWSER"),"Current environment is not a web browser"),i.assert(void 0!==window.localStorage,"Current browser does not appear to support localStorage"),this.LS=window.localStorage}return e.prototype.listModels=function(){return r(this,void 0,void 0,function(){var t,n,r,i,o,a;return s(this,function(e){for(t={},n=p+c,r=c+h,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(n)&&o.endsWith(r)&&(a=g(o),t[a]=JSON.parse(this.LS.getItem(o)));return[2,t]})})},e.prototype.removeModel=function(i){return r(this,void 0,void 0,function(){var n,r;return s(this,function(e){var t;if(i=(t=i).startsWith(v.URL_SCHEME)?t.slice(v.URL_SCHEME.length):t,n=y(i),null==this.LS.getItem(n.info))throw new Error("Cannot find model at path '"+i+"'");return r=JSON.parse(this.LS.getItem(n.info)),this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),[2,r]})})},e}();if(n.BrowserLocalStorageManager=_,a.ENV.get("IS_BROWSER"))try{o.ModelStoreManagerRegistry.registerManager(v.URL_SCHEME,new _)}catch(e){}},{"../environment":62,"../util":187,"./io_utils":71,"./model_management":73,"./router_registry":75}],73:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},f=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var d=e("../util"),m=e("./router_registry"),u="://",y=function(){function r(){this.managers={}}return r.getInstance=function(){return null==r.instance&&(r.instance=new r),r.instance},r.registerManager=function(e,t){d.assert(null!=e,"scheme must not be undefined or null."),e.endsWith(u)&&(e=e.slice(0,e.indexOf(u))),d.assert(0<e.length,"scheme must not be an empty string.");var n=r.getInstance();d.assert(null==n.managers[e],"A model store manager is already registered for scheme '"+e+"'."),n.managers[e]=t},r.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},r.getSchemes=function(){return Object.keys(this.getInstance().managers)},r}();function g(e){if(-1===e.indexOf(u))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+y.getSchemes().join(","));return{scheme:e.split(u)[0],path:e.split(u)[1]}}function i(c,p,h){return void 0===h&&(h=!1),r(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,l;return f(this,function(e){switch(e.label){case 0:return d.assert(c!==p,"Old path and new path are the same: '"+c+"'"),t=m.IORouterRegistry.getLoadHandlers(c),d.assert(0<t.length,"Copying failed because no load handler is found for source URL "+c+"."),d.assert(t.length<2,"Copying failed because more than one ("+t.length+") load handlers for source URL "+c+"."),n=t[0],r=m.IORouterRegistry.getSaveHandlers(p),d.assert(0<r.length,"Copying failed because no save handler is found for destination URL "+p+"."),d.assert(r.length<2,"Copying failed because more than one ("+t.length+") save handlers for destination URL "+p+"."),i=r[0],o=g(c).scheme,a=g(c).path,s=o===g(c).scheme,[4,n.load()];case 1:return u=e.sent(),h&&s?[4,y.getManager(o).removeModel(a)]:[3,3];case 2:e.sent(),e.label=3;case 3:return[4,i.save(u)];case 4:return l=e.sent(),!h||s?[3,6]:[4,y.getManager(o).removeModel(a)];case 5:e.sent(),e.label=6;case 6:return[2,l.modelArtifactsInfo]}})})}n.ModelStoreManagerRegistry=y,n.listModels=function(){return r(this,void 0,void 0,function(){var t,n,r,i,o,a,s;return f(this,function(e){switch(e.label){case 0:t=y.getSchemes(),n={},r=0,i=t,e.label=1;case 1:return r<i.length?(o=i[r],[4,y.getManager(o).listModels()]):[3,4];case 2:for(s in a=e.sent())n[o+u+s]=a[s];e.label=3;case 3:return r++,[3,1];case 4:return[2,n]}})})},n.removeModel=function(n){return r(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return t=g(n),[4,y.getManager(t.scheme).removeModel(t.path)];case 1:return[2,e.sent()]}})})},n.copyModel=function(t,n){return r(this,void 0,void 0,function(){return f(this,function(e){switch(e.label){case 0:return[4,i(t,n,!1)];case 1:return[2,e.sent()]}})})},n.moveModel=function(t,n){return r(this,void 0,void 0,function(){return f(this,function(e){switch(e.label){case 0:return[4,i(t,n,!0)];case 1:return[2,e.sent()]}})})}},{"../util":187,"./router_registry":75}],74:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},o=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t,n){this.modelTopology=e,this.weightSpecs=t,this.weightData=n}return e.prototype.load=function(){return i(this,void 0,void 0,function(){var t;return o(this,function(e){return t={},null!=this.modelTopology&&(t=r({modelTopology:this.modelTopology},t)),null!=this.weightSpecs&&0<this.weightSpecs.length&&(t=r({weightSpecs:this.weightSpecs},t)),null!=this.weightData&&0<this.weightData.byteLength&&(t=r({weightData:this.weightData},t)),[2,t]})})},e}(),s=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(t){return i(this,void 0,void 0,function(){return o(this,function(e){return[2,this.saveHandler(t)]})})},e}();n.fromMemory=function(e,t,n){return new a(e,t,n)},n.withSaveHandler=function(e){return new s(e)}},{}],75:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(e){t.getInstance().saveRouters.push(e)},t.registerLoadRouter=function(e){t.getInstance().loadRouters.push(e)},t.getSaveHandlers=function(e){return t.getHandlers(e,"save")},t.getLoadHandlers=function(e){return t.getHandlers(e,"load")},t.getHandlers=function(n,e){var r=[];return("load"===e?this.getInstance().loadRouters:this.getInstance().saveRouters).forEach(function(e){var t=e(n);null!==t&&r.push(t)}),r},t}();n.IORouterRegistry=r},{}],76:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DTYPE_VALUE_SIZE_MAP={float32:4,int32:4,uint16:2,uint8:1,bool:1}},{}],77:[function(e,t,n){"use strict";var a=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},m=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var y=e("../ops/ops"),g=e("../util"),v=e("./types");function b(r,i){return a(this,void 0,void 0,function(){var t,n;return m(this,function(e){switch(e.label){case 0:return t=r.map(function(e){return fetch(e,i)}),[4,Promise.all(t)];case 1:return n=e.sent(),[4,Promise.all(n.map(function(e){return e.arrayBuffer()}))];case 2:return[2,e.sent()]}})})}n.loadWeightsAsArrayBuffer=b,n.loadWeights=function(f,i,d,o){return void 0===i&&(i=""),a(this,void 0,void 0,function(){var a,l,s,u,t,n,r,c,p,h;return m(this,function(e){switch(e.label){case 0:if(a=f.map(function(){return!1}),l={},s=null!=d?d.map(function(){return!1}):[],u=[],f.forEach(function(e,i){var o=0;e.weights.forEach(function(n){var e="quantization"in n?n.quantization.dtype:n.dtype,t=v.DTYPE_VALUE_SIZE_MAP[e]*g.sizeFromShape(n.shape),r=function(){a[i]=!0,null==l[i]&&(l[i]=[]),l[i].push({manifestEntry:n,groupOffset:o,sizeBytes:t})};null!=d?d.forEach(function(e,t){e===n.name&&(r(),s[t]=!0)}):r(),u.push(n.name),o+=t})}),!s.every(function(e){return e}))throw t=d.filter(function(e,t){return!s[t]}),new Error("Could not find weights in manifest with names: "+t.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");return n=a.reduce(function(e,t,n){return t&&e.push(n),e},[]),r=[],n.forEach(function(e){f[e].paths.forEach(function(e){var t=i+(i.endsWith("/")?"":"/")+e;r.push(t)})}),[4,b(r,o)];case 1:return c=e.sent(),p={},h=0,n.forEach(function(e){for(var t=f[e].paths.length,n=0,r=0;r<t;r++)n+=c[h+r].byteLength;for(var s=new ArrayBuffer(n),i=new Uint8Array(s),o=0,a=0;a<t;a++){var u=new Uint8Array(c[h+a]);i.set(u,o),o+=u.byteLength}l[e].forEach(function(e){var t,n=s.slice(e.groupOffset,e.groupOffset+e.sizeBytes),r=e.manifestEntry.dtype;if("quantization"in e.manifestEntry){var i=e.manifestEntry.quantization;if("uint8"!==i.dtype&&"uint16"!==i.dtype)throw new Error("Weight "+e.manifestEntry.name+" has unknown quantization dtype "+i.dtype+".");var o="uint8"===i.dtype?new Uint8Array(n):new Uint16Array(n);if("float32"===r)t=Float32Array.from(o,function(e){return e*i.scale+i.min});else{if("int32"!==r)throw new Error("Weight "+e.manifestEntry.name+" has a dtype not supported by quantization: "+r);t=Int32Array.from(o,function(e){return Math.round(e*i.scale+i.min)})}}else if("float32"===r)t=new Float32Array(n);else if("int32"===r)t=new Int32Array(n);else{if("bool"!==r)throw new Error("Weight "+e.manifestEntry.name+" has unknown dtype "+r+".");t=new Uint8Array(n)}var a=e.manifestEntry.name;if(null!=p[a])throw new Error("Duplicate weight with name "+a+". Please make sure weights names are unique in the manifest JSON.");p[a]=y.tensor(t,e.manifestEntry.shape,e.manifestEntry.dtype)}),h+=t}),[2,p]}})})}},{"../ops/ops":149,"../util":187,"./types":76}],78:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},i=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var b=e("seedrandom"),u=e("../environment"),o=e("../log"),c=e("../ops/array_ops_util"),y=e("../ops/axis_util"),g=e("../ops/broadcast_util"),l=e("../ops/concat_util"),h=e("../ops/erf_util"),X=e("../ops/ops"),w=e("../ops/ops"),s=e("../ops/selu_util"),_=e("../ops/slice_util"),f=e("../tensor"),d=e("../types"),v=e("../util"),a=e("../util"),p=e("./backend_util"),m=e("./non_max_suppression_impl"),S=e("./topk_impl"),x=e("./where_impl"),T=function(){function e(){this.blockSize=48,this.data=new WeakMap,this.firstUse=!0,u.ENV.get("IS_BROWSER")&&(this.canvas=document.createElement("canvas"))}return e.prototype.register=function(e,t,n){if(this.firstUse&&(this.firstUse=!1,u.ENV.get("IS_NODE")&&o.warn("\n============================\nHi there 👋. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================\n")),this.data.has(e))throw new Error("Data buffer is already registered");this.data.set(e,null)},e.prototype.write=function(e,t){if(null==t)throw new Error("MathBackendCPU.write(): values can not be null");this.throwIfNoData(e),this.data.set(e,t)},e.prototype.fromPixels=function(e,t){if(null==e)throw new Error("pixels passed to tf.fromPixels() can not be null");var n,r;if(u.ENV.get("IS_NODE")&&null==e.getContext)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(null!=e.getContext)n=e.getContext("2d").getImageData(0,0,e.width,e.height).data;else if(e instanceof ImageData)n=e.data;else{if(!(e instanceof HTMLImageElement||e instanceof HTMLVideoElement))throw new Error("pixels passed to tf.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+e.constructor.name);if(null==this.canvas)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.canvas.width=e.width,this.canvas.height=e.height,this.canvas.getContext("2d").drawImage(e,0,0,e.width,e.height),n=this.canvas.getContext("2d").getImageData(0,0,e.width,e.height).data}if(4===t)r=new Int32Array(n);else{var i=e.width*e.height;r=new Int32Array(i*t);for(var o=0;o<i;o++)for(var a=0;a<t;++a)r[o*t+a]=n[4*o+a]}var s=[e.height,e.width,t];return w.tensor3d(r,s,"int32")},e.prototype.read=function(t){return r(this,void 0,void 0,function(){return i(this,function(e){return[2,this.readSync(t)]})})},e.prototype.readSync=function(e){return this.throwIfNoData(e),this.data.get(e)},e.prototype.disposeData=function(e){this.data.has(e)&&this.data.delete(e)},e.prototype.time=function(n){return r(this,void 0,void 0,function(){var t;return i(this,function(e){return t=a.now(),n(),[2,{kernelMs:a.now()-t}]})})},e.prototype.memory=function(){return{unreliable:!0}},e.prototype.throwIfNoData=function(e){if(!this.data.has(e))throw new Error("CPU backend: No data found for this tensor. Did you change your backend in the middle of the program? New backends can't use Tensors created with previous backends")},e.prototype.slice=function(e,n,t){for(var r=X.buffer(t,e.dtype),i=0;i<r.size;++i){var o=r.indexToLoc(i),a=o.map(function(e,t){return e+n[t]});r.set.apply(r,[e.get.apply(e,a)].concat(o))}return r.toTensor()},e.prototype.stridedSlice=function(e,t,n,r,i,o,a,s,u){var l=_.getStridedSlicedInfo(e.shape,t,n,r,i,o,a,s,u),c=l[0],p=l[1],h=l[2],f=p.filter(function(e,t){return-1===h.indexOf(t)});if(f.some(function(e){return 0===e}))return X.tensor([],f);for(var d=X.buffer(p,e.dtype),m=0;m<d.size;m++){for(var y=d.indexToLoc(m),g=new Array(y.length),v=0;v<g.length;v++)g[v]=y[v]*r[v]+c[v];d.set.apply(d,[e.get.apply(e,g)].concat(y))}return d.toTensor().reshape(f)},e.prototype.reverse=function(r,i){for(var o=X.buffer(r.shape,r.dtype),a=r.buffer(),e=function(e){var t=o.indexToLoc(e),n=t.slice();i.forEach(function(e){return n[e]=r.shape[e]-1-n[e]}),o.set.apply(o,[a.get.apply(a,n)].concat(t))},t=0;t<o.size;t++)e(t);return o.toTensor()},e.prototype.concat=function(e,t){var n=l.computeOutShape([e.shape,t.shape],1),r=X.buffer(n,e.dtype);if(1===e.shape[0]&&1===t.shape[0]){var i=e.dataSync(),o=t.dataSync(),a=r.values;return a.set(i,0),a.set(o,e.size),r.toTensor()}for(var s=0;s<n[0];++s){for(var u=0;u<e.shape[1];++u)r.set(e.get(s,u),s,u);for(u=0;u<t.shape[1];++u)r.set(t.get(s,u),s,u+e.shape[1])}return r.toTensor()},e.prototype.neg=function(e){return this.multiply(X.scalar(-1),e)},e.prototype.add=function(e,t){return this.broadcastedBinaryOp(e,t,d.upcastType(e.dtype,t.dtype),function(e,t){return e+t})},e.prototype.addN=function(e){for(var t=e.map(function(e){return e.dataSync()}),n=X.buffer(e[0].shape,e[0].dtype),r=n.values,i=0;i<e.length;i++)for(var o=t[i],a=0;a<r.length;a++)r[a]+=o[a];return n.toTensor()},e.prototype.subtract=function(e,t){return this.broadcastedBinaryOp(e,t,d.upcastType(e.dtype,t.dtype),function(e,t){return e-t})},e.prototype.pow=function(e,t){return this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.pow(e,t)})},e.prototype.matMul=function(e,t,n,r){for(var i=n?e.shape[0]:e.shape[1],o=n?e.shape[1]:e.shape[0],a=r?t.shape[0]:t.shape[1],s=e.dataSync(),u=t.dataSync(),l=n?[1,e.strides[0]]:[e.strides[0],1],c=l[0],p=l[1],h=r?[t.strides[0],1]:[1,t.strides[0]],f=h[0],d=h[1],m=new Float32Array(o*a),y=this.blockSize,g=0;g<o;g+=y)for(var v=0;v<a;v+=y)for(var b=0;b<i;b+=y)for(var _=Math.min(g+y,o),w=Math.min(v+y,a),S=Math.min(b+y,i),x=g;x<_;x++)for(var T=v;T<w;T++){for(var P=0,N=b;N<S;N++)P+=s[x*c+N*p]*u[N*d+T*f];m[x*a+T]+=P}return X.tensor2d(m,[o,a])},e.prototype.multiply=function(e,t){return this.broadcastedBinaryOp(e,t,d.upcastType(e.dtype,t.dtype),function(e,t){return e*t})},e.prototype.realDivide=function(e,t){return this.broadcastedBinaryOp(e,t,"float32",function(e,t){return e/t})},e.prototype.floorDiv=function(e,t){return this.broadcastedBinaryOp(e,t,"int32",function(e,t){return Math.floor(e/t)})},e.prototype.sum=function(e,t){y.assertAxesAreInnerMostDims("sum",t,e.rank);for(var n=y.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=d.upcastType(e.dtype,"int32"),a=X.zeros(r,o),s=v.sizeFromShape(i),u=a.dataSync(),l=e.dataSync(),c=0;c<u.length;++c){for(var p=c*s,h=0,f=0;f<s;++f)h+=l[p+f];u[c]=h}return a},e.prototype.unsortedSegmentSum=function(e,t,n){for(var r=[],i=e.rank-t.rank,o=0;o<i;++o)t=t.expandDims(o+1);for(o=0;o<n;++o){var a=X.scalar(o,"int32"),s=X.equal(a,t).asType("float32").mul(e).sum(0);r.push(s)}return X.stack(r)},e.prototype.argMin=function(e,t){var n=[t];y.assertAxesAreInnerMostDims("argMin",n,e.rank);for(var r=y.computeOutAndReduceShapes(e.shape,n),i=r[0],o=r[1],a=X.zeros(i,"int32"),s=v.sizeFromShape(o),u=a.dataSync(),l=e.dataSync(),c=0;c<u.length;++c){for(var p=c*s,h=l[p],f=0,d=0;d<s;++d){var m=l[p+d];m<h&&(h=m,f=d)}u[c]=f}return a},e.prototype.argMax=function(e,t){var n=[t];y.assertAxesAreInnerMostDims("argMax",n,e.rank);for(var r=y.computeOutAndReduceShapes(e.shape,n),i=r[0],o=r[1],a=X.zeros(i,"int32"),s=v.sizeFromShape(o),u=a.dataSync(),l=e.dataSync(),c=0;c<u.length;++c){for(var p=c*s,h=l[p],f=0,d=0;d<s;++d){var m=l[p+d];h<m&&(h=m,f=d)}u[c]=f}return a},e.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var i=d.upcastType(e.dtype,"int32"),o=X.zeros(e.shape,i),a=o.dataSync(),s=e.dataSync(),u=e.shape[e.rank-1],l=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},c=0;c<s.length;c+=u)for(var p=0;p<u;p++){var h=l(c,p);if(0===p)a[h]=n?0:s[h];else{var f=l(c,p-1);a[h]=n?s[f]+a[f]:s[h]+a[f]}}return o},e.prototype.equal=function(e,t){return this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e===t?1:0})},e.prototype.notEqual=function(e,t){return this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e!==t?1:0})},e.prototype.less=function(e,t){return this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<t?1:0})},e.prototype.lessEqual=function(e,t){return this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e<=t?1:0})},e.prototype.greater=function(e,t){return this.broadcastedBinaryOp(e,t,"bool",function(e,t){return t<e?1:0})},e.prototype.greaterEqual=function(e,t){return this.broadcastedBinaryOp(e,t,"bool",function(e,t){return t<=e?1:0})},e.prototype.logicalNot=function(e){for(var t=e.dataSync(),n=new Int32Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return f.Tensor.make(e.shape,{values:n},"bool")},e.prototype.logicalAnd=function(e,t){return this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e&&t})},e.prototype.logicalOr=function(e,t){return this.broadcastedBinaryOp(e,t,"bool",function(e,t){return e||t})},e.prototype.select=function(e,t,n){for(var r=e.dataSync(),i=t.dataSync(),o=n.dataSync(),a=X.zeros(t.shape,d.upcastType(t.dtype,n.dtype)),s=a.dataSync(),u=0,l=0===e.rank||1<e.rank||1===t.rank?1:t.shape[1],c=0;c<r.length;c++)for(var p=0;p<l;p++)1===r[c]?s[u++]=i[c]:s[u++]=o[c];return a},e.prototype.where=function(e){var t=e.dataSync();return x.whereImpl(e.shape,t)},e.prototype.topk=function(e,t,n){var r=e.dataSync();return S.topkImpl(r,e.shape,e.dtype,t,n)},e.prototype.min=function(e,t){y.assertAxesAreInnerMostDims("min",t,e.rank);for(var n=y.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=X.zeros(r,e.dtype),a=v.sizeFromShape(i),s=o.dataSync(),u=e.dataSync(),l=0;l<s.length;++l){for(var c=l*a,p=u[c],h=0;h<a;++h){var f=u[c+h];f<p&&(p=f)}s[l]=p}return o},e.prototype.minimum=function(e,t){return this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.min(e,t)})},e.prototype.mod=function(e,t){return this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e%t;return e<0&&t<0||0<=e&&0<=t?n:(n+t)%t})},e.prototype.max=function(e,t){y.assertAxesAreInnerMostDims("max",t,e.rank);for(var n=y.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=X.zeros(r,e.dtype),a=v.sizeFromShape(i),s=o.dataSync(),u=e.dataSync(),l=0;l<s.length;++l){for(var c=l*a,p=u[c],h=0;h<a;++h){var f=u[c+h];p<f&&(p=f)}s[l]=p}return o},e.prototype.maximum=function(e,t){return this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.max(e,t)})},e.prototype.all=function(e,t){y.assertAxesAreInnerMostDims("all",t,e.rank);for(var n=y.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=X.zeros(r,e.dtype),a=v.sizeFromShape(i),s=o.dataSync(),u=e.dataSync(),l=0;l<s.length;++l){for(var c=l*a,p=u[c],h=0;h<a;++h){var f=u[c+h];p=p&&f}s[l]=p}return o},e.prototype.any=function(e,t){y.assertAxesAreInnerMostDims("any",t,e.rank);for(var n=y.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=X.zeros(r,e.dtype),a=v.sizeFromShape(i),s=o.dataSync(),u=e.dataSync(),l=0;l<s.length;++l){for(var c=l*a,p=u[c],h=0;h<a;++h){var f=u[c+h];p=p||f}s[l]=p}return o},e.prototype.squaredDifference=function(e,t){return this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){var n=e-t;return n*n})},e.prototype.ceil=function(e){for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return f.Tensor.make(e.shape,{values:n})},e.prototype.floor=function(e){for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return f.Tensor.make(e.shape,{values:n})},e.prototype.sign=function(e){for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)t[r]<0?n[r]=-1:0<t[r]?n[r]=1:n[r]=0;return f.Tensor.make(e.shape,{values:n})},e.prototype.round=function(e){for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=Math.floor(t[r]);t[r]-i<.5?n[r]=Math.floor(t[r]):.5<t[r]-i?n[r]=Math.ceil(t[r]):n[r]=i%2==0?i:i+1}return f.Tensor.make(e.shape,{values:n})},e.prototype.exp=function(e){for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return f.Tensor.make(e.shape,{values:n})},e.prototype.expm1=function(e){for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return f.Tensor.make(e.shape,{values:n})},e.prototype.log=function(e){for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.log(i)}return f.Tensor.make(e.shape,{values:n})},e.prototype.log1p=function(e){for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.log1p(i)}return f.Tensor.make(e.shape,{values:n})},e.prototype.sqrt=function(e){for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=Math.sqrt(i)}return f.Tensor.make(e.shape,{values:n})},e.prototype.rsqrt=function(e){for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=1/Math.sqrt(i)}return f.Tensor.make(e.shape,{values:n})},e.prototype.square=function(e){for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=t[r];n[r]=i*i}return f.Tensor.make(e.shape,{values:n})},e.prototype.reciprocal=function(e){for(var t=e.dataSync(),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return f.Tensor.make(e.shape,{values:n})},e.prototype.relu=function(e){for(var t=X.zeros(e.shape,e.dtype),n=t.dataSync(),r=e.dataSync(),i=0;i<r.length;++i)n[i]=Math.max(0,r[i]);return t},e.prototype.elu=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r){var i=n[r];t[r]=0<=i?i:Math.exp(i)-1}return f.Tensor.make(e.shape,{values:t})},e.prototype.eluDer=function(e,t){for(var n=new Float32Array(t.size),r=t.dataSync(),i=e.dataSync(),o=0;o<r.length;++o){var a=r[o];n[o]=1<=a?i[o]:i[o]*(a+1)}return f.Tensor.make(t.shape,{values:n})},e.prototype.selu=function(e){for(var t=s.SELU_SCALEALPHA,n=s.SELU_SCALE,r=new Float32Array(e.size),i=e.dataSync(),o=0;o<i.length;++o){var a=i[o];r[o]=0<=a?n*a:t*(Math.exp(a)-1)}return f.Tensor.make(e.shape,{values:r})},e.prototype.clip=function(e,t,n){for(var r=new Float32Array(e.size),i=e.dataSync(),o=0;o<i.length;++o){var a=i[o];r[o]=n<a?n:a<t?t:a}return f.Tensor.make(e.shape,{values:r})},e.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return f.Tensor.make(e.shape,{values:t})},e.prototype.int=function(e){for(var t=new Int32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=n[r];return f.Tensor.make(e.shape,{values:t},"int32")},e.prototype.sigmoid=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return f.Tensor.make(e.shape,{values:t})},e.prototype.softplus=function(e){for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i){var o=r[i]>-t,a=r[i]<t,s=Math.exp(r[i]),u=void 0;u=a?s:o?r[i]:Math.log(1+s),n[i]=u}return f.Tensor.make(e.shape,{values:n})},e.prototype.sin=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return f.Tensor.make(e.shape,{values:t})},e.prototype.cos=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return f.Tensor.make(e.shape,{values:t})},e.prototype.tan=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return f.Tensor.make(e.shape,{values:t})},e.prototype.asin=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return f.Tensor.make(e.shape,{values:t})},e.prototype.acos=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return f.Tensor.make(e.shape,{values:t})},e.prototype.atan=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return f.Tensor.make(e.shape,{values:t})},e.prototype.atan2=function(e,t){return this.broadcastedBinaryOp(e,t,e.dtype,function(e,t){return Math.atan2(e,t)})},e.prototype.sinh=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return f.Tensor.make(e.shape,{values:t})},e.prototype.cosh=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return f.Tensor.make(e.shape,{values:t})},e.prototype.tanh=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=v.tanh(n[r]);return f.Tensor.make(e.shape,{values:t})},e.prototype.asinh=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return f.Tensor.make(e.shape,{values:t})},e.prototype.acosh=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return f.Tensor.make(e.shape,{values:t})},e.prototype.atanh=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return f.Tensor.make(e.shape,{values:t})},e.prototype.erf=function(e){for(var t=new Float32Array(e.size),n=e.dataSync(),r=h.ERF_P,i=h.ERF_A1,o=h.ERF_A2,a=h.ERF_A3,s=h.ERF_A4,u=h.ERF_A5,l=0;l<n.length;++l){var c=n[l],p=1/(1+r*c);t[l]=1-((((u*p+s)*p+a)*p+o)*p+i)*p*Math.exp(-c*c)}return f.Tensor.make(e.shape,{values:t})},e.prototype.step=function(e,t){void 0===t&&(t=0);for(var n=new Float32Array(e.size),r=e.dataSync(),i=0;i<r.length;++i){var o=r[i];isNaN(o)?n[i]=NaN:n[i]=0<o?1:t}return f.Tensor.make(e.shape,{values:n})},e.prototype.conv2d=function(e,t,n){for(var r=n.filterHeight,i=n.filterWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=X.buffer(n.outShape,e.dtype),c=e.dataSync(),p=t.dataSync(),h=l.values,f=0;f<n.batchSize;++f)for(var d=f*e.strides[0],m=f*l.strides[0],y=0;y<n.outHeight;++y)for(var g=m+y*l.strides[1],v=y*n.strideHeight-s,b=0;b<r;b++){var _=v+b*o;if(!(_<0||_>=n.inHeight))for(var w=b*t.strides[0],S=d+_*e.strides[1],x=0;x<n.outWidth;++x)for(var T=g+x*n.outChannels,P=x*n.strideWidth-u,N=0;N<i;N++){var A=P+N*a;if(!(A<0||A>=n.inWidth))for(var O=w+N*t.strides[1],k=S+A*n.inChannels,E=O,I=0;I<n.inChannels;++I){for(var M=c[k+I],C=0;C<n.outChannels;++C)h[T+C]+=M*p[E+C];E+=n.outChannels}}}return l.toTensor()},e.prototype.conv2dDerInput=function(e,t,n){for(var r=X.buffer(n.inShape,"float32"),i=r.values,o=r.strides,a=o[0],s=o[1],u=o[2],l=e.dataSync(),c=e.strides,p=c[0],h=c[1],f=c[2],d=t.dataSync(),m=t.strides,y=m[0],g=m[1],v=m[2],b=n.batchSize,_=n.filterHeight,w=n.filterWidth,S=n.inChannels,x=n.inHeight,T=n.inWidth,P=n.outChannels,N=n.outHeight,A=n.outWidth,O=n.strideHeight,k=n.strideWidth,E=_-1-n.padInfo.top,I=w-1-n.padInfo.left,M=0;M<b;++M)for(var C=0;C<S;++C)for(var R=0;R<x;++R)for(var z=R-E,D=Math.max(0,Math.ceil(z/O)),L=Math.min(N,(_+z)/O),F=0;F<T;++F){for(var q=F-I,V=Math.max(0,Math.ceil(q/k)),j=Math.min(A,(w+q)/k),B=0,U=D;U<L;++U)for(var G=U*O-z,W=V;W<j;++W)for(var H=p*M+h*U+f*W,Q=y*(_-1-G)+g*(w-1-(W*k-q))+v*C,K=0;K<P;++K){B+=l[H+K]*d[Q+K]}i[a*M+s*R+u*F+C]=B}return r.toTensor()},e.prototype.conv2dDerFilter=function(e,t,n){for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,s=X.buffer(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=0;c<o;++c)for(var p=Math.max(0,Math.ceil((l-c)/r)),h=Math.min(n.outHeight,(n.inHeight+l-c)/r),f=0;f<a;++f)for(var d=Math.max(0,Math.ceil((u-f)/i)),m=Math.min(n.outWidth,(n.inWidth+u-f)/i),y=0;y<n.inChannels;++y)for(var g=0;g<n.outChannels;++g){for(var v=0,b=0;b<n.batchSize;++b)for(var _=p;_<h;++_)for(var w=c+_*r-l,S=d;S<m;++S){var x=f+S*i-u;v+=e.get(b,w,x,y)*t.get(b,_,S,g)}s.set(v,c,f,y,g)}return s.toTensor()},e.prototype.depthwiseConv2D=function(e,t,n){for(var r=n.filterHeight,i=n.filterWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=n.outChannels/n.inChannels,c=X.buffer(n.outShape,e.dtype),p=e.dataSync(),h=t.dataSync(),f=c.values,d=0;d<n.batchSize;++d)for(var m=d*e.strides[0],y=d*c.strides[0],g=0;g<n.outHeight;++g)for(var v=y+g*c.strides[1],b=g*n.strideHeight-s,_=0;_<r;++_){var w=b+_*o;if(!(w<0||w>=n.inHeight))for(var S=_*t.strides[0],x=m+w*e.strides[1],T=0;T<n.outWidth;++T)for(var P=v+T*c.strides[2],N=T*n.strideWidth-u,A=0;A<i;++A){var O=N+A*a;if(!(O<0||O>=n.inWidth))for(var k=S+A*t.strides[1],E=x+O*n.inChannels,I=P,M=k,C=0;C<n.inChannels;++C){for(var R=p[E+C],z=0;z<l;++z)f[I+z]+=R*h[M+z];I+=l,M+=l}}}return c.toTensor()},e.prototype.depthwiseConv2DDerInput=function(e,t,n){for(var r=X.buffer(n.inShape,"float32"),i=r.values,o=r.strides,a=o[0],s=o[1],u=o[2],l=e.dataSync(),c=e.strides,p=c[0],h=c[1],f=c[2],d=t.dataSync(),m=t.strides,y=m[0],g=m[1],v=m[2],b=n.batchSize,_=n.filterHeight,w=n.filterWidth,S=n.inChannels,x=n.inHeight,T=n.inWidth,P=n.outChannels,N=n.outHeight,A=n.outWidth,O=n.strideHeight,k=n.strideWidth,E=_-1-n.padInfo.top,I=w-1-n.padInfo.left,M=P/S,C=0;C<b;++C)for(var R=0;R<S;++R)for(var z=0;z<x;++z)for(var D=z-E,L=Math.max(0,Math.ceil(D/O)),F=Math.min(N,(_+D)/O),q=0;q<T;++q){for(var V=q-I,j=Math.max(0,Math.ceil(V/k)),B=Math.min(A,(w+V)/k),U=0,G=L;G<F;++G)for(var W=G*O-D,H=j;H<B;++H)for(var Q=p*C+h*G+f*H,K=y*(_-1-W)+g*(w-1-(H*k-V))+v*R,$=0;$<M;++$){U+=l[Q+(R*M+$)]*d[K+$]}i[a*C+s*z+u*q+R]=U}return r.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,s=X.buffer(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=n.outChannels/n.inChannels,p=0;p<o;++p)for(var h=Math.max(0,Math.ceil((l-p)/r)),f=Math.min(n.outHeight,(n.inHeight+l-p)/r),d=0;d<a;++d)for(var m=Math.max(0,Math.ceil((u-d)/i)),y=Math.min(n.outWidth,(n.inWidth+u-d)/i),g=0;g<n.outChannels;++g){for(var v=Math.trunc(g/c),b=g%c,_=0,w=0;w<n.batchSize;++w)for(var S=h;S<f;++S)for(var x=p+S*r-l,T=m;T<y;++T){var P=d+T*i-u;_+=e.get(w,x,P,v)*t.get(w,S,T,g)}s.set(_,p,d,v,b)}return s.toTensor()},e.prototype.tile=function(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var i=X.buffer(n,e.dtype),o=e.buffer();for(r=0;r<i.values.length;++r){for(var a=i.indexToLoc(r),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=a[u]%e.shape[u];var l=o.locToIndex(s);i.values[r]=o.values[l]}return i.toTensor()},e.prototype.pad=function(n,e,t){var r=e.map(function(e,t){return e[0]+n.shape[t]+e[1]}),i=e.map(function(e){return e[0]}),o=n.buffer(),a=X.buffer(r,n.dtype);0!==t&&a.values.fill(t);for(var s=0;s<n.size;s++){var u=o.indexToLoc(s),l=u.map(function(e,t){return e+i[t]});a.set.apply(a,[n.get.apply(n,u)].concat(l))}return a.toTensor()},e.prototype.transpose=function(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[t[r]];var i=e.dataSync(),o=w.buffer(n,e.dtype),a=e.buffer();for(r=0;r<e.size;++r){for(var s=a.indexToLoc(r),u=new Array(s.length),l=0;l<u.length;l++)u[l]=s[t[l]];var c=o.locToIndex(u);o.values[c]=i[r]}return o.toTensor()},e.prototype.gather=function(e,t,n){var r=e.shape.slice(),i=t.dataSync();r[n]=i.length;for(var o=w.buffer(r,e.dtype),a=e.buffer(),s=0;s<o.size;++s){var u=o.indexToLoc(s),l=u.slice();l[n]=i[u[n]];var c=a.locToIndex(l);o.values[s]=a.values[c]}return o.toTensor()},e.prototype.batchToSpaceND=function(e,t,n){var r=t.reduce(function(e,t){return e*t}),i=c.getReshaped(e.shape,t,r),o=c.getPermuted(i.length,t.length),a=c.getReshapedPermuted(e.shape,t,r),s=c.getSliceBeginCoords(n,t.length),u=c.getSliceSize(a,n,t.length);return e.reshape(i).transpose(o).reshape(a).slice(s,u)},e.prototype.spaceToBatchND=function(e,t,n){var r=t.reduce(function(e,t){return e*t}),i=[[0,0]];i.push.apply(i,n);for(var o=1+t.length;o<e.shape.length;++o)i.push([0,0]);var a=e.pad(i),s=c.getReshaped(a.shape,t,r,!1),u=c.getPermuted(s.length,t.length,!1),l=c.getReshapedPermuted(a.shape,t,r,!1);return a.reshape(s).transpose(u).reshape(l)},e.prototype.pool=function(e,t,n){for(var r=t.strideHeight,i=t.strideWidth,o=t.filterHeight,a=t.filterWidth,s=X.buffer(t.outShape,"float32"),u=t.padInfo.top,l=t.padInfo.left,c="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=0;p<t.batchSize;++p)for(var h=0;h<t.inChannels;++h)for(var f=0;f<t.outHeight;++f)for(var d=f*r-u,m=Math.max(0,d),y=Math.min(t.inHeight,o+d),g=0;g<t.outWidth;++g){for(var v=g*i-l,b=Math.max(0,v),_=Math.min(t.inWidth,a+v),w=c,S=0,x=0,T=m;T<y;++T){for(var P=b;P<_;++P){var N=e.get(p,T,P,h);"max"===n&&w<N?w=N:"avg"===n&&(S+=N,x++)}if(isNaN(w))break}s.set("avg"===n?S/x:w,p,f,g,h)}return s.toTensor()},e.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},e.prototype.maxPoolPositions=function(e,t){for(var n=X.buffer(t.outShape,"int32"),r=t.strideHeight,i=t.strideWidth,o=t.filterHeight,a=t.filterWidth,s=t.padInfo.top,u=t.padInfo.left,l=0;l<t.batchSize;++l)for(var c=0;c<t.inChannels;++c)for(var p=0;p<t.outHeight;++p)for(var h=p*r-s,f=Math.max(0,h),d=Math.min(t.inHeight,o+h),m=0;m<t.outWidth;++m){for(var y=m*i-u,g=Math.max(0,y),v=Math.min(t.inWidth,a+y),b=Number.NEGATIVE_INFINITY,_=-1,w=f;w<d;++w)for(var S=w-h,x=g;x<v;++x){var T=x-y,P=e.get(l,w,x,c);b<P&&(b=P,_=S*a+T)}n.set(_,l,p,m,c)}return n.toTensor()},e.prototype.maxPoolBackprop=function(e,t,n,r){for(var i=this.maxPoolPositions(t,r),o=r.strideHeight,a=r.strideWidth,s=r.filterHeight,u=r.filterWidth,l=u-1-r.padInfo.left,c=s-1-r.padInfo.top,p=X.buffer(t.shape,"float32"),h=0;h<r.batchSize;++h)for(var f=0;f<r.inChannels;++f)for(var d=0;d<r.inHeight;++d)for(var m=0;m<r.inWidth;++m){for(var y=d-c,g=m-l,v=0,b=0;b<s;++b){var _=(y+b)/o;if(!(_<0||_>=r.outHeight||Math.floor(_)!==_))for(var w=0;w<u;++w){var S=(g+w)/a;if(!(S<0||S>=r.outWidth||Math.floor(S)!==S)){var x=s*u-1-i.get(h,_,S,f)===b*u+w?1:0;if(0!==x)v+=e.get(h,_,S,f)*x}}}p.set(v,h,d,m,f)}return p.toTensor()},e.prototype.avgPoolBackprop=function(e,t,n){for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,s=a-1-n.padInfo.left,u=o-1-n.padInfo.top,l=X.buffer(t.shape,"float32"),c=1/(o*a),p=0;p<n.batchSize;++p)for(var h=0;h<n.inChannels;++h)for(var f=0;f<n.inHeight;++f)for(var d=0;d<n.inWidth;++d){for(var m=f-u,y=d-s,g=0,v=0;v<o;++v){var b=(m+v)/r;if(!(b<0||b>=n.outHeight||Math.floor(b)!==b))for(var _=0;_<a;++_){var w=(y+_)/i;if(!(w<0||w>=n.outWidth||Math.floor(w)!==w))g+=e.get(p,b,w,h)}}l.set(g*c,p,f,d,h)}return l.toTensor()},e.prototype.cast=function(e,t){return p.castTensor(e,t,this)},e.prototype.reshape=function(e,t){return p.reshapeTensor(e,t)},e.prototype.avgPool=function(e,t){return this.pool(e,t,"avg").toFloat()},e.prototype.resizeBilinear=function(e,t,n,r){for(var i=e.shape,o=i[0],a=i[1],s=i[2],u=i[3],l=X.buffer([o,t,n,u],e.dtype),c=[r&&1<t?a-1:a,r&&1<n?s-1:s],p=[r&&1<t?t-1:t,r&&1<n?n-1:n],h=0;h<o;h++)for(var f=0;f<t;f++)for(var d=0;d<n;d++)for(var m=0;m<u;m++){var y=c[0]*f/p[0],g=c[1]*d/p[1],v=Math.floor(y),b=Math.min(a-1,Math.ceil(y)),_=Math.floor(g),w=Math.min(s-1,Math.ceil(g)),S=e.get(h,v,_,m),x=e.get(h,b,_,m),T=g-_,P=S+(e.get(h,v,w,m)-S)*T,N=P+(x+(e.get(h,b,w,m)-x)*T-P)*(y-v);l.set(N,h,f,d,m)}return l.toTensor()},e.prototype.resizeBilinearBackprop=function(e,t,n){for(var r=t.shape,i=r[0],o=r[1],a=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],p=X.buffer([i,o,a,s],t.dtype),h=[n&&1<l?o-1:o,n&&1<c?a-1:a],f=[n&&1<l?l-1:l,n&&1<c?c-1:c],d=h[0]/f[0],m=h[1]/f[1],y=0;y<i;y++)for(var g=0;g<l;g++)for(var v=g*d,b=Math.floor(v),_=Math.min(Math.ceil(v),o-1),w=v-b,S=1-w,x=0;x<c;x++)for(var T=x*m,P=Math.floor(T),N=Math.min(Math.ceil(T),a-1),A=T-P,O=1-A,k=0;k<s;k++){var E=e.get(y,g,x,k),I=p.get(y,b,P,k);I+=E*S*O,p.set(I,y,b,P,k);var M=p.get(y,b,N,k);M+=E*S*A,p.set(M,y,b,N,k);var C=p.get(y,_,P,k);C+=E*w*O,p.set(C,y,_,P,k);var R=p.get(y,_,N,k);R+=E*w*A,p.set(R,y,_,N,k)}return p.toTensor()},e.prototype.resizeNearestNeighbor=function(e,t,n,r){for(var i=e.shape,o=i[0],a=i[1],s=i[2],u=i[3],l=X.buffer([o,t,n,u],e.dtype),c=[r&&1<t?a-1:a,r&&1<n?s-1:s],p=[r&&1<t?t-1:t,r&&1<n?n-1:n],h=0;h<o;h++)for(var f=0;f<t;f++)for(var d=0;d<n;d++)for(var m=0;m<u;m++){var y=c[0]*f/p[0],g=c[1]*d/p[1],v=Math.min(a-1,r?Math.round(y):Math.floor(y)),b=Math.min(s-1,r?Math.round(g):Math.floor(g)),_=e.get(h,v,b,m);l.set(_,h,f,d,m)}return l.toTensor()},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){for(var r=t.shape,i=r[0],o=r[1],a=r[2],s=r[3],u=e.shape,l=u[1],c=u[2],p=X.buffer([i,o,a,s],t.dtype),h=[n&&1<l?o-1:o,n&&1<c?a-1:a],f=[n&&1<l?l-1:l,n&&1<c?c-1:c],d=1/(h[0]/f[0]),m=1/(h[1]/f[1]),y=2*Math.ceil(d)+2,g=2*Math.ceil(m)+2,v=0;v<i;v++)for(var b=0;b<o;b++)for(var _=0;_<a;_++)for(var w=Math.floor(b*d),S=Math.floor(w-y/2),x=Math.floor(_*m),T=Math.floor(x-g/2),P=0;P<s;P++){for(var N=0,A=0;A<y;A++){var O=A+S;if(!(O<0||l<=O))for(var k=0;k<g;k++){var E=k+T;if(!(E<0||c<=E)){var I=h[0]*(O/f[0]),M=h[1]*(E/f[1]),C=Math.min(o-1,n?Math.round(I):Math.floor(I)),R=Math.min(a-1,n?Math.round(M):Math.floor(M));b===C&&_===R&&(N+=e.get(v,O,E,P))}}}p.set(N,v,b,_,P)}return p.toTensor()},e.prototype.batchNormalization=function(e,t,n,r,i,o){for(var a=e.dataSync(),s=t.dataSync(),u=n.dataSync(),l=i?i.dataSync():new Float32Array([1]),c=o?o.dataSync():new Float32Array([0]),p=new Float32Array(a.length),h=c.length,f=l.length,d=u.length,m=s.length,y=0,g=0,v=0,b=0,_=0;_<a.length;++_)p[_]=c[y++]+(a[_]-s[g++])*l[v++]/Math.sqrt(u[b++]+r),h<=y&&(y=0),m<=g&&(g=0),f<=v&&(v=0),d<=b&&(b=0);return w.tensor4d(p,e.shape)},e.prototype.localResponseNormalization4D=function(s,e,t,n,r){var i=X.buffer(s.shape,"float32"),u=e,l=i.shape[3]-1;function o(e,t,n,r){for(var i=0,o=Math.max(0,r-u);o<=Math.min(r+u,l);o++){var a=s.get(e,t,n,o);i+=a*a}return i}for(var a=0;a<i.shape[0];a++)for(var c=0;c<=i.shape[1];c++)for(var p=0;p<i.shape[2];p++)for(var h=0;h<i.shape[3];h++){var f=o(a,c,p,h),d=s.get(a,c,p,h)*Math.pow(t+n*f,-r);i.set(d,a,c,p,h)}return i.toTensor()},e.prototype.LRNGrad=function(e,t,n,r,i,o,a){for(var s=e.shape[0],u=e.shape[1],l=e.shape[2],c=e.shape[3],p=X.buffer([s,u,l,c],"float32"),h=0;h<s;++h)for(var f=0;f<u;++f)for(var d=0;d<l;++d)for(var m=0;m<c;++m){for(var y=Math.max(0,m-r),g=Math.min(c,m+r+1),v=0,b=y;b<g;++b)v+=t.get(h,f,d,b)*t.get(h,f,d,b);v=o*v+i;for(b=y;b<g;++b){var _=-2*o*a*t.get(h,f,d,b)*n.get(h,f,d,m)/v;m===b&&(_+=Math.pow(v,-a)),_*=e.get(h,f,d,m),p.set(_+p.get(h,f,d,b),h,f,d,b)}}return p.toTensor()},e.prototype.multinomial=function(e,t,n,r){for(var i=t?e:X.softmax(e),o=i.shape[0],a=i.shape[1],s=X.zeros([o,n],"int32"),u=s.dataSync(),l=i.dataSync(),c=0;c<o;++c){var p=c*a,h=new Float32Array(a-1);h[0]=l[p];for(var f=1;f<h.length;++f)h[f]=h[f-1]+l[p+f];for(var d=b.alea(r.toString()),m=c*n,y=0;y<n;++y){var g=d();u[m+y]=h.length;for(var v=0;v<h.length;v++)if(g<h[v]){u[m+y]=v;break}}}return s},e.prototype.oneHot=function(e,t,n,r){var i=new Float32Array(e.size*t);i.fill(r);for(var o=0;o<e.size;++o)0<=e.get(o)&&e.get(o)<t&&(i[o*t+e.get(o)]=n);return X.tensor2d(i,[e.size,t],"int32")},e.prototype.nonMaxSuppression=function(e,t,n,r,i){var o=e.dataSync(),a=t.dataSync();return m.nonMaxSuppressionImpl(o,a,n,r,i)},e.prototype.broadcastedBinaryOp=function(a,s,e,u){var t=g.assertAndGetBroadcastShape(a.shape,s.shape),l=X.buffer(t,e),c=a.dataSync(),p=s.dataSync(),h=g.getBroadcastDims(a.shape,t),f=g.getBroadcastDims(s.shape,t),d=l.values;if(h.length+f.length===0)for(var n=0;n<d.length;++n)d[n]=u(c[n%c.length],p[n%p.length]);else{var m=a.buffer(),y=s.buffer(),r=function(e){var t=l.indexToLoc(e),n=t.slice(-a.rank);h.forEach(function(e){return n[e]=0});var r=m.locToIndex(n),i=t.slice(-s.rank);f.forEach(function(e){return i[e]=0});var o=y.locToIndex(i);d[e]=u(c[r],p[o])};for(n=0;n<d.length;++n)r(n)}return l.toTensor()},e.prototype.dispose=function(){},e}();n.MathBackendCPU=T,u.ENV.registerBackend("cpu",function(){return new T},1,f.setTensorTracker)},{"../environment":62,"../log":126,"../ops/array_ops_util":128,"../ops/axis_util":129,"../ops/broadcast_util":132,"../ops/concat_util":135,"../ops/erf_util":138,"../ops/ops":149,"../ops/selu_util":158,"../ops/slice_util":160,"../tensor":180,"../types":186,"../util":187,"./backend_util":79,"./non_max_suppression_impl":81,"./topk_impl":82,"./where_impl":125,seedrandom:258}],79:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../ops/tensor_ops"),i=e("../tensor"),o=e("../util");n.castTensor=function(e,t,n){if(!o.hasEncodingLoss(e.dtype,t))return i.Tensor.make(e.shape,{dataId:e.dataId},t);if("int32"===t)return n.int(e);if("bool"===t)return n.notEqual(e,r.scalar(0,e.dtype));throw new Error("Error in Cast: unknown dtype argument ("+t+")")},n.reshapeTensor=function(e,t){return i.Tensor.make(t,{dataId:e.dataId},e.dtype)}},{"../ops/tensor_ops":163,"../tensor":180,"../util":187}],80:[function(e,t,g){"use strict";var r=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},h=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(g,"__esModule",{value:!0});var f=e("../environment"),s=e("../log"),c=e("../ops/array_ops_util"),p=e("../ops/axis_util"),d=e("../ops/reduce_util"),m=e("../ops/segment_util"),y=e("../ops/slice_util"),v=e("../ops/softmax"),b=e("../ops/tensor_ops"),_=e("../tensor"),w=e("../types"),S=e("../util"),x=e("../util"),n=e("./backend_util"),u=e("./non_max_suppression_impl"),i=e("./topk_impl"),T=e("./webgl/argminmax_gpu"),o=e("./webgl/avg_pool_backprop_gpu"),P=e("./webgl/batchnorm_gpu"),a=e("./webgl/binaryop_gpu"),l=e("./webgl/binaryop_gpu"),N=e("./webgl/clip_gpu"),A=e("./webgl/concat_gpu"),O=e("./webgl/conv_backprop_gpu"),k=e("./webgl/conv_backprop_gpu_depthwise"),E=e("./webgl/conv_gpu"),I=e("./webgl/conv_gpu_depthwise"),M=e("./webgl/cumsum_gpu"),C=e("./webgl/encode_float_gpu"),R=e("./webgl/from_pixels_gpu"),z=e("./webgl/gather_gpu"),D=e("./webgl/gpgpu_context"),L=e("./webgl/gpgpu_math"),F=e("./webgl/gpgpu_util"),q=e("./webgl/lrn_gpu"),V=e("./webgl/lrn_grad_gpu"),j=e("./webgl/max_pool_backprop_gpu"),B=e("./webgl/mulmat_gpu"),U=e("./webgl/multinomial_gpu"),G=e("./webgl/onehot_gpu"),W=e("./webgl/pad_gpu"),H=e("./webgl/pool_gpu"),Q=e("./webgl/reduce_gpu"),K=e("./webgl/resize_bilinear_backprop_gpu"),$=e("./webgl/resize_bilinear_gpu"),X=e("./webgl/resize_nearest_neighbor_backprop_gpu"),Y=e("./webgl/resize_nearest_neighbor_gpu"),J=e("./webgl/reverse_gpu"),Z=e("./webgl/segment_gpu"),ee=e("./webgl/select_gpu"),te=e("./webgl/slice_gpu"),ne=e("./webgl/strided_slice_gpu"),re=e("./webgl/tex_util"),ie=e("./webgl/texture_manager"),oe=e("./webgl/tile_gpu"),ae=e("./webgl/transpose_gpu"),se=e("./webgl/unaryop_gpu"),ue=e("./webgl/unaryop_gpu"),le=e("./webgl/webgl_util"),ce=e("./where_impl");g.SIZE_UPLOAD_UNIFORM=32;var pe=function(){function e(e,t){if(void 0===t&&(t=!0),this.gpgpu=e,this.delayedStorage=t,this.texData=new WeakMap,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.lruDataGPU=[],this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.binaryCache={},this.disposed=!1,f.ENV.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");f.ENV.get("IS_BROWSER")&&(this.canvas=document.createElement("canvas")),null==e?(this.gpgpu=new D.GPGPUContext(F.createWebGLContext(this.canvas)),this.gpgpuCreatedLocally=!0):this.gpgpuCreatedLocally=!1,this.NUM_BYTES_BEFORE_PAGING=window.screen.height*window.screen.width*window.devicePixelRatio*300,this.textureManager=new ie.TextureManager(this.gpgpu)}return e.prototype.register=function(e,t,n){if(this.texData.has(e))throw new Error("Data buffer is already registered");this.texData.set(e,{shape:t,dtype:n,values:null,texture:null,texShape:null,usage:re.TextureUsage.RENDER})},e.prototype.fromPixels=function(e,t){if(null==e)throw new Error("pixels passed to tf.fromPixels() can not be null");var n=[e.height,e.width],r=[e.height,e.width,t];if(!(e instanceof HTMLVideoElement||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData))throw new Error("pixels passed to tf.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+e.constructor.name);if(e instanceof HTMLVideoElement){if(null==this.fromPixelsCanvas){if(!f.ENV.get("IS_BROWSER"))throw new Error("Can't read pixels from HTMLImageElement outside the browser.");if("complete"!==document.readyState)throw new Error("The DOM is not ready yet. Please call tf.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixelsCanvas=document.createElement("canvas")}this.fromPixelsCanvas.width=e.width,this.fromPixelsCanvas.height=e.height,this.fromPixelsCanvas.getContext("2d").drawImage(e,0,0,e.width,e.height),e=this.fromPixelsCanvas}var i=_.Tensor.make(n,{},"int32");this.texData.get(i.dataId).usage=re.TextureUsage.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(i.dataId),e);var o=new R.FromPixelsProgram(r),a=this.compileAndRun(o,[i]);return i.dispose(),a},e.prototype.write=function(e,t){if(null==t)throw new Error("MathBackendWebGL.write(): values can not be null");this.throwIfNoData(e);var n=this.texData.get(e),r=n.texture,i=n.texShape,o=n.usage;null!=r&&(this.releaseTexture(e,r,i,o),n.texture=null,n.texShape=null),n.usage=re.TextureUsage.UPLOAD,n.values=t,this.delayedStorage||this.uploadToGPU(e)},e.prototype.readSync=function(e){this.throwIfNoData(e);var t=this.texData.get(e),n=t.shape,r=t.texture,i=t.values,o=t.texShape,a=t.dtype;if(null!=i)return this.cacheOnCPU(e),i;var s,u=null!=this.activeTimers;u&&(s=performance.now());var l=this.getValuesFromTexture(r,e,a,o,n);return u&&(this.downloadWaitMs+=performance.now()-s),this.cacheOnCPU(e,l),t.values},e.prototype.read=function(p){return r(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,l,c;return h(this,function(e){switch(e.label){case 0:if(this.pendingRead.has(p))return t=this.pendingRead.get(p),[2,new Promise(function(e){return t.push(e)})];if(this.throwIfNoData(p),n=this.texData.get(p),r=n.shape,i=n.texture,o=n.values,a=n.texShape,s=n.dtype,null!=o)return this.cacheOnCPU(p),[2,o];if(this.pendingRead.set(p,[]),!f.ENV.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===f.ENV.get("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return u=this.gpgpu.maybeCreateBufferFromTexture(i,a[0],a[1]),[4,this.gpgpu.createAndWaitForFence()];case 1:return e.sent(),l=u instanceof WebGLTexture?this.getValuesFromTexture(i,p,s,a,r):this.gpgpu.downloadFloat32MatrixFromBuffer(u,a[0],a[1]),this.cacheOnCPU(p,l),c=this.pendingRead.get(p),this.pendingRead.delete(p),c.forEach(function(e){return e(l)}),this.pendingDisposal.has(p)&&(this.pendingDisposal.delete(p),this.disposeData(p)),[2,l]}})})},e.prototype.getValuesFromTexture=function(e,t,n,r,i){if(f.ENV.get("WEBGL_DOWNLOAD_FLOAT_ENABLED"))return this.gpgpu.downloadFloat32MatrixFromOutputTexture(e,r[0],r[1]);var o=_.Tensor.make(i,{});this.texData.get(o.dataId).usage=re.TextureUsage.DOWNLOAD;var a=_.Tensor.make(i,{dataId:t},n),s=new C.EncodeFloatProgram(i);this.compileAndRun(s,[a],o,null,!1);var u=this.texData.get(o.dataId),l=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture,u.texShape[0],u.texShape[1]);return a.dispose(),o.dispose(),l},e.prototype.time=function(s){return r(this,void 0,void 0,function(){var t,n,r,i,o,a;return h(this,function(e){switch(e.label){case 0:return t=this.activeTimers,r=!(n=[]),null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,s(),i=S.flatten(this.activeTimers),this.activeTimers=t,r&&(this.programTimersStack=null),[4,Promise.all(i).then(function(e){var t=0;return e.forEach(function(e){return t+=e}),t})];case 1:return o=e.sent(),a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:o,wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,a]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return 0<f.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},e.prototype.endTimer=function(e){return 0<f.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?this.gpgpu.endQuery():e.endMs=performance.now(),e},e.prototype.getQueryTime=function(n){return r(this,void 0,void 0,function(){var t;return h(this,function(e){return 0<f.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?[2,this.gpgpu.waitForQueryAndGetTime(n)]:[2,(t=n).endMs-t.startMs]})})},e.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e))if(this.pendingRead.has(e))this.pendingDisposal.add(e);else if(this.texData.has(e)){var t=this.texData.get(e),n=t.texture,r=t.texShape,i=t.usage;null!=n&&this.releaseTexture(e,n,r,i),this.texData.delete(e)}},e.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.getCanvas=function(){return this.canvas},e.prototype.slice=function(e,t,n){var r=new te.SliceProgram(n),i=r.getCustomSetupFunc(t);return this.compileAndRun(r,[e],null,i)},e.prototype.stridedSlice=function(e,t,n,r,i,o,a,s,u){var l=y.getStridedSlicedInfo(e.shape,t,n,r,i,o,a,s,u),c=l[0],p=l[1],h=l[2],f=p.filter(function(e,t){return-1===h.indexOf(t)});if(f.some(function(e){return 0===e}))return b.tensor([],f);var d=new ne.StridedSliceProgram(c,r,p,h);return this.compileAndRun(d,[e])},e.prototype.reverse=function(e,t){var n=new J.ReverseProgram(e.shape,t);return this.compileAndRun(n,[e])},e.prototype.concat=function(e,t){var n=new A.ConcatProgram(e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.neg=function(e){var t=new ue.UnaryOpProgram(e.shape,se.NEG);return this.compileAndRun(t,[e])},e.prototype.matMul=function(e,t,n,r){var i=new B.MatMulProgram(e.shape,t.shape,n,r);return this.compileAndRun(i,[e,t])},e.prototype.multiply=function(e,t){var n=new l.BinaryOpProgram(a.MUL,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,w.upcastType(e.dtype,t.dtype));return this.compileAndRun(n,[e,t],r)},e.prototype.batchNormalization=function(e,t,n,r,i,o){var a=[e,t,n],s=null;null!=o&&(s=o.shape,a.push(o));var u=null;null!=i&&(u=i.shape,a.push(i));var l=new P.BatchNormProgram(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(l,a)},e.prototype.localResponseNormalization4D=function(e,t,n,r,i){var o=new q.LRNProgram(e.shape,t,n,r,i);return this.compileAndRun(o,[e])},e.prototype.LRNGrad=function(e,t,n,r,i,o,a){var s=new V.LRNGradProgram(t.shape,r,i,o,a);return this.compileAndRun(s,[t,n,e])},e.prototype.tile=function(e,t){var n=new oe.TileProgram(e.shape,t);return this.compileAndRun(n,[e])},e.prototype.pad=function(e,t,n){var r=new W.PadProgram(e.shape,t,n);return this.compileAndRun(r,[e])},e.prototype.transpose=function(e,t){var n=new ae.TransposeProgram(e.shape,t);return this.compileAndRun(n,[e])},e.prototype.gather=function(e,t,n){var r=new z.GatherProgram(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},e.prototype.batchToSpaceND=function(e,t,n){S.assert(e.rank<=4,"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");var r=t.reduce(function(e,t){return e*t}),i=c.getReshaped(e.shape,t,r),o=c.getPermuted(i.length,t.length),a=c.getReshapedPermuted(e.shape,t,r),s=c.getSliceBeginCoords(n,t.length),u=c.getSliceSize(a,n,t.length);return e.reshape(i).transpose(o).reshape(a).slice(s,u)},e.prototype.spaceToBatchND=function(e,t,n){S.assert(e.rank<=4,"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");var r=t.reduce(function(e,t){return e*t}),i=[[0,0]];i.push.apply(i,n);for(var o=1+t.length;o<e.shape.length;++o)i.push([0,0]);var a=e.pad(i),s=c.getReshaped(a.shape,t,r,!1),u=c.getPermuted(s.length,t.length,!1),l=c.getReshapedPermuted(a.shape,t,r,!1);return a.reshape(s).transpose(u).reshape(l)},e.prototype.reduce=function(e,t,n){var r=e.shape[0],i=e.shape[1],o={windowSize:d.computeOptimalWindowSize(i),inSize:i,batchSize:r},a=new Q.ReduceProgram(o,t),s=a.outputShape,u=s[0],l=s[1],c=this.makeOutputArray([u,l],n);return this.compileAndRun(a,[e],c),1===c.shape[1]?c:this.reduce(c,t,n)},e.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],i=e.shape[1];null!=n&&(r=n.shape[0],i=n.shape[1]);var o={windowSize:d.computeOptimalWindowSize(i),inSize:i,batchSize:r},a=new T.ArgMinMaxProgram(o,t,null==n),s=a.outputShape,u=s[0],l=s[1],c=this.makeOutputArray([u,l],"int32"),p=[e];return null!=n&&p.push(n),this.compileAndRun(a,p,c),1===c.shape[1]?c:this.argReduce(e,t,c)},e.prototype.sum=function(e,t){p.assertAxesAreInnerMostDims("sum",t,e.rank);var n=p.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=S.sizeFromShape(i),a=e.as2D(-1,o),s=w.sumOutType(e.dtype);return this.reduce(a,"sum",s).reshape(r)},e.prototype.unsortedSegmentSum=function(e,t,n){var r=0,i=p.getAxesPermutation([r],e.rank),o=e;null!=i&&(o=e.transpose(i),r=p.getInnerMostAxes(1,e.rank)[0]);var a=m.computeOutShape(o.shape,r,n),s=S.sizeFromShape([o.shape[r]]),u=o.as2D(-1,s),l=w.sumOutType(e.dtype),c=this.segOpCompute(u,"unsortedSegmentSum",t,l,n).reshape(a);return null!=i&&(c=c.transpose(p.getUndoAxesPermutation(i))),c},e.prototype.segOpCompute=function(e,t,n,r,i){var o=e.shape[0],a=e.shape[1],s=m.segOpComputeOptimalWindowSize(a,i),u={windowSize:s,inSize:a,batchSize:o,numSegments:i},l=new Z.SegmentOpProgram(u,t),c=l.outputShape,p=c[0],h=c[1],f=this.makeOutputArray([p,h],r);return this.compileAndRun(l,[e,n],f),f.shape[1]===i?f:(n=b.range(0,i).tile([a/s]),this.segOpCompute(f,t,n,r,i))},e.prototype.argMin=function(e,t){var n=[t];p.assertAxesAreInnerMostDims("argMin",n,e.rank);var r=p.computeOutAndReduceShapes(e.shape,n),i=r[0],o=r[1],a=S.sizeFromShape(o),s=e.as2D(-1,a);return this.argReduce(s,"min").reshape(i)},e.prototype.argMax=function(e,t){var n=[t];p.assertAxesAreInnerMostDims("argMax",n,e.rank);var r=p.computeOutAndReduceShapes(e.shape,n),i=r[0],o=r[1],a=S.sizeFromShape(o),s=e.as2D(-1,a);return this.argReduce(s,"max").reshape(i)},e.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var i=new M.CumSumProgram(e.shape,n,r);return this.compileAndRun(i,[e])},e.prototype.equal=function(e,t){var n=new l.BinaryOpProgram(a.EQUAL,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.notEqual=function(e,t){var n=new l.BinaryOpProgram(a.NOT_EQUAL,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.less=function(e,t){var n=new l.BinaryOpProgram(a.LESS,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.lessEqual=function(e,t){var n=new l.BinaryOpProgram(a.LESS_EQUAL,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.greater=function(e,t){var n=new l.BinaryOpProgram(a.GREATER,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.greaterEqual=function(e,t){var n=new l.BinaryOpProgram(a.GREATER_EQUAL,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.logicalNot=function(e){var t=new ue.UnaryOpProgram(e.shape,se.LOGICAL_NOT);return this.compileAndRun(t,[e])},e.prototype.logicalAnd=function(e,t){var n=new l.BinaryOpProgram(a.LOGICAL_AND,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.logicalOr=function(e,t){var n=new l.BinaryOpProgram(a.LOGICAL_OR,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],r)},e.prototype.select=function(e,t,n){var r=new ee.SelectProgram(e.rank,t.shape,t.rank),i=this.makeOutputArray(r.outputShape,w.upcastType(t.dtype,n.dtype));return this.compileAndRun(r,[e,t,n],i)},e.prototype.where=function(e){s.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return ce.whereImpl(e.shape,t)},e.prototype.topk=function(e,t,n){var r=e.dataSync();return i.topkImpl(r,e.shape,e.dtype,t,n)},e.prototype.min=function(e,t){p.assertAxesAreInnerMostDims("min",t,e.rank);var n=p.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=S.sizeFromShape(i),a=e.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(r)},e.prototype.minimum=function(e,t){var n=new l.BinaryOpProgram(a.MIN,e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.mod=function(e,t){var n=new l.BinaryOpProgram(a.MOD,e.shape,t.shape),r=n.getCustomSetupFunc();return this.compileAndRun(n,[e,t],null,r)},e.prototype.max=function(e,t){p.assertAxesAreInnerMostDims("max",t,e.rank);var n=p.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=S.sizeFromShape(i),a=e.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(r)},e.prototype.maximum=function(e,t){var n=new l.BinaryOpProgram(a.MAX,e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.all=function(e,t){p.assertAxesAreInnerMostDims("all",t,e.rank);var n=p.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=S.sizeFromShape(i),a=e.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(r)},e.prototype.any=function(e,t){p.assertAxesAreInnerMostDims("any",t,e.rank);var n=p.computeOutAndReduceShapes(e.shape,t),r=n[0],i=n[1],o=S.sizeFromShape(i),a=e.as2D(-1,o);return this.reduce(a,"any",a.dtype).reshape(r)},e.prototype.squaredDifference=function(e,t){var n=new l.BinaryOpProgram(a.SQUARED_DIFFERENCE,e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.realDivide=function(e,t){var n=a.DIV,r=new l.BinaryOpProgram(n,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[e,t],i)},e.prototype.floorDiv=function(e,t){var n=a.INT_DIV,r=new l.BinaryOpProgram(n,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"int32");return this.compileAndRun(r,[e,t],i)},e.prototype.add=function(e,t){var n=new l.BinaryOpProgram(a.ADD,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,w.upcastType(e.dtype,t.dtype));return this.compileAndRun(n,[e,t],r)},e.prototype.addN=function(e){for(var t=e[0],n=1;n<e.length;n++)t=this.add(t,e[n]);return t},e.prototype.subtract=function(e,t){var n=new l.BinaryOpProgram(a.SUB,e.shape,t.shape),r=this.makeOutputArray(n.outputShape,w.upcastType(e.dtype,t.dtype));return this.compileAndRun(n,[e,t],r)},e.prototype.pow=function(e,t){var n=new l.BinaryOpProgram(a.POW,e.shape,t.shape),r=n.getCustomSetupFunc(),i=this.makeOutputArray(n.outputShape,w.upcastType(e.dtype,t.dtype));return this.compileAndRun(n,[e,t],i,r)},e.prototype.ceil=function(e){var t=new ue.UnaryOpProgram(e.shape,se.CEIL);return this.compileAndRun(t,[e])},e.prototype.floor=function(e){var t=new ue.UnaryOpProgram(e.shape,se.FLOOR);return this.compileAndRun(t,[e])},e.prototype.sign=function(e){var t=new ue.UnaryOpProgram(e.shape,se.SIGN);return this.compileAndRun(t,[e])},e.prototype.round=function(e){var t=new ue.UnaryOpProgram(e.shape,se.ROUND);return this.compileAndRun(t,[e])},e.prototype.exp=function(e){var t=new ue.UnaryOpProgram(e.shape,se.EXP);return this.compileAndRun(t,[e])},e.prototype.expm1=function(e){var t=new ue.UnaryOpProgram(e.shape,se.EXPM1);return this.compileAndRun(t,[e])},e.prototype.log=function(e){var t=new ue.UnaryOpProgram(e.shape,se.LOG),n=t.getCustomSetupFunc();return this.compileAndRun(t,[e],null,n)},e.prototype.log1p=function(e){var t=new ue.UnaryOpProgram(e.shape,se.LOG1P);return this.compileAndRun(t,[e])},e.prototype.sqrt=function(e){var t=new ue.UnaryOpProgram(e.shape,se.SQRT);return this.compileAndRun(t,[e])},e.prototype.rsqrt=function(e){var t=new ue.UnaryOpProgram(e.shape,se.RSQRT);return this.compileAndRun(t,[e])},e.prototype.square=function(e){var t=new ue.UnaryOpProgram(e.shape,se.SQUARE);return this.compileAndRun(t,[e])},e.prototype.reciprocal=function(e){var t=new ue.UnaryOpProgram(e.shape,se.RECIPROCAL);return this.compileAndRun(t,[e])},e.prototype.relu=function(e){var t=new ue.UnaryOpProgram(e.shape,se.RELU);return this.compileAndRun(t,[e])},e.prototype.elu=function(e){var t=new ue.UnaryOpProgram(e.shape,se.ELU);return this.compileAndRun(t,[e])},e.prototype.eluDer=function(e,t){var n=new l.BinaryOpProgram(a.ELU_DER,e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.selu=function(e){var t=new ue.UnaryOpProgram(e.shape,se.SELU);return this.compileAndRun(t,[e])},e.prototype.int=function(e){var t=new ue.UnaryOpProgram(e.shape,se.TO_INT),n=this.makeOutputArray(t.outputShape,"int32");return this.compileAndRun(t,[e],n)},e.prototype.clip=function(e,t,n){var r=new N.ClipProgram(e.shape,t,n);return this.compileAndRun(r,[e])},e.prototype.abs=function(e){var t=new ue.UnaryOpProgram(e.shape,se.ABS);return this.compileAndRun(t,[e])},e.prototype.sigmoid=function(e){var t=new ue.UnaryOpProgram(e.shape,se.SIGMOID);return this.compileAndRun(t,[e])},e.prototype.softplus=function(e){var t=new ue.UnaryOpProgram(e.shape,se.SOFTPLUS);return this.compileAndRun(t,[e])},e.prototype.sin=function(e){var t=new ue.UnaryOpProgram(e.shape,se.SIN);return this.compileAndRun(t,[e])},e.prototype.cos=function(e){var t=new ue.UnaryOpProgram(e.shape,se.COS);return this.compileAndRun(t,[e])},e.prototype.tan=function(e){var t=new ue.UnaryOpProgram(e.shape,se.TAN);return this.compileAndRun(t,[e])},e.prototype.asin=function(e){var t=new ue.UnaryOpProgram(e.shape,se.ASIN);return this.compileAndRun(t,[e])},e.prototype.acos=function(e){var t=new ue.UnaryOpProgram(e.shape,se.ACOS);return this.compileAndRun(t,[e])},e.prototype.atan=function(e){var t=new ue.UnaryOpProgram(e.shape,se.ATAN);return this.compileAndRun(t,[e])},e.prototype.atan2=function(e,t){var n=new l.BinaryOpProgram(a.ATAN2,e.shape,t.shape);return this.compileAndRun(n,[e,t])},e.prototype.sinh=function(e){var t=new ue.UnaryOpProgram(e.shape,se.SINH);return this.compileAndRun(t,[e])},e.prototype.cosh=function(e){var t=new ue.UnaryOpProgram(e.shape,se.COSH);return this.compileAndRun(t,[e])},e.prototype.tanh=function(e){var t=new ue.UnaryOpProgram(e.shape,se.TANH);return this.compileAndRun(t,[e])},e.prototype.asinh=function(e){var t=new ue.UnaryOpProgram(e.shape,se.ASINH);return this.compileAndRun(t,[e])},e.prototype.acosh=function(e){var t=new ue.UnaryOpProgram(e.shape,se.ACOSH),n=t.getCustomSetupFunc();return this.compileAndRun(t,[e],null,n)},e.prototype.atanh=function(e){var t=new ue.UnaryOpProgram(e.shape,se.ATANH),n=t.getCustomSetupFunc();return this.compileAndRun(t,[e],null,n)},e.prototype.erf=function(e){var t=new ue.UnaryOpProgram(e.shape,se.ERF);return this.compileAndRun(t,[e])},e.prototype.step=function(e,t){var n=new ue.UnaryOpProgram(e.shape,se.STEP(t));return this.compileAndRun(n,[e])},e.prototype.conv2d=function(e,t,n){var r=new E.Conv2DProgram(n);return this.compileAndRun(r,[e,t])},e.prototype.conv2dDerInput=function(e,t,n){var r=new O.Conv2DDerInputProgram(n);return this.compileAndRun(r,[e,t])},e.prototype.conv2dDerFilter=function(e,t,n){var r=new O.Conv2DDerFilterProgram(n);return this.compileAndRun(r,[e,t])},e.prototype.depthwiseConv2D=function(e,t,n){var r=new I.DepthwiseConv2DProgram(n);return this.compileAndRun(r,[e,t])},e.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new k.DepthwiseConv2DDerInputProgram(n);return this.compileAndRun(r,[e,t])},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new k.DepthwiseConv2DDerFilterProgram(n);return this.compileAndRun(r,[e,t])},e.prototype.maxPool=function(e,t){var n=new H.Pool2DProgram(t,"max",!1),r=this.makeOutputArray(n.outputShape,e.dtype);return this.compileAndRun(n,[e],r)},e.prototype.avgPool=function(e,t){var n=new H.Pool2DProgram(t,"avg",!1),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[e],r)},e.prototype.maxPoolBackprop=function(e,t,n,r){var i=new H.Pool2DProgram(r,"max",!0),o=this.compileAndRun(i,[t]),a=new j.MaxPool2DBackpropProgram(r),s=this.makeOutputArray(a.outputShape,t.dtype),u=this.compileAndRun(a,[e,o],s);return o.dispose(),u},e.prototype.avgPoolBackprop=function(e,t,n){var r=new o.AvgPool2DBackpropProgram(n),i=this.makeOutputArray(r.outputShape,t.dtype);return this.compileAndRun(r,[e],i)},e.prototype.cast=function(e,t){return n.castTensor(e,t,this)},e.prototype.reshape=function(e,t){return n.reshapeTensor(e,t)},e.prototype.resizeBilinear=function(e,t,n,r){var i=new $.ResizeBilinearProgram(e.shape,t,n,r);return this.compileAndRun(i,[e])},e.prototype.resizeBilinearBackprop=function(e,t,n){var r=new K.ResizeBilinearBackpropProgram(e,t,n);return this.compileAndRun(r,[e])},e.prototype.resizeNearestNeighbor=function(e,t,n,r){var i=new Y.ResizeNearestNeighborProgram(e.shape,t,n,r);return this.compileAndRun(i,[e])},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new X.ResizeNearestNeigborBackpropProgram(e,t,n);return this.compileAndRun(r,[e])},e.prototype.multinomial=function(e,t,n,r){var i=t?e:v.softmax(e),o=i.shape[0],a=i.shape[1],s=new U.MultinomialProgram(o,a,n),u=this.makeOutputArray(s.outputShape,"int32"),l=s.getCustomSetupFunc(r);return this.compileAndRun(s,[i],u,l)},e.prototype.oneHot=function(e,t,n,r){var i=new G.OneHotProgram(e.size,t,n,r);return this.compileAndRun(i,[e])},e.prototype.nonMaxSuppression=function(e,t,n,r,i){s.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=e.dataSync(),a=t.dataSync();return u.nonMaxSuppressionImpl(o,a,n,r,i)},e.prototype.makeOutputArray=function(e,t){return _.Tensor.make(e,{},t)},e.prototype.compileAndRun=function(e,t,n,r,i){var o=this;if(void 0===i&&(i=!0),null==n&&(n=this.makeOutputArray(e.outputShape,t[0].dtype)),0===n.size)return this.texData.get(n.dataId).values=x.getTypedArrayFromDType(n.dtype,0),n;var a=t.map(function(e){var t=o.texData.get(e.dataId);return null==t.texture&&e.size<=g.SIZE_UPLOAD_UNIFORM?{tensor:e,texData:null,isUniform:!0}:(o.uploadToGPU(e.dataId),{tensor:e,texData:t,isUniform:!1})});this.uploadToGPU(n.dataId);var s,u={tensor:n,texData:this.texData.get(n.dataId),isUniform:!1},l=L.makeShaderKey(e,a,u),c=this.getAndSaveBinary(l,function(){return L.compileProgram(o.gpgpu,e,a,u)}),p=null!=this.activeTimers;if(p&&(s=this.startTimer()),L.runProgram(c,a,u,r),i&&this.numBytesInGPU>this.NUM_BYTES_BEFORE_PAGING)for(var h=this.numBytesInGPU-this.NUM_BYTES_BEFORE_PAGING;0<h&&0<this.lruDataGPU.length;){var f=this.lruDataGPU.shift(),d=this.texData.get(f),m=d.shape,y=d.dtype;h-=this.computeBytes(m,y),this.read(f)}return p&&(s=this.endTimer(s),this.activeTimers.push(this.getQueryTime(s))),n},e.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){if(!this.disposed){for(var e in this.binaryCache)this.gpgpu.deleteProgram(this.binaryCache[e].webGLProgram);this.textureManager.dispose(),this.canvas.remove(),null!=this.fromPixelsCanvas&&this.fromPixelsCanvas.remove(),this.gpgpuCreatedLocally&&this.gpgpu.dispose(),this.disposed=!0}},e.prototype.throwIfNoData=function(e){if(!this.texData.has(e))throw new Error("WebGL backend: No data found for this tensor. Did you change your backend in the middle of the program? New backends can't use Tensors created with previous backends")},e.prototype.uploadToGPU=function(e){this.throwIfNoData(e);var t=this.texData.get(e),n=t.shape,r=t.values,i=t.texture,o=(t.dtype,t.usage);if(null==i){var a,s=null!=this.activeTimers;s&&(a=performance.now());var u=le.getTextureShapeFromLogicalShape(this.gpgpu.gl,n);t.texShape=u;var l,c=this.acquireTexture(e,u,o);t.texture=c,null!=r&&(this.gpgpu.uploadMatrixToTexture(c,u[0],u[1],(l=r)instanceof Float32Array?l:new Float32Array(l)),t.values=null,s&&(this.uploadWaitMs+=performance.now()-a))}else{0<=this.lruDataGPU.indexOf(e)&&(this.lruDataGPU.splice(this.lruDataGPU.indexOf(e),1),this.lruDataGPU.push(e))}},e.prototype.cacheOnCPU=function(e,t){var n=this.delayedStorage,r=this.texData.get(e),i=r.texture,o=r.texShape,a=r.dtype,s=r.usage;n&&null!=i&&(this.releaseTexture(e,i,o,s),r.texture=null,r.texShape=null),null!=t&&(r.values=function(e,t){{if("float32"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}}(t,a))},e.prototype.releaseTexture=function(e,t,n,r){var i=this.texData.get(e),o=i.shape,a=i.dtype,s=this.lruDataGPU.indexOf(e);0<=s&&this.lruDataGPU.splice(s,1),this.numBytesInGPU-=this.computeBytes(o,a),this.textureManager.releaseTexture(t,n,r)},e.prototype.acquireTexture=function(e,t,n){var r=this.texData.get(e),i=r.shape,o=r.dtype;return this.lruDataGPU.push(e),this.numBytesInGPU+=this.computeBytes(i,o),this.textureManager.acquireTexture(t,n)},e.prototype.computeBytes=function(e,t){return S.sizeFromShape(e)*S.bytesPerElement(t)},e}();g.MathBackendWebGL=pe,f.ENV.get("IS_BROWSER")&&f.ENV.registerBackend("webgl",function(){return new pe},2,_.setTensorTracker)},{"../environment":62,"../log":126,"../ops/array_ops_util":128,"../ops/axis_util":129,"../ops/reduce_util":152,"../ops/segment_util":157,"../ops/slice_util":160,"../ops/softmax":161,"../ops/tensor_ops":163,"../tensor":180,"../types":186,"../util":187,"./backend_util":79,"./non_max_suppression_impl":81,"./topk_impl":82,"./webgl/argminmax_gpu":83,"./webgl/avg_pool_backprop_gpu":84,"./webgl/batchnorm_gpu":85,"./webgl/binaryop_gpu":86,"./webgl/clip_gpu":87,"./webgl/concat_gpu":88,"./webgl/conv_backprop_gpu":89,"./webgl/conv_backprop_gpu_depthwise":90,"./webgl/conv_gpu":91,"./webgl/conv_gpu_depthwise":92,"./webgl/cumsum_gpu":93,"./webgl/encode_float_gpu":94,"./webgl/from_pixels_gpu":95,"./webgl/gather_gpu":96,"./webgl/gpgpu_context":97,"./webgl/gpgpu_math":98,"./webgl/gpgpu_util":99,"./webgl/lrn_gpu":100,"./webgl/lrn_grad_gpu":101,"./webgl/max_pool_backprop_gpu":102,"./webgl/mulmat_gpu":103,"./webgl/multinomial_gpu":104,"./webgl/onehot_gpu":105,"./webgl/pad_gpu":106,"./webgl/pool_gpu":107,"./webgl/reduce_gpu":108,"./webgl/resize_bilinear_backprop_gpu":109,"./webgl/resize_bilinear_gpu":110,"./webgl/resize_nearest_neighbor_backprop_gpu":111,"./webgl/resize_nearest_neighbor_gpu":112,"./webgl/reverse_gpu":113,"./webgl/segment_gpu":114,"./webgl/select_gpu":115,"./webgl/slice_gpu":117,"./webgl/strided_slice_gpu":118,"./webgl/tex_util":119,"./webgl/texture_manager":120,"./webgl/tile_gpu":121,"./webgl/transpose_gpu":122,"./webgl/unaryop_gpu":123,"./webgl/webgl_util":124,"./where_impl":125}],81:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var f=e("../ops/tensor_ops");function d(e,t,n){var r=e.subarray(4*t,4*t+4),i=e.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),p=Math.max(i[0],i[2]),h=Math.max(i[1],i[3]),f=(s-o)*(u-a),d=(p-l)*(h-c);if(f<=0||d<=0)return 0;var m=Math.max(o,l),y=Math.max(a,c),g=Math.min(s,p),v=Math.min(u,h),b=Math.max(g-m,0)*Math.max(v-y,0);return b/(f+d-b)}n.nonMaxSuppressionImpl=function(e,t,n,r,i){for(var o=Array.from(t).map(function(e,t){return{score:e,boxIndex:t}}).filter(function(e){return e.score>i}).sort(function(e,t){return t.score-e.score}),a=[],s=0;s<o.length;s++){var u=o[s],l=u.score,c=u.boxIndex;if(l<i)break;for(var p=!1,h=a.length-1;0<=h;--h)if(r<=d(e,c,a[h])){p=!0;break}if(!p&&(a.push(c),a.length>=n))break}return f.tensor1d(a,"int32")}},{"../ops/tensor_ops":163}],82:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var _=e("../ops/tensor_ops"),w=e("../util");n.topkImpl=function(e,t,n,r,i){for(var o=t[t.length-1],a=[e.length/o,o],s=a[0],u=a[1],l=w.getTypedArrayFromDType(n,s*r),c=w.getTypedArrayFromDType("int32",s*r),p=0;p<s;p++){for(var h=p*u,f=e.subarray(h,h+u),d=[],m=0;m<f.length;m++)d.push({value:f[m],index:m});d.sort(function(e,t){return t.value-e.value});var y=p*r,g=l.subarray(y,y+r),v=c.subarray(y,y+r);for(m=0;m<r;m++)g[m]=d[m].value,v[m]=d[m].index}var b=t.slice();return b[b.length-1]=r,[_.tensor(l,b,n),_.tensor(c,b,"int32")]}},{"../ops/tensor_ops":163,"../util":187}],83:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,i=e.batchSize,o=e.inSize,a=Math.ceil(o/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];var s="max"===t?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = 0;\n        float bestValue = getA(batch, inOffset);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};n.ArgMinMaxProgram=r},{}],84:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=n-1-e.padInfo.left,s=1/(t*n);this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n      const float avgMultiplier = float("+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.AvgPool2DBackpropProgram=r},{}],85:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=e("../../ops/broadcast_util"),r=function(e,t,n,r,i,o){this.outputShape=[],this.supportsBroadcasting=!0,this.variableNames=["x","mean","variance"],u.assertAndGetBroadcastShape(e,t),u.assertAndGetBroadcastShape(e,n);var a="0.0";null!=r&&(u.assertAndGetBroadcastShape(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";null!=i&&(u.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+o+"));\n        setOutput((x - mean) * inv + offset);\n      }\n    "};n.BatchNormProgram=r},{"../../ops/broadcast_util":132}],86:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../ops/broadcast_util"),i="\n  if (isNaN(a)) return a;\n  if (isNaN(b)) return b;\n";n.ADD="return a + b;",n.SUB="return a - b;",n.MUL="return a * b;",n.DIV="if (a == b) return 1.0;\n  return a / b;",n.INT_DIV="\n  float resultSign = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  int result = ia / ib;\n  int amodb = ia - ib * result;\n\n  if (resultSign < 0.0 && amodb != 0) {\n    result -= 1;\n  }\n  return float(result);\n",n.POW="\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nreturn (round(mod(b, 2.0)) == 0 || round(mod(b, 2.0)) == 2) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",n.SQUARED_DIFFERENCE="return (a - b) * (a - b);",n.EQUAL="return float(a == b);",n.NOT_EQUAL="return float(a != b);",n.LESS="return float(a < b);",n.LESS_EQUAL="return float(a <= b);",n.GREATER="return float(a > b);",n.GREATER_EQUAL="return float(a >= b);",n.LOGICAL_AND="return float(a >= 1.0 && b >= 1.0);",n.LOGICAL_OR="return float(a >= 1.0 || b >= 1.0);",n.MAX=i+"\n  return max(a, b);\n",n.MIN=i+"\n  return min(a, b);\n",n.MOD="if (b == 0.0) return NAN;\n  return mod(a, b);",n.ATAN2=i+"\n  return atan(a, b);\n",n.ELU_DER="return (b >= 1.0) ? a : a * (b + 1.0);";var o=function(){function e(e,t,n){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.outputShape=r.assertAndGetBroadcastShape(t,n),this.userCode="\n      uniform float NAN;\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(){var n=this;return function(e,t){null==n.startLoc&&(n.startLoc=e.getUniformLocationNoThrow(t,"NAN"),null==n.startLoc)||e.gl.uniform1f(n.startLoc,NaN)}},e}();n.BinaryOpProgram=o},{"../../ops/broadcast_util":132}],87:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n){this.variableNames=["A"],this.outputShape=e;var r=t.toFixed(20),i=n.toFixed(20);this.userCode="\n      void main() {\n        float value = getAAtOutCoords();\n        if (isNaN(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, "+r+", "+i+"));\n      }\n    "};n.ClipProgram=r},{}],88:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../ops/concat_util"),i=function(e,t){this.variableNames=["A","B"],this.outputShape=[],this.outputShape=r.computeOutShape([e,t],1),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        float value = 0.0;\n        if (yC < "+e[1]+") {\n          value = getA(yR, yC);\n        } else {\n          yC -= "+e[1]+";\n          value = getB(yR, yC);\n        }\n\n        setOutput(value);\n      }\n    "};n.ConcatProgram=i},{"../../ops/concat_util":135}],89:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.Conv2DDerFilterProgram=r;var i=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=n-1-e.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.Conv2DDerInputProgram=i},{}],90:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+o+" + dm;\n\n        float dotProd = 0.0;\n\n        // TODO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+t+" - "+r+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.DepthwiseConv2DDerFilterProgram=r;var i=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=n-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TODO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.DepthwiseConv2DDerInputProgram=i},{}],91:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.top,n=e.padInfo.left,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,s=e.filterHeight,u=e.filterWidth,l=4*Math.floor(e.inChannels/4),c=e.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+r+", "+i+");\n      const ivec2 pads = ivec2("+t+", "+n+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+"; wR++) {\n          int xR = xRCorner + wR * "+o+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+u+"; wC++) {\n            int xC = xCCorner + wC * "+a+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+l+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1===c)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+l+") *\n                getW(wR, wC, "+l+", d2);\n            } else if ("+(2===c)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+l+"),\n                getX(batch, xR, xC, "+l+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+l+", d2),\n                getW(wR, wC, "+l+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3===c)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+l+"),\n                getX(batch, xR, xC, "+l+" + 1),\n                getX(batch, xR, xC, "+l+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+l+", d2),\n                getW(wR, wC, "+l+" + 1, d2),\n                getW(wR, wC, "+l+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.Conv2DProgram=r},{}],92:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,n=e.inWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.strideHeight,a=e.strideWidth,s=e.dilationHeight,u=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,p=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+r+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+s+";\n\n          if (xR < 0 || xR >= "+t+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+c+"; wC++) {\n            int xC = xCCorner + wC * "+u+";\n\n            if (xC < 0 || xC >= "+n+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.DepthwiseConv2DProgram=r},{}],93:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("./shader_compiler"),r=function(e,t,n){this.variableNames=["x"];var r=(this.outputShape=e).length,i=e[e.length-1],o=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+i+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+a.getCoordsDataType(r)+" coords = getOutputCoords();\n        int end = "+s(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+i+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+o+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+s(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function s(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}n.CumSumProgram=r},{"./shader_compiler":116}],94:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      const float FLOAT_MAX = 1.70141184e38;\n      const float FLOAT_MIN = 1.17549435e-38;\n\n      lowp vec4 encode_float(highp float v) {\n        if (isNaN(v)) {\n          return vec4(255, 255, 255, 255);\n        }\n\n        highp float av = abs(v);\n\n        if(av < FLOAT_MIN) {\n          return vec4(0.0, 0.0, 0.0, 0.0);\n        } else if(v > FLOAT_MAX) {\n          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n        } else if(v < -FLOAT_MAX) {\n          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n        }\n\n        highp vec4 c = vec4(0,0,0,0);\n\n        highp float e = floor(log2(av));\n        highp float m = exp2(fract(log2(av))) - 1.0;\n\n        c[2] = floor(128.0 * m);\n        m -= c[2] / 128.0;\n        c[1] = floor(32768.0 * m);\n        m -= c[1] / 32768.0;\n        c[0] = floor(8388608.0 * m);\n\n        highp float ebias = e + 127.0;\n        c[3] = floor(ebias / 2.0);\n        ebias -= c[3] * 2.0;\n        c[2] += floor(ebias) * 128.0;\n\n        c[3] += 128.0 * step(0.0, -v);\n\n        return c / 255.0;\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        gl_FragColor = encode_float(x);\n      }\n    "};n.EncodeFloatProgram=r},{}],95:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){this.variableNames=["A"];var t=e[0],n=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+n+".0, "+t+".0);\n\n        vec4 values = texture2D(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "};n.FromPixelsProgram=r},{}],96:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("./shader_compiler"),r=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var i=a.getCoordsDataType(this.rank),o=function(e,t){var n=e.length;if(4<n)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],o=0;o<e.length;o++)o===t?i.push("int(getIndices("+r[o]+"))"):i.push(""+r[o]);return i.join()}(e,n);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "};n.GatherProgram=r},{"./shader_compiler":116}],97:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},i=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../environment"),o=e("../../util"),s=e("./gpgpu_util"),u=e("./tex_util"),l=e("./webgl_util"),c=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.autoDebugValidate=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[],this.gl=null!=e?e:s.createWebGLContext(),1===a.ENV.get("WEBGL_VERSION")?(this.textureFloatExtension=l.getExtensionOrThrow(this.gl,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),a.ENV.get("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=l.getExtensionOrThrow(this.gl,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=l.getExtensionOrThrow(this.gl,"EXT_color_buffer_float"),this.loseContextExtension=l.getExtensionOrThrow(this.gl,"WEBGL_lose_context"),this.vertexBuffer=s.createVertexBuffer(this.gl),this.indexBuffer=s.createIndexBuffer(this.gl),this.framebuffer=l.createFramebuffer(this.gl),this.textureConfig=s.getTextureConfig(this.gl,this.textureHalfFloatExtension)}return e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;l.callAndCheck(t,function(){return t.finish()}),l.callAndCheck(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),l.callAndCheck(t,function(){return t.deleteFramebuffer(e.framebuffer)}),l.callAndCheck(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),l.callAndCheck(t,function(){return t.deleteBuffer(e.vertexBuffer)}),l.callAndCheck(t,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),l.callAndCheck(t,function(){return t.deleteBuffer(e.indexBuffer)}),this.loseContextExtension.loseContext(),this.disposed=!0}},e.prototype.enableAutomaticDebugValidation=function(e){this.autoDebugValidate=e,l.enableDebugWebGLErrorChecking(e)},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),s.createFloat32MatrixTexture(this.gl,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),s.createFloat16MatrixTexture(this.gl,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),s.createUnsignedBytesMatrixTexture(this.gl,e,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),s.uploadPixelDataToTexture(this.gl,e,t)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),s.createPackedMatrixTexture(this.gl,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(l.unbindColorTextureFromFramebuffer(this.gl,this.framebuffer),this.outputTexture=null),l.callAndCheck(this.gl,function(){return t.gl.deleteTexture(e)})},e.prototype.uploadMatrixToTexture=function(e,t,n,r){this.throwIfDisposed();var i=l.getNumChannels();return s.uploadMatrixToTexture(this.gl,e,t,n,r,i,this.textureConfig)},e.prototype.uploadMatrixToPackedTexture=function(e,t,n,r){return this.throwIfDisposed(),s.uploadMatrixToPackedTexture(this.gl,e,t,n,r,this.textureConfig)},e.prototype.downloadFloat32MatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return s.downloadFloat32MatrixFromOutputTexture(r.gl,t,n,r.textureConfig)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return s.downloadByteEncodedFloatMatrixFromOutputTexture(r.gl,t,n,r.textureConfig)})},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t,n){return s.downloadFloat32MatrixFromBuffer(this.gl,e,t,n,this.textureConfig)},e.prototype.maybeCreateBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=s.maybeCreateBufferFromOutputTexture(this.gl,e,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(a.ENV.get("WEBGL_FENCE_API_ENABLED")){var i=e,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=i.clientWaitSync(o,0,0);return e===i.ALREADY_SIGNALED||e===i.CONDITION_SATISFIED},t=o}else 0<a.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,a.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,function(){return s.downloadMatrixFromPackedOutputTexture(r.gl,t,n,r.textureConfig)})},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=l.createFragmentShader(t,e),r=s.createVertexShader(t),i=l.createProgram(t);return l.callAndCheck(t,function(){return t.attachShader(i,r)}),l.callAndCheck(t,function(){return t.attachShader(i,n)}),l.linkProgram(t,i),this.autoDebugValidate&&l.validateProgram(t,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=s.bindVertexProgramAttributeStreams(t,this.program,this.vertexBuffer)),i},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&l.callAndCheck(this.gl,function(){return t.gl.deleteProgram(e)})},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.autoDebugValidate&&l.validateProgram(this.gl,this.program),l.callAndCheck(this.gl,function(){return t.gl.useProgram(e)})},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?l.getProgramUniformLocationOrThrow(this.gl,e,t):l.getProgramUniformLocation(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),l.callAndCheck(this.gl,function(){return n.gl.getAttribLocation(e,t)})},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),l.bindTextureToProgramUniformSampler(this.gl,this.program,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=u.getPackedMatrixTextureShapeWidthHeight(t,n),i=r[0],o=r[1];this.setOutputMatrixTextureDriver(e,i,o)},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&l.validateProgram(this.gl,this.program),l.validateFramebuffer(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.autoDebugValidate&&this.debugValidate(),l.callAndCheck(e,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),l.callAndCheck(this.gl,function(){return e.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=l.getExtensionOrThrow(this.gl,2===a.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===a.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),i=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,i),i},e.prototype.endQuery=function(){if(2!==a.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(n){return r(this,void 0,void 0,function(){var t=this;return i(this,function(e){switch(e.label){case 0:return[4,o.repeatedTry(function(){return t.isQueryAvailable(n,a.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return e.sent(),[2,this.getQueryTime(n,a.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}i=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint},e.prototype.pollFence=function(t){var n=this;return new Promise(function(e){n.addItemToPoll(function(){return t.isFencePassed()},function(){return e()})})},e.prototype.pollItems=function(){for(var e=p(this.itemsToPoll.map(function(e){return e.isDoneFn})),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),1<this.itemsToPoll.length||o.repeatedTry(function(){return n.pollItems(),0===n.itemsToPoll.length})},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),l.bindColorTextureToFramebuffer(this.gl,e,this.framebuffer),this.autoDebugValidate&&l.validateFramebuffer(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(l.bindColorTextureToFramebuffer(this.gl,this.outputTexture,this.framebuffer),this.autoDebugValidate&&l.validateFramebuffer(this.gl)):l.unbindColorTextureFromFramebuffer(this.gl,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;l.bindColorTextureToFramebuffer(r,e,this.framebuffer),this.autoDebugValidate&&l.validateFramebuffer(r),this.outputTexture=e,l.callAndCheck(r,function(){return r.viewport(0,0,t,n)}),l.callAndCheck(r,function(){return r.scissor(0,0,t,n)})},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var i=this;this.throwIfDisposed(),l.callAndCheck(this.gl,function(){return i.gl.scissor(e,t,n,r)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function p(e){for(var t=0,n=e.length-1,r=-1;t<=n;){var i=t+n>>1;e[i]()?t=(r=i)+1:n=i-1}return r}n.GPGPUContext=c,n.binSearchLastTrue=p},{"../../environment":62,"../../util":187,"./gpgpu_util":99,"./tex_util":119,"./webgl_util":124}],98:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=e("../../util"),f=e("./shader_compiler");function o(e,s){if(e.length!==s.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+s.length+" inputs");e.forEach(function(e,t){var n=e.logicalShape,r=s[t],i=r.tensor.shape;if(!u.arraysEqual(n,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+n+" and "+i+" must match");if(!e.isUniform||!r.isUniform){var o=e.texShape,a=r.isUniform?null:r.texData.texShape;if(!u.arraysEqual(o,a))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+o+" and "+a+" must match")}})}n.compileProgram=function(e,r,t,n){for(var i=r.userCode,o=t.map(function(e,t){var n={logicalShape:e.tensor.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform};return{name:r.variableNames[t],shapeInfo:n}}),a=o.map(function(e){return e.shapeInfo}),s={logicalShape:n.tensor.shape,texShape:n.texData.texShape,isUniform:!1},u=f.makeShader(o,s,i,!0===r.supportsBroadcasting),l=e.createProgram(u),c={},p=0;p<r.variableNames.length;p++){var h=r.variableNames[p];c[h]=e.getUniformLocation(l,h,!1)}return{program:r,source:u,webGLProgram:l,uniformLocations:c,gpgpu:e,inShapeInfos:a,outShapeInfo:s}},n.runProgram=function(a,e,t,n){o(a.inShapeInfos,e),o([a.outShapeInfo],[t]);var r=t.texData.texture,i=t.texData.texShape,s=a.gpgpu;s.setOutputMatrixTexture(r,i[0],i[1]),s.setProgram(a.webGLProgram),e.forEach(function(e,t){var n=a.program.variableNames[t],r=a.uniformLocations[n];if(null!=r){if(e.isUniform){if(1===e.tensor.size)s.gl.uniform1f(r,e.tensor.dataSync()[0]);else{var i=e.tensor.dataSync();i instanceof Float32Array||(i=new Float32Array(i)),s.gl.uniform1fv(r,i)}return}var o=e.texData.texture;s.setInputMatrixTexture(o,r,t)}}),null!=n&&n(s,a.webGLProgram),s.executeProgram()},n.makeShaderKey=function(e,t,n){var r="";t.concat(n).forEach(function(e){r+=e.tensor.shape+"_"+(e.isUniform?"uniform":e.texData.texShape)});var i=e.userCode,o=(!0===e.supportsBroadcasting).toString(),a=e.constructor.name;return a+="_"+o+"_"+r+"_"+i}},{"../../util":187,"./shader_compiler":116}],99:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var c=e("../../environment"),p=e("./tex_util"),l=e("./webgl_util");function r(){return{alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0}}function o(e,t,n,r,i,o){l.validateTextureSize(e,t,n);var a=l.createTexture(e),s=e.TEXTURE_2D;return l.callAndCheck(e,function(){return e.bindTexture(s,a)}),l.callAndCheck(e,function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),l.callAndCheck(e,function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),l.callAndCheck(e,function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)}),l.callAndCheck(e,function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)}),l.callAndCheck(e,function(){return e.texImage2D(s,0,r,t,n,0,i,o,null)}),l.callAndCheck(e,function(){return e.bindTexture(e.TEXTURE_2D,null)}),a}function h(e,t,n,r,i,o){l.validateTextureSize(e,n,r),l.callAndCheck(e,function(){return e.bindTexture(e.TEXTURE_2D,t)}),l.callAndCheck(e,function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,o,e.FLOAT,i)}),l.callAndCheck(e,function(){return e.bindTexture(e.TEXTURE_2D,null)})}n.getWebGLContextAttributes=r,n.createWebGLContext=function(e){var t,n={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};return t=null!=e?l.createWebGLRenderingContextFromCanvas(e,n):l.createWebGLRenderingContext(n),l.callAndCheck(t,function(){return t.disable(t.DEPTH_TEST)}),l.callAndCheck(t,function(){return t.disable(t.STENCIL_TEST)}),l.callAndCheck(t,function(){return t.disable(t.BLEND)}),l.callAndCheck(t,function(){return t.disable(t.DITHER)}),l.callAndCheck(t,function(){return t.disable(t.POLYGON_OFFSET_FILL)}),l.callAndCheck(t,function(){return t.disable(t.SAMPLE_COVERAGE)}),l.callAndCheck(t,function(){return t.enable(t.SCISSOR_TEST)}),l.callAndCheck(t,function(){return t.enable(t.CULL_FACE)}),l.callAndCheck(t,function(){return t.cullFace(t.BACK)}),t},n.createVertexShader=function(e){return l.createVertexShader(e,"\n    precision highp float;\n    attribute vec3 clipSpacePos;\n    attribute vec2 uv;\n    varying vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")},n.createVertexBuffer=function(e){var t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return l.createStaticVertexBuffer(e,t)},n.createIndexBuffer=function(e){var t=new Uint16Array([0,1,2,2,1,3]);return l.createStaticIndexBuffer(e,t)},n.getTextureConfig=function(e,t){var n,r,i,o,a,s,u,l=e;return 2===c.ENV.get("WEBGL_VERSION")?(n=l.R32F,r=l.R16F,i=l.RGBA32F,o=l.RED,a=4,s=1,u=l.HALF_FLOAT):(n=e.RGBA,r=e.RGBA,i=l.RGBA,o=e.RGBA,s=a=4,u=null!=t?t.HALF_FLOAT_OES:null),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:a,defaultNumChannels:s,textureTypeHalfFloat:u}},n.createFloat32MatrixTexture=function(e,t,n,r){var i=p.getUnpackedMatrixTextureShapeWidthHeight(t,n);return o(e,i[0],i[1],r.internalFormatFloat,r.textureFormatFloat,e.FLOAT)},n.createFloat16MatrixTexture=function(e,t,n,r){var i=p.getUnpackedMatrixTextureShapeWidthHeight(t,n);return o(e,i[0],i[1],r.internalFormatFloat,r.textureFormatFloat,r.textureTypeHalfFloat)},n.createUnsignedBytesMatrixTexture=function(e,t,n,r){var i=p.getUnpackedMatrixTextureShapeWidthHeight(t,n);return o(e,i[0],i[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)},n.createPackedMatrixTexture=function(e,t,n,r){var i=p.getPackedMatrixTextureShapeWidthHeight(t,n);return o(e,i[0],i[1],r.internalFormatPackedFloat,e.RGBA,e.FLOAT)},n.bindVertexProgramAttributeStreams=function(e,t,n){return l.callAndCheck(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,n)}),l.bindVertexBufferToProgramAttribute(e,t,"clipSpacePos",n,3,20,0)&&l.bindVertexBufferToProgramAttribute(e,t,"uv",n,2,20,12)},n.uploadPixelDataToTexture=function(e,t,n){l.callAndCheck(e,function(){return e.bindTexture(e.TEXTURE_2D,t)}),l.callAndCheck(e,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)}),l.callAndCheck(e,function(){return e.bindTexture(e.TEXTURE_2D,null)})},n.uploadMatrixToTexture=function(e,t,n,r,i,o,a){var s,u=p.getUnpackedMatrixTextureShapeWidthHeight(n,r),l=u[0],c=u[1];1===a.defaultNumChannels?s=i:(s=new Float32Array(p.getUnpackedArraySizeFromMatrixSize(i.length,o)),p.encodeMatrixToUnpackedArray(i,s,o)),h(e,t,l,c,s,a.textureFormatFloat)},n.uploadMatrixToPackedTexture=function(e,t,n,r,i,o){var a=p.getPackedMatrixTextureShapeWidthHeight(n,r),s=a[0],u=a[1],l=new Float32Array(p.getPackedRGBAArraySizeFromMatrixShape(n,r));p.encodeMatrixToPackedRGBA(i,n,r,l),h(e,t,s,u,l,e.RGBA)},n.maybeCreateBufferFromOutputTexture=function(e,t,n,r,i){var o=t;if(2===c.ENV.get("WEBGL_VERSION")){var a=e,s=a.createBuffer();l.callAndCheck(e,function(){return e.bindBuffer(a.PIXEL_PACK_BUFFER,s)});var u=4*p.getUnpackedArraySizeFromMatrixSize(n*r,i.downloadUnpackNumChannels);l.callAndCheck(e,function(){return e.bufferData(a.PIXEL_PACK_BUFFER,u,e.STATIC_DRAW)}),l.callAndCheck(e,function(){return a.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)}),l.callAndCheck(e,function(){return e.bindBuffer(a.PIXEL_PACK_BUFFER,null)}),o=s}return o},n.downloadFloat32MatrixFromBuffer=function(e,t,n,r,i){var o=e,a=new Float32Array(p.getUnpackedArraySizeFromMatrixSize(n*r,i.downloadUnpackNumChannels));o.bindBuffer(e.ARRAY_BUFFER,t),o.getBufferSubData(e.ARRAY_BUFFER,0,a),o.bindBuffer(e.ARRAY_BUFFER,null);var s=new Float32Array(n*r);return p.decodeMatrixFromUnpackedArray(a,s,i.downloadUnpackNumChannels),s},n.downloadFloat32MatrixFromOutputTexture=function(e,t,n,r){var i=p.getUnpackedMatrixTextureShapeWidthHeight(t,n),o=i[0],a=i[1],s=new Float32Array(p.getUnpackedArraySizeFromMatrixSize(t*n,r.downloadUnpackNumChannels));l.callAndCheck(e,function(){return e.readPixels(0,0,o,a,r.downloadTextureFormat,e.FLOAT,s)});var u=new Float32Array(t*n);return p.decodeMatrixFromUnpackedArray(s,u,r.downloadUnpackNumChannels),u},n.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n,r){var i=p.getUnpackedMatrixTextureShapeWidthHeight(t,n),o=i[0],a=i[1],s=new Uint8Array(p.getUnpackedArraySizeFromMatrixSize(t*n,4));return l.callAndCheck(e,function(){return e.readPixels(0,0,o,a,r.downloadTextureFormat,e.UNSIGNED_BYTE,s)}),new Float32Array(s.buffer)},n.downloadMatrixFromPackedOutputTexture=function(e,t,n,r){var i=p.getPackedMatrixTextureShapeWidthHeight(t,n),o=i[0],a=i[1],s=new Float32Array(p.getPackedRGBAArraySizeFromMatrixShape(t,n));l.callAndCheck(e,function(){return e.readPixels(0,0,o,a,e.RGBA,e.FLOAT,s)});var u=new Float32Array(t*n);return p.decodeMatrixFromPackedRGBA(s,t,n,u)}},{"../../environment":62,"./tex_util":119,"./webgl_util":124}],100:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[];var o,a=t,s=e[3]-1;this.outputShape=e;var u="float("+n+") + float("+r+") * sum";o=.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+a+"; j <= "+a+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+o+";\n        setOutput(val);\n      }\n    "};n.LRNProgram=r},{}],101:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+i+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+i+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "};n.LRNGradProgram=r},{}],102:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,a=n-1-e.padInfo.left,s=t*n-1;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+s+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+n+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "};n.MaxPool2DBackpropProgram=r},{}],103:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1),this.variableNames=["matrixA","matrixB"];var i=n?e[1]:e[0],o=r?t[0]:t[1],a=n?e[0]:e[1];this.outputShape=[i,o];var s=function(e,t){return n?t+" + "+e+", aRow":"aRow, "+t+" + "+e},u=function(e,t){return r?"bCol, "+t+" + "+e:t+" + "+e+", bCol"},l=4*Math.floor(a/4),c=a%4;this.userCode=" float dotARowBCol(int aRow, int bCol) {\n      float result = 0.0;\n      for (int i = 0; i < "+l+"; i += 4) {\n        vec4 a = vec4(\n          getMatrixA("+s(0,"i")+"),\n          getMatrixA("+s(1,"i")+"),\n          getMatrixA("+s(2,"i")+"),\n          getMatrixA("+s(3,"i")+")\n        );\n        vec4 b = vec4(\n          getMatrixB("+u(0,"i")+"),\n          getMatrixB("+u(1,"i")+"),\n          getMatrixB("+u(2,"i")+"),\n          getMatrixB("+u(3,"i")+")\n        );\n\n        result += dot(a, b);\n      }\n\n      if ("+(1===c)+") {\n        result += getMatrixA("+s(0,l)+") *\n          getMatrixB("+u(0,l)+");\n      } else if ("+(2===c)+") {\n        vec2 a = vec2(\n          getMatrixA("+s(0,l)+"),\n          getMatrixA("+s(1,l)+")\n        );\n        vec2 b = vec2(\n          getMatrixB("+u(0,l)+"),\n          getMatrixB("+u(1,l)+")\n        );\n        result += dot(a, b);\n      } else if ("+(3===c)+") {\n        vec3 a = vec3(\n          getMatrixA("+s(0,l)+"),\n          getMatrixA("+s(1,l)+"),\n          getMatrixA("+s(2,l)+")\n        );\n        vec3 b = vec3(\n          getMatrixB("+u(0,l)+"),\n          getMatrixB("+u(1,l)+"),\n          getMatrixB("+u(2,l)+")\n        );\n        result += dot(a, b);\n      }\n\n      return result;\n    }\n\n    void main() {\n      ivec2 resRC = getOutputCoords();\n      setOutput(dotARowBCol(resRC.x, resRC.y));\n    }\n    "};n.MatMulProgram=r},{}],104:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(n){var r=this;return function(e,t){null==r.seedLoc&&(r.seedLoc=e.getUniformLocation(t,"seed")),e.gl.uniform1f(r.seedLoc,n)}},e}();n.MultinomialProgram=r},{}],105:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "};n.OneHotProgram=r},{}],106:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=e("./shader_compiler"),r=function(n,e,t){this.variableNames=["x"],this.outputShape=e.map(function(e,t){return e[0]+n[t]+e[1]});var r=n.length,i=u.getCoordsDataType(r),o=e.map(function(e){return e[0]}).join(","),a=e.map(function(e,t){return e[0]+n[t]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+i+" start = "+i+"("+o+");\n      "+i+" end = "+i+"("+a+");\n\n      void main() {\n        "+i+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+t+"));\n        } else {\n          "+i+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+o+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+t+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "};n.PadProgram=r},{"./shader_compiler":116}],107:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterHeight,i=e.filterWidth,o=e.strideHeight,a=e.strideWidth,s=e.padInfo.top,u=e.padInfo.left;this.outputShape=e.outShape;var l="avg"===t,c="0.0";if(l||(c="-1.0 / 0.0"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+a+");\n        const ivec2 pads = ivec2("+s+", "+u+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+r+"; wR++) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+i+"; wC++) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+i+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(p="avgValue / count");var h=4*Math.floor(i/4),f=i%4,d="\n      if ("+l+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+s+", "+u+");\n      const float initializationValue = "+c+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+c+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+r+"; wR++) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC += 4) {\n            int xC = xCCorner + wC;\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + 1, d),\n              getValue(batch, xR, xC + 2, d),\n              getValue(batch, xR, xC + 3, d)\n            );\n\n            "+d+"\n          }\n\n          int xC = xCCorner + "+h+";\n          if ("+(1===f)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+d+"\n          } else if ("+(2===f)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + 1, d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+d+"\n          } else if ("+(3===f)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + 1, d),\n              getValue(batch, xR, xC + 2, d),\n              initializationValue\n            );\n\n            "+d+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}};n.Pool2DProgram=r},{}],108:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,i=e.inSize,o=Math.ceil(i/n);this.outputShape=[r,o];var a="0.0",s="";"min"===t?(a="1.0 / 0.0",s="min"):"max"===t&&(a="-1.0 / 0.0",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,p="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",h="vec4";"all"===t?(a="1.0",p="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===t&&(a="0.0",p="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");var f="";0<i%n&&(f="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+f+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+p+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+p+"\n        } else if ("+(2===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+p+"\n        } else if ("+(3===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+p+"\n        }\n        setOutput("+u+");\n      }\n    "};n.ReduceProgram=r},{}],109:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],o=r[2],a=e.shape,s=a[1],u=a[2],l=[n&&1<s?i-1:i,n&&1<u?o-1:o],c=[n&&1<s?s-1:s,n&&1<u?u-1:u],p=l[0]/c[0],h=l[1]/c[1],f=1/p,d=1/h,m=2*Math.ceil(f)+2,y=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+p+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+y+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(o-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "};n.ResizeBilinearBackpropProgram=r},{}],110:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[0],o=e[1],a=e[2],s=e[3];this.outputShape=[i,t,n,s];var u=[r&&1<t?o-1:o,r&&1<n?a-1:a],l=[r&&1<t?t-1:t,r&&1<n?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "};n.ResizeBilinearProgram=r},{}],111:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],o=r[2],a=e.shape,s=a[1],u=a[2],l=[n&&1<s?i-1:i,n&&1<u?o-1:o],c=[n&&1<s?s-1:s,n&&1<u?u-1:u],p=l[0]/c[0],h=l[1]/c[1],f=1/p,d=1/h,m=2*Math.ceil(f)+2,y=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+p+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+y+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "};n.ResizeNearestNeigborBackpropProgram=r},{}],112:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[0],o=e[1],a=e[2],s=e[3];this.outputShape=[i,t,n,s];var u=[r&&1<t?o-1:o,r&&1<n?a-1:a],l=[r&&1<t?t-1:t,r&&1<n?n-1:n],c=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+c+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "};n.ResizeNearestNeighborProgram=r},{}],113:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./shader_compiler"),r=function(r,i){this.variableNames=["x"];var e=r.length;if(4<e)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");if(this.outputShape=r,1!==e){var t=r.map(function(e,t){return n=t,-1!==i.indexOf(n)&&1!==r[n]?r[n]+" - coords["+n+"] - 1":"coords["+n+"]";var n}).join(","),n=o.getCoordsDataType(e);this.userCode="\n      void main() {\n        "+n+" coords = getOutputCoords();\n        setOutput(getX("+t+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+r[0]+" - coord - 1));\n        }\n      "};n.ReverseProgram=r},{"./shader_compiler":116}],114:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/n);this.outputShape=[r,a];var s=4*Math.floor(n/4),u=n%4,l="\n        sumValue += dot(values, filter);\n    ",c="";0<i%n&&(c="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      ");var p="";0<i%n&&(p="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+c+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+p+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+o+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+o+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+l+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+l+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+l+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+l+"\n        }\n        setOutput(sumValue);\n      }\n    "};n.SegmentOpProgram=r},{}],115:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var c=e("./shader_compiler"),r=function(e,t,n){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=t,4<n)throw Error("Where for rank "+n+" is not yet supported");if(1===n)r=i="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<t.length;u++)s.push(""+o[u]),u<e&&a.push(""+o[u]);r=a.join(),i=s.join()}var l=c.getCoordsDataType(n);this.userCode="\n      void main() {\n        "+l+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+i+"));\n        } else {\n          setOutput(getB("+i+"));\n        }\n      }\n    "};n.SelectProgram=r},{"./shader_compiler":116}],116:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var y=e("../../ops/broadcast_util"),A=e("../../util");function g(e){var t,n,r=e.shapeInfo.logicalShape;switch(r.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";return"\n    float "+n+"() {\n      return sampleTexture("+t+", halfCR);\n    }\n  "}(e);case 1:return t=e.name,"\n    float "+(n="get"+t.charAt(0).toUpperCase()+t.slice(1))+"(int index) {\n      return "+n+"Flat(index);\n    }\n  ";case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape;if(null!=i&&A.arraysEqual(t,i)){var o=i[0],a=i[1];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+a+".0, "+o+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var s=A.squeezeShape(t),u=s.newShape,l=s.keptDims,c=u;if(c.length<t.length){var p=v(e,c);return"\n      "+g(p)+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+b(["row","col"],l)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = row * "+t[1]+" + col;\n        return "+r+"Flat(index);\n      }\n    ";var h=i[0],f=i[1];if(1===f)return"\n    float "+r+"(int row, int col) {\n      int index = row * "+t[1]+" + col;\n      vec2 uv = vec2(0.5, (float(index) + 0.5) / "+h+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ";if(1===h)return"\n    float "+r+"(int row, int col) {\n      int index = row * "+t[1]+" + col;\n      vec2 uv = vec2((float(index) + 0.5) / "+f+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ";return"\n  float "+r+"(int row, int col) {\n    vec2 uv = UVfrom2D("+h+", "+f+", "+t[1]+", row, col);\n    return sampleTexture("+n+", uv);\n  }\n"}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[1]*t[2],o=t[2],a=A.squeezeShape(t),s=a.newShape,u=a.keptDims,l=s;if(l.length<t.length){var c=v(e,l);return"\n        "+g(c)+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+b(["row","col","depth"],u)+");\n        }\n      "}if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = row * "+i+" + col * "+o+" + depth;\n        return "+r+"Flat(index);\n      }\n    ";var p=e.shapeInfo.texShape,h=p[0],f=p[1];if(f===i)return"\n        float "+r+"(int row, int col, int depth) {\n          int texR = row;\n          int texC = col * "+o+" + depth;\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+f+".0, "+h+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ";if(f===o)return"\n    float "+r+"(int row, int col, int depth) {\n      int texR = row * "+t[1]+" + col;\n      int texC = depth;\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+f+".0, "+h+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ";return"\n      float "+r+"(int row, int col, int depth) {\n        vec2 uv = UVfrom3D(\n            "+h+", "+f+", "+i+", "+o+", row, col, depth);\n        return sampleTexture("+n+", uv);\n      }\n  "}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[3],o=t[2]*i,a=t[1]*o,s=A.squeezeShape(t),u=s.newShape,l=s.keptDims;if(u.length<t.length){var c=v(e,u);return"\n      "+g(c)+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+b(["row","col","depth","depth2"],l)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = row * "+a+" + col * "+o+" +\n            depth * "+i+" + depth2;\n        return "+r+"Flat(index);\n      }\n    ";var p=e.shapeInfo.texShape,h=p[0],f=p[1];if(f===a)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int texR = row;\n        int texC = col * "+o+" + depth * "+i+" + depth2;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+f+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ";if(f===i)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int texR = row * "+t[1]*t[2]+" + col * "+t[2]+" + depth;\n        int texC = depth2;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+f+".0, "+h+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ";return"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      vec2 uv = UVfrom4D("+h+", "+f+", "+a+", "+o+",\n          "+i+", row, col, depth, depth2);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[4],o=t[3]*i,a=t[2]*o,s=t[1]*a,u=A.squeezeShape(t),l=u.newShape,c=u.keptDims;if(l.length<t.length){var p=v(e,l);return"\n      "+g(p)+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+b(["row","col","depth","depth2","depth3"],c)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int index = row * "+s+" + col * "+a+" +\n            depth * "+o+" + depth2 * "+i+" + depth3;\n        return "+r+"Flat(index);\n      }\n    ";var h=e.shapeInfo.texShape,f=h[0],d=h[1];if(d===s)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        int texC = col * "+a+" + depth * "+o+" +\n                   depth2 * "+i+" + depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+d+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ";if(d===i)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row * "+t[1]*t[2]+" + col * "+t[2]+" +\n                   depth * "+t[3]+" + depth2;\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+d+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ";return"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      vec2 uv = UVfrom5D("+f+", "+d+", "+s+", "+a+",\n          "+o+", "+i+", row, col, depth, depth2, depth3);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[5],o=t[4]*i,a=t[3]*o,s=t[2]*a,u=t[1]*s,l=A.squeezeShape(t),c=l.newShape,p=l.keptDims;if(c.length<t.length){var h=v(e,c);return"\n      "+g(h)+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+b(["row","col","depth","depth2","depth3","depth4"],p)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = row * "+u+" + col * "+s+" +\n            depth * "+a+" + depth2 * "+o+" + depth3 * "+o+"\n            + depth4\n        return "+r+"Flat(index);\n      }\n    ";var f=e.shapeInfo.texShape,d=f[0],m=f[1];if(m===u)return"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        int texC = col * "+s+" + depth * "+a+" + depth2;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ";if(m===i)return"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row * "+t[1]*t[2]+" + col * "+t[2]+" + depth;\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ";return"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      vec2 uv = UVfrom6D("+d+", "+m+", "+u+", "+s+",\n          "+a+", "+o+", "+i+"\n          ,row, col, depth, depth2, depth3, depth4);\n      return sampleTexture("+n+", uv);\n    }\n  "}(e);default:throw new Error(r.length+"-D input sampling is not yet supported")}}n.makeShader=function(e,o,t,a){var n=e.map(function(e){var t=A.sizeFromShape(e.shapeInfo.logicalShape);return e.shapeInfo.isUniform?"uniform float "+e.name+(1<t?"["+t+"]":"")+";":"uniform sampler2D "+e.name+";"});n=n.join("\n");var r=e.map(function(e){return n=o,r=a,i=function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1)+"Flat",r=A.sizeFromShape(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform)return 1===r?"float "+n+"(int index) {return "+t+";}":"\n      float "+n+"(int index) {\n        for (int i = 0; i < "+r+"; i++) {\n          if (i == index) {\n            return "+t+"[i];\n          }\n        }\n      }\n    ";var i=e.shapeInfo.texShape,o=i[0],a=i[1];return 1===a&&1===o?"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ":1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index) + 0.5) / "+o+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index) + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = UVfrom1D("+o+", "+a+", index);\n      return sampleTexture("+t+", uv);\n    }\n  "}(t=e),i+=g(t),(r||A.arraysEqual(t.shapeInfo.logicalShape,n.logicalShape))&&(i+=function(e,t,n){var r=e.name,i=r.charAt(0).toUpperCase()+r.slice(1),o="get"+i+"AtOutCoords",a=y.getBroadcastDims(e.shapeInfo.logicalShape,t.logicalShape),s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length,l=n&&(s<u||0<a.length),c=y.broadcastDimsAreOuter(a),p=e.shapeInfo.isUniform;if(l&&!c)return function(e,t,n,r){var i=e.shapeInfo.logicalShape.length,o=t.logicalShape.length,a="int";2===o?a="ivec2":3===o?a="ivec3":4===o&&(a="ivec4");var s,u=y.getBroadcastDims(e.shapeInfo.logicalShape,t.logicalShape),l=o-i;s=0===i?"":o<2&&1<=u.length?"coords = 0;":u.map(function(e){return"coords["+(e+l)+"] = 0;"}).join("\n");var c="";return c=o<2&&0<i?"coords":e.shapeInfo.logicalShape.map(function(e,t){return"coords["+(t+l)+"]"}).join(", "),"\n    float "+r+"() {\n      "+a+" coords = getOutputCoords();\n      "+s+"\n      return get"+n+"("+c+");\n    }\n  "}(e,t,i,o);var h=A.sizeFromShape(e.shapeInfo.logicalShape),f="";l&&c&&(f="\n        int mainPart = index / "+h+";\n        index -= mainPart * "+h+";\n      ");var d=t.texShape;if(p)return 1===h?"float "+o+"() {return "+r+";}":"\n      float "+o+"() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                              vec2("+d[0]+", "+d[1]+"));\n        int index = resTexRC.x * "+d[1]+" + resTexRC.y;\n        "+f+"\n        return get"+i+"Flat(index);\n      }\n    ";var m=e.shapeInfo.texShape;return A.arraysEqual(m,d)?"\n      float "+o+"() {\n        return sampleTexture("+r+", resultUV);\n      }\n    ":"\n    float "+o+"() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+d[0]+", "+d[1]+"));\n      int index = resTexRC.x * "+d[1]+" + resTexRC.y;\n      "+f+"\n      int texR = index / "+m[1]+";\n      int texC = index - texR * "+m[1]+";\n      vec2 uv = (vec2(texC, texR) + halfCR) /\n                 vec2("+m[1]+".0, "+m[0]+".0);\n\n      return sampleTexture("+r+", uv);\n    }\n  "}(t,n,r)),i;var t,n,r,i}).join("\n"),i=o.texShape,s=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(i=t)[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+i[1]+".0);\n      }\n    ":1===i[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+i[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+i[0]+", "+i[1]+"));\n      return resTexRC.x * "+i[1]+" + resTexRC.y;\n    }\n  ";case 2:return n=e,r=t,A.arraysEqual(n,r)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+r[0]+", "+r[1]+"));\n      }\n    ":1===n[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+r[0]+", "+r[1]+"));\n        int index = resTexRC.x * "+r[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===n[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+r[0]+", "+r[1]+"));\n        int index = resTexRC.x * "+r[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+r[0]+", "+r[1]+"));\n      int index = resTexRC.x * "+r[1]+" + resTexRC.y;\n      int r = index / "+n[1]+";\n      int c = index - r * "+n[1]+";\n      return ivec2(r, c);\n    }\n  ";case 3:return T=t,P=(x=e)[1]*x[2],N=x[2],"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+T[0]+", "+T[1]+"));\n      int index = resTexRC.x * "+T[1]+" + resTexRC.y;\n      int r = index / "+P+";\n      index -= r * "+P+";\n      int c = index / "+N+";\n      int d = index - c * "+N+";\n      return ivec3(r, c, d);\n    }\n  ";case 4:return b=t,_=(v=e)[3],w=v[2]*_,S=v[1]*w,"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+b[0]+", "+b[1]+"));\n      int index = resTexRC.x * "+b[1]+" + resTexRC.y;\n\n      int r = index / "+S+";\n      index -= r * "+S+";\n\n      int c = index / "+w+";\n      index -= c * "+w+";\n\n      int d = index / "+_+";\n      int d2 = index - d * "+_+";\n\n      return ivec4(r, c, d, d2);\n    }\n  ";case 5:return f=t,d=(h=e)[4],m=h[3]*d,y=h[2]*m,g=h[1]*y,"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+f[0]+",\n                             "+f[1]+"));\n\n      int index = resTexRC.x * "+f[1]+" + resTexRC.y;\n\n      int r = index / "+g+";\n      index -= r * "+g+";\n\n      int c = index / "+y+";\n      index -= c * "+y+";\n\n      int d = index / "+m+";\n      index -= d * "+m+";\n\n      int d2 = index  / "+d+";\n      int d3 = index - d2 * "+d+";\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ";case 6:return a=t,s=(o=e)[5],u=o[4]*s,l=o[3]*u,c=o[2]*l,p=o[1]*c,"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+a[0]+", "+a[1]+"));\n      int index = resTexRC.x * "+a[1]+" + resTexRC.y;\n\n      int r = index / "+p+";\n      index -= r * "+p+";\n\n      int c = index / "+c+";\n      index -= c * "+c+";\n\n      int d = index / "+l+";\n      index -= d * "+l+";\n\n      int d2 = index / "+u+";\n      index -= d2 * "+u+";\n\n      int d3 = index / "+s+";\n      int d4 = index - d3 * "+s+";\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ";default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r,i,o,a,s,u,l,c,p,h,f,d,m,y,g,v,b,_,w,S,x,T,P,N}(o.logicalShape,i);return[c,u,l,n,s,r,t].join("\n")};var u="\n  float sampleTexture(sampler2D textureSampler, vec2 uv) {\n    return texture2D(textureSampler, uv).r;\n  }\n",l="\n  void setOutput(float val) {\n    gl_FragColor = vec4(val, 0, 0, 0);\n  }\n",c="\n  precision highp float;\n  precision highp int;\n  varying vec2 resultUV;\n  const vec2 halfCR = vec2(0.5, 0.5);\n\n  struct ivec5\n  {\n    int x;\n    int y;\n    int z;\n    int w;\n    int u;\n  };\n\n  struct ivec6\n  {\n    int x;\n    int y;\n    int z;\n    int w;\n    int u;\n    int v;\n  };\n\n  bool isNaN(float val) {\n    return (val < 0.0 || 0.0 < val || val == 0.0) ? false : true;\n  }\n\n  bool hasNaN(vec4 values) {\n    vec4 v1 = values * values;\n    vec4 v2 = values * values;\n    return any(notEqual(v1, v2));\n  }\n\n  float getNaN(vec4 values) {\n    return dot(vec4(1), values);\n  }\n\n  int round(float value) {\n    return int(floor(value + 0.5));\n  }\n\n  int imod(int x, int y) {\n    return x - y * (x / y);\n  }\n\n  //Based on the work of Dave Hoskins\n  //https://www.shadertoy.com/view/4djSRW\n  #define HASHSCALE1 443.8975\n  float random(float seed){\n    vec2 p = resultUV * seed;\n    vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n    p3 += dot(p3, p3.yzx + 19.19);\n    return fract((p3.x + p3.y) * p3.z);\n  }\n\n  \nvec2 UVfrom1D(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom2D(int texNumR, int texNumC, int numC, int row, int col) {\n  int index = row * numC + col;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom3D(int texNumR, int texNumC, int stride0,\n    int stride1, int row, int col, int depth) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom4D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int row, int col, int depth,\n    int depth2) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth * stride2 + depth2;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom5D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int stride3, int row, int col, int depth,\n    int depth2, int depth3) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 +\n              depth * stride2 + depth2 * stride3 + depth3;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  \nvec2 UVfrom6D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int stride3, int stride4,\n    int row, int col, int depth, int depth2, int depth3, int depth4) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth * stride2 + depth2 *\n    stride3 + depth3 * stride4 + depth4;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n";function v(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function b(t,e){return e.map(function(e){return t[e]}).join(", ")}n.getCoordsDataType=function(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}},{"../../ops/broadcast_util":132,"../../util":187}],117:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./shader_compiler"),i=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t=r.getCoordsDataType(this.rank),n=function(e){{if(1===e)return"sourceLoc";if(2===e)return"sourceLoc.x, sourceLoc.y";if(3===e)return"sourceLoc.x, sourceLoc.y, sourceLoc.z";if(4===e)return"sourceLoc.x, sourceLoc.y, sourceLoc.z, sourceLoc.w";throw Error("Slicing for rank "+e+" is not yet supported")}}(this.rank);this.userCode="\n      uniform "+t+" start;\n\n      void main() {\n        "+t+" sourceLoc = start + getOutputCoords();\n        setOutput(getSource("+n+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(n){var r=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(e,t){if(null!=r.startLoc||(r.startLoc=e.getUniformLocationNoThrow(t,"start"),null!=r.startLoc))if(1===r.rank)e.gl.uniform1i(r.startLoc,n[0]);else if(2===r.rank)e.gl.uniform2i(r.startLoc,n[0],n[1]);else if(3===r.rank)e.gl.uniform3i(r.startLoc,n[0],n[1],n[2]);else{if(4!==r.rank)throw Error("Slicing for rank "+r.rank+" is not yet supported");e.gl.uniform4i(r.startLoc,n[0],n[1],n[2],n[3])}}},e}();n.SliceProgram=i},{"./shader_compiler":116}],118:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var c=e("./shader_compiler"),r=function(e,t,n,r){this.variableNames=["x"];var i=n.filter(function(e,t){return-1===r.indexOf(t)});this.outputShape=i;var o=n.length,a=c.getCoordsDataType(n.length),s=c.getCoordsDataType(i.length),u="";if(1===o)u="coords * strides + begin";else{var l=0;u=n.map(function(e,t){return-1===r.indexOf(t)?(l++,1===i.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(l-1)+"] * strides["+t+"] + begin["+t+"]"):"begin["+t+"]"}).join(",")}this.userCode="\n      "+a+" begin = "+a+"("+e+");\n      "+a+" strides = "+a+"("+t+");\n\n      void main() {\n        "+s+" coords = getOutputCoords();\n        setOutput(getX("+u+"));\n      }\n    "};n.StridedSliceProgram=r},{"./shader_compiler":116}],119:[function(e,t,n){"use strict";var r,i;function a(e,t){return e*t}function s(e,t){if(e%t!=0)throw new Error("unpackedSize ("+e+") must be a multiple of "+t);return e/t}function _(e,t){return[Math.ceil(t/2),Math.ceil(e/2)]}function w(e,t){var n=_(e,t);return n[0]*n[1]*4}Object.defineProperty(n,"__esModule",{value:!0}),(r=n.TextureUsage||(n.TextureUsage={}))[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD",(i=n.PhysicalTextureType||(n.PhysicalTextureType={}))[i.FLOAT16=0]="FLOAT16",i[i.FLOAT32=1]="FLOAT32",i[i.UNSIGNED_BYTE=2]="UNSIGNED_BYTE",n.getUnpackedMatrixTextureShapeWidthHeight=function(e,t){return[t,e]},n.getUnpackedArraySizeFromMatrixSize=a,n.getColorMatrixTextureShapeWidthHeight=function(e,t){return[4*t,e]},n.getMatrixSizeFromUnpackedArraySize=s,n.encodeMatrixToUnpackedArray=function(e,t,n){var r=a(e.length,n);if(t.length<r)throw new Error("unpackedArray length ("+t.length+") must be >= "+r);for(var i=0,o=0;o<e.length;++o)t[i]=e[o],i+=n},n.decodeMatrixFromUnpackedArray=function(e,t,n){var r=s(e.length,n);if(t.length<r)throw new Error("matrix length ("+t.length+") must be >= "+r);for(var i=0,o=0;o<e.length;o+=n)t[i++]=e[o]},n.decodeMatrixFromUnpackedColorRGBAArray=function(e,t,n){var r=e.length*n/4;if(t.length<r)throw new Error("matrix length ("+t.length+") must be >= "+r);for(var i=0,o=0;o<e.length;o+=4)for(var a=0;a<n;a++)t[i++]=e[o+a]},n.getPackedMatrixTextureShapeWidthHeight=_,n.getPackedRGBAArraySizeFromMatrixShape=w,n.encodeMatrixToPackedRGBA=function(e,t,n,r){var i=w(t,n);if(r.length<i)throw new Error("packedRGBA length ("+r.length+") must be >= "+i);for(var o=_(t,n),a=o[0],s=o[1],u=n%2==1,l=t%2==1,c=Math.floor(n/2),p=Math.floor(t/2),h=u?4:0,f=n,d=0,m=0;m<p;++m){for(var y=2*m*n,g=0;g<c;++g){var v=y+2*g;r[d]=e[v],r[d+1]=e[v+1],r[d+2]=e[v+f],r[d+3]=e[v+f+1],d+=4}d+=h}if(u){v=n-1,d=4*(a-1);var b=2*n;for(h=4*a,m=0;m<p;++m)r[d]=e[v],r[d+2]=e[v+n],v+=b,d+=h}if(l)for(v=(t-1)*n,d=(s-1)*a*4,g=0;g<c;++g)r[d++]=e[v++],r[d++]=e[v++],d+=2;return u&&l&&(r[r.length-4]=e[e.length-1]),r},n.decodeMatrixFromPackedRGBA=function(e,t,n,r){var i=t*n;if(i<r.length)throw new Error("matrix length ("+r.length+") must be >= "+i);for(var o=n%2==1,a=t%2==1,s=Math.floor(n/2),u=Math.floor(t/2),l=_(t,n),c=l[0],p=l[1],h=o?4:0,f=n+(o?1:0),d=0,m=0,y=n,g=0;g<u;++g){for(var v=0;v<s;++v)r[m++]=e[d++],r[m++]=e[d++],r[y++]=e[d++],r[y++]=e[d++];d+=h,m+=f,y+=f}if(o){d=4*(c-1);var b=n-1;for(h=4*c,f=2*n,g=0;g<u;++g)r[b]=e[d],r[b+n]=e[d+2],d+=h,b+=f}if(a)for(d=(p-1)*c*4,b=(t-1)*n,v=0;v<s;++v)r[b++]=e[d++],r[b++]=e[d++],d+=2;return o&&a&&(r[r.length-1]=e[e.length-4]),r}},{}],120:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../environment"),a=e("./tex_util"),i=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t){var n,r=s(t),i=u(e,r);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),0<this.freeTextures[i].length){this.numFreeTextures--,this.numUsedTextures++,this.log();var o=this.freeTextures[i].shift();return this.usedTextures[i].push(o),o}return this.numUsedTextures++,this.log(),r===a.PhysicalTextureType.FLOAT32?n=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===a.PhysicalTextureType.FLOAT16?n=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===a.PhysicalTextureType.UNSIGNED_BYTE&&(n=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(n),n},e.prototype.releaseTexture=function(e,t,n){var r=u(t,s(n));r in this.freeTextures||(this.freeTextures[r]=[]),this.freeTextures[r].push(e),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[r],o=i.indexOf(e);if(o<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(o,1),this.log()},e.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var t=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function s(e){if(e===a.TextureUsage.DOWNLOAD||e===a.TextureUsage.PIXELS)return a.PhysicalTextureType.UNSIGNED_BYTE;if(e===a.TextureUsage.UPLOAD)return a.PhysicalTextureType.FLOAT32;if(e===a.TextureUsage.RENDER)return r.ENV.get("WEBGL_RENDER_FLOAT32_ENABLED")?a.PhysicalTextureType.FLOAT32:a.PhysicalTextureType.FLOAT16;throw new Error("Unknown logical texture type "+e)}function u(e,t){return e[0]+"_"+e[1]+"_"+t}n.TextureManager=i},{"../../environment":62,"./tex_util":119}],121:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("./shader_compiler"),r=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var i=a.getCoordsDataType(this.rank),o=function(e){var t=e.length;if(5<t)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],i=0;i<e.length;i++)r.push("imod("+n[i]+", "+e[i]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "};n.TileProgram=r},{"./shader_compiler":116}],122:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("./shader_compiler"),r=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var i=a.getCoordsDataType(this.rank),o=function(e){var t=e.length;if(6<t)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),i=0;i<e.length;i++)r[e[i]]=n[i];return r.join()}(t);this.userCode="\n    void main() {\n      "+i+" resRC = getOutputCoords();\n      setOutput(getA("+o+"));\n    }\n    "};n.TransposeProgram=r},{"./shader_compiler":116}],123:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../ops/erf_util"),i=e("../../ops/selu_util"),o=function(){function e(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float NAN;\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(){var n=this;return function(e,t){null==n.startLoc&&(n.startLoc=e.getUniformLocationNoThrow(t,"NAN"),null==n.startLoc)||e.gl.uniform1f(n.startLoc,NaN)}},e}();n.UnaryOpProgram=o;var a="if (isNaN(x)) return x;";n.ABS="return abs(x);",n.RELU=a+"\n  return (x < 0.0) ? 0.0 : x;\n",n.ELU="return (x >= 0.0) ? x : (exp(x) - 1.0);",n.SELU="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+i.SELU_SCALEALPHA+";\n  float scale = "+i.SELU_SCALE+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",n.STEP=function(e){return void 0===e&&(e=0),a+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "},n.NEG="return -x;",n.CEIL="return ceil(x);",n.FLOOR="return floor(x);",n.SIGN="\n  if (isNaN(x)) { return 0.0; }\n  return sign(x);\n",n.ROUND="\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n",n.EXP="return exp(x);",n.EXPM1="return exp(x) - 1.0;",n.LOG="if (x < 0.0) return NAN;\n  return log(x);",n.LOG1P="return log(1.0 + x);",n.SQRT="return sqrt(x);",n.RSQRT="return inversesqrt(x);",n.SIGMOID="return 1.0 / (1.0 + exp(-1.0 * x));",n.SOFTPLUS="\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n",n.SIN=a+"\n  return sin(x);\n",n.COS=a+"\n  return cos(x);\n",n.TAN="return tan(x);",n.ASIN="return asin(x);",n.ACOS="return acos(x);",n.ATAN=a+"\n  return atan(x);\n",n.SINH="\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n",n.COSH="\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n",n.TANH="\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n",n.ASINH="return log(x + sqrt(x * x + 1.0));",n.ACOSH=a+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",n.ATANH=a+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",n.ERF='\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '+r.ERF_P+";\n  float a1 = "+r.ERF_A1+";\n  float a2 = "+r.ERF_A2+";\n  float a3 = "+r.ERF_A3+";\n  float a4 = "+r.ERF_A4+";\n  float a5 = "+r.ERF_A5+";\n\n  float t = 1.0 / (1.0 + p * x);\n  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);\n",n.SQUARE="return x * x;",n.RECIPROCAL="return 1.0 / x;",n.LOGICAL_NOT="return float(!(x >= 1.0));",n.TO_INT="return float(int(x));"},{"../../ops/erf_util":138,"../../ops/selu_util":158}],124:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=null,h=e("../../util"),i=e("../../environment");function o(e,t){var n,r=i.ENV.get("WEBGL_VERSION");if(2===r?n=e.getContext("webgl2",t):1===r&&(n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t)),0===r||null==n)throw new Error("This browser does not support WebGL.");return n}function u(e,t){var n=t();return s(e),n}n.createWebGLRenderingContext=function(e){var t=document.createElement("canvas");return t.width=1,t.height=1,o(t,e)},n.createWebGLRenderingContextFromCanvas=o,n.callAndCheck=u;var a=!1;function s(e){if(a){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+l(e,t))}}function l(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}n.enableDebugWebGLErrorChecking=function(e){a=e},n.checkWebGLError=s,n.getWebGLErrorMessage=l,n.getExtensionOrThrow=function(e,t){return m(e,function(){return e.getExtension(t)},'Extension "'+t+'" not supported on this browser.')},n.createVertexShader=function(e,t){var n=m(e,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(u(e,function(){return e.shaderSource(n,t)}),u(e,function(){return e.compileShader(n)}),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n},n.createFragmentShader=function(e,t){var n=m(e,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(u(e,function(){return e.shaderSource(n,t)}),u(e,function(){return e.compileShader(n)}),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw function(e,t){var n=f.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),console.log(e);for(var r=+n[1],i=e.split("\n"),o=i.length.toString().length+2,a=i.map(function(e,t){return h.rightPad((t+1).toString(),o)+e}),s=0,u=0;u<a.length;u++)s=Math.max(a[u].length,s);var l=a.slice(0,r-1),c=a.slice(r-1,r),p=a.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+h.rightPad(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join("\n"))}(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n};var f=/ERROR: [0-9]+:([0-9]+):/g;function c(e){return null!=r?r:r=u(e,function(){return e.getParameter(e.MAX_TEXTURE_SIZE)})}function p(e,t,n){y(e,n),u(e,function(){return e.activeTexture(e.TEXTURE0+n)}),u(e,function(){return e.bindTexture(e.TEXTURE_2D,t)})}function d(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function m(e,t,n){var r=u(e,function(){return t()});if(null==r)throw new Error(n);return r}function y(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||n<r)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+n+"]")+".")}n.createProgram=function(e){return m(e,function(){return e.createProgram()},"Unable to create WebGLProgram.")},n.linkProgram=function(e,t){if(u(e,function(){return e.linkProgram(t)}),!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")},n.validateProgram=function(e,t){if(u(e,function(){return e.validateProgram(t)}),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")},n.createStaticVertexBuffer=function(e,t){var n=m(e,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return u(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,n)}),u(e,function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)}),n},n.createStaticIndexBuffer=function(e,t){var n=m(e,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return u(e,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)}),u(e,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)}),n},n.queryMaxTextureSize=c,n.getNumChannels=function(){return 2===i.ENV.get("WEBGL_VERSION")?1:4},n.createTexture=function(e){return m(e,function(){return e.createTexture()},"Unable to create WebGLTexture.")},n.validateTextureSize=function(e,t,n){var r=c(e);if(t<=0||n<=0){var i="["+t+"x"+n+"]";throw new Error("Requested texture size "+i+" is invalid.")}if(r<t||r<n)throw i="["+t+"x"+n+"]",new Error("Requested texture size "+i+" greater than WebGL maximum on this browser / GPU ["+r+"x"+r+"].")},n.createFramebuffer=function(e){return m(e,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")},n.bindVertexBufferToProgramAttribute=function(e,t,n,r,i,o,a){var s=e.getAttribLocation(t,n);return-1!==s&&(u(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),u(e,function(){return e.vertexAttribPointer(s,i,e.FLOAT,!1,o,a)}),u(e,function(){return e.enableVertexAttribArray(s)}),!0)},n.bindTextureUnit=p,n.unbindTextureUnit=function(e,t){y(e,t),u(e,function(){return e.activeTexture(e.TEXTURE0+t)}),u(e,function(){return e.bindTexture(e.TEXTURE_2D,null)})},n.getProgramUniformLocationOrThrow=function(e,t,n){return m(e,function(){return e.getUniformLocation(t,n)},'uniform "'+n+'" not present in program.')},n.getProgramUniformLocation=function(e,t,n){return e.getUniformLocation(t,n)},n.bindTextureToProgramUniformSampler=function(e,t,n,r,i){u(e,function(){return p(e,n,i)}),u(e,function(){return e.uniform1i(r,i)})},n.bindCanvasToFramebuffer=function(e){u(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),u(e,function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)}),u(e,function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)})},n.bindColorTextureToFramebuffer=function(e,t,n){u(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)}),u(e,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)})},n.unbindColorTextureFromFramebuffer=function(e,t){u(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)}),u(e,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})},n.validateFramebuffer=function(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+d(e,t))},n.getFramebufferErrorMessage=d,n.getTextureShapeFromLogicalShape=function(e,t){2!==t.length&&(t=h.squeezeShape(t).newShape);var n=c(e),r=h.sizeFromShape(t);return t.length<=1&&r<=n?[r,1]:2===t.length&&t[0]<=n&&t[1]<=n?t:3===t.length&&t[0]<=n&&t[1]*t[2]<=n?[t[0],t[1]*t[2]]:4===t.length&&t[0]<=n&&t[1]*t[2]*t[3]<=n?[t[0],t[1]*t[2]*t[3]]:h.sizeToSquarishShape(r)}},{"../../environment":62,"../../util":187}],125:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=e("../ops/array_ops");n.whereImpl=function(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var i=u.buffer(e,"int32"),o=u.buffer([n.length,e.length],"int32");for(r=0;r<n.length;r++){var a=i.indexToLoc(n[r]),s=r*e.length;o.values.set(a,s)}return o.toTensor()}},{"../ops/array_ops":127}],126:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./environment");n.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.ENV.get("IS_TEST")||console.warn.apply(console,e)},n.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.ENV.get("IS_TEST")||console.log.apply(console,e)}},{"./environment":62}],127:[function(e,t,u){"use strict";var n=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},x=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(u,"__esModule",{value:!0});var l=e("../environment"),a=e("../tensor"),T=e("../tensor_util_env"),c=e("../util"),p=e("./axis_util"),s=e("./concat"),r=e("./operation"),h=e("./rand"),f=e("./tensor_ops");function d(e,t,n){return void 0===t&&(t="float32"),new a.TensorBuffer(e,t,n)}u.toPixels=function(w,S){return n(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,l,c,p,h,f,d,m,y,g,v,b,_;return x(this,function(e){switch(e.label){case 0:if(2!==(t=T.convertToTensor(w,"img","toPixels","int32")).rank&&3!==t.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(n=t.shape.slice(0,2),r=n[0],i=n[1],4<(o=2===t.rank?1:t.shape[2])||2===o)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+o);return a=t.min(),s=t.max(),[4,a.data()];case 1:return u=e.sent()[0],[4,s.data()];case 2:if(l=e.sent()[0],a.dispose(),s.dispose(),"float32"===t.dtype){if(u<0||1<l)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+u+" - "+l+"].")}else{if("int32"!==t.dtype)throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(u<0||255<l)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+u+" - "+l+"].")}return[4,t.data()];case 3:for(c=e.sent(),p="float32"===t.dtype?255:1,h=new Uint8ClampedArray(i*r*4),f=0;f<r*i;++f)g=y=m=d=void 0,1===o?(d=c[f]*p,m=c[f]*p,y=c[f]*p,g=255):3===o?(d=c[3*f]*p,m=c[3*f+1]*p,y=c[3*f+2]*p,g=255):4===o&&(d=c[4*f]*p,m=c[4*f+1]*p,y=c[4*f+2]*p,g=c[4*f+3]*p),h[0+(v=4*f)]=Math.round(d),h[v+1]=Math.round(m),h[v+2]=Math.round(y),h[v+3]=Math.round(g);return null!=S&&(S.width=i,S.height=r,b=S.getContext("2d"),_=new ImageData(h,i,r),b.putImageData(_,0,0)),t!==w&&t.dispose(),[2,h]}})})},u.buffer=d,u.print=function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},u.cast=r.op({cast_:function(e,t){var n=T.convertToTensor(e,"x","cast");return l.ENV.engine.runKernel(function(e){return e.cast(n,t)},{$x:n},function(e){return{$x:function(){return e.clone()}}})}}),u.clone=r.op({clone_:function(e){var t=T.convertToTensor(e,"x","clone");return l.ENV.engine.runKernel(function(e){return a.Tensor.make(t.shape,{dataId:t.dataId},t.dtype)},{$x:t},function(e){return{$x:function(){return e.toFloat()}}})}}),u.cumsum=r.op({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var i=T.convertToTensor(e,"x","cumsum");t|=0;var o=p.getAxesPermutation([t],i.rank),a=i;null!=o&&(a=i.transpose(o));var s=p.getInnerMostAxes(1,i.rank)[0],u=l.ENV.engine.runKernel(function(e){return e.cumsum(a,s,n,r)},{permutedX:a},function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}});return null!=o&&(u=u.transpose(o)),u}}),u.expandDims=r.op({expandDims_:function(e,t){void 0===t&&(t=0);var n=T.convertToTensor(e,"x","expandDims");c.assert(t<=n.rank,"Axis must be <= rank of the tensor");var r=n.shape.slice();return t<0&&(c.assert(-(n.rank+1)<=t,"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"),t=n.rank+t+1),r.splice(t,0,1),u.reshape(n,r)}}),u.eye=r.op({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var i=d([e,t],r),o=e<=t?e:t,a=0;a<o;++a)i.set(1,a,a);var s=i.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return u.tile(u.expandDims(s,0),[n[0],1,1]);if(2===n.length)return u.tile(u.expandDims(u.expandDims(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return u.tile(u.expandDims(u.expandDims(u.expandDims(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),u.fromPixels=r.op({fromPixels_:function(e,t){if(void 0===t&&(t=3),4<t)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return l.ENV.engine.fromPixels(e,t)}}),u.multinomial=r.op({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var i=T.convertToTensor(e,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(2<a)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);n=n||Math.random();var s=1===a?i.as2D(1,-1):i,u=l.ENV.engine.runKernel(function(e){return e.multinomial(s,r,t,n)},{logits2D:s});return 1===a?u.as1D():u}}),u.oneHot=r.op({oneHot_:function(e,t,n,r){void 0===n&&(n=1),void 0===r&&(r=0);var i=T.convertToTensor(e,"indices","oneHot","int32");if(c.assert("int32"===i.dtype,"Indices must be of dtype `int32`"),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);return l.ENV.engine.runKernel(function(e){return e.oneHot(i,t,n,r)},{$indices:i})}}),u.pad=r.op({pad_:function(e,t,n){void 0===n&&(n=0);var r=T.convertToTensor(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i=t.map(function(e){return e[0]});return l.ENV.engine.runKernel(function(e){return e.pad(r,t,n)},{$x:r},function(e){return{$x:function(){return e.slice(i,r.shape)}}})}}),u.pad1d=r.op({pad1d_:function(e,t,n){return void 0===n&&(n=0),c.assert(2===t.length,"Invalid number of paddings. Must be length of 2."),u.pad(e,[t],n)}}),u.pad2d=r.op({pad2d_:function(e,t,n){return void 0===n&&(n=0),c.assert(2===t.length&&2===t[0].length&&2===t[1].length,"Invalid number of paddings. Must be length of 2 each."),u.pad(e,t,n)}}),u.pad3d=r.op({pad3d_:function(e,t,n){return void 0===n&&(n=0),c.assert(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,"Invalid number of paddings. Must be length of 2 each."),u.pad(e,t,n)}}),u.pad4d=r.op({pad4d_:function(e,t,n){return void 0===n&&(n=0),c.assert(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,"Invalid number of paddings. Must be length of 2 each."),u.pad(e,t,n)}}),u.rand=r.op({rand_:function(e,t,n){var r=c.sizeFromShape(e),i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=t();return a.Tensor.make(e,{values:i},n)}}),u.randomNormal=r.op({randomNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new h.MPRandGauss(t,n,r,!1,i),a=d(e,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),u.randomUniform=r.op({randomUniform_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var i=d(e,r),o=0;o<i.values.length;o++)i.values[o]=c.randUniform(t,n);return i.toTensor()}}),u.reshape=r.op({reshape_:function(e,t){var n=T.convertToTensor(e,"x","reshape");return t=c.inferFromImplicitShape(t,n.size),c.assert(n.size===c.sizeFromShape(t),"new shape and old shape must have the same number of elements."),l.ENV.engine.runKernel(function(e){return e.reshape(n,t)},{$x:n},function(e){return{$x:function(){return e.reshape(n.shape)}}})}}),u.split=r.op({split_:function(e,t,n){void 0===n&&(n=0);var r,i=T.convertToTensor(e,"x","split");n=p.parseAxisParam(n,i.shape)[0],"number"==typeof t?(c.assert(i.shape[n]%t==0,"Number of splits must evenly divide the axis."),r=Array(t).fill(i.shape[n]/t)):(c.assert(i.shape[n]===t.reduce(function(e,t){return e+t}),"The sum of sizes must match the size of the axis dimension."),r=t);var o=Array(i.rank).fill(0),a=i.shape.slice();return r.map(function(e){a[n]=e;var t=i.slice(o,a);return o[n]+=e,t})}}),u.squeeze=r.op({squeeze_:function(e,t){var n=T.convertToTensor(e,"x","squeeze");return u.reshape(n,c.squeezeShape(n.shape,t).newShape)}}),u.stack=r.op({stack_:function(e,t){void 0===t&&(t=0);var n=T.convertToTensorArray(e,"tensors","stack");if(c.assert(1<=n.length,"Pass at least one tensor to tf.stack"),1===n.length)return n[0].expandDims(t);var r=n[0].rank,i=n[0].shape,o=n[0].dtype;c.assert(t<=r,"Axis must be <= rank of the tensor"),n.forEach(function(e){c.assertShapesMatch(i,e.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(e){c.assert(o===e.dtype,"All tensors passed to stack must have matching dtypes")});var a=n.map(function(e){return e.expandDims(t)});return s.concat(a,t)}}),u.tile=r.op({tile_:function(e,a){var s=T.convertToTensor(e,"x","tile");return c.assert(s.rank===a.length,"Error in transpose: rank of input "+s.rank+" must match length of reps "+a+"."),l.ENV.engine.runKernel(function(e){return e.tile(s,a)},{$x:s},function(o){return{$x:function(){var e=f.zerosLike(s);if(1===s.rank)for(var t=0;t<a[0];++t)e=e.add(o.slice([t*s.shape[0]],[s.shape[0]]));else if(2===s.rank)for(t=0;t<a[0];++t)for(var n=0;n<a[1];++n)e=e.add(o.slice([t*s.shape[0],n*s.shape[1]],[s.shape[0],s.shape[1]]));else if(3===s.rank)for(t=0;t<a[0];++t)for(n=0;n<a[1];++n)for(var r=0;r<a[2];++r)e=e.add(o.slice([t*s.shape[0],n*s.shape[1],r*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(4!==s.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(t=0;t<a[0];++t)for(n=0;n<a[1];++n)for(r=0;r<a[2];++r)for(var i=0;i<a[3];++i)e=e.add(o.slice([t*s.shape[0],n*s.shape[1],r*s.shape[2],i*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return e}}})}}),u.truncatedNormal=r.op({truncatedNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new h.MPRandGauss(t,n,r,!0,i),a=d(e,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),u.unstack=r.op({unstack_:function(e,n){void 0===n&&(n=0);for(var t,r=T.convertToTensor(e,"x","unstack"),i=r.shape[n],o=Array(r.rank-1).fill(0),a=0,s=0;s<r.rank;s++)s!==n&&(o[a]=r.shape[s],a++);t=Array(i).fill(1);var u=Array(r.rank).fill(0),l=r.shape.slice();return t.map(function(e){l[n]=e;var t=r.slice(u,l);return u[n]+=e,t.reshape(o)})}}),u.batchToSpaceND=r.op({batchToSpaceND_:function(e,t,n){var r=T.convertToTensor(e,"x","batchToSpaceND"),i=t.reduce(function(e,t){return e*t});return c.assert(r.rank>=1+t.length,"input rank should be > than [blockShape] but got "+r.rank),c.assert(n.length===t.length,"crops.shape[0] must be equal to [blockShape] but got "+n.length),c.assert(r.shape[0]%i==0,"input tensor batch must be divisible by prod( blockShape )"),l.ENV.engine.runKernel(function(e){return e.batchToSpaceND(r,t,n)},{$x:r},function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}})}}),u.spaceToBatchND=r.op({spaceToBatchND_:function(e,r,t){var n=T.convertToTensor(e,"x","spaceToBatchND");return c.assert(n.rank>=1+r.length,"input rank should be > than [blockShape] but got "+n.rank),c.assert(t.length===r.length,"paddings.shape[0] must be equal to [blockShape], got "+t.length),c.assert(n.shape.reduce(function(e,t,n){return 0<n&&n<=r.length?e&&t%r[n-1]==0:e},!0),"input spatial dimensions must be divisible by blockShapes"),l.ENV.engine.runKernel(function(e){return e.spaceToBatchND(n,r,t)},{$x:n},function(e){return{$x:function(){return e.batchToSpaceND(r,t)}}})}})},{"../environment":62,"../tensor":180,"../tensor_util_env":183,"../util":187,"./axis_util":129,"./concat":134,"./operation":148,"./rand":151,"./tensor_ops":163}],128:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getReshaped=function(e,t,n,r){void 0===r&&(r=!0);var i=[];if(r)(i=i.concat(t.slice(0))).push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);for(var o=t.length,a=0;a<o;++a)i=i.concat([e[a+1]/t[a],t[a]]);i=i.concat(e.slice(o+1))}return i},n.getPermuted=function(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var i=t+1;i<e;++i)i<=2*t?(r.push(i),r.push(i-(t+1))):r.push(i)}else{var o=[],a=[];for(i=1;i<e;++i)2*t+1<=i||i%2==1?a.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,a)}return r},n.getReshapedPermuted=function(e,t,n,r){void 0===r&&(r=!0);var i=[];r?i.push(e[0]/n):i.push(e[0]*n);for(var o=1;o<e.length;++o)o<=t.length?r?i.push(t[o-1]*e[o]):i.push(e[o]/t[o-1]):i.push(e[o]);return i},n.getSliceBeginCoords=function(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n},n.getSliceSize=function(e,t,n){for(var r=e.slice(0,1),i=0;i<n;++i)r.push(e[i+1]-t[i][0]-t[i][1]);return r}},{}],129:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../util");function i(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function o(e,t,n){for(var r=e.length+t.length,i=[],o=0,a=0,s=0;s<r;s++)-1===n.indexOf(s)?i.push(e[o++]):i.push(t[a++]);return i}n.axesAreInnerMostDims=i,n.combineLocations=o,n.computeOutAndReduceShapes=function(t,e){for(var n=[],r=t.length,i=0;i<r;i++)-1===e.indexOf(i)&&n.push(t[i]);return[n,e.map(function(e){return t[e]})]},n.expandShapeToKeepDim=function(e,t){return o(e,t.map(function(e){return 1}),t)},n.parseAxisParam=function(e,t){var n=t.length;return e=null==e?t.map(function(e,t){return t}):[].concat(e),r.assert(e.every(function(e){return-n<=e&&e<n}),"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e),r.assert(e.every(function(e){return r.isInt(e)}),"All values in axis param must be integers but got axis "+e),e.map(function(e){return e<0?n+e:e})},n.assertAxesAreInnerMostDims=function(e,t,n){r.assert(i(t,n),e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input.")},n.getAxesPermutation=function(e,t){if(i(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach(function(e){return n.push(e)}),n},n.getUndoAxesPermutation=function(e){return e.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})},n.getInnerMostAxes=function(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}},{"../util":187}],130:[function(e,t,p){"use strict";Object.defineProperty(p,"__esModule",{value:!0});var a=e("../environment"),m=e("../tensor_util_env"),y=e("../util"),g=e("./array_ops"),v=e("./broadcast_util"),n=e("./operation"),b=e("./tensor_ops"),_=e("./unary_ops");function s(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}p.batchNormalization2d=n.op({batchNormalization2d_:function(e,t,n,r,i,o){void 0===r&&(r=.001);var a,s,u=m.convertToTensor(e,"x","batchNormalization"),l=m.convertToTensor(t,"mean","batchNormalization"),c=m.convertToTensor(n,"variance","batchNormalization");return null!=i&&(a=m.convertToTensor(i,"scale","batchNormalization")),null!=o&&(s=m.convertToTensor(o,"offset","batchNormalization")),y.assert(2===u.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+u.rank+"."),y.assert(2===l.rank||1===l.rank,"Error in batchNormalization2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."),y.assert(2===c.rank||1===c.rank,"Error in batchNormalization2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."),null!=a&&y.assert(2===a.rank||1===a.rank,"Error in batchNormalization2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."),null!=s&&y.assert(2===s.rank||1===s.rank,"Error in batchNormalization2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."),p.batchNormalization(u,l,c,r,a,s)}}),p.batchNormalization3d=n.op({batchNormalization3d_:function(e,t,n,r,i,o){void 0===r&&(r=.001);var a,s,u=m.convertToTensor(e,"x","batchNormalization"),l=m.convertToTensor(t,"mean","batchNormalization"),c=m.convertToTensor(n,"variance","batchNormalization");return null!=i&&(a=m.convertToTensor(i,"scale","batchNormalization")),null!=o&&(s=m.convertToTensor(o,"offset","batchNormalization")),y.assert(3===u.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+u.rank+"."),y.assert(3===l.rank||1===l.rank,"Error in batchNormalization3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."),y.assert(3===c.rank||1===c.rank,"Error in batchNormalization3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."),null!=a&&y.assert(3===a.rank||1===a.rank,"Error in batchNormalization3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."),null!=s&&y.assert(3===s.rank||1===s.rank,"Error in batchNormalization3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."),p.batchNormalization(u,l,c,r,a,s)}}),p.batchNormalization4d=n.op({batchNormalization4d_:function(e,t,n,r,i,o){void 0===r&&(r=.001);var a,s,u=m.convertToTensor(e,"x","batchNormalization"),l=m.convertToTensor(t,"mean","batchNormalization"),c=m.convertToTensor(n,"variance","batchNormalization");return null!=i&&(a=m.convertToTensor(i,"scale","batchNormalization")),null!=o&&(s=m.convertToTensor(o,"offset","batchNormalization")),y.assert(4===u.rank,"Error in batchNormalization4D: x must be rank 4 but got rank "+u.rank+"."),y.assert(4===l.rank||1===l.rank,"Error in batchNormalization4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."),y.assert(4===c.rank||1===c.rank,"Error in batchNormalization4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."),null!=a&&y.assert(4===a.rank||1===a.rank,"Error in batchNormalization4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."),null!=s&&y.assert(4===s.rank||1===s.rank,"Error in batchNormalization4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."),p.batchNormalization(u,l,c,r,a,s)}}),p.batchNormalization=n.op({batchNormalization_:function(e,t,n,l,r,i){void 0===l&&(l=.001);var c,o,p,h=m.convertToTensor(e,"x","batchNormalization"),f=m.convertToTensor(t,"mean","batchNormalization"),d=m.convertToTensor(n,"variance","batchNormalization");return null!=r&&(c=m.convertToTensor(r,"scale","batchNormalization")),null!=i&&(o=m.convertToTensor(i,"offset","batchNormalization")),y.assert(f.rank===d.rank,"Batch normalization gradient requires mean and variance to have equal ranks."),y.assert(null==o||f.rank===o.rank,"Batch normalization gradient requires mean and offset to have equal ranks."),y.assert(null==c||f.rank===c.rank,"Batch normalization gradient requires mean and scale to have equal ranks."),p=0===h.rank||1===h.rank?h.as4D(1,1,1,h.size):2===h.rank?h.as4D(1,1,h.shape[0],h.shape[1]):3===h.rank?h.as4D(1,h.shape[0],h.shape[1],h.shape[2]):h,a.ENV.engine.runKernel(function(e){return e.batchNormalization(p,s(f),s(d),l,s(c),s(o))},{$x:h,$mean:f,$variance:d,$scale:c,$offset:o},function(n){var e=null==c?b.scalar(1):c,r=v.getReductionAxes(f.shape,p.shape),t=[];if(1===f.rank){for(var i=0;i<p.shape.length-1;++i)t.push(p.shape[i]);t.push(1)}var o=h.sub(f),a=n.mul(e),s=_.rsqrt(d.add(b.scalar(l))),u=s.mul(s).mul(s).mul(b.scalar(-.5));return{$x:function(){return 1===f.rank?n.mul(g.tile(s.as4D(1,1,1,f.shape[0]),t)).mul(e).reshape(h.shape):n.mul(s).mul(e).reshape(h.shape)},$mean:function(){var e=s.mul(b.scalar(-1)).mul(a);return 1===f.rank&&(e=e.sum(r)),e.reshape(f.shape)},$variance:function(){var e=u.mul(o).mul(a);return 1===f.rank&&(e=e.sum(r)),e.reshape(f.shape)},$scale:function(){var e=o.mul(s),t=n.mul(e);return 1===f.rank&&(t=t.sum(r)),t.reshape(f.shape)},$offset:function(){var e=n;return 1===f.rank&&(e=e.sum(r)),e.reshape(f.shape)}}}).reshape(h.shape)}})},{"../environment":62,"../tensor_util_env":183,"../util":187,"./array_ops":127,"./broadcast_util":132,"./operation":148,"./tensor_ops":163,"./unary_ops":166}],131:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var u=e("../environment"),l=e("../tensor_util"),c=e("../tensor_util_env"),n=e("../types"),i=e("../util"),p=e("./broadcast_util"),r=e("./operation"),o=e("./tensor_ops"),h=e("./unary_ops");s.add=r.op({add_:function(e,t){var r=c.convertToTensor(e,"a","add"),i=c.convertToTensor(t,"b","add");l.assertTypesMatch(r,i);var o=p.assertAndGetBroadcastShape(r.shape,i.shape);return u.ENV.engine.runKernel(function(e){return e.add(r,i)},{$a:r,$b:i},function(n){return{$a:function(){var e=n,t=p.getReductionAxes(r.shape,o);return 0<t.length&&(e=e.sum(t)),e.reshape(r.shape)},$b:function(){var e=n,t=p.getReductionAxes(i.shape,o);return 0<t.length&&(e=e.sum(t)),e.reshape(i.shape)}}})}}),s.addN=r.op({addN_:function(e){i.assert(Array.isArray(e),function(){return"The param passed to tf.addN() must be a list of tensors"}),i.assert(1<=e.length,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var t=e.map(function(e,t){return c.convertToTensor(e,"tensors"+t,"addN")}),n=t[0];t.forEach(function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(e){if(!i.arraysEqual(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return u.ENV.engine.runKernel(function(e){return e.addN(t)},r,function(n){var r={};return t.forEach(function(e,t){r[t]=function(){return n.clone()}}),r})}}),s.addStrict=r.op({addStrict_:function(e,t){return i.assertShapesMatch(e.shape,t.shape,"Error in addStrict: "),e.add(t)}}),s.atan2=r.op({atan2_:function(e,t){var i=c.convertToTensor(e,"a","atan2"),o=c.convertToTensor(t,"b","atan2");l.assertTypesMatch(i,o);var a=p.assertAndGetBroadcastShape(i.shape,o.shape);return u.ENV.engine.runKernel(function(e){return e.atan2(i,o)},{$a:i,$b:o},function(r){return{$a:function(){var e=s.add(i.square(),o.square()),t=r.mul(o.div(e)),n=p.getReductionAxes(i.shape,a);return 0<n.length&&(t=t.sum(n)),t.reshape(i.shape)},$b:function(){var e=s.add(i.square(),o.square()),t=h.neg(r.mul(i.div(e))),n=p.getReductionAxes(o.shape,a);return 0<n.length&&(t=t.sum(n)),t.reshape(o.shape)}}})}}),s.div=r.op({div_:function(e,t){var n,i=c.convertToTensor(e,"a","div"),o=c.convertToTensor(t,"b","div");if(l.assertTypesMatch(i,o),"int32"===i.dtype&&"int32"===o.dtype)return s.floorDiv(i,o);n=function(e){return e.realDivide(i,o)};var a=p.assertAndGetBroadcastShape(i.shape,o.shape);return u.ENV.engine.runKernel(n,{$a:i,$b:o},function(r){return{$a:function(){var e=r.div(o.toFloat()),t=p.getReductionAxes(i.shape,a);return 0<t.length?e.sum(t).reshape(i.shape):e},$b:function(){var e=r.mul(i.toFloat()),t=p.getReductionAxes(o.shape,a);0<t.length&&(e=e.sum(t).reshape(o.shape));var n=o.square();return e.div(n.toFloat()).neg()}}})}}),s.divStrict=r.op({divStrict_:function(e,t){return i.assertShapesMatch(e.shape,t.shape,"Error in divideStrict: "),e.div(t)}}),s.floorDiv=r.op({floorDiv_:function(e,t){var i=c.convertToTensor(e,"a","floorDiv"),o=c.convertToTensor(t,"b","floorDiv");l.assertTypesMatch(i,o);var a=p.assertAndGetBroadcastShape(i.shape,o.shape);return u.ENV.engine.runKernel(function(e){return e.floorDiv(i,o)},{$a:i,$b:o},function(r){return{$a:function(){var e=r.div(o.toFloat()),t=p.getReductionAxes(i.shape,a);return 0<t.length?e.sum(t).reshape(i.shape):e},$b:function(){var e=r.mul(i.toFloat()),t=p.getReductionAxes(o.shape,a);0<t.length&&(e=e.sum(t).reshape(o.shape));var n=o.square();return e.div(n.toFloat()).neg()}}})}}),s.maximum=r.op({maximum_:function(e,t){var n=c.convertToTensor(e,"a","maximum"),r=c.convertToTensor(t,"b","maximum");return l.assertTypesMatch(n,r),"bool"===n.dtype&&(n=n.toInt()),"bool"===r.dtype&&(r=r.toInt()),p.assertAndGetBroadcastShape(n.shape,r.shape),u.ENV.engine.runKernel(function(e){return e.maximum(n,r)},{$a:n,$b:r},function(e){return{$a:function(){return e.mul(n.greaterEqual(r).toFloat())},$b:function(){return e.mul(n.less(r).toFloat())}}})}}),s.maximumStrict=r.op({maximumStrict_:function(e,t){return i.assertShapesMatch(e.shape,t.shape,"Error in minimumStrict: "),e.maximum(t)}}),s.minimum=r.op({minimum_:function(e,t){var n=c.convertToTensor(e,"a","minimum"),r=c.convertToTensor(t,"b","minimum");return l.assertTypesMatch(n,r),"bool"===n.dtype&&(n=n.toInt()),"bool"===r.dtype&&(r=r.toInt()),p.assertAndGetBroadcastShape(n.shape,r.shape),u.ENV.engine.runKernel(function(e){return e.minimum(n,r)},{$a:n,$b:r},function(e){return{$a:function(){return e.mul(n.lessEqual(r).toFloat())},$b:function(){return e.mul(n.greater(r).toFloat())}}})}}),s.minimumStrict=r.op({minimumStrict_:function(e,t){return i.assertShapesMatch(e.shape,t.shape,"Error in minimumStrict: "),e.minimum(t)}}),s.mod=r.op({mod_:function(e,t){var r=c.convertToTensor(e,"a","mod"),i=c.convertToTensor(t,"b","mod");l.assertTypesMatch(r,i);var o=p.assertAndGetBroadcastShape(r.shape,i.shape);return u.ENV.engine.runKernel(function(e){return e.mod(r,i)},{$a:r,$b:i},function(n){return{$a:function(){var e=p.getReductionAxes(r.shape,o);return 0<e.length?n.sum(e).reshape(r.shape):n},$b:function(){var e=n.mul(r.div(i).floor().neg()),t=p.getReductionAxes(i.shape,o);return 0<t.length?e.sum(t).reshape(i.shape):e}}})}}),s.modStrict=r.op({modStrict_:function(e,t){return i.assertShapesMatch(e.shape,t.shape,"Error in modStrict: "),e.mod(t)}}),s.mul=r.op({mul_:function(e,t){var r=c.convertToTensor(e,"a","mul"),i=c.convertToTensor(t,"b","mul");l.assertTypesMatch(r,i);var o=p.assertAndGetBroadcastShape(r.shape,i.shape);return u.ENV.engine.runKernel(function(e){return e.multiply(r,i)},{$a:r,$b:i},function(n){return{$a:function(){var e=n.mul(i.toFloat()),t=p.getReductionAxes(r.shape,o);return 0<t.length?e.sum(t).reshape(r.shape):e},$b:function(){var e=n.mul(r.toFloat()),t=p.getReductionAxes(i.shape,o);return 0<t.length?e.sum(t).reshape(i.shape):e}}})}}),s.mulStrict=r.op({mulStrict_:function(e,t){return i.assertShapesMatch(e.shape,t.shape,"Error in multiplyStrict: "),e.mul(t)}}),s.pow=r.op({pow_:function(e,t){var i=c.convertToTensor(e,"base","pow"),o=c.convertToTensor(t,"exp","pow"),a=p.assertAndGetBroadcastShape(i.shape,o.shape);return e=i.cast(n.upcastType(i.dtype,o.dtype)),t=o.cast(n.upcastType(i.dtype,o.dtype)),u.ENV.engine.runKernel(function(e,t){return t(e.pow(i,o))},{$base:i,$exp:o},function(n,e){var r=e[0];return{$base:function(){var e=n.mul(o.toFloat().mul(r.div(i))),t=p.getReductionAxes(i.shape,a);return 0<t.length&&(e=e.sum(t)),e.reshape(i.shape)},$exp:function(){var e=n.mul(r.mul(i.log()).toFloat()),t=p.getReductionAxes(o.shape,a);return 0<t.length&&(e=e.sum(t)),e.reshape(o.shape)}}})}}),s.powStrict=r.op({powStrict_:function(e,t){return i.assertShapesMatch(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),s.squaredDifference=r.op({squaredDifference_:function(e,t){var n=c.convertToTensor(e,"a","squaredDifference"),r=c.convertToTensor(t,"b","squaredDifference");return l.assertTypesMatch(n,r),p.assertAndGetBroadcastShape(n.shape,r.shape),u.ENV.engine.runKernel(function(e){return e.squaredDifference(n,r)},{$a:n,$b:r},function(e){var t=o.scalar(2);return{$a:function(){return e.mul(n.sub(r).mul(t))},$b:function(){return e.mul(r.sub(n).mul(t))}}})}}),s.squaredDifferenceStrict=r.op({squaredDifferenceStrict_:function(e,t){return i.assertShapesMatch(e.shape,t.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(t)}}),s.sub=r.op({sub_:function(e,t){var r=c.convertToTensor(e,"a","sub"),i=c.convertToTensor(t,"b","sub");l.assertTypesMatch(r,i);var o=p.assertAndGetBroadcastShape(r.shape,i.shape);return u.ENV.engine.runKernel(function(e){return e.subtract(r,i)},{$a:r,$b:i},function(n){return{$a:function(){var e=n,t=p.getReductionAxes(r.shape,o);return 0<t.length&&(e=e.sum(t)),e.reshape(r.shape)},$b:function(){var e=n,t=p.getReductionAxes(i.shape,o);return 0<t.length&&(e=e.sum(t)),e.neg().reshape(i.shape)}}})}}),s.subStrict=r.op({subStrict_:function(e,t){return i.assertShapesMatch(e.shape,t.shape,"Error in subStrict: "),e.sub(t)}})},{"../environment":62,"../tensor_util":182,"../tensor_util_env":183,"../types":186,"../util":187,"./broadcast_util":132,"./operation":148,"./tensor_ops":163,"./unary_ops":166}],132:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getBroadcastDims=function(e,t){for(var n=e.length,r=[],i=0;i<n;i++){var o=n-1-i,a=e[o]||1;1<(t[t.length-1-i]||1)&&1===a&&r.unshift(o)}return r},n.getReductionAxes=function(e,t){for(var n=[],r=0;r<t.length;r++){var i=e[e.length-r-1],o=t.length-r-1,a=t[o];(null==i||1===i&&1<a)&&n.unshift(o)}return n},n.broadcastDimsAreOuter=function(e){for(var t=0;t<e.length;t++)if(e[t]!==t)return!1;return!0},n.assertAndGetBroadcastShape=function(e,t){for(var n=[],r=Math.max(e.length,t.length),i=0;i<r;i++){var o=e[e.length-i-1];null==o&&(o=1);var a=t[t.length-i-1];if(null==a&&(a=1),1===o)n.unshift(a);else if(1===a)n.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(o)}}return n}},{}],133:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../environment"),o=e("../tensor_util"),a=e("../tensor_util_env"),s=e("../util"),u=e("./broadcast_util"),r=e("./operation");n.equal=r.op({equal_:function(e,t){var n=a.convertToTensor(e,"a","equal"),r=a.convertToTensor(t,"b","equal");return o.assertTypesMatch(n,r),u.assertAndGetBroadcastShape(n.shape,r.shape),i.ENV.engine.runKernel(function(e){return e.equal(n,r)},{$a:n,$b:r})}}),n.equalStrict=r.op({equalStrict_:function(e,t){var n=a.convertToTensor(e,"a","equalStrict"),r=a.convertToTensor(t,"b","equalStrict");return s.assertShapesMatch(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),n.greater=r.op({greater_:function(e,t){var n=a.convertToTensor(e,"a","greater"),r=a.convertToTensor(t,"b","greater");return o.assertTypesMatch(n,r),u.assertAndGetBroadcastShape(n.shape,r.shape),i.ENV.engine.runKernel(function(e){return e.greater(n,r)},{$a:n,$b:r})}}),n.greaterEqual=r.op({greaterEqual_:function(e,t){var n=a.convertToTensor(e,"a","greaterEqual"),r=a.convertToTensor(t,"b","greaterEqual");return o.assertTypesMatch(n,r),u.assertAndGetBroadcastShape(n.shape,r.shape),i.ENV.engine.runKernel(function(e){return e.greaterEqual(n,r)},{$a:n,$b:r})}}),n.greaterEqualStrict=r.op({greaterEqualStrict_:function(e,t){var n=a.convertToTensor(e,"a","greaterEqualStrict"),r=a.convertToTensor(t,"b","greaterEqualStrict");return s.assertShapesMatch(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),n.greaterStrict=r.op({greaterStrict_:function(e,t){var n=a.convertToTensor(e,"a","greaterStrict"),r=a.convertToTensor(t,"b","greaterStrict");return s.assertShapesMatch(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),n.less=r.op({less_:function(e,t){var n=a.convertToTensor(e,"a","less"),r=a.convertToTensor(t,"b","less");return o.assertTypesMatch(n,r),u.assertAndGetBroadcastShape(n.shape,r.shape),i.ENV.engine.runKernel(function(e){return e.less(n,r)},{$a:n,$b:r})}}),n.lessEqual=r.op({lessEqual_:function(e,t){var n=a.convertToTensor(e,"a","lessEqual"),r=a.convertToTensor(t,"b","lessEqual");return o.assertTypesMatch(n,r),u.assertAndGetBroadcastShape(n.shape,r.shape),i.ENV.engine.runKernel(function(e){return e.lessEqual(n,r)},{$a:n,$b:r})}}),n.lessEqualStrict=r.op({lessEqualStrict_:function(e,t){var n=a.convertToTensor(e,"a","lessEqualStrict"),r=a.convertToTensor(t,"b","lessEqualStrict");return s.assertShapesMatch(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),n.lessStrict=r.op({lessStrict_:function(e,t){var n=a.convertToTensor(e,"a","lessStrict"),r=a.convertToTensor(t,"b","lessStrict");return s.assertShapesMatch(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),n.notEqual=r.op({notEqual_:function(e,t){var n=a.convertToTensor(e,"a","notEqual"),r=a.convertToTensor(t,"b","notEqual");return o.assertTypesMatch(n,r),u.assertAndGetBroadcastShape(n.shape,r.shape),i.ENV.engine.runKernel(function(e){return e.notEqual(n,r)},{$a:n,$b:r})}}),n.notEqualStrict=r.op({notEqualStrict_:function(e,t){var n=a.convertToTensor(e,"a","notEqualStrict"),r=a.convertToTensor(t,"b","notEqualStrict");return s.assertShapesMatch(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}})},{"../environment":62,"../tensor_util":182,"../tensor_util_env":183,"../util":187,"./broadcast_util":132,"./operation":148}],134:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var p=e("../environment"),s=e("../tensor_util_env"),h=e("../util"),u=e("./axis_util"),f=e("./concat_util"),r=e("./operation"),l=e("./tensor_ops");function c(e,t,n){f.assertParams(e.shape,t.shape,n);var r=f.computeOutShape([e.shape,t.shape],n),i=e.as2D(-1,h.sizeFromShape(e.shape.slice(n))),o=t.as2D(-1,h.sizeFromShape(t.shape.slice(n))),a=f.computeGradientSliceShapes(i.shape,o.shape),s=a.aBegin,u=a.aSize,l=a.bBegin,c=a.bSize;return p.ENV.engine.runKernel(function(e){return e.concat(i,o)},{a:i,b:o},function(e){return{a:function(){return e.slice(s,u)},b:function(){return e.slice(l,c)}}}).reshape(r)}n.concat=r.op({concat_:function(e,t){void 0===t&&(t=0),h.assert(1<=e.length,"Pass at least one tensor to concat");var n=s.convertToTensorArray(e,"tensors","concat"),r=f.computeOutShape(n.map(function(e){return e.shape}),t);if(0===h.sizeFromShape(r))return l.tensor([],r);var i=(n=n.filter(function(e){return 0<e.size}))[0];if(1===n.length)return i;for(var o=u.parseAxisParam(t,i.shape),a=1;a<n.length;++a)i=c(i,n[a],o[0]);return i}}),n.concat1d=r.op({concat1d_:function(e){return n.concat(e,0)}}),n.concat2d=r.op({concat2d_:function(e,t){return n.concat(e,t)}}),n.concat3d=r.op({concat3d_:function(e,t){return n.concat(e,t)}}),n.concat4d=r.op({concat4d_:function(e,t){return n.concat(e,t)}})},{"../environment":62,"../tensor_util_env":183,"../util":187,"./axis_util":129,"./concat_util":135,"./operation":148,"./tensor_ops":163}],135:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../util");n.assertParams=function(e,t,n){var r=e.length,i=t.length;a.assert(e.length===t.length,"Error in concat"+r+"D: rank of x1 ("+r+") and x2 ("+i+") must be the same."),a.assert(0<=n&&n<r,"Error in concat"+r+"D: axis must be between 0 and "+(r-1)+".");for(var o=0;o<r;o++)a.assert(o===n||e[o]===t[o],"Error in concat"+r+"D: Shape ("+e+") does not match ("+t+") along the non-concatenated axis "+o+".")},n.computeOutShape=function(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n},n.computeGradientSliceShapes=function(e,t){return{aBegin:[0,0],aSize:e,bBegin:[0,e[1]],bSize:t}}},{"../util":187}],136:[function(e,t,y){"use strict";Object.defineProperty(y,"__esModule",{value:!0});var f=e("../environment"),g=e("../tensor_util_env"),v=e("../util"),d=e("./conv_util"),n=e("./operation");function m(e,t,n,r,i,o){v.assert(e.length===t.rank,"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match");var a=e,s=t,u=!1;3===t.rank&&(u=!0,s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),a=[1,e[0],e[1],e[2]]);var l=a[3],c=s.shape[3];v.assert(4===a.length,"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."),v.assert(4===s.rank,"Error in conv2dDerInput: dy must be rank 4, but got rank "+s.rank),v.assert(4===n.rank,"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank),v.assert(l===n.shape[2],"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."),v.assert(c===n.shape[3],"Error in conv2dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[3]+"."),null!=o&&v.assert(v.isInt(i),"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+".");var p=d.computeConv2DInfo(a,n.shape,r,1,i,o),h=f.ENV.engine.runKernel(function(e){return e.conv2dDerInput(s,n,p)},{dy4D:s});return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function b(e){var t,n="number"==typeof(t=e)?[t,t]:t,r=n[0],i=n[1];return 1===r&&1===i}function _(e,t){return b(e)||b(t)}y.conv1d=n.op({conv1d_:function(e,t,n,r,i,o,a){void 0===i&&(i="NWC"),void 0===o&&(o=1);var s=g.convertToTensor(e,"x","conv1d"),u=g.convertToTensor(t,"filter","conv1d"),l=s,c=!1;2===s.rank&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),v.assert(3===l.rank,"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."),v.assert(3===u.rank,"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."),null!=a&&v.assert(v.isInt(r),"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."),v.assert(l.shape[2]===u.shape[1],"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."),v.assert(_(n,o),"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+o+"'"),v.assert("NWC"===i,"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported.");var p=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),h=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),f=[1,n],d=[1,o],m=y.conv2d(h,p,f,r,"NHWC",d,a);return c?m.as2D(m.shape[2],m.shape[3]):m.as3D(m.shape[0],m.shape[2],m.shape[3])}}),y.conv2d=n.op({conv2d_:function(e,t,n,r,i,o,a){void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]);var s=g.convertToTensor(e,"x","conv2d"),u=g.convertToTensor(t,"filter","conv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),v.assert(4===l.rank,"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."),v.assert(4===u.rank,"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."),null!=a&&v.assert(v.isInt(r),"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."),v.assert(l.shape[3]===u.shape[2],"Error in conv2d: depth of input ("+l.shape[3]+") must match input depth for filter "+u.shape[2]+"."),v.assert(_(n,o),"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"),v.assert("NHWC"===i,"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported.");var p=d.computeConv2DInfo(l.shape,u.shape,n,o,r,a),h=f.ENV.engine.runKernel(function(e){return e.conv2d(l,u,p)},{x:l,$filter:u},function(e){return v.assert(b(o),"Error in gradient of conv2D: dilation rates greater than 1 are notyet supported in gradients. Got dilations '"+o+"'"),{x:function(){return m(l.shape,e,u,n,r)},$filter:function(){return function(e,t,n,r,i,o){var a=e;3===e.rank&&(a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=t;3===s.rank&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),v.assert(4===a.rank,"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."),v.assert(4===s.rank,"Error in conv2dDerFilter: dy must be rank 4, but got shape "+s.shape+"."),v.assert(4===n.length,"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."),v.assert(a.shape[3]===n[2],"Error in conv2dDerFilter: depth of input "+a.shape[3]+") must match input depth in filter ("+n[2]+"."),v.assert(s.shape[3]===n[3],"Error in conv2dDerFilter: depth of dy ("+s.shape[3]+") must match output depth for filter ("+n[3]+")."),null!=o&&v.assert(v.isInt(i),"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+".");var u=d.computeConv2DInfo(a.shape,n,r,1,i,o);return f.ENV.engine.runKernel(function(e){return e.conv2dDerFilter(a,s,u)},{x4D:a,dy4D:s})}(l,e,u.shape,n,r)}}});return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),y.depthwiseConv2d=n.op({depthwiseConv2d_:function(e,t,n,r,i,o,a){void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]);var s=g.convertToTensor(e,"x","depthwiseConv2d"),u=g.convertToTensor(t,"filter","depthwiseConv2d"),l=s,c=!1;3===s.rank&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),v.assert(4===l.rank,"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."),v.assert(4===u.rank,"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."),v.assert(l.shape[3]===u.shape[2],"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."),null==o&&(o=[1,1]),v.assert(_(n,o),"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"),null!=a&&v.assert(v.isInt(r),"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+".");var p=d.computeConv2DInfo(l.shape,u.shape,n,o,r,a,!0),h=f.ENV.engine.runKernel(function(e){return e.depthwiseConv2D(l,u,p)},{x:l,$filter:u},function(e){return v.assert(b(o),"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"),{x:function(){return function(e,t,n,r){var i=t,o=!1;3===t.rank&&(o=!0,i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var a=f.ENV.engine.runKernel(function(e){return e.depthwiseConv2DDerInput(i,n,r)},{dy4D:i});return o?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}(l.shape,e,u,p)},$filter:function(){return function(e,t,n,r){var i=e;3===e.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var o=t;return 3===o.rank&&(o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),f.ENV.engine.runKernel(function(e){return e.depthwiseConv2DDerFilter(i,o,r)},{x4D:i,dy4D:o})}(l,e,u.shape,p)}}});return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),y.separableConv2d=n.op({separableConv2d_:function(e,t,n,r,i,o,a){void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC");var s=g.convertToTensor(e,"x","separableConv2d"),u=g.convertToTensor(t,"depthwiseFilter","separableConv2d"),l=g.convertToTensor(n,"pointwiseFilter","separableConv2d"),c=s,p=!1;if(3===s.rank&&(p=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");v.assert(4===c.rank,"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."),v.assert(4===u.rank,"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."),v.assert(4===l.rank,"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."),v.assert(1===l.shape[0],"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."),v.assert(1===l.shape[1],"Error in separableConv2d: the second dimension of pointwise filter  must be 1, but got "+l.shape[1]+".");var h=u.shape[2],f=u.shape[3];v.assert(l.shape[2]===h*f,"Error in separableConv2d: the third dimension of pointwise filter must be "+h*f+", but got "+l.shape[2]+".");var d=y.depthwiseConv2d(c,u,r,i,a,o),m=y.conv2d(d,l,1,"valid",a);return p?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),y.conv2dTranspose=n.op({conv2dTranspose_:function(e,t,n,r,i,o){return m(n,g.convertToTensor(e,"x","conv2dTranspose"),g.convertToTensor(t,"filter","conv2dTranspose"),r,i,o)}})},{"../environment":62,"../tensor_util_env":183,"../util":187,"./conv_util":137,"./operation":148}],137:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var O=e("../util");function c(e,t,n,r,i,o,a,s){void 0===a&&(a=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],p=u[2],h=u[3];if("channelsLast"===s)l=e[0],c=e[1],p=e[2],h=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);l=e[0],h=e[1],c=e[2],p=e[3]}var f,d=t[0],m=t[1],y=t[3],g=E(n),v=g[0],b=g[1],_=E(r),w=_[0],S=_[1],x=function(e,t,n,r,i,o,a,s){var u,l,c;if("number"==typeof e){var p=0===e?"VALID":"NUMBER";u={top:e,bottom:e,left:e,right:e,type:p};var h=function(e,t,n,r,i,o){null==i&&(i=k(e,t,r));var a=e[0],s=e[1],u=M((a-t+2*i)/r+1,o);O.assert(O.isInt(u),"The output # of rows ("+u+") must be an integer. Change the stride and/or zero pad parameters");var l=M((s-t+2*i)/r+1,o);return O.assert(O.isInt(l),"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"),[u,l,n]}([t,n,1],o,1,r,e,s);l=h[0],c=h[1]}else if("same"===e){l=Math.ceil(t/r),c=Math.ceil(n/i);var f=(l-1)*r+o-t,d=(c-1)*i+a-n,m=Math.floor(f/2),y=f-m,g=Math.floor(d/2),v=d-g;u={top:m,bottom:y,left:g,right:v,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);u={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-o+1)/r),c=Math.ceil((n-a+1)/i)}return{padInfo:u,outHeight:l,outWidth:c}}(i,c,p,v,b,I(d,w),I(m,S),o),T=x.padInfo,P=x.outHeight,N=x.outWidth,A=a?y*h:y;return"channelsFirst"===s?f=[l,A,P,N]:"channelsLast"===s&&(f=[l,P,N,A]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:p,inChannels:h,outHeight:P,outWidth:N,outChannels:A,padInfo:T,strideHeight:v,strideWidth:b,filterHeight:d,filterWidth:m,dilationHeight:w,dilationWidth:S,inShape:e,outShape:f,filterShape:t}}function k(e,t,n,r){void 0===r&&(r=1);var i=I(t,r);return Math.floor((e[0]*(n-1)-n+i)/2)}function E(e){return"number"==typeof e?[e,e]:e}function I(e,t){return t<=1?e:e+(e-1)*(t-1)}function M(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}n.computePool2DInfo=function(e,t,n,r,i,o){void 0===o&&(o="channelsLast");var a,s=E(t),u=s[0],l=s[1];if("channelsLast"===o)a=[u,l,e[3],e[3]];else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);a=[u,l,e[1],e[1]]}return c(e,a,n,1,r,i,!1,o)},n.computeConv2DInfo=c,n.computeDefaultPad=k},{"../util":187}],138:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ERF_P=.3275911,n.ERF_A1=.254829592,n.ERF_A2=-.284496736,n.ERF_A3=1.421413741,n.ERF_A4=-1.453152027,n.ERF_A5=1.061405429},{}],139:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},h=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var l=e("../environment"),f=e("../kernels/non_max_suppression_impl"),d=e("../tensor_util_env"),c=e("../util"),i=e("./operation");function m(e,t,n,r,i){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY);var o=e.shape[0];return n=Math.min(n,o),c.assert(0<=r&&r<=1,"iouThreshold must be in [0, 1], but was '"+r+"'"),c.assert(2===e.rank,"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"),c.assert(4===e.shape[1],"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]),c.assert(1===t.rank,"scores must be a 1D tensor"),c.assert(t.shape[0]===o,"scores has incompatible shape with boxes. Expected "+o+", but was "+t.shape[0]),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i}}n.resizeBilinear=i.op({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=d.convertToTensor(e,"images","resizeBilinear");c.assert(3===r.rank||4===r.rank,"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."),c.assert(2===t.length,"Error in resizeBilinear: new shape must 2D, but got shape "+t+".");var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=t[0],s=t[1],u=l.ENV.engine.runKernel(function(e,t){return e.resizeBilinear(i,a,s,n)},{batchImages:i},function(t,e){return{batchImages:function(){return l.ENV.engine.runKernel(function(e){return e.resizeBilinearBackprop(t,i,n)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),n.resizeNearestNeighbor=i.op({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=d.convertToTensor(e,"images","resizeNearestNeighbor");c.assert(3===r.rank||4===r.rank,"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."),c.assert(2===t.length,"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."),c.assert("float32"===r.dtype||"int32"===r.dtype,"`images` must have `int32` or `float32` as dtype");var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=t[0],s=t[1],u=l.ENV.engine.runKernel(function(e,t){return e.resizeNearestNeighbor(i,a,s,n)},{batchImages:i},function(t,e){return{batchImages:function(){return l.ENV.engine.runKernel(function(e){return e.resizeNearestNeighborBackprop(t,i,n)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),n.nonMaxSuppression=i.op({nonMaxSuppression_:function(e,t,n,r,i){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY);var o=d.convertToTensor(e,"boxes","nonMaxSuppression"),a=d.convertToTensor(t,"scores","nonMaxSuppression"),s=m(o,a,n,r,i);return n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,l.ENV.engine.runKernel(function(e){return e.nonMaxSuppression(o,a,n,r,i)},{$boxes:o})}}),n.nonMaxSuppressionAsync=function(s,u,l,c,p){return void 0===c&&(c=.5),void 0===p&&(p=Number.NEGATIVE_INFINITY),r(this,void 0,void 0,function(){var t,n,r,i,o,a;return h(this,function(e){switch(e.label){case 0:return t=d.convertToTensor(s,"boxes","nonMaxSuppressionAsync"),n=d.convertToTensor(u,"scores","nonMaxSuppressionAsync"),r=m(t,n,l,c,p),l=r.maxOutputSize,c=r.iouThreshold,p=r.scoreThreshold,[4,t.data()];case 1:return i=e.sent(),[4,n.data()];case 2:return o=e.sent(),a=f.nonMaxSuppressionImpl(i,o,l,c,p),t!==s&&t.dispose(),n!==u&&n.dispose(),[2,a]}})})}},{"../environment":62,"../kernels/non_max_suppression_impl":81,"../tensor_util_env":183,"../util":187,"./operation":148}],140:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var s=e("../environment"),o=e("../globals"),u=e("../util"),l=e("./array_ops"),c=e("./norm"),r=e("./operation"),p=e("./reduction_ops"),a=e("./tensor_ops");function h(r,i){return void 0===i&&(i=!1),s.ENV.engine.tidy(function(){if(2!==r.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor.");for(var p=r.shape[0],h=r.shape[1],f=l.eye(p),d=r.clone(),m=a.tensor2d([[1]],[1,1]),y=m.clone(),e=h<=p?h:p,t=function(c){var e,t=d,n=y,r=f;y=(e=s.ENV.engine.tidy(function(){var e=d.slice([c,c],[p-c,1]),t=e.norm(),n=d.slice([c,c],[1,1]),r=n.sign().neg(),i=n.sub(r.mul(t)),o=e.div(i);y=1===o.shape[0]?m.clone():m.concat(o.slice([1,0],[o.shape[0]-1,o.shape[1]]),0);var a=r.matMul(i).div(t).neg(),s=d.slice([c,0],[p-c,h]),u=a.mul(y);d=0===c?s.sub(u.matMul(y.transpose().matMul(s))):d.slice([0,0],[c,h]).concat(s.sub(u.matMul(y.transpose().matMul(s))),0);var l=f.slice([0,c],[p,f.shape[1]-c]);return f=0===c?l.sub(l.matMul(y).matMul(u.transpose())):f.slice([0,0],[p,c]).concat(l.sub(l.matMul(y).matMul(u.transpose())),1),[y,d,f]}))[0],d=e[1],f=e[2],o.dispose([t,n,r])},n=0;n<e;++n)t(n);return!i&&h<p&&(f=f.slice([0,0],[p,h]),d=d.slice([0,0],[h,h])),[f,d]})}n.gramSchmidt=r.op({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,u.assert(null!=e&&0<e.length,"Gram-Schmidt process: input must not be null, undefined, or empty");for(var n=e[0].shape[0],r=1;r<e.length;++r)u.assert(e[r].shape[0]===n,"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[r].shape[0]+" vs. "+n+")")}else t=!0,e=l.split(e,e.shape[0],0).map(function(e){return l.squeeze(e,[0])});u.assert(e.length<=e[0].shape[0],"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+").");var i=[],o=e,a=function(r){i.push(s.ENV.engine.tidy(function(){var e=o[r];if(0<r)for(var t=0;t<r;++t){var n=p.sum(i[t].mulStrict(e)).mul(i[t]);e=e.sub(n)}return e.div(c.norm(e,"euclidean"))}))};for(r=0;r<e.length;++r)a(r);return t?l.stack(i,0):i}}),n.qr=r.op({qr_:function(e,i){if(void 0===i&&(i=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return h(e,i);var t=e.shape.slice(0,e.shape.length-2).reduce(function(e,t){return e*t}),n=l.unstack(e.reshape([t,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),o=[],a=[];return n.forEach(function(e){var t=h(e,i),n=t[0],r=t[1];o.push(n),a.push(r)}),[l.stack(o,0).reshape(e.shape),l.stack(a,0).reshape(e.shape)]}})},{"../environment":62,"../globals":64,"../util":187,"./array_ops":127,"./norm":147,"./operation":148,"./reduction_ops":153,"./tensor_ops":163}],141:[function(e,t,i){"use strict";var n=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},o=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(i,"__esModule",{value:!0});var a=e("../environment"),s=e("../kernels/where_impl"),u=e("../tensor_util_env"),l=e("../util"),c=e("./broadcast_util"),r=e("./operation"),p=e("./tensor_ops");i.logicalAnd=r.op({logicalAnd_:function(e,t){var n=u.convertToTensor(e,"a","logicalAnd","bool"),r=u.convertToTensor(t,"b","logicalAnd","bool");return l.assert("bool"===n.dtype&&"bool"===r.dtype,"Error Array must be of type bool."),c.assertAndGetBroadcastShape(n.shape,r.shape),a.ENV.engine.runKernel(function(e){return e.logicalAnd(n,r)},{$a:n,$b:r})}}),i.logicalNot=r.op({logicalNot_:function(e){var t=u.convertToTensor(e,"x","logicalNot","bool");return l.assert("bool"===t.dtype,"Error Array must be of type bool."),a.ENV.engine.runKernel(function(e){return e.logicalNot(t)},{$x:t})}}),i.logicalOr=r.op({logicalOr_:function(e,t){var n=u.convertToTensor(e,"a","logicalOr","bool"),r=u.convertToTensor(t,"b","logicalOr","bool");return l.assert("bool"===n.dtype&&"bool"===r.dtype,"Error Array must be of type bool."),c.assertAndGetBroadcastShape(n.shape,r.shape),a.ENV.engine.runKernel(function(e){return e.logicalOr(n,r)},{$a:n,$b:r})}}),i.logicalXor=r.op({logicalXor_:function(e,t){var n=u.convertToTensor(e,"a","logicalXor","bool"),r=u.convertToTensor(t,"b","logicalXor","bool");return l.assert("bool"===n.dtype&&"bool"===r.dtype,"Error Array must be of type bool."),c.assertAndGetBroadcastShape(n.shape,r.shape),i.logicalOr(e,t).logicalAnd(i.logicalAnd(e,t).logicalNot())}}),i.where=r.op({where_:function(e,t,n){var r=u.convertToTensor(t,"a","where"),i=u.convertToTensor(n,"b","where"),o=u.convertToTensor(e,"condition","where","bool");return l.assert("bool"===o.dtype,"Error Condition must be of type bool."),l.assertShapesMatch(r.shape,i.shape,"Error in where: "),1===o.rank?l.assert(o.shape[0]===r.shape[0],"The first dimension of `a` must match the size of `condition`."):l.assertShapesMatch(o.shape,i.shape,"Error in where: "),a.ENV.engine.runKernel(function(e){return e.select(o,r,i)},{$condition:o,$a:r,$b:i},function(e){return{$condition:function(){return p.zerosLike(o)},$a:function(){return e.mul(o.cast(r.dtype))},$b:function(){return e.mul(o.logicalNot().cast(i.dtype))}}})}}),i.whereAsync=function(i){return n(this,void 0,void 0,function(){var t,n,r;return o(this,function(e){switch(e.label){case 0:return t=u.convertToTensor(i,"condition","where","bool"),l.assert("bool"===t.dtype,"Condition must be of type bool."),[4,t.data()];case 1:return n=e.sent(),r=s.whereImpl(t.shape,n),i!==t&&t.dispose(),[2,r]}})})}},{"../environment":62,"../kernels/where_impl":125,"../tensor_util_env":183,"../util":187,"./broadcast_util":132,"./operation":148,"./tensor_ops":163}],142:[function(e,t,f){"use strict";Object.defineProperty(f,"__esModule",{value:!0});var d,n,h=e("../globals"),m=e("../tensor_util_env"),y=e("../util"),g=e("./axis_util"),v=e("./binary_ops"),r=e("./operation"),b=e("./tensor_ops");(n=d=f.Reduction||(f.Reduction={}))[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS",f.absoluteDifference=r.op({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=d.SUM_BY_NONZERO_WEIGHTS);var i=m.convertToTensor(e,"labels","absoluteDifference"),o=m.convertToTensor(t,"predictions","absoluteDifference"),a=null;null!=n&&(a=m.convertToTensor(n,"weights","absoluteDifference")),y.assertShapesMatch(i.shape,o.shape,"Error in absoluteDifference: ");var s=i.sub(o).abs();return f.computeWeightedLoss(s,a,r)}}),f.computeWeightedLoss=r.op({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=d.SUM_BY_NONZERO_WEIGHTS);var r=m.convertToTensor(e,"losses","computeWeightedLoss"),i=null;null!=t&&(i=m.convertToTensor(t,"weights","computeWeightedLoss"));var o=null==i?r:r.mul(i);if(n===d.NONE)return o;if(n===d.SUM)return o.sum();if(n===d.MEAN){if(null==i)return o.mean();var a=y.sizeFromShape(r.shape)/y.sizeFromShape(i.shape),s=o.sum().div(i.sum());return 1<a?s.div(b.scalar(a)):s}if(n===d.SUM_BY_NONZERO_WEIGHTS){if(null==i)return o.sum().div(b.scalar(r.size));var u=i.mul(b.ones(r.shape)).notEqual(b.scalar(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+n)}}),f.cosineDistance=r.op({cosineDistance_:function(e,t,n,r,i){void 0===i&&(i=d.SUM_BY_NONZERO_WEIGHTS);var o=m.convertToTensor(e,"labels","cosineDistance"),a=m.convertToTensor(t,"predictions","cosineDistance"),s=null;null!=r&&(s=m.convertToTensor(r,"weights","cosineDistance")),y.assertShapesMatch(o.shape,a.shape,"Error in cosineDistance: ");var u=b.scalar(1).sub(o.mul(a).sum(n,!0));return f.computeWeightedLoss(u,s,i)}}),f.hingeLoss=r.op({hingeLoss_:function(e,t,n,r){void 0===r&&(r=d.SUM_BY_NONZERO_WEIGHTS);var i=m.convertToTensor(e,"labels","hingeLoss"),o=m.convertToTensor(t,"predictions","hingeLoss"),a=null;null!=n&&(a=m.convertToTensor(n,"weights","hingeLoss")),y.assertShapesMatch(i.shape,o.shape,"Error in hingeLoss: ");var s=b.scalar(1);i=b.scalar(2).mul(i).sub(s);var u=s.sub(i.mul(o)).relu();return f.computeWeightedLoss(u,a,r)}}),f.huberLoss=r.op({huberLoss_:function(e,t,n,r,i){void 0===r&&(r=1),void 0===i&&(i=d.SUM_BY_NONZERO_WEIGHTS);var o=m.convertToTensor(e,"labels","huberLoss"),a=m.convertToTensor(t,"predictions","huberLoss"),s=null;null!=n&&(s=m.convertToTensor(n,"weights","huberLoss")),y.assertShapesMatch(o.shape,a.shape,"Error in huberLoss: ");var u=b.scalar(r),l=a.sub(o).abs(),c=v.minimum(l,u),p=l.sub(c),h=b.scalar(.5).mul(c.square()).add(u.mul(p));return f.computeWeightedLoss(h,s,i)}}),f.logLoss=r.op({logLoss_:function(e,t,n,r,i){void 0===r&&(r=1e-7),void 0===i&&(i=d.SUM_BY_NONZERO_WEIGHTS);var o=m.convertToTensor(e,"labels","logLoss"),a=m.convertToTensor(t,"predictions","logLoss"),s=null;null!=n&&(s=m.convertToTensor(n,"weights","logLoss")),y.assertShapesMatch(o.shape,a.shape,"Error in logLoss: ");var u=b.scalar(1),l=b.scalar(r),c=o.mul(a.add(l).log()).neg().sub(u.sub(o).mul(u.sub(a).add(l).log()));return f.computeWeightedLoss(c,s,i)}}),f.meanSquaredError=r.op({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=d.SUM_BY_NONZERO_WEIGHTS);var i=m.convertToTensor(e,"labels","meanSquaredError"),o=m.convertToTensor(t,"predictions","meanSquaredError"),a=null;null!=n&&(a=m.convertToTensor(n,"weights","meanSquaredError")),y.assertShapesMatch(i.shape,o.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(o);return f.computeWeightedLoss(s,a,r)}}),f.sigmoidCrossEntropy=r.op({sigmoidCrossEntropy_:function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=d.SUM_BY_NONZERO_WEIGHTS);var o=m.convertToTensor(e,"multiClassLabels","sigmoidCrossEntropy"),a=m.convertToTensor(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=m.convertToTensor(n,"weights","sigmoidCrossEntropy")),y.assertShapesMatch(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),0<r){var u=b.scalar(r),l=b.scalar(1),c=b.scalar(.5);o=o.mul(l.sub(u)).add(c.mul(u))}var p=function(e,t){var n=m.convertToTensor(e,"labels","sigmoidCrossEntropyWithLogits"),r=m.convertToTensor(t,"logits","sigmoidCrossEntropyWithLogits");y.assertShapesMatch(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var i=r.relu(),o=r.mul(n),a=r.abs().neg().exp().log1p();return i.sub(o).add(a)}(o,a);return f.computeWeightedLoss(p,s,i)}}),f.softmaxCrossEntropy=r.op({softmaxCrossEntropy_:function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=d.SUM_BY_NONZERO_WEIGHTS);var o=m.convertToTensor(e,"onehotLabels","softmaxCrossEntropy"),a=m.convertToTensor(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=m.convertToTensor(n,"weights","softmaxCrossEntropy")),y.assertShapesMatch(o.shape,a.shape,"Error in softmaxCrossEntropy: "),0<r){var u=b.scalar(r),l=b.scalar(1),c=b.scalar(o.shape[1]);o=o.mul(l.sub(u)).add(u.div(c))}var p=function(e,t,i){if(void 0===i&&(i=-1),-1===i&&(i=t.rank-1),i!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+i);return h.customGrad(function(n,e){var t=e.logSumExp([i],!0),r=e.toFloat().sub(t);return{value:r.mul(n).neg().sum([i]),gradFunc:function(e){var t=g.expandShapeToKeepDim(e.shape,[i]);return[e.reshape(t).mul(n.toFloat().sub(r.exp())),e.reshape(t).mul(r.exp().sub(n.toFloat()))]}}})(e,t)}(o,a);return f.computeWeightedLoss(p,s,i)}})},{"../globals":64,"../tensor_util_env":183,"../util":187,"./axis_util":129,"./binary_ops":131,"./operation":148,"./tensor_ops":163}],143:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var l=e("../environment"),c=e("../tensor_util_env"),p=e("../util"),r=e("./operation");n.localResponseNormalization=r.op({localResponseNormalization_:function(e,r,i,o,a){void 0===r&&(r=5),void 0===i&&(i=1),void 0===o&&(o=1),void 0===a&&(a=.5);var t=c.convertToTensor(e,"x","localResponseNormalization");p.assert(4===t.rank||3===t.rank,"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+t.rank+"."),p.assert(p.isInt(r),"Error in localResponseNormalization: depthRadius must be an integer\n                     but got depthRadius "+r+".");var s=t,n=!1;3===t.rank&&(n=!0,s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var u=l.ENV.engine.runKernel(function(e,t){return t(e.localResponseNormalization4D(s,r,i,o,a))},{x4D:s},function(t,e){var n=e[0];return{x4D:function(){return l.ENV.engine.runKernel(function(e){return e.LRNGrad(t,s,n,r,i,o,a)},{})}}});return n?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}})},{"../environment":62,"../tensor_util_env":183,"../util":187,"./operation":148}],144:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var S=e("../tensor_util_env"),r=e("./operation");n.basicLSTMCell=r.op({basicLSTMCell_:function(e,t,n,r,i,o){var a=S.convertToTensor(e,"forgetBias","basicLSTMCell"),s=S.convertToTensor(t,"lstmKernel","basicLSTMCell"),u=S.convertToTensor(n,"lstmBias","basicLSTMCell"),l=S.convertToTensor(r,"data","basicLSTMCell"),c=S.convertToTensor(i,"c","basicLSTMCell"),p=S.convertToTensor(o,"h","basicLSTMCell"),h=l.concat(p,1).matMul(s).add(u),f=h.shape[0],d=h.shape[1]/4,m=[f,d],y=h.slice([0,0],m),g=h.slice([0,d],m),v=h.slice([0,2*d],m),b=h.slice([0,3*d],m),_=y.sigmoid().mulStrict(g.tanh()).addStrict(c.mulStrict(a.add(v).sigmoid())),w=_.tanh().mulStrict(b.sigmoid());return[_,w]}}),n.multiRNNCell=r.op({multiRNNCell_:function(e,t,n,r){for(var i=S.convertToTensor(t,"data","multiRNNCell"),o=S.convertToTensorArray(n,"c","multiRNNCell"),a=S.convertToTensorArray(r,"h","multiRNNCell"),s=i,u=[],l=0;l<e.length;l++){var c=e[l](s,o[l],a[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var p=[],h=[];for(l=0;l<u.length;l+=2)p.push(u[l]),h.push(u[l+1]);return[p,h]}})},{"../tensor_util_env":183,"./operation":148}],145:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=e("../environment"),l=e("../tensor_util_env"),c=e("../util"),r=e("./operation");n.matMul=r.op({matMul_:function(e,t,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1);var i=l.convertToTensor(e,"a","matMul"),o=l.convertToTensor(t,"b","matMul"),a=n?i.shape[0]:i.shape[1],s=r?o.shape[1]:o.shape[0];return c.assert(2===i.rank&&2===o.rank,"Error in matMul: inputs must be rank 2, got ranks "+i.rank+" and "+o.rank+"."),c.assert(a===s,"Error in matMul: inner shapes ("+a+") and ("+s+") of Tensors with shapes "+i.shape+" and "+o.shape+" and transposeA="+n+" and transposeB="+r+" must match."),u.ENV.engine.runKernel(function(e){return e.matMul(i,o,n,r)},{$a:i,$b:o},function(e){return n||r?!n&&r?{$a:function(){return e.matMul(o.toFloat(),!1,!1)},$b:function(){return e.matMul(i.toFloat(),!0,!1)}}:n&&!r?{$a:function(){return o.toFloat().matMul(e,!1,!0)},$b:function(){return i.toFloat().matMul(e,!1,!1)}}:{$a:function(){return o.toFloat().matMul(e,!0,!0)},$b:function(){return e.matMul(i.toFloat(),!0,!0)}}:{$a:function(){return e.matMul(o.toFloat(),!1,!0)},$b:function(){return i.toFloat().matMul(e,!0,!1)}}})}}),n.dot=r.op({dot_:function(e,t){var n=l.convertToTensor(e,"t1","dot"),r=l.convertToTensor(t,"t2","dot");c.assert(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+".");var i=1===n.rank?n.size:n.shape[1],o=1===r.rank?r.size:r.shape[0];return c.assert(i===o,"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),n.outerProduct=r.op({outerProduct_:function(e,t){var n=l.convertToTensor(e,"v1","outerProduct"),r=l.convertToTensor(t,"v2","outerProduct");return c.assert(1===n.rank&&1===r.rank,"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."),n.as2D(-1,1).matMul(r.as2D(1,-1))}})},{"../environment":62,"../tensor_util_env":183,"../util":187,"./operation":148}],146:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var h=e("../tensor_util"),f=e("../tensor_util_env"),d=e("../util"),m=e("./binary_ops"),r=e("./operation"),y=e("./tensor_ops");n.movingAverage=r.op({movingAverage_:function(e,t,n,r,i){void 0===i&&(i=!0);var o=f.convertToTensor(e,"v","movingAverage"),a=f.convertToTensor(t,"x","movingAverage"),s=f.convertToTensor(n,"decay","movingAverage");h.assertTypesMatch(o,a),d.assert(d.arraysEqual(o.shape,a.shape),"Shape mismatch in v and x");var u=y.scalar(1),l=u.sub(s),c=a.sub(o).mul(l);if(i){d.assert(null!=r,"When using zeroDebias: true, step is required.");var p=f.convertToTensor(r,"step","movingAverage");c=c.div(u.sub(m.pow(s,p)))}return o.add(c)}})},{"../tensor_util":182,"../tensor_util_env":183,"../util":187,"./binary_ops":131,"./operation":148,"./tensor_ops":163}],147:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var s=e("../tensor_util_env"),u=e("./axis_util"),r=e("./operation"),l=e("./tensor_ops");n.norm=r.op({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var i=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||r instanceof Array&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(l.scalar(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(r instanceof Array&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=s.convertToTensor(e,"x","norm"),t,n),o=i.shape;if(r){var a=u.parseAxisParam(n,e.shape);o=u.expandShapeToKeepDim(i.shape,a)}return i.reshape(o)}})},{"../tensor_util_env":183,"./axis_util":129,"./operation":148,"./tensor_ops":163}],148:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("../environment");n.op=function(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var r=t[0],i=e[r];r.endsWith("_")&&(r=r.substring(0,r.length-1));var n=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.ENV.engine.startScope(r);try{var n=i.apply(void 0,e);return n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),o.ENV.engine.endScope(n),n}catch(e){throw o.ENV.engine.endScope(null),e}};return Object.defineProperty(n,"name",{value:r,configurable:!0}),n}},{"../environment":62}],149:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),r(e("./batchnorm")),r(e("./concat")),r(e("./conv")),r(e("./matmul")),r(e("./reverse")),r(e("./pool")),r(e("./slice")),r(e("./unary_ops")),r(e("./reduction_ops")),r(e("./compare")),r(e("./binary_ops")),r(e("./relu_ops")),r(e("./logical_ops")),r(e("./array_ops")),r(e("./tensor_ops")),r(e("./transpose")),r(e("./softmax")),r(e("./lrn")),r(e("./norm")),r(e("./segment_ops")),r(e("./lstm")),r(e("./moving_average")),r(e("./strided_slice")),r(e("./topk"));var i=e("./operation");n.op=i.op;var o=e("./loss_ops");n.losses=o;var a=e("./linalg_ops");n.linalg=a;var s=e("./image_ops");n.image=s},{"./array_ops":127,"./batchnorm":130,"./binary_ops":131,"./compare":133,"./concat":134,"./conv":136,"./image_ops":139,"./linalg_ops":140,"./logical_ops":141,"./loss_ops":142,"./lrn":143,"./lstm":144,"./matmul":145,"./moving_average":146,"./norm":147,"./operation":148,"./pool":150,"./reduction_ops":153,"./relu_ops":154,"./reverse":155,"./segment_ops":156,"./slice":159,"./softmax":161,"./strided_slice":162,"./tensor_ops":163,"./topk":164,"./transpose":165,"./unary_ops":166}],150:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var h=e("../environment"),f=e("../tensor_util_env"),d=e("../util"),m=e("./conv_util"),r=e("./operation");n.maxPool=r.op({maxPool_:function(e,r,i,o,t){var n=f.convertToTensor(e,"x","maxPool"),a=n,s=!1;3===n.rank&&(s=!0,a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),d.assert(4===a.rank,"Error in maxPool: input must be rank 4 but got rank "+a.rank+"."),null!=t&&d.assert(d.isInt(o),"Error in maxPool: pad must be an integer when using, dimRoundingMode "+t+" but got pad "+o+".");var u=m.computePool2DInfo(a.shape,r,i,o,t),l=h.ENV.engine.runKernel(function(e,t){return t(e.maxPool(a,u))},{x:a},function(e,t){var n=t[0];return{x:function(){return function(e,t,n,r,i,o,a){var s=f.convertToTensor(e,"dy","maxPoolBackprop"),u=f.convertToTensor(t,"input","maxPoolBackprop"),l=f.convertToTensor(n,"output","maxPoolBackprop");d.assert(u.rank===s.rank,"Rank of input ("+u.rank+") does not match rank of dy ("+s.rank+")"),d.assert(4===s.rank,"Error in maxPoolBackprop: dy must be rank 4 but got rank "+s.rank+"."),d.assert(4===u.rank,"Error in maxPoolBackprop: input must be rank 4 but got rank "+u.rank+"."),null!=a&&d.assert(d.isInt(o),"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+".");var c=m.computePool2DInfo(u.shape,r,i,o,a);return h.ENV.engine.runKernel(function(e){return e.maxPoolBackprop(s,u,l,c)},{$dy:s,$input:u})}(e,a,n,r,i,o)}}});return s?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}}),n.avgPool=r.op({avgPool_:function(e,t,n,r,i){var o=f.convertToTensor(e,"x","avgPool");d.assert("float32"===o.dtype,"The input dtype to avgPool must be float32");var a=o,s=!1;3===o.rank&&(s=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),d.assert(4===a.rank,"Error in avgPool: x must be rank 4 but got rank "+a.rank+"."),null!=i&&d.assert(d.isInt(r),"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+".");var u=m.computePool2DInfo(a.shape,t,n,r),l=h.ENV.engine.runKernel(function(e){return e.avgPool(a,u)},{x:a},function(e){return{x:function(){return function(e,t,n,r,i){var o=f.convertToTensor(e,"dy","avgPoolBackprop"),a=f.convertToTensor(t,"input","avgPoolBackprop");d.assert(a.rank===o.rank,"Rank of input ("+a.rank+") does not match rank of dy ("+o.rank+")");var s=a,u=o,l=!1;3===a.rank&&(l=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]),u=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),d.assert(4===u.rank,"Error in avgPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."),d.assert(4===s.rank,"Error in avgPoolBackprop: input must be rank 4 but got rank "+s.rank+".");var c=m.computePool2DInfo(s.shape,n,r,i),p=h.ENV.engine.runKernel(function(e){return e.avgPoolBackprop(u,s,c)},{dy4D:u,input4D:s});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}(e,a,t,n,r)}}});return l=l.cast(o.dtype),s?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}})},{"../environment":62,"../tensor_util_env":183,"../util":187,"./conv_util":137,"./operation":148}],151:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("seedrandom"),r=function(){function e(e,t,n,r,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=a.alea(o.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){for(var i=void 0,o=void 0,a=void 0;1<=(a=(i=2*this.random()-1)*i+(o=2*this.random()-1)*o)||0===a;);var s=Math.sqrt(-2*Math.log(a)/a);t=this.mean+this.stdDev*i*s,n=this.mean+this.stdDev*o*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}();n.MPRandGauss=r},{seedrandom:258}],152:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../util");n.PARALLELIZE_THRESHOLD=30,n.computeOptimalWindowSize=function(e){return e<=n.PARALLELIZE_THRESHOLD?e:r.nearestDivisor(e,Math.floor(Math.sqrt(e)))}},{"../util":187}],153:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var l=e("../environment"),u=e("../globals"),c=e("../tensor_util_env"),p=e("../util"),h=e("./axis_util"),r=e("./operation"),f=e("./tensor_ops");n.all=r.op({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=c.convertToTensor(e,"x","all","bool");p.assert("bool"===r.dtype,"Error Tensor must be of type bool. Got: "+r.dtype);var i=h.parseAxisParam(t,r.shape),o=i,a=h.getAxesPermutation(o,r.rank);null!=a&&(r=r.transpose(a),o=h.getInnerMostAxes(o.length,r.rank));var s=l.ENV.engine.runKernel(function(e){return e.all(r,o)},{$x:r});if(n){var u=h.expandShapeToKeepDim(s.shape,i);return s.reshape(u)}return s}}),n.any=r.op({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=c.convertToTensor(e,"x","any","bool");p.assert("bool"===r.dtype,"Error Tensor must be of type bool. Got: "+r.dtype);var i=h.parseAxisParam(t,r.shape),o=i,a=h.getAxesPermutation(o,r.rank);null!=a&&(r=r.transpose(a),o=h.getInnerMostAxes(o.length,r.rank));var s=l.ENV.engine.runKernel(function(e){return e.any(r,o)},{$x:r});if(n){var u=h.expandShapeToKeepDim(s.shape,i);return s.reshape(u)}return s}}),n.argMax=r.op({argMax_:function(e,t){void 0===t&&(t=0);var n=c.convertToTensor(e,"x","argMax");null==t&&(t=0);var r=h.parseAxisParam(t,n.shape),i=h.getAxesPermutation(r,n.rank);return null!=i&&(n=n.transpose(i),r=h.getInnerMostAxes(r.length,n.rank)),l.ENV.engine.runKernel(function(e){return e.argMax(n,r[0])},{$x:n})}}),n.argMin=r.op({argMin_:function(e,t){void 0===t&&(t=0);var n=c.convertToTensor(e,"x","argMin");null==t&&(t=0);var r=h.parseAxisParam(t,n.shape),i=h.getAxesPermutation(r,n.rank);return null!=i&&(n=n.transpose(i),r=h.getInnerMostAxes(r.length,n.rank)),l.ENV.engine.runKernel(function(e){return e.argMin(n,r[0])},{$x:n})}}),n.logSumExp=r.op({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=c.convertToTensor(e,"x","logSumExp"),i=h.parseAxisParam(t,r.shape),o=r.max(i,!0),a=r.sub(o).exp().sum(i).log(),s=o.reshape(a.shape).add(a);if(n){var u=h.expandShapeToKeepDim(s.shape,i);return s.reshape(u)}return s}}),n.max=r.op({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=c.convertToTensor(e,"x","max"),i=h.parseAxisParam(t,r.shape),o=i,a=h.getAxesPermutation(o,r.rank);null!=a&&(r=r.transpose(a),o=h.getInnerMostAxes(o.length,r.rank));var s=l.ENV.engine.runKernel(function(e){return e.max(r,o)},{$x:r});if(n){var u=h.expandShapeToKeepDim(s.shape,i);return s.reshape(u)}return s}}),n.mean=r.op({mean_:function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=!1);var n=c.convertToTensor(e,"x","mean"),o=h.parseAxisParam(t,n.shape),r=h.computeOutAndReduceShapes(n.shape,o)[1],a=p.sizeFromShape(r);return u.customGrad(function(n){var r=f.scalar(a);return{value:(r.dtype===n.dtype?n:n.cast(r.dtype)).div(r).sum(t,i),gradFunc:function(e){var t=n.shape.slice();return o.forEach(function(e){t[e]=1}),e.reshape(t).mul(f.ones(n.shape,"float32")).div(r)}}})(n)}}),n.min=r.op({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=c.convertToTensor(e,"x","min"),i=h.parseAxisParam(t,r.shape),o=i,a=h.getAxesPermutation(o,r.rank);null!=a&&(r=r.transpose(a),o=h.getInnerMostAxes(o.length,r.rank));var s=l.ENV.engine.runKernel(function(e){return e.min(r,o)},{$x:r});if(n){var u=h.expandShapeToKeepDim(s.shape,i);return s.reshape(u)}return s}}),n.moments=r.op({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1),e=c.convertToTensor(e,"x","moments");var r=h.parseAxisParam(t,e.shape),i=e.mean(r,n),o=i.shape;n||(o=h.expandShapeToKeepDim(i.shape,r));var a=e.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:a.mean(r,n)}}}),n.sum=r.op({sum_:function(e,t,a){void 0===t&&(t=null),void 0===a&&(a=!1);var n=c.convertToTensor(e,"x","sum");"bool"===n.dtype&&(n=n.toInt());var s=h.parseAxisParam(t,n.shape);return u.customGrad(function(n){var e=h.getAxesPermutation(s,n.rank),t=s,r=n;null!=e&&(r=n.transpose(e),t=h.getInnerMostAxes(t.length,n.rank));var i=l.ENV.engine.runKernel(function(e){return e.sum(r,t)},{permutedX:r});if(a){var o=h.expandShapeToKeepDim(i.shape,s);i=i.reshape(o)}return{value:i,gradFunc:function(e){var t=n.shape.slice();return s.forEach(function(e){t[e]=1}),e.reshape(t).mul(f.ones(n.shape,"float32"))}}})(n)}})},{"../environment":62,"../globals":64,"../tensor_util_env":183,"../util":187,"./axis_util":129,"./operation":148,"./tensor_ops":163}],154:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),o=e("../tensor_util_env"),a=e("./binary_ops"),s=e("./logical_ops"),i=e("./operation"),u=e("./selu_util"),l=e("./tensor_ops");n.elu=i.op({elu_:function(e){var n=o.convertToTensor(e,"x","elu");return r.ENV.engine.runKernel(function(e,t){return t(e.elu(n))},{$x:n},function(t,e){var n=e[0];return{$x:function(){return r.ENV.engine.runKernel(function(e){return e.eluDer(t,n)},{dy:t,y:n})}}})}}),n.leakyRelu=i.op({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=o.convertToTensor(e,"x","leakyRelu");return a.maximum(l.scalar(t).mul(n),n)}}),n.prelu=i.op({prelu_:function(e,t){var n=o.convertToTensor(e,"x","prelu"),r=o.convertToTensor(t,"alpha","prelu"),i=l.scalar(0);return a.maximum(i,n).add(r.mul(a.minimum(i,n)))}}),n.relu=i.op({relu_:function(e){var n=o.convertToTensor(e,"x","relu");return"bool"===n.dtype?n.toInt():r.ENV.engine.runKernel(function(e){return e.relu(n)},{$x:n},function(e){var t=n.step();return{$x:function(){return e.mulStrict(t.toFloat())}}})}}),n.selu=i.op({selu_:function(e){var a=o.convertToTensor(e,"x","selu");return r.ENV.engine.runKernel(function(e){return e.selu(a)},{$x:a},function(o){return{$x:function(){var e=a.greater(l.scalar(0)),t=l.scalar(u.SELU_SCALEALPHA),n=l.scalar(u.SELU_SCALE),r=o.mul(n),i=o.mul(t).mul(a.toFloat().exp());return s.where(e,r,i)}}})}})},{"../environment":62,"../tensor_util_env":183,"./binary_ops":131,"./logical_ops":141,"./operation":148,"./selu_util":158,"./tensor_ops":163}],155:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("../environment"),o=e("../tensor_util_env"),a=e("../util"),s=e("./axis_util"),n=e("./operation");r.reverse=n.op({reverse_:function(e,t){var n=o.convertToTensor(e,"x","reverse");if(0===n.rank)return n.clone();var r=s.parseAxisParam(t,n.shape);return i.ENV.engine.runKernel(function(e){return e.reverse(n,r)},{$x:n},function(e){return{$x:function(){return e.reverse(r)}}}).reshapeAs(n)}}),r.reverse1d=n.op({reverse1d_:function(e){var t=o.convertToTensor(e,"x","reverse");return a.assert(1===t.rank,"Error in reverse1D: x must be rank 1 but got\n             rank "+t.rank+"."),r.reverse(t,0)}}),r.reverse2d=n.op({reverse2d_:function(e,t){var n=o.convertToTensor(e,"x","reverse");return a.assert(2===n.rank,"Error in reverse2D: x must be rank 2 but got\n             rank "+n.rank+"."),r.reverse(n,t)}}),r.reverse3d=n.op({reverse3d_:function(e,t){var n=o.convertToTensor(e,"x","reverse");return a.assert(3===n.rank,"Error in reverse3D: x must be rank 3 but got\n             rank "+n.rank+"."),r.reverse(n,t)}}),r.reverse4d=n.op({reverse4d_:function(e,t){var n=o.convertToTensor(e,"x","reverse");return a.assert(4===n.rank,"Error in reverse4D: x must be rank 4 but got\n             rank "+n.rank+"."),r.reverse(n,t)}})},{"../environment":62,"../tensor_util_env":183,"../util":187,"./axis_util":129,"./operation":148}],156:[function(e,t,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var o=e("../environment"),a=e("../tensor_util_env"),s=e("../util"),u=e("./array_ops"),_=e("./axis_util"),l=e("./binary_ops"),c=e("./compare"),p=e("./logical_ops"),n=e("./operation"),h=e("./tensor_ops");function w(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function S(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}b.gather=n.op({gather_:function(e,t,y){void 0===y&&(y=0);var g=a.convertToTensor(e,"x","gather"),v=a.convertToTensor(t,"indices","gather","int32");return s.assert("int32"===v.dtype,"Indices must be of dtype `int32`"),y=_.parseAxisParam(y,g.shape)[0],o.ENV.engine.runKernel(function(e){return e.gather(g,v,y)},{$x:g},function(m){return{$x:function(){if(0===y)return b.unsortedSegmentSum(m,v,g.shape[y]);var e=g.shape,t=v.size,n=e.slice(0,y),r=n.length,i=e.slice(y,e.length).slice(1),o=i.length,a=w(0,r),s=w(r+1,r+1+o),u=S([n,[t],i]),l=m.reshape(u),c=v.reshape([t]),p=S([[r],a,s]),h=l.transpose(p),f=b.unsortedSegmentSum(h,c,g.shape[y]),d=_.getUndoAxesPermutation(p);return f=f.transpose(d)}}})}}),b.unsortedSegmentSum=n.op({unsortedSegmentSum_:function(e,t,n){var r=a.convertToTensor(e,"x","unsortedSegmentSum"),i=a.convertToTensor(t,"segmentIds","unsortedSegmentSum","int32");return s.assert("int32"===i.dtype,"segmentIds must be of dtype `int32`"),s.assert(s.isInt(n),"numSegments must be of dtype int"),o.ENV.engine.runKernel(function(e){return e.unsortedSegmentSum(r,i,n)},{$x:r},function(e){return{$x:function(){return function(e,t){for(var n=l.maximum(t,h.zerosLike(t)),r=b.gather(e,n),i=c.greaterEqual(t,h.scalar(0,"int32")),o=r.rank-i.rank,a=0;a<o;++a)i=u.expandDims(i,a+1);i=p.logicalAnd(i,h.ones(r.shape,"bool"));var s=h.zerosLike(r);return p.where(i,r,s)}(e,i)}}})}})},{"../environment":62,"../tensor_util_env":183,"../util":187,"./array_ops":127,"./axis_util":129,"./binary_ops":131,"./compare":133,"./logical_ops":141,"./operation":148,"./tensor_ops":163}],157:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../util"),o=e("./reduce_util");n.segOpComputeOptimalWindowSize=function(e,t){var n,r=!1;for(e<=o.PARALLELIZE_THRESHOLD?(n=e,r=!0):n=i.nearestDivisor(e,Math.floor(Math.sqrt(e)));!r;){if(t<n||n===e){r=!0;break}n=i.nearestDivisor(e,n+1)}return n},n.computeOutShape=function(e,t,n){for(var r=[],i=e.length,o=0;o<i;o++)o!==t?r.push(e[o]):r.push(n);return r}},{"../util":187,"./reduce_util":152}],158:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SELU_SCALEALPHA=1.7580993408473768,n.SELU_SCALE=1.0507009873554805},{}],159:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=e("../environment"),u=e("../tensor_util_env"),l=e("../util"),n=e("./operation"),c=e("./slice_util");i.slice=n.op({slice_:function(e,t,n){var r,i,o=u.convertToTensor(e,"x","slice");if(0===o.rank)throw new Error("Slicing scalar is not possible");r="number"==typeof t?[t].concat(new Array(o.rank-1).fill(0)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(0)):t,i=(i=null==n?new Array(o.rank).fill(-1):"number"==typeof n?[n].concat(new Array(o.rank-1).fill(-1)):n.length<o.rank?n.concat(new Array(o.rank-n.length).fill(-1)):n).map(function(e,t){return 0<=e?e:(l.assert(-1===e,"Bad value in size"),o.shape[t]-r[t])}),c.assertParamsValid(o,r,i);var a=o.shape;return s.ENV.engine.runKernel(function(e){return e.slice(o,r,i)},{$x:o},function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],a[n]-r[n]-i[n]]);return{$x:function(){return e.pad(t)}}})}}),i.slice1d=n.op({slice1d_:function(e,t,n){var r=u.convertToTensor(e,"x","slice1d");return l.assert(1===r.rank,"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"),i.slice(r,[t],[n])}}),i.slice2d=n.op({slice2d_:function(e,t,n){var r=u.convertToTensor(e,"x","slice2d");return l.assert(2===r.rank,"slice1d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"),i.slice(r,t,n)}}),i.slice3d=n.op({slice3d_:function(e,t,n){var r=u.convertToTensor(e,"x","slice3d");return l.assert(3===r.rank,"slice1d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"),i.slice(r,t,n)}}),i.slice4d=n.op({slice4d_:function(e,t,n){var r=u.convertToTensor(e,"x","slice4d");return l.assert(4===r.rank,"slice1d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"),i.slice(r,t,n)}})},{"../environment":62,"../tensor_util_env":183,"../util":187,"./operation":148,"./slice_util":160}],160:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var s=e("../util");function d(e,t,n,r,i){var o=t[i];e&1<<i&&(o=0<n[i]?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),o=s.clamp(0,o,a-1)}function m(e,t,n,r,i){var o=t[i];e&1<<i&&(o=0<n[i]?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),o=0<n[i]?s.clamp(0,o,a):s.clamp(-1,o,a-1)}n.assertParamsValid=function(e,t,n){s.assert(e.rank===t.length,"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."),s.assert(e.rank===n.length,"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+").");for(var r=0;r<e.rank;++r)s.assert(t[r]+n[r]<=e.shape[r],"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")")},n.getStridedSlicedInfo=function(e,t,n,i,r,o,a,s,u){if(void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),0!==a)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");for(var l=[],c=[],p=[],h=0;h<e.length;h++)l[h]=d(r,t,i,e,h),c[h]=m(o,n,i,e,h),u&1<<h&&(c[h]=l[h]+1,p.push(h));var f=new Array(e.length).fill(0);return f=f.map(function(e,t){for(var n=0,r=l[t];!(0<i[t]?r>=c[t]:r<=c[t]);r+=i[t])n+=1;return n}),[l,f,p]},n.startForAxis=d,n.stopForAxis=m},{"../util":187}],161:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../gradients"),o=e("../tensor_util_env"),r=e("./operation");n.softmax=r.op({softmax_:function(e,r){void 0===r&&(r=-1);var t=o.convertToTensor(e,"logits","softmax");if(-1===r&&(r=t.rank-1),r!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+r);return i.customGrad(function(e){var t=e.logSumExp([r],!0),n=e.toFloat().sub(t).exp();return{value:n,gradFunc:function(e){var t=e.mul(n);return t.sub(t.sum([r],!0).mul(n))}}})(t)}})},{"../gradients":65,"../tensor_util_env":183,"./operation":148}],162:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var c=e("../environment"),p=e("../tensor_util_env"),r=e("./operation");n.stridedSlice=r.op({stridedSlice_:function(e,t,n,r,i,o,a,s,u){if(void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),0!==a)throw new Error("ellipsis mask is not yet supported");if(0!==s)throw new Error("new axis mask is not yet supported");var l=p.convertToTensor(e,"x","stridedSlice");return c.ENV.engine.runKernel(function(e){return e.stridedSlice(l,t,n,r,i,o,a,s,u)},{$x:l})}})},{"../environment":62,"../tensor_util_env":183,"./operation":148}],163:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../environment"),o=e("../tensor"),r=e("../tensor_util_env"),s=e("../util"),a=e("./operation");function u(e,t,n){if(void 0===n&&(n="float32"),!s.isTypedArray(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e)throw new Error("values passed to tensor(values) must be an array of numbers or booleans, or a TypedArray");var r=s.inferShape(e);return null!=t&&1!==r.length&&s.assertShapesMatch(t,r,"Error creating a new Tensor. Inferred shape ("+r+") does not match the provided shape ("+t+"). "),s.isTypedArray(e)||Array.isArray(e)||(e=[e]),t=t||r,o.Tensor.make(t,{values:s.toTypedArray(e,n,i.ENV.get("DEBUG"))},n)}function l(e,t){void 0===t&&(t="float32"),s.assertNonNull(e);var n=s.inferShape(e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return u(e,n,t)}function c(e,t){void 0===t&&(t="float32");var n=s.makeOnesTypedArray(s.sizeFromShape(e),t);return o.Tensor.make(e,{values:n},t)}function p(e,t){void 0===t&&(t="float32");var n=s.makeZerosTypedArray(s.sizeFromShape(e),t);return o.Tensor.make(e,{values:n},t)}n.tensor=u,n.scalar=function(e,t){if(void 0===t&&(t="float32"),s.isTypedArray(e)||Array.isArray(e))throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean)");return u(e,[],t)},n.tensor1d=l,n.tensor2d=function(e,t,n){if(void 0===n&&(n="float32"),s.assertNonNull(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=s.inferShape(e);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return u(e,t=t||r,n)},n.tensor3d=function(e,t,n){if(void 0===n&&(n="float32"),s.assertNonNull(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=s.inferShape(e);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return u(e,t=t||r,n)},n.tensor4d=function(e,t,n){if(void 0===n&&(n="float32"),s.assertNonNull(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=s.inferShape(e);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return u(e,t=t||r,n)},n.tensor5d=function(e,t,n){if(void 0===n&&(n="float32"),s.assertNonNull(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=s.inferShape(e);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return u(e,t=t||r,n)},n.tensor6d=function(e,t,n){if(void 0===n&&(n="float32"),s.assertNonNull(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=s.inferShape(e);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return u(e,t=t||r,n)},n.ones=c,n.zeros=p,n.fill=function(e,t,n){void 0===n&&(n="float32");var r=s.getTypedArrayFromDType(n,s.sizeFromShape(e));return r.fill(t),o.Tensor.make(e,{values:r},n)},n.linspace=function(e,t,n){if(0===n)throw new Error("Cannot request zero samples");var r=(t-e)/(n-1),i=s.makeZerosTypedArray(n,"float32");i[0]=e;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return l(i,"float32")},n.range=function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&1<n)return p([0],r);var i=Math.abs(Math.ceil((t-e)/n)),o=s.makeZerosTypedArray(i,r);t<e&&1===n&&(n=-1),o[0]=e;for(var a=1;a<o.length;a++)o[a]=o[a-1]+n;return l(o,r)},n.onesLike=a.op({onesLike_:function(e){var t=r.convertToTensor(e,"x","onesLike");return c(t.shape,t.dtype)}}),n.zerosLike=a.op({zerosLike_:function(e){var t=r.convertToTensor(e,"x","zerosLike");return p(t.shape,t.dtype)}})},{"../environment":62,"../tensor":180,"../tensor_util_env":183,"../util":187,"./operation":148}],164:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../environment"),s=e("../tensor_util_env"),r=e("./operation");n.topk=r.op({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=s.convertToTensor(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(i<t)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+t);var o=a.ENV.engine.runKernel(function(e){return e.topk(r,t,n)},{$x:r});return{values:o[0],indices:o[1]}}})},{"../environment":62,"../tensor_util_env":183,"./operation":148}],165:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment"),i=e("../tensor_util_env"),o=e("../util"),a=e("./axis_util"),s=e("./operation");n.transpose=s.op({transpose_:function(e,n){var t=i.convertToTensor(e,"x","transpose");return null==n&&(n=t.shape.map(function(e,t){return t}).reverse()),o.assert(t.rank===n.length,"Error in transpose: rank of input "+t.rank+" must match length of perm "+n+"."),n.forEach(function(e){o.assert(0<=e&&e<t.rank,"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+n)}),t.rank<=1?t.clone():r.ENV.engine.runKernel(function(e){return e.transpose(t,n)},{$x:t},function(e){var t=a.getUndoAxesPermutation(n);return{$x:function(){return e.transpose(t)}}})}})},{"../environment":62,"../tensor_util_env":183,"../util":187,"./axis_util":129,"./operation":148}],166:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("../environment"),o=e("../tensor_util_env"),a=e("../util"),r=e("./operation"),s=e("./tensor_ops");n.abs=r.op({abs_:function(e){var t=o.convertToTensor(e,"x","abs");return i.ENV.engine.runKernel(function(e){return e.abs(t)},{$x:t},function(e){return{$x:function(){return e.mulStrict(t.toFloat().step(-1))}}})}}),n.acos=r.op({acos_:function(e){var t=o.convertToTensor(e,"x","acos");return i.ENV.engine.runKernel(function(e){return e.acos(t)},{$x:t},function(e){return{$x:function(){return e.divStrict(s.scalar(1).sub(t.toFloat().square()).sqrt()).neg()}}})}}),n.acosh=r.op({acosh_:function(e){var t=o.convertToTensor(e,"x","acosh");return i.ENV.engine.runKernel(function(e){return e.acosh(t)},{$x:t},function(e){return{$x:function(){return e.divStrict(t.toFloat().square().sub(s.scalar(1)).sqrt())}}})}}),n.asin=r.op({asin_:function(e){var t=o.convertToTensor(e,"x","asin");return i.ENV.engine.runKernel(function(e){return e.asin(t)},{$x:t},function(e){return{$x:function(){return e.divStrict(s.scalar(1).sub(t.toFloat().square()).sqrt())}}})}}),n.asinh=r.op({asinh_:function(e){var t=o.convertToTensor(e,"x","asinh");return i.ENV.engine.runKernel(function(e){return e.asinh(t)},{$x:t},function(e){return{$x:function(){return e.divStrict(s.scalar(1).add(t.toFloat().square()).sqrt())}}})}}),n.atan=r.op({atan_:function(e){var t=o.convertToTensor(e,"x","atan");return i.ENV.engine.runKernel(function(e){return e.atan(t)},{$x:t},function(e){return{$x:function(){return e.divStrict(s.scalar(1).add(t.toFloat().square()))}}})}}),n.atanh=r.op({atanh_:function(e){var t=o.convertToTensor(e,"x","atanh");return i.ENV.engine.runKernel(function(e){return e.atanh(t)},{$x:t},function(e){return{$x:function(){return e.divStrict(s.scalar(1).sub(t.toFloat().square()))}}})}}),n.ceil=r.op({ceil_:function(e){var t=o.convertToTensor(e,"x","ceil");return i.ENV.engine.runKernel(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return s.zerosLike(e)}}})}}),n.clipByValue=r.op({clipByValue_:function(e,t,n){var r=o.convertToTensor(e,"x","clipByValue");return a.assert(t<=n,"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."),i.ENV.engine.runKernel(function(e){return e.clip(r,t,n)},{$x:r},function(e){return{$x:function(){return e.where(r.greaterEqual(s.scalar(t)).logicalAnd(r.lessEqual(s.scalar(n))),s.zerosLike(e))}}})}}),n.cos=r.op({cos_:function(e){var t=o.convertToTensor(e,"x","cos");return i.ENV.engine.runKernel(function(e){return e.cos(t)},{$x:t},function(e){return{$x:function(){return t.toFloat().sin().neg().mulStrict(e)}}})}}),n.cosh=r.op({cosh_:function(e){var t=o.convertToTensor(e,"x","cosh");return i.ENV.engine.runKernel(function(e){return e.cosh(t)},{$x:t},function(e){return{$x:function(){return t.toFloat().sinh().mulStrict(e)}}})}}),n.erf=r.op({erf_:function(e){var t=o.convertToTensor(e,"x","erf");return a.assert("int32"===t.dtype||"float32"===t.dtype,"Input dtype must be `int32` or `float32`."),"int32"===t.dtype&&(t=t.toFloat()),i.ENV.engine.runKernel(function(e){return e.erf(t)},{$x:t},function(e){return{$x:function(){return e.mulStrict(s.scalar(2/Math.sqrt(Math.PI)).mul(t.square().neg().exp()))}}})}}),n.exp=r.op({exp_:function(e){var n=o.convertToTensor(e,"x","exp");return i.ENV.engine.runKernel(function(e,t){return t(e.exp(n))},{$x:n},function(e,t){var n=t[0];return{$x:function(){return e.mulStrict(n)}}})}}),n.expm1=r.op({expm1_:function(e){var t=o.convertToTensor(e,"x","expm1");return i.ENV.engine.runKernel(function(e){return e.expm1(t)},{$x:t},function(e){return{$x:function(){return e.mulStrict(t.exp())}}})}}),n.floor=r.op({floor_:function(e){var t=o.convertToTensor(e,"x","floor");return i.ENV.engine.runKernel(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return s.zerosLike(e)}}})}}),n.log=r.op({log_:function(e){var t=o.convertToTensor(e,"x","log");return i.ENV.engine.runKernel(function(e){return e.log(t)},{$x:t},function(e){return{$x:function(){return e.divStrict(t.toFloat())}}})}}),n.log1p=r.op({log1p_:function(e){var t=o.convertToTensor(e,"x","log1p");return i.ENV.engine.runKernel(function(e){return e.log1p(t)},{$x:t},function(e){return{$x:function(){return e.divStrict(t.add(s.scalar(1)))}}})}}),n.logSigmoid=r.op({logSigmoid_:function(e){var t=o.convertToTensor(e,"x","logSigmoid");return i.ENV.engine.runKernel(function(e){return e.softplus(t.neg()).neg()},{$x:t},function(e){return{$x:function(){return e.mulStrict(t.neg().sigmoid())}}})}}),n.neg=r.op({neg_:function(e){var t=o.convertToTensor(e,"x","neg");return i.ENV.engine.runKernel(function(e){return e.neg(t)},{$x:t},function(e){return{$x:function(){return e.neg()}}})}}),n.reciprocal=r.op({reciprocal_:function(e){var t=o.convertToTensor(e,"x","reciprocal");return i.ENV.engine.runKernel(function(e){return e.reciprocal(t)},{$x:t},function(e){return{$x:function(){return e.divStrict(t.square().neg())}}})}}),n.round=r.op({round_:function(e){var t=o.convertToTensor(e,"x","round");return i.ENV.engine.runKernel(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return s.zerosLike(e)}}})}}),n.rsqrt=r.op({rsqrt_:function(e){var t=o.convertToTensor(e,"x","rsqrt");return i.ENV.engine.runKernel(function(e){return e.rsqrt(t)},{$x:t},function(e){return{$x:function(){return e.divStrict(t.pow(s.scalar(1.5)).mul(s.scalar(2))).neg()}}})}}),n.sigmoid=r.op({sigmoid_:function(e){var n=o.convertToTensor(e,"x","sigmoid");return i.ENV.engine.runKernel(function(e,t){return t(e.sigmoid(n))},{$x:n},function(e,t){var n=t[0];return{$x:function(){return e.mulStrict(n.mul(s.scalar(1).sub(n)))}}})}}),n.sign=r.op({sign_:function(e){var t=o.convertToTensor(e,"x","sign");return i.ENV.engine.runKernel(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return s.zerosLike(e)}}})}}),n.sin=r.op({sin_:function(e){var t=o.convertToTensor(e,"x","sin");return i.ENV.engine.runKernel(function(e){return e.sin(t)},{$x:t},function(e){return{$x:function(){return t.toFloat().cos().mulStrict(e)}}})}}),n.sinh=r.op({sinh_:function(e){var t=o.convertToTensor(e,"x","sinh");return i.ENV.engine.runKernel(function(e){return e.sinh(t)},{$x:t},function(e){return{$x:function(){return t.toFloat().cosh().mulStrict(e)}}})}}),n.softplus=r.op({softplus_:function(e){var t=o.convertToTensor(e,"x","softplus");return i.ENV.engine.runKernel(function(e){return e.softplus(t)},{$x:t},function(e){return{$x:function(){return e.mulStrict(t.sigmoid())}}})}}),n.sqrt=r.op({sqrt_:function(e){var t=o.convertToTensor(e,"x","sqrt");return i.ENV.engine.runKernel(function(e){return e.sqrt(t)},{$x:t},function(e){return{$x:function(){return e.divStrict(t.toFloat().sqrt().mul(s.scalar(2)))}}})}}),n.square=r.op({square_:function(e){var t=o.convertToTensor(e,"x","square");return i.ENV.engine.runKernel(function(e){return e.square(t)},{$x:t},function(e){return{$x:function(){return e.mulStrict(t.toFloat().mul(s.scalar(2)))}}})}}),n.step=r.op({step_:function(e,t){void 0===t&&(t=0);var n=o.convertToTensor(e,"x","step");return i.ENV.engine.runKernel(function(e){return e.step(n,t)},{$x:n},function(e){return{$x:function(){return s.zerosLike(e)}}})}}),n.tan=r.op({tan_:function(e){var t=o.convertToTensor(e,"x","tan");return i.ENV.engine.runKernel(function(e){return e.tan(t)},{$x:t},function(e){return{$x:function(){return e.divStrict(t.cos().square())}}})}}),n.tanh=r.op({tanh_:function(e){var n=o.convertToTensor(e,"x","tanh");return i.ENV.engine.runKernel(function(e,t){return t(e.tanh(n))},{$x:n},function(e,t){var n=t[0];return{$x:function(){return s.scalar(1).sub(n.square()).mulStrict(e)}}})}})},{"../environment":62,"../tensor_util_env":183,"../util":187,"./operation":148,"./tensor_ops":163}],167:[function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var c=e("../environment"),p=e("../globals"),h=e("../ops/ops"),i=e("../serialization"),a=e("./optimizer"),s=e("./optimizer_utils"),u=function(i){function e(e,t,n){void 0===n&&(n=null);var r=i.call(this)||this;return r.learningRate=e,r.rho=t,r.epsilon=n,r.accumulatedGrads={},r.accumulatedUpdates={},r.c=p.keep(h.scalar(-e)),r.rhoScalar=p.keep(h.scalar(t)),r.oneMinusRho=p.keep(h.scalar(1-t)),null===n&&(n=s.getOptimizerDefaultEpsilonValue()),r.epsilonScalar=p.keep(h.scalar(n)),r}return o(e,i),e.prototype.applyGradients=function(e){var l=this,t=function(i){var o=c.ENV.engine.registeredVariables[i];if(null==n.accumulatedGrads[i]){p.tidy(function(){l.accumulatedGrads[i]=h.zerosLike(o).variable(!1)})}if(null==n.accumulatedUpdates[i]){p.tidy(function(){l.accumulatedUpdates[i]=h.zerosLike(o).variable(!1)})}var a=e[i],s=n.accumulatedGrads[i],u=n.accumulatedUpdates[i];p.tidy(function(){var e=l.rhoScalar.mul(s).add(l.oneMinusRho.mul(a.square())),t=u.add(l.epsilonScalar).sqrt().div(s.add(l.epsilonScalar).sqrt()).mul(a),n=l.rhoScalar.mul(u).add(l.oneMinusRho.mul(t.square()));l.accumulatedGrads[i].assign(e),l.accumulatedUpdates[i].assign(n);var r=l.c.mul(t).add(o);o.assign(r)})},n=this;for(var r in e)t(r)},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsilonScalar.dispose(),this.rhoScalar.dispose(),this.oneMinusRho.dispose(),null!=this.accumulatedUpdates&&(Object.keys(this.accumulatedUpdates).forEach(function(e){return t.accumulatedUpdates[e].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(e){return t.accumulatedGrads[e].dispose()}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},e.className="AdadeltaOptimizer",e}(a.Optimizer);n.AdadeltaOptimizer=u,i.SerializationMap.register(u)},{"../environment":62,"../globals":64,"../ops/ops":149,"../serialization":178,"./optimizer":172,"./optimizer_utils":174}],168:[function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var u=e("../environment"),l=e("../globals"),c=e("../ops/ops"),i=e("../serialization"),a=e("./optimizer"),s=e("./optimizer_utils"),p=function(i){function e(e,t){void 0===t&&(t=.1);var n=i.call(this)||this;n.learningRate=e,n.initialAccumulatorValue=t,n.accumulatedGrads={},n.c=l.keep(c.scalar(-e));var r=s.getOptimizerDefaultEpsilonValue();return n.epsilon=l.keep(c.scalar(r)),n}return o(e,i),e.prototype.applyGradients=function(e){var a=this,t=function(n){var r=u.ENV.engine.registeredVariables[n];if(null==s.accumulatedGrads[n]){l.tidy(function(){a.accumulatedGrads[n]=c.fill(r.shape,a.initialAccumulatorValue).variable(!1)})}var i=e[n],o=s.accumulatedGrads[n];l.tidy(function(){var e=o.add(i.square());a.accumulatedGrads[n].assign(e);var t=a.c.mul(i.div(e.add(a.epsilon).sqrt())).add(r);r.assign(t)})},s=this;for(var n in e)t(n)},e.prototype.dispose=function(){var t=this;this.epsilon.dispose(),this.c.dispose(),null!=this.accumulatedGrads&&Object.keys(this.accumulatedGrads).forEach(function(e){return t.accumulatedGrads[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},e.className="AdagradOptimizer",e}(a.Optimizer);n.AdagradOptimizer=p,i.SerializationMap.register(p)},{"../environment":62,"../globals":64,"../ops/ops":149,"../serialization":178,"./optimizer":172,"./optimizer_utils":174}],169:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var m=e("../environment"),a=e("../globals"),y=e("../ops/ops"),o=e("../serialization"),s=e("./optimizer"),u=e("./optimizer_utils"),l=function(o){function e(e,t,n,r){void 0===r&&(r=null);var i=o.call(this)||this;return i.learningRate=e,i.beta1=t,i.beta2=n,i.epsilon=r,i.accumulatedFirstMoment={},i.accumulatedSecondMoment={},i.c=a.keep(y.scalar(-e)),i.beta1Scalar=a.keep(y.scalar(t)),i.beta2Scalar=a.keep(y.scalar(n)),a.tidy(function(){i.accBeta1=y.scalar(t).variable(),i.accBeta2=y.scalar(n).variable()}),i.oneMinusBeta1=a.keep(y.scalar(1-t)),i.oneMinusBeta2=a.keep(y.scalar(1-n)),i.one=a.keep(y.scalar(1)),null===r&&(r=u.getOptimizerDefaultEpsilonValue()),i.epsScalar=a.keep(y.scalar(r)),i}return i(e,o),e.prototype.applyGradients=function(f){var d=this;a.tidy(function(){var e=d.one.sub(d.accBeta1),t=d.one.sub(d.accBeta2);for(var n in f){var r=m.ENV.engine.registeredVariables[n];if(null==d.accumulatedFirstMoment[n]){var i=!1;d.accumulatedFirstMoment[n]=y.zerosLike(r).variable(i)}if(null==d.accumulatedSecondMoment[n]){i=!1;d.accumulatedSecondMoment[n]=y.zerosLike(r).variable(i)}var o=f[n],a=d.accumulatedFirstMoment[n],s=d.accumulatedSecondMoment[n],u=d.beta1Scalar.mul(a).add(d.oneMinusBeta1.mul(o)),l=d.beta2Scalar.mul(s).add(d.oneMinusBeta2.mul(o.square())),c=u.div(e),p=l.div(t);d.accumulatedFirstMoment[n].assign(u),d.accumulatedSecondMoment[n].assign(l);var h=d.c.mul(c.div(d.epsScalar.add(p.sqrt()))).add(r);r.assign(h)}d.accBeta1.assign(d.accBeta1.mul(d.beta1Scalar)),d.accBeta2.assign(d.accBeta2.mul(d.beta2Scalar))})},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsScalar.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(e){return t.accumulatedFirstMoment[e].dispose()}),null!=this.accumulatedSecondMoment&&Object.keys(this.accumulatedSecondMoment).forEach(function(e){return t.accumulatedSecondMoment[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},e.className="AdamOptimizer",e}(s.Optimizer);n.AdamOptimizer=l,o.SerializationMap.register(l)},{"../environment":62,"../globals":64,"../ops/ops":149,"../serialization":178,"./optimizer":172,"./optimizer_utils":174}],170:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var m=e("../environment"),s=e("../globals"),y=e("../ops/ops"),o=e("../serialization"),a=e("./optimizer"),u=e("./optimizer_utils"),l=function(a){function e(e,t,n,r,i){void 0===r&&(r=null),void 0===i&&(i=0);var o=a.call(this)||this;return o.learningRate=e,o.beta1=t,o.beta2=n,o.epsilon=r,o.decay=i,o.accumulatedFirstMoment={},o.accumulatedWeightedInfNorm={},o.c=s.keep(y.scalar(-e)),o.beta1Scalar=s.keep(y.scalar(t)),o.beta2Scalar=s.keep(y.scalar(n)),o.decayScalar=s.keep(y.scalar(i)),s.tidy(function(){o.iteration=y.scalar(0).variable(),o.accBeta1=y.scalar(t).variable()}),o.oneMinusBeta1=s.keep(y.scalar(1-t)),o.one=s.keep(y.scalar(1)),null===r&&(r=u.getOptimizerDefaultEpsilonValue()),o.epsScalar=s.keep(y.scalar(r)),o}return i(e,a),e.prototype.applyGradients=function(f){var d=this;s.tidy(function(){var e=d.one.sub(d.accBeta1),t=d.c.div(d.one.add(d.decayScalar.mul(d.iteration)));for(var n in f){var r=m.ENV.engine.registeredVariables[n];if(null==d.accumulatedFirstMoment[n]){var i=!1;d.accumulatedFirstMoment[n]=y.zerosLike(r).variable(i)}if(null==d.accumulatedWeightedInfNorm[n]){i=!1;d.accumulatedWeightedInfNorm[n]=y.zerosLike(r).variable(i)}var o=f[n],a=d.accumulatedFirstMoment[n],s=d.accumulatedWeightedInfNorm[n],u=d.beta1Scalar.mul(a).add(d.oneMinusBeta1.mul(o)),l=d.beta2Scalar.mul(s),c=o.abs(),p=l.maximum(c);d.accumulatedFirstMoment[n].assign(u),d.accumulatedWeightedInfNorm[n].assign(p);var h=t.div(e).mul(u.div(d.epsScalar.add(p))).add(r);r.assign(h)}d.iteration.assign(d.iteration.add(d.one)),d.accBeta1.assign(d.accBeta1.mul(d.beta1Scalar))})},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsScalar.dispose(),this.accBeta1.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.oneMinusBeta1.dispose(),this.decayScalar.dispose(),this.iteration.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(e){return t.accumulatedFirstMoment[e].dispose()}),null!=this.accumulatedWeightedInfNorm&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(e){return t.accumulatedWeightedInfNorm[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},e.className="AdamaxOptimizer",e}(a.Optimizer);n.AdamaxOptimizer=l,o.SerializationMap.register(l)},{"../environment":62,"../globals":64,"../ops/ops":149,"../serialization":178,"./optimizer":172,"./optimizer_utils":174}],171:[function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var u=e("../environment"),l=e("../globals"),c=e("../ops/ops"),i=e("../serialization"),a=function(i){function e(e,t,n){void 0===n&&(n=!1);var r=i.call(this,e)||this;return r.learningRate=e,r.momentum=t,r.useNesterov=n,r.m=c.scalar(r.momentum),r.accumulations={},r}return o(e,i),e.prototype.applyGradients=function(e){var a=this,t=function(n){var r=u.ENV.engine.registeredVariables[n];if(null==s.accumulations[n]){l.tidy(function(){a.accumulations[n]=c.zerosLike(r).variable(!1)})}var i=s.accumulations[n],o=e[n];l.tidy(function(){var e,t=a.m.mul(i).add(o);e=a.useNesterov?a.c.mul(o.add(t.mul(a.m))).add(r):a.c.mul(t).add(r),a.accumulations[n].assign(t),r.assign(e)})},s=this;for(var n in e)t(n)},e.prototype.dispose=function(){if(i.prototype.dispose.call(this),this.m.dispose(),null!=this.accumulations)for(var e in this.accumulations)this.accumulations[e].dispose()},e.prototype.setMomentum=function(e){this.momentum=e},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},e.className="MomentumOptimizer",e}(e("./sgd_optimizer").SGDOptimizer);n.MomentumOptimizer=a,i.SerializationMap.register(a)},{"../environment":62,"../globals":64,"../ops/ops":149,"../serialization":178,"./sgd_optimizer":176}],172:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("../globals"),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),i=r.value,o=r.grads;return this.applyGradients(o),Object.keys(o).forEach(function(e){return o[e].dispose()}),t?i:(i.dispose(),null)},t.prototype.computeGradients=function(e,t){return o.variableGrads(e,t)},t}(e("../serialization").Serializable);n.Optimizer=a},{"../globals":64,"../serialization":178}],173:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./adadelta_optimizer"),i=e("./adagrad_optimizer"),o=e("./adam_optimizer"),a=e("./adamax_optimizer"),s=e("./momentum_optimizer"),u=e("./rmsprop_optimizer"),l=e("./sgd_optimizer"),c=function(){function e(){}return e.sgd=function(e){return new l.SGDOptimizer(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new s.MomentumOptimizer(e,t,n)},e.rmsprop=function(e,t,n,r,i){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===i&&(i=!1),new u.RMSPropOptimizer(e,t,n,r,i)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new o.AdamOptimizer(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new r.AdadeltaOptimizer(e,t,n)},e.adamax=function(e,t,n,r,i){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===i&&(i=0),new a.AdamaxOptimizer(e,t,n,r,i)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new i.AdagradOptimizer(e,t)},e}();n.OptimizerConstructors=c},{"./adadelta_optimizer":167,"./adagrad_optimizer":168,"./adam_optimizer":169,"./adamax_optimizer":170,"./momentum_optimizer":171,"./rmsprop_optimizer":175,"./sgd_optimizer":176}],174:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../environment");n.getOptimizerDefaultEpsilonValue=function(){return r.ENV.get("WEBGL_RENDER_FLOAT32_ENABLED")?1e-8:1e-4}},{"../environment":62}],175:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var h=e("../environment"),f=e("../globals"),d=e("../ops/ops"),o=e("../serialization"),a=e("./optimizer"),s=e("./optimizer_utils"),u=function(a){function e(e,t,n,r,i){void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===i&&(i=!1);var o=a.call(this)||this;return o.learningRate=e,o.decay=t,o.momentum=n,o.epsilon=r,o.accumulatedMeanSquares={},o.accumulatedMeanGrads={},o.accumulatedMoments={},o.c=f.keep(d.scalar(e)),o.decayScalar=f.keep(d.scalar(t)),o.momentumScalar=f.keep(d.scalar(n)),o.oneMinusDecay=f.keep(d.scalar(1-t)),o.centered=i,null===r&&(r=s.getOptimizerDefaultEpsilonValue()),o.epsilonScalar=f.keep(d.scalar(r)),o}return i(e,a),e.prototype.applyGradients=function(e){var p=this,t=function(o){var a=h.ENV.engine.registeredVariables[o];if(null==n.accumulatedMeanSquares[o]){f.tidy(function(){p.accumulatedMeanSquares[o]=d.zerosLike(a).variable(!1)})}if(null==n.accumulatedMeanGrads[o]&&n.centered){f.tidy(function(){p.accumulatedMeanGrads[o]=d.zerosLike(a).variable(!1)})}if(null==n.accumulatedMoments[o]){f.tidy(function(){p.accumulatedMoments[o]=d.zerosLike(a).variable(!1)})}var s=n.accumulatedMeanSquares[o],u=n.accumulatedMeanGrads[o],l=n.accumulatedMoments[o],c=e[o];f.tidy(function(){var e=p.decayScalar.mul(s).add(p.oneMinusDecay.mul(c.square()));if(p.centered){var t=p.decayScalar.mul(u).add(p.oneMinusDecay.mul(c)),n=p.momentumScalar.mul(l).add(p.c.mul(c).div(e.sub(t.square().add(p.epsilonScalar)).sqrt()));p.accumulatedMeanSquares[o].assign(e),p.accumulatedMeanGrads[o].assign(t),p.accumulatedMoments[o].assign(n);var r=a.sub(n);a.assign(r)}else{var i=p.decayScalar.mul(s).add(p.oneMinusDecay.mul(c.square()));n=p.momentumScalar.mul(l).add(p.c.mul(c).div(i.add(p.epsilonScalar).sqrt()));p.accumulatedMeanSquares[o].assign(i),p.accumulatedMoments[o].assign(n);r=a.sub(n);a.assign(r)}})},n=this;for(var r in e)t(r)},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsilonScalar.dispose(),this.decayScalar.dispose(),this.momentumScalar.dispose(),this.oneMinusDecay.dispose(),null!=this.accumulatedMeanSquares&&Object.keys(this.accumulatedMeanSquares).forEach(function(e){return t.accumulatedMeanSquares[e].dispose()}),null!=this.accumulatedMeanGrads&&this.centered&&Object.keys(this.accumulatedMeanGrads).forEach(function(e){return t.accumulatedMeanGrads[e].dispose()}),null!=this.accumulatedMoments&&Object.keys(this.accumulatedMoments).forEach(function(e){return t.accumulatedMoments[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},e.className="RMSPropOptimizer",e}(a.Optimizer);n.RMSPropOptimizer=u,o.SerializationMap.register(u)},{"../environment":62,"../globals":64,"../ops/ops":149,"../serialization":178,"./optimizer":172,"./optimizer_utils":174}],176:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("../environment"),a=e("../globals"),s=e("../ops/ops"),u=e("../serialization"),l=function(n){function e(e){var t=n.call(this)||this;return t.learningRate=e,t.setLearningRate(e),t}return i(e,n),e.prototype.applyGradients=function(r){var i=this;Object.keys(r).forEach(function(e){var t=r[e],n=o.ENV.engine.registeredVariables[e];a.tidy(function(){var e=i.c.mul(t).add(n);n.assign(e)})})},e.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=a.keep(s.scalar(-e))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(e,t){return new e(t.learningRate)},e.className="SGDOptimizer",e}(e("./optimizer").Optimizer);n.SGDOptimizer=l,u.SerializationMap.register(l)},{"../environment":62,"../globals":64,"../ops/ops":149,"../serialization":178,"./optimizer":172}],177:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var l=e("./util"),r=function(){function e(e,t){this.backendTimer=e,null==(this.logger=t)&&(this.logger=new i)}return e.prototype.profileKernel=function(r,e){var t,i=this,o=this.backendTimer.time(function(){t=e()});return(Array.isArray(t)?t:[t]).forEach(function(t){var n=t.dataSync();l.checkComputationForNaN(n,t.dtype,r),o.then(function(e){i.logger.logKernelProfile(r,t,n,e.kernelMs)})}),t},e}();n.Profiler=r;var i=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r){var i=l.rightPad(r+"ms",9),o=l.rightPad(e,25),a=t.rank,s=t.size,u=l.rightPad(t.shape.toString(),14);console.log("%c"+o+"\t%c"+i+"\t%c"+a+"D "+u+"\t%c"+s,"font-weight:bold","color:red","color:blue","color: orange")},e}();n.Logger=i},{"./util":187}],178:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}();n.Serializable=r;var i=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(e){t.getMap().classNameMap[e.className]=[e,e.fromConfig]},t}();n.SerializationMap=i},{}],179:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var c=e("./util");n.getFilteredNodesXToY=function(e,t,n){for(var r={},i={},o=0;o<t.length;o++)r[t[o].id]=!0;for(o=0;o<e.length;o++){var a=(m=e[o]).inputs;for(var s in a){for(var u=a[s],l=!1,c=0;c<t.length;c++)if(r[u.id]){l=r[m.output.id]=!0,i[m.id]=!0;break}if(l)break}}var p={};p[n.id]=!0;var h={};for(o=e.length-1;0<=o;o--){a=(m=e[o]).inputs;var f=[];for(f.push(m.output),c=0;c<f.length;c++)if(p[f[c].id]){for(var s in a)p[a[s].id]=!0,h[m.id]=!0;break}}var d=[];for(o=0;o<e.length;o++){var m;if(i[(m=e[o]).id]&&h[m.id]){var y={};for(var s in m.inputs){var g=m.inputs[s];r[g.id]&&(y[s]=g)}var v=Object.assign({},m);v.inputs=y,v.output=m.output,d.push(v)}}return d},n.backpropagateGradients=function(e,t){for(var n=t.length-1;0<=n;n--){var r=t[n],i=e[r.output.id];if(null==r.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+r.name+".");var o=r.gradient(i);for(var a in r.inputs){if(!(a in o))throw new Error("Cannot backprop through input "+a+". Available gradients found: "+Object.keys(o)+".");var s=o[a](),u=r.inputs[a];if(!c.arraysEqual(s.shape,u.shape))throw new Error("Error in gradient for op "+r.name+". The gradient of input '"+a+"' has shape '"+s.shape+"', which does not match the shape of the input '"+u.shape+"'");if(null==e[u.id])e[u.id]=s;else{var l=e[u.id];e[u.id]=l.add(s),l.dispose()}}}}},{"./util":187}],180:[function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},s=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var u=e("./tensor_format"),l=e("./util"),c=e("./util"),i=function(){function e(e,t,n){if(this.dtype=t,null!=n){var r=n.length,i=l.sizeFromShape(e);l.assert(r===i,"Length of values '"+r+"' does not match the size inferred by the shape '"+i+"'")}this.shape=e.slice(),this.values=n||l.getTypedArrayFromDType(t,l.sizeFromShape(e)),this.strides=c.computeStrides(e),this.size=l.sizeFromShape(e)}return e.prototype.set=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];0===t.length&&(t=[0]),l.assert(t.length===this.rank,"The number of provided coordinates ("+t.length+") must match the rank ("+this.rank+")");var r=this.locToIndex(t);this.values[r]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=e[e.length-1],r=0;r<e.length-1;++r)n+=this.strides[r]*e[r];return this.values[n]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return f.make(this.shape,{values:this.values},this.dtype)},e}();n.TensorBuffer=i;var p=null,h=null;n.setTensorTracker=function(e){p=e},n.setOpHandler=function(e){h=e};var f=function(){function i(e,t,n,r){this.isDisposedInternal=!1,this.size=l.sizeFromShape(e),null!=n&&l.assert(this.size===n.length,"Based on the provided shape, ["+e+"], the tensor should have "+this.size+" values but has "+n.length),this.shape=e.slice(),this.dtype=t||"float32",this.strides=c.computeStrides(e),this.dataId=null!=r?r:{},this.id=i.nextId++,this.rankType=this.rank<5?this.rank.toString():"higher",p().registerTensor(this),null!=n&&p().write(this.dataId,n)}return i.make=function(e,t,n){return new i(e,n,t.values,t.dataId)},i.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},i.prototype.asScalar=function(){return this.throwIfDisposed(),l.assert(1===this.size,"The array must have only 1 element."),this.reshape([])},i.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},i.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},i.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},i.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},i.prototype.asType=function(e){return this.throwIfDisposed(),h.cast(this,e)},Object.defineProperty(i.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),i.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];l.assert(e.length===this.rank,"Number of coordinates in get() must match the rank of the tensor"),this.throwIfDisposed(),0===e.length&&(e=[0]);for(var n=e[e.length-1],r=0;r<e.length-1;++r)n+=this.strides[r]*e[r];return this.dataSync()[n]},i.prototype.buffer=function(){return h.buffer(this.shape,this.dtype,this.dataSync())},i.prototype.data=function(){return o(this,void 0,void 0,function(){return s(this,function(e){return this.throwIfDisposed(),[2,p().read(this.dataId)]})})},i.prototype.dataSync=function(){return this.throwIfDisposed(),p().readSync(this.dataId)},i.prototype.dispose=function(){this.isDisposed||(p().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(i.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),i.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},i.prototype.toFloat=function(){return this.asType("float32")},i.prototype.toInt=function(){return this.asType("int32")},i.prototype.toBool=function(){return this.asType("bool")},i.prototype.print=function(e){return void 0===e&&(e=!1),h.print(this,e)},i.prototype.reshape=function(e){return this.throwIfDisposed(),h.reshape(this,e)},i.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},i.prototype.expandDims=function(e){return void 0===e&&(e=0),h.expandDims(this,e)},i.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),h.cumsum(this,e,t,n)},i.prototype.squeeze=function(e){return this.throwIfDisposed(),h.squeeze(this,e)},i.prototype.clone=function(){return this.throwIfDisposed(),h.clone(this)},i.prototype.toString=function(e){void 0===e&&(e=!1);var t=this.dataSync();return u.tensorToString(t,this.shape,this.dtype,e)},i.prototype.tile=function(e){return this.throwIfDisposed(),h.tile(this,e)},i.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),h.gather(this,e,t)},i.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),h.matMul(this,e,t,n)},i.prototype.dot=function(e){return this.throwIfDisposed(),h.dot(this,e)},i.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),h.norm(this,e,t,n)},i.prototype.slice=function(e,t){return this.throwIfDisposed(),h.slice(this,e,t)},i.prototype.reverse=function(e){return this.throwIfDisposed(),h.reverse(this,e)},i.prototype.concat=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),h.concat([this,e],t)},i.prototype.stack=function(e,t){return void 0===t&&(t=0),h.stack([this,e],t)},i.prototype.unstack=function(e,t){return void 0===t&&(t=0),h.unstack(this,t)},i.prototype.pad=function(e,t){return void 0===t&&(t=0),h.pad(this,e,t)},i.prototype.batchNormalization=function(e,t,n,r,i){return void 0===n&&(n=.001),this.throwIfDisposed(),h.batchNormalization(this,e,t,n,r,i)},i.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),h.all(this,e,t)},i.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),h.any(this,e,t)},i.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),h.logSumExp(this,e,t)},i.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),h.sum(this,e,t)},i.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),h.mean(this,e,t)},i.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),h.min(this,e,t)},i.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),h.max(this,e,t)},i.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),h.argMin(this,e)},i.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),h.argMax(this,e)},i.prototype.cast=function(e){return this.throwIfDisposed(),h.cast(this,e)},i.prototype.add=function(e){return this.throwIfDisposed(),h.add(this,e)},i.prototype.addStrict=function(e){return this.throwIfDisposed(),h.addStrict(this,e)},i.prototype.sub=function(e){return this.throwIfDisposed(),h.sub(this,e)},i.prototype.subStrict=function(e){return this.throwIfDisposed(),h.subStrict(this,e)},i.prototype.pow=function(e){return this.throwIfDisposed(),h.pow(this,e)},i.prototype.powStrict=function(e){return this.throwIfDisposed(),h.powStrict(this,e)},i.prototype.mul=function(e){return this.throwIfDisposed(),h.mul(this,e)},i.prototype.mulStrict=function(e){return this.throwIfDisposed(),h.mulStrict(this,e)},i.prototype.div=function(e){return this.throwIfDisposed(),h.div(this,e)},i.prototype.floorDiv=function(e){return this.throwIfDisposed(),h.floorDiv(this,e)},i.prototype.divStrict=function(e){return this.throwIfDisposed(),h.divStrict(this,e)},i.prototype.minimum=function(e){return this.throwIfDisposed(),h.minimum(this,e)},i.prototype.minimumStrict=function(e){return this.throwIfDisposed(),h.minimumStrict(this,e)},i.prototype.maximum=function(e){return this.throwIfDisposed(),h.maximum(this,e)},i.prototype.maximumStrict=function(e){return this.throwIfDisposed(),h.maximumStrict(this,e)},i.prototype.mod=function(e){return this.throwIfDisposed(),h.mod(this,e)},i.prototype.modStrict=function(e){return this.throwIfDisposed(),h.modStrict(this,e)},i.prototype.squaredDifference=function(e){return this.throwIfDisposed(),h.squaredDifference(this,e)},i.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),h.squaredDifferenceStrict(this,e)},i.prototype.transpose=function(e){return this.throwIfDisposed(),h.transpose(this,e)},i.prototype.notEqual=function(e){return this.throwIfDisposed(),h.notEqual(this,e)},i.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),h.notEqualStrict(this,e)},i.prototype.less=function(e){return this.throwIfDisposed(),h.less(this,e)},i.prototype.lessStrict=function(e){return this.throwIfDisposed(),h.lessStrict(this,e)},i.prototype.equal=function(e){return this.throwIfDisposed(),h.equal(this,e)},i.prototype.equalStrict=function(e){return this.throwIfDisposed(),h.equalStrict(this,e)},i.prototype.lessEqual=function(e){return this.throwIfDisposed(),h.lessEqual(this,e)},i.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),h.lessEqualStrict(this,e)},i.prototype.greater=function(e){return this.throwIfDisposed(),h.greater(this,e)},i.prototype.greaterStrict=function(e){return this.throwIfDisposed(),h.greaterStrict(this,e)},i.prototype.greaterEqual=function(e){return this.throwIfDisposed(),h.greaterEqual(this,e)},i.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),h.greaterEqualStrict(this,e)},i.prototype.logicalAnd=function(e){return this.throwIfDisposed(),h.logicalAnd(this,e)},i.prototype.logicalOr=function(e){return this.throwIfDisposed(),h.logicalOr(this,e)},i.prototype.logicalNot=function(){return this.throwIfDisposed(),h.logicalNot(this)},i.prototype.logicalXor=function(e){return this.throwIfDisposed(),h.logicalXor(this,e)},i.prototype.where=function(e,t){return this.throwIfDisposed(),h.where(e,this,t)},i.prototype.neg=function(){return this.throwIfDisposed(),h.neg(this)},i.prototype.ceil=function(){return this.throwIfDisposed(),h.ceil(this)},i.prototype.floor=function(){return this.throwIfDisposed(),h.floor(this)},i.prototype.sign=function(){return this.throwIfDisposed(),h.sign(this)},i.prototype.exp=function(){return this.throwIfDisposed(),h.exp(this)},i.prototype.expm1=function(){return this.throwIfDisposed(),h.expm1(this)},i.prototype.log=function(){return this.throwIfDisposed(),h.log(this)},i.prototype.log1p=function(){return this.throwIfDisposed(),h.log1p(this)},i.prototype.sqrt=function(){return this.throwIfDisposed(),h.sqrt(this)},i.prototype.rsqrt=function(){return this.throwIfDisposed(),h.rsqrt(this)},i.prototype.square=function(){return this.throwIfDisposed(),h.square(this)},i.prototype.reciprocal=function(){return this.throwIfDisposed(),h.reciprocal(this)},i.prototype.abs=function(){return this.throwIfDisposed(),h.abs(this)},i.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),h.clipByValue(this,e,t)},i.prototype.relu=function(){return this.throwIfDisposed(),h.relu(this)},i.prototype.elu=function(){return this.throwIfDisposed(),h.elu(this)},i.prototype.selu=function(){return this.throwIfDisposed(),h.selu(this)},i.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),h.leakyRelu(this,e)},i.prototype.prelu=function(e){return this.throwIfDisposed(),h.prelu(this,e)},i.prototype.sigmoid=function(){return this.throwIfDisposed(),h.sigmoid(this)},i.prototype.logSigmoid=function(){return this.throwIfDisposed(),h.logSigmoid(this)},i.prototype.softplus=function(){return this.throwIfDisposed(),h.softplus(this)},i.prototype.sin=function(){return this.throwIfDisposed(),h.sin(this)},i.prototype.cos=function(){return this.throwIfDisposed(),h.cos(this)},i.prototype.tan=function(){return this.throwIfDisposed(),h.tan(this)},i.prototype.asin=function(){return this.throwIfDisposed(),h.asin(this)},i.prototype.acos=function(){return this.throwIfDisposed(),h.acos(this)},i.prototype.atan=function(){return this.throwIfDisposed(),h.atan(this)},i.prototype.sinh=function(){return this.throwIfDisposed(),h.sinh(this)},i.prototype.cosh=function(){return this.throwIfDisposed(),h.cosh(this)},i.prototype.tanh=function(){return this.throwIfDisposed(),h.tanh(this)},i.prototype.asinh=function(){return this.throwIfDisposed(),h.asinh(this)},i.prototype.acosh=function(){return this.throwIfDisposed(),h.acosh(this)},i.prototype.atanh=function(){return this.throwIfDisposed(),h.atanh(this)},i.prototype.erf=function(){return this.throwIfDisposed(),h.erf(this)},i.prototype.round=function(){return this.throwIfDisposed(),h.round(this)},i.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),h.step(this,e)},i.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),h.softmax(this,e)},i.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),h.image.resizeBilinear(this,e,t)},i.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),h.image.resizeNearestNeighbor(this,e,t)},i.prototype.conv1d=function(e,t,n,r,i,o){return void 0===r&&(r="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),h.conv1d(this,e,t,n,r,i,o)},i.prototype.conv2d=function(e,t,n,r,i,o){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),h.conv2d(this,e,t,n,r,i,o)},i.prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),h.conv2dTranspose(this,e,t,n,r,i)},i.prototype.depthwiseConv2D=function(e,t,n,r,i,o){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),h.depthwiseConv2d(this,e,t,n,r,i,o)},i.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),h.avgPool(this,e,t,n,r)},i.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),h.maxPool(this,e,t,n,r)},i.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),h.localResponseNormalization(this,e,t,n,r)},i.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),d.variable(this,e,t,n)},i.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),h.unsortedSegmentSum(this,e,t)},i.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),h.batchToSpaceND(this,e,t)},i.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),h.spaceToBatchND(this,e,t)},i.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),h.topk(this,e,t)},i.prototype.stridedSlice=function(e,t,n,r,i){return void 0===r&&(r=0),void 0===i&&(i=0),this.throwIfDisposed(),h.stridedSlice(this,e,t,n,r,i)},i.nextId=0,i}();n.Tensor=f,Object.defineProperty(f,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.shape&&null!=e.dtype}});var d=function(i){function o(e,t,n){void 0===t&&(t=!0);var r=i.call(this,e.shape,e.dtype,null,e.dataId)||this;r.trainable=t,r.name=n,null==r.name&&(r.name=o.nextVarId.toString(),o.nextVarId++);try{p().registerVariable(r)}catch(e){throw p().disposeTensor(r),e}return r}return a(o,i),o.variable=function(e,t,n,r){return void 0===t&&(t=!0),null!=r&&r!==e.dtype&&(e=e.asType(r)),new o(e,t,n)},o.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!l.arraysEqual(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");p().disposeTensor(this),this.dataId=e.dataId,p().registerTensor(this)},o.nextVarId=0,o}(f);n.Variable=d,Object.defineProperty(d,Symbol.hasInstance,{value:function(e){return e instanceof f&&null!=e.assign&&e.assign instanceof Function}});var m=d.variable;n.variable=m},{"./tensor_format":181,"./util":187}],181:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var l=e("./util"),b=20,_=3,r=7;function w(e,t){return l.rightPad(parseFloat(e.toFixed(r)).toString(),t)}n.tensorToString=function(e,t,n,r){var i=l.computeStrides(t),o=function(e,t,n){var r=l.sizeFromShape(t),i=n[n.length-1],o=new Array(i).fill(0);if(1<t.length)for(var a=0;a<r/i;a++)for(var s=a*i,u=0;u<i;u++)o[u]=Math.max(o[u],w(e[s+u],0).length);return o}(e,t,i),a=t.length,s=function e(t,n,r,i,o){void 0===o&&(o=!0);var a=n[0],s=n.length;if(0===s)return[t[0].toString()];if(1===s){if(b<a){var u=Array.from(t.subarray(0,_)),l=Array.from(t.subarray(a-_,a));return["["+u.map(function(e,t){return w(e,i[t])}).join(", ")+", ..., "+l.map(function(e,t){return w(e,i[a-_+t])}).join(", ")+"]"]}return["["+Array.from(t).map(function(e,t){return w(e,i[t])}).join(", ")+"]"]}var c=n.slice(1),p=r.slice(1),h=r[0],f=[];if(b<a){for(var d=0;d<_;d++){var m=d*h,y=m+h;f.push.apply(f,e(t.subarray(m,y),c,p,i,!1))}f.push("...");for(var d=a-_;d<a;d++){var m=d*h,y=m+h;f.push.apply(f,e(t.subarray(m,y),c,p,i,d===a-1))}}else for(var d=0;d<a;d++){var m=d*h,y=m+h;f.push.apply(f,e(t.subarray(m,y),c,p,i,d===a-1))}var g=2===s?",":"";f[0]="["+f[0]+g;for(var d=1;d<f.length-1;d++)f[d]=" "+f[d]+g;for(var v=",\n",d=2;d<s;d++)v+="\n";return f[f.length-1]=" "+f[f.length-1]+"]"+(o?"":v),f}(e,t,i,o),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+a),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(e){return"    "+e}).join("\n")),u.join("\n")}},{"./util":187}],182:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=e("./tensor"),r=e("./util");n.assertTypesMatch=function(e,t){r.assert(e.dtype===t.dtype," The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match")},n.isTensorInList=function(e,t){for(var n=0;n<t.length;n++)if(t[n].id===e.id)return!0;return!1},n.flattenNameArrayMap=function(e,t){var n=[];if(e instanceof u.Tensor)n.push(e);else for(var r=e,i=0;i<t.length;i++)n.push(r[t[i]]);return n},n.unflattenToNameArrayMap=function(e,t){if(e.length!==t.length)throw new Error("Cannot unflatten Tensor[], keys and arrays are not of same length.");for(var n={},r=0;r<e.length;r++)n[e[r]]=t[r];return n},n.getTensorsInContainer=function(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof u.Tensor)n.push(t);else if(i=t,Array.isArray(i)||"object"==typeof i){var i,o=t;for(var a in o){var s=o[a];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}},{"./tensor":180,"./util":187}],183:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("./environment"),a=e("./tensor"),s=e("./util");function i(e,t,n,r){if(void 0===r&&(r="float32"),r=r||"float32",e instanceof a.Tensor)return e;if(!s.isTypedArray(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e)throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got "+e.constructor.name);var i=s.inferShape(e);return s.isTypedArray(e)||Array.isArray(e)||(e=[e]),a.Tensor.make(i,{values:s.toTypedArray(e,r,o.ENV.get("DEBUG"))},r)}n.convertToTensor=i,n.convertToTensorArray=function(e,n,r){if(!Array.isArray(e))throw new Error("Argument "+n+" passed to "+r+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(e,t){return i(e,n+"["+t+"]",r)})}},{"./environment":62,"./tensor":180,"./util":187}],184:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var c=e("./environment"),p=e("./tensor"),h=e("./util");function r(e,t,n){if(null==n&&(n=c.ENV.get("TEST_EPSILON")),e instanceof p.Tensor||t instanceof p.Tensor){if(e instanceof p.Tensor&&t instanceof p.Tensor){if(e.dtype!==t.dtype)throw new Error("Arrays are of different type actual: "+e.dtype+" vs expected: "+t.dtype+".");if(!h.arraysEqual(e.shape,t.shape))throw new Error("Arrays are of different shape actual: "+e.shape+" vs expected: "+t.shape+".")}}else{var r=e.constructor.name,i=t.constructor.name;if(r!==i)throw new Error("Arrays are of different type actual: "+r+" vs expected: "+i)}var o,a;if(o=e instanceof p.Tensor?e.dataSync():e,a=t instanceof p.Tensor?t.dataSync():t,o.length!==a.length)throw new Error("Arrays have different lengths actual: "+o.length+" vs expected: "+a.length+".\nActual:   "+o+".\nExpected: "+a+".");for(var s=0;s<a.length;++s){var u=o[s],l=a[s];if(!f(u,Number(l),n))throw new Error("Arrays differ: actual["+s+"] = "+u+", expected["+s+"] = "+l+".\nActual:   "+o+".\nExpected: "+a+".")}}function f(e,t,n){return!(!isNaN(e)||!isNaN(t))||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}n.WEBGL_ENVS={HAS_WEBGL:!0},n.NODE_ENVS={IS_NODE:!0},n.CHROME_ENVS={IS_CHROME:!0},n.BROWSER_ENVS={IS_BROWSER:!0},n.CPU_ENVS={HAS_WEBGL:!1},n.ALL_ENVS={},n.expectArraysClose=r,n.expectPromiseToFail=function(e,t){e().then(function(){return t.fail()},function(){return t()})},n.expectArraysEqual=function(e,t){return r(e,t,0)},n.expectNumbersClose=function(e,t,n){if(null==n&&(n=c.ENV.get("TEST_EPSILON")),!f(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},n.expectValuesInRange=function(e,t,n){var r;r=e instanceof p.Tensor?e.dataSync():e;for(var i=0;i<r.length;i++)if(r[i]<t||r[i]>n)throw new Error("Value out of range:"+r[i]+" low: "+t+", high: "+n)},n.expectArrayBuffersEqual=function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}},{"./environment":62,"./tensor":180,"./util":187}],185:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./optimizers/adadelta_optimizer"),i=e("./optimizers/adagrad_optimizer"),o=e("./optimizers/adam_optimizer"),a=e("./optimizers/adamax_optimizer"),s=e("./optimizers/momentum_optimizer"),u=e("./optimizers/optimizer_constructors"),l=e("./optimizers/rmsprop_optimizer"),c=e("./optimizers/sgd_optimizer");s.MomentumOptimizer,c.SGDOptimizer,r.AdadeltaOptimizer,i.AdagradOptimizer,l.RMSPropOptimizer,a.AdamaxOptimizer,o.AdamOptimizer,n.train={sgd:u.OptimizerConstructors.sgd,momentum:u.OptimizerConstructors.momentum,adadelta:u.OptimizerConstructors.adadelta,adagrad:u.OptimizerConstructors.adagrad,rmsprop:u.OptimizerConstructors.rmsprop,adamax:u.OptimizerConstructors.adamax,adam:u.OptimizerConstructors.adam}},{"./optimizers/adadelta_optimizer":167,"./optimizers/adagrad_optimizer":168,"./optimizers/adam_optimizer":169,"./optimizers/adamax_optimizer":170,"./optimizers/momentum_optimizer":171,"./optimizers/optimizer_constructors":173,"./optimizers/rmsprop_optimizer":175,"./optimizers/sgd_optimizer":176}],186:[function(e,t,n){"use strict";var r,i,o,a,s,u,l,c;Object.defineProperty(n,"__esModule",{value:!0}),(r=n.DType||(n.DType={})).float32="float32",r.int32="int32",r.bool="bool",(i=n.Rank||(n.Rank={})).R0="R0",i.R1="R1",i.R2="R2",i.R3="R3",i.R4="R4",i.R5="R5",i.R6="R6",(a=o||(o={})).float32="float32",a.int32="int32",a.bool="int32",(u=s||(s={})).float32="float32",u.int32="int32",u.bool="bool",(c=l||(l={})).float32="float32",c.int32="float32",c.bool="float32";var p={float32:l,int32:o,bool:s};function h(e,t){return p[e][t]}n.upcastType=h,n.sumOutType=function(e){return h(e,"int32")}},{}],187:[function(e,t,n){(function(t){"use strict";function r(e){for(var t=e.length,n=0,r=0;0<t;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function a(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function o(e,t){if(void 0===t&&(t=[]),Array.isArray(e))for(var n=0;n<e.length;++n)o(e[n],t);else t.push(e);return t}function i(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function s(e,t){if("float32"!==t)for(var n=0;n<e.length;n++)if(isNaN(e[n]))throw Error("NaN is not a valid value for dtype: '"+t+"'.")}function u(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function l(e,t){if(null==t||"float32"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}Object.defineProperty(n,"__esModule",{value:!0}),n.shuffle=r,n.clamp=function(e,t,n){return Math.max(e,Math.min(t,n))},n.randUniform=function(e,t){return Math.random()*(t-e)+e},n.distSquared=function(e,t){for(var n=0,r=0;r<e.length;r++){var i=Number(e[r])-Number(t[r]);n+=i*i}return n},n.assert=a,n.assertShapesMatch=function(e,t,n){void 0===n&&(n=""),a(i(e,t),n+" Shapes "+e+" and "+t+" must match")},n.assertNonNull=function(e){a(null!=e,"The input to the tensor constructor must be a non-null value.")},n.flatten=o,n.inferShape=function(e){var t=e;if(u(e))return[e.length];if(!Array.isArray(e))return[];for(var n=[];t instanceof Array;)n.push(t.length),t=t[0];return e instanceof Array&&function e(t,n,r){if(r=r||[],t instanceof Array){a(0<n.length,function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"}),a(t.length===n[0],function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"});for(var i=n.slice(1),o=0;o<t.length;++o)e(t[o],i,r.concat(o))}else a(0===n.length,function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array of "+n[0]+" elements"})}(e,n,[]),n},n.sizeFromShape=function(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t},n.isScalarShape=function(e){return 0===e.length},n.arraysEqual=i,n.isInt=function(e){return e%1==0},n.tanh=function(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)},n.sizeToSquarishShape=function(e){for(var t=Math.floor(Math.sqrt(e));1<t;--t)if(e%t==0)return[t,e/t];return[1,e]},n.createShuffledIndices=function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return r(t),t},n.rightPad=function(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)},n.repeatedTry=function(o,a,s){return void 0===a&&(a=function(e){return 0}),new Promise(function(t,n){var r=0,i=function(){if(o())t();else{var e=a(++r);null!=s&&s<=r?n():setTimeout(i,e)}};i()})},n.inferFromImplicitShape=function(e,t){for(var n=1,r=-1,i=0;i<e.length;++i)if(0<=e[i])n*=e[i];else if(-1===e[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(e[i]<0)throw Error("Shapes can not be < 0. Found "+e[i]+" at dim "+i);if(-1===r){if(0<t&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var o=e.slice();return o[r]=t/n,o},n.squeezeShape=function(e,t){for(var n=[],r=[],i=0,o=0;o<e.length;++o){if(null!=t){if(t[i]===o&&1!==e[o])throw new Error("Can't squeeze axis "+o+" since its dim '"+e[o]+"' is not 1");(null==t[i]||t[i]>o)&&1===e[o]&&(n.push(e[o]),r.push(o)),t[i]<=o&&i++}1!==e[o]&&(n.push(e[o]),r.push(o))}return{newShape:n,keptDims:r}},n.getTypedArrayFromDType=function(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n},n.checkComputationForNaN=function(e,t,n){if("float32"===t)for(var r=0;r<e.length;r++)if(isNaN(e[r]))throw Error("The result of the '"+n+"' has NaNs.")},n.checkConversionForNaN=s,n.hasEncodingLoss=function(e,t){return!("float32"===t||"int32"===t&&"float32"!==e||"bool"===t&&"bool"===e)},n.isTypedArray=u,n.bytesPerElement=function(e){if("float32"===e||"int32"===e)return 4;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)},n.isFunction=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},n.nearestDivisor=function(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e},n.computeStrides=function(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;0<=r;--r)n[r]=n[r+1]*e[r+1];return n},n.toTypedArray=function(e,t,n){return i=t,(r=e)instanceof Float32Array&&"float32"===i||r instanceof Int32Array&&"int32"===i||r instanceof Uint8Array&&"bool"===i?e:(Array.isArray(e)&&(e=o(e)),function(e,t,n){if(null==t||"float32"===t)return new Float32Array(e);if("int32"===t)return n&&s(e,t),new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),i=0;i<r.length;++i)0!==Math.round(e[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+t)}(e,t,n));var r,i},n.makeOnesTypedArray=function(e,t){for(var n=l(e,t),r=0;r<n.length;r++)n[r]=1;return n},n.makeZerosTypedArray=l,n.now=function(){if("undefined"!=typeof performance)return performance.now();if(void 0!==t){var e=t.hrtime();return 1e3*e[0]+e[1]/1e6}throw new Error("Can not measure time in this environment. You should run tf.js in the browser or in Node.js")}}).call(this,e("_process"))},{_process:246}],188:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.version="0.12.11"},{}],189:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./kernels/webgl/gpgpu_util");n.gpgpu_util=r;var i=e("./kernels/webgl/webgl_util");n.webgl_util=i;var o=e("./kernels/backend_webgl");n.MathBackendWebGL=o.MathBackendWebGL;var a=e("./kernels/webgl/gpgpu_context");n.GPGPUContext=a.GPGPUContext},{"./kernels/backend_webgl":80,"./kernels/webgl/gpgpu_context":97,"./kernels/webgl/gpgpu_util":99,"./kernels/webgl/webgl_util":124}],190:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("@tensorflow/tfjs-core"),s=e("./backend/tfjs_backend"),u=e("./backend/state"),l=e("./utils/generic_utils"),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.getConfig=function(){return{}},t}(a.serialization.Serializable),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e,t){return void 0===t&&(t=1),s.elu(e,t)},t.className="elu",t}(n.Activation=c);n.Elu=p,a.serialization.SerializationMap.register(p);var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return o.selu(e)},t.className="selu",t}(c);n.Selu=h,a.serialization.SerializationMap.register(h);var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return o.relu(e)},t.className="relu",t}(c);n.Relu=f,a.serialization.SerializationMap.register(f);var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return a.tidy(function(){return o.minimum(u.getScalar(6),o.relu(e))})},t.className="relu6",t}(c);n.Relu6=d,a.serialization.SerializationMap.register(d);var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return e},t.className="linear",t}(c);n.Linear=m,a.serialization.SerializationMap.register(m);var y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return o.sigmoid(e)},t.className="sigmoid",t}(c);n.Sigmoid=y,a.serialization.SerializationMap.register(y);var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return s.hardSigmoid(e)},t.className="hardSigmoid",t}(c);n.HardSigmoid=g,a.serialization.SerializationMap.register(g);var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return o.softplus(e)},t.className="softplus",t}(c);n.Softplus=v,a.serialization.SerializationMap.register(v);var b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return s.softsign(e)},t.className="softsign",t}(c);n.Softsign=b,a.serialization.SerializationMap.register(b);var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return o.tanh(e)},t.className="tanh",t}(c);n.Tanh=_,a.serialization.SerializationMap.register(_);var w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e,t){return void 0===t&&(t=-1),o.softmax(e,t)},t.className="softmax",t}(c);function S(e,t){return void 0===t&&(t={}),l.deserializeKerasObject(e,a.serialization.SerializationMap.getMap().classNameMap,t,"activation")}n.Softmax=w,a.serialization.SerializationMap.register(w),n.serializeActivation=function(e){return e.getClassName()},n.deserializeActivation=S,n.getActivation=function(e){return null==e?S({className:"linear",config:{}}):"string"==typeof e?S({className:e,config:{}}):e instanceof c?e:S(e)}},{"./backend/state":192,"./backend/tfjs_backend":193,"./utils/generic_utils":231,"@tensorflow/tfjs-core":66}],191:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=1e-7;n.epsilon=function(){return r},n.setEpsilon=function(e){r=e},n.imageDataFormat=function(){return"channelsLast"}},{}],192:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=0;n.getNextUniqueTensorId=function(){return i++};var o={};n.getUid=function(e){return void 0===e&&(e=""),e in o||(o[e]=0),o[e]+=1,e+o[e].toString()};var a={float32:{},int32:{}};n.getScalar=function(e,t){return void 0===t&&(t="float32"),null==a[t][e]&&(a[t][e]=r.scalar(e,t),r.keep(a[t][e])),a[t][e]},n.disposeScalarCache=function(){for(var e in a)for(var t in a[e])a[e][t].dispose(),delete a[e][t]}},{"@tensorflow/tfjs-core":66}],193:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("@tensorflow/tfjs-core"),s=e("../backend/state"),u=e("../common"),l=e("../errors"),r=e("../utils/math_utils"),c=e("./common"),i="webgl";function p(e,t){void 0===t&&(t=-1);var n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),e.reshape(n)}function h(e,t,n){return a.tidy(function(){switch(e.rank){case 1:return o.slice1d(e,t,n);case 2:return o.slice2d(e,[t,0],[n,e.shape[1]]);case 3:return o.slice3d(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return o.slice4d(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);default:throw new l.ValueError("sliceAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}})}function f(e,t,n){return a.tidy(function(){switch(e.rank){case 1:return o.slice1d(e,t,n);case 2:return o.slice2d(e,[0,t],[e.shape[0],n]);case 3:return o.slice3d(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return o.slice4d(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new l.ValueError("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}})}function d(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new l.ValueError("The length of input n ("+t.length+") does not match the number of dimensions in input x ("+e.rank+")");return o.tile(e,t)}n.setBackend=function(e){o.setBackend(e),i=e,s.disposeScalarCache()},n.getBackend=function(){return i},n.isBackendSymbolic=function(){return!1},n.countParams=function(e){var t=e.shape;return 0<t.length?t.reduce(function(e,t){return e*t}):1},n.cast=function(e,t){return e.asType(t)},n.expandDims=p,n.repeat=function(e,t){return a.tidy(function(){if(2!==e.shape.length)throw new l.ValueError("repeat() expects a rank-2 tensor, but received a rank-"+e.shape.length+" tensor.");return d(p(e,1),[1,t,1])})},n.flatten=function(e){var t=[r.arrayProd(e.shape)];return e.reshape(t)},n.batchFlatten=function(e){if(e.rank<=1)throw new l.ValueError("batchFlatten requires a minimum rank of 2. Got rank: "+e.rank+".");var t=[e.shape[0],r.arrayProd(e.shape,1)];return e.reshape(t)},n.sliceAlongFirstAxis=h,n.sliceAlongLastAxis=f,n.sliceAlongAxis=function(e,t,n,r){return a.tidy(function(){switch(e.rank){case 1:return o.slice1d(e,t,n);case 2:switch(r){case 1:return h(e,t,n);case 2:return f(e,t,n);default:throw new l.ValueError("The axis is not within the rank of the tensor "+r)}case 3:switch(r){case 1:return h(e,t,n);case 2:return o.slice3d(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return f(e,t,n);default:throw new l.ValueError("The axis is not within the rank of the tensor "+r)}case 4:switch(r){case 1:return h(e,t,n);case 2:return o.slice4d(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return o.slice4d(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return f(e,t,n);default:throw new l.ValueError("The axis is not within the rank of the tensor "+r)}default:throw new l.ValueError("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}})},n.concatenate=function(e,t){var n;return void 0===t&&(t=-1),t<0&&(t=0!==(n=e[0].rank)?n:0),t===e[0].rank&&(t=-1),o.concat(e,t)},n.concatAlongFirstAxis=function(e,t){switch(e.rank){case 1:return o.concat1d([e,t]);case 2:return o.concat2d([e,t],0);case 3:return o.concat3d([e,t],0);case 4:return o.concat4d([e,t],0);default:throw new l.ValueError("concatAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}},n.tile=d,n.randomNormal=function(e,t,n,r,i){return void 0===t&&(t=0),void 0===n&&(n=1),o.randomNormal(e,t,n,r,i)},n.dot=function(e,t){if(2!==t.rank)throw new l.NotImplementedError("dot support for y other than rank 2 is not yet implemented: y shape = "+t.shape);if(2===e.rank)return o.matMul(e,t);if(3===e.rank){var n=e.shape[0],r=e.shape[1],i=e.shape[2];return e=e.reshape([n*r,i]),o.matMul(e,t).reshape([n,r,t.shape[1]])}throw new l.NotImplementedError("dot support for x of rank "+e.rank+" is not yet implemented: x shape = "+e.shape)},n.sign=function(n){return a.tidy(function(){var e=a.zerosLike(n),t=a.onesLike(n);return a.where(o.equal(n,e),e,a.where(o.greater(n,a.zerosLike(n)),t,o.mul(s.getScalar(-1),t)))})},n.oneHot=function(e,t){return a.tidy(function(){if(1!==e.rank)throw new Error("Only 1D one-hot tensors are supported in the deeplearn backend, at present.");return e=e.toInt(),o.oneHot(e,t).toFloat()})},n.gather=function(e,t,n){return a.tidy(function(){return t=Array.isArray(t)?a.tensor1d(t,"int32"):t.toInt(),o.gather(e,t,n)})},n.square=function(e){return o.mulStrict(e,e)},n.pow=function(e,t){return a.tidy(function(){if("number"==typeof t&&(t=a.scalar(Math.round(t),"int32")),"int32"!==t.dtype)throw new l.NotImplementedError("Non-int32 dtype ("+t.dtype+") is not supported by pow() yet");return o.pow(e,t)})},n.biasAdd=function(n,r,i){return a.tidy(function(){if(null==i&&(i=c.imageDataFormat()),u.checkDataFormat(i),1!==r.rank&&r.rank!==n.rank)throw new l.ValueError("Unexpected bias dimensions: "+r.rank+"; expected it to be 1 or "+n.rank);var e,t=r.shape;if(5===n.rank)"channelsFirst"===i?e=1===t.length?n.add(r.reshape([1,t[0],1,1,1])):n.add(r.reshape([1,t[3],t[0],t[1],t[2]])):"channelsLast"===i&&(e=1===t.length?n.add(r.reshape([1,1,1,1,t[0]])):n.add(r.reshape([1].concat(t))));else if(4===n.rank)"channelsFirst"===i?e=1===t.length?n.add(r.reshape([1,t[0],1,1])):n.add(r.reshape([1,t[2],t[0],t[1]])):"channelsLast"===i&&(e=1===t.length?n.add(r.reshape([1,1,1,t[0]])):n.add(r.reshape([1].concat(t))));else if(3===n.rank)"channelsFirst"===i?e=1===t.length?n.add(r.reshape([1,t[0],1])):n.add(r.reshape([1,t[1],t[0]])):"channelsLast"===i&&(e=1===t.length?n.add(r.reshape([1,1,t[0]])):n.add(r.reshape([1].concat(t))));else{if(!(n.rank<3))throw new l.ValueError("Unsupported input rank by biasAdd: "+n.rank);e=n.add(r)}return e})},n.elu=function(e,t){if(void 0===t&&(t=1),1!==t)throw new l.NotImplementedError("Support for alpha values other than 1 ("+t+") is not implemented yet.");return o.elu(e)},n.softsign=function(e){return a.tidy(function(){return o.div(e,o.add(s.getScalar(1),o.abs(e)))})},n.dropout=function(t,n,r,i){return a.tidy(function(){if(null!=r&&!a.util.arraysEqual(t.shape,r))throw new l.NotImplementedError("Non-default noise shape is not implemented yet: "+JSON.stringify(r));if(null!=i)throw new l.NotImplementedError("seed is not implemented for dropout yet.");var e=o.step(o.add(o.neg(n),o.randomUniform(t.shape,0,1,"float32")));return e=o.mul(o.div(s.getScalar(1),o.sub(s.getScalar(1),n)),e),o.mul(t,e)})},n.hardSigmoid=function(t){return a.tidy(function(){var e=o.add(s.getScalar(.5),o.mul(s.getScalar(.2),t));return o.clipByValue(e,0,1)})},n.inTrainPhase=function(e,t,n){return void 0===n&&(n=!1),n?e():t()}},{"../backend/state":192,"../common":196,"../errors":203,"../utils/math_utils":233,"./common":191,"@tensorflow/tfjs-core":66}],194:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},c=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var u=e("@tensorflow/tfjs-core"),l=e("./backend/state"),a=e("./logs"),s=e("./utils/generic_utils"),p=function(){function e(){this.validationData=null}return e.prototype.setParams=function(e){this.params=e},e.prototype.onEpochBegin=function(e,t){return o(this,void 0,void 0,function(){return c(this,function(e){return[2]})})},e.prototype.onEpochEnd=function(e,t){return o(this,void 0,void 0,function(){return c(this,function(e){return[2]})})},e.prototype.onBatchBegin=function(e,t){return o(this,void 0,void 0,function(){return c(this,function(e){return[2]})})},e.prototype.onBatchEnd=function(e,t){return o(this,void 0,void 0,function(){return c(this,function(e){return[2]})})},e.prototype.onTrainBegin=function(e){return o(this,void 0,void 0,function(){return c(this,function(e){return[2]})})},e.prototype.onTrainEnd=function(e){return o(this,void 0,void 0,function(){return c(this,function(e){return[2]})})},e.prototype.setModel=function(e){},e}();n.BaseCallback=p;var h=function(){function e(e,t){void 0===t&&(t=10),null==e&&(e=[]),this.callbacks=e,this.queueLength=t}return e.prototype.append=function(e){this.callbacks.push(e)},e.prototype.setParams=function(e){for(var t=0,n=this.callbacks;t<n.length;t++){n[t].setParams(e)}},e.prototype.setModel=function(e){for(var t=0,n=this.callbacks;t<n.length;t++){n[t].setModel(e)}},e.prototype.onEpochBegin=function(r,i){return o(this,void 0,void 0,function(){var t,n;return c(this,function(e){switch(e.label){case 0:null==i&&(i={}),t=0,n=this.callbacks,e.label=1;case 1:return t<n.length?[4,n[t].onEpochBegin(r,i)]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},e.prototype.onEpochEnd=function(r,i){return o(this,void 0,void 0,function(){var t,n;return c(this,function(e){switch(e.label){case 0:null==i&&(i={}),t=0,n=this.callbacks,e.label=1;case 1:return t<n.length?[4,n[t].onEpochEnd(r,i)]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},e.prototype.onBatchBegin=function(r,i){return o(this,void 0,void 0,function(){var t,n;return c(this,function(e){switch(e.label){case 0:null==i&&(i={}),t=0,n=this.callbacks,e.label=1;case 1:return t<n.length?[4,n[t].onBatchBegin(r,i)]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},e.prototype.onBatchEnd=function(r,i){return o(this,void 0,void 0,function(){var t,n;return c(this,function(e){switch(e.label){case 0:null==i&&(i={}),t=0,n=this.callbacks,e.label=1;case 1:return t<n.length?[4,n[t].onBatchEnd(r,i)]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},e.prototype.onTrainBegin=function(r){return o(this,void 0,void 0,function(){var t,n;return c(this,function(e){switch(e.label){case 0:null==r&&(r={}),t=0,n=this.callbacks,e.label=1;case 1:return t<n.length?[4,n[t].onTrainBegin(r)]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},e.prototype.onTrainEnd=function(r){return o(this,void 0,void 0,function(){var t,n;return c(this,function(e){switch(e.label){case 0:null==r&&(r={}),t=0,n=this.callbacks,e.label=1;case 1:return t<n.length?[4,n[t].onTrainEnd(r)]:[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},e}();n.CallbackList=h;var f=function(){function i(e){this.yieldEvery=e,this.batchCount=0,this.batchDurationsMillis=[],this.autoYieldEveryBatches=null,this.batchStartMillis=u.util.now()}return i.prototype.resolveOneTensorInLogs=function(a){return o(this,void 0,void 0,function(){var t,n,r,i,o;return c(this,function(e){switch(e.label){case 0:for(n in t=[],a)t.push(n);r=0,e.label=1;case 1:return r<t.length?(i=t[r],"number"==typeof(o=a[i])?[3,3]:[4,o.data()]):[3,4];case 2:return e.sent(),[3,4];case 3:return r++,[3,1];case 4:return[2]}})})},i.prototype.maybeYieldOnBatch=function(r){return o(this,void 0,void 0,function(){var t,n;return c(this,function(e){switch(e.label){case 0:return"auto"!==this.yieldEvery?[3,7]:(this.batchCount++,null!=this.autoYieldEveryBatches?[3,3]:[4,this.resolveOneTensorInLogs(r)]);case 1:return e.sent(),t=u.util.now(),[4,u.nextFrame()];case 2:return e.sent(),this.batchCount>i.SKIP_FIRST_BATCHES&&(this.batchDurationsMillis.push(t-this.batchStartMillis),this.batchDurationsMillis.length>=i.DECISION_BATCH_COUNT&&(n=this.batchDurationsMillis.reduce(function(e,t){return e+t})/this.batchDurationsMillis.length,this.autoYieldEveryBatches=Math.round(i.THRESHOLD_MILLIS/n),this.autoYieldEveryBatches<1&&(this.autoYieldEveryBatches=1))),this.batchStartMillis=u.util.now(),this.lastYieldBatchCount=this.batchCount,[3,6];case 3:return this.batchCount-this.lastYieldBatchCount>=this.autoYieldEveryBatches?[4,u.nextFrame()]:[3,6];case 4:return e.sent(),[4,this.resolveOneTensorInLogs(r)];case 5:e.sent(),this.lastYieldBatchCount=this.batchCount,e.label=6;case 6:return[3,9];case 7:return"batch"!==this.yieldEvery?[3,9]:[4,u.nextFrame()];case 8:e.sent(),e.label=9;case 9:return[2]}})})},i.prototype.maybeYieldOnEpoch=function(){return o(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return"epoch"!==this.yieldEvery?[3,2]:[4,u.nextFrame()];case 1:e.sent(),e.label=2;case 2:return[2]}})})},i.SKIP_FIRST_BATCHES=1,i.DECISION_BATCH_COUNT=2,i.THRESHOLD_MILLIS=16,i}();n.ModelTrainingYielder=f;var d=function(n){function e(e){var t=n.call(this)||this;return t.yieldEvery=e||"auto",t}return i(e,n),e.prototype.onTrainBegin=function(e){return o(this,void 0,void 0,function(){return c(this,function(e){return this.autoYielder=new f(this.yieldEvery),[2]})})},e.prototype.onEpochBegin=function(e){return o(this,void 0,void 0,function(){return c(this,function(e){return this.seen=0,this.totals={},[2]})})},e.prototype.onBatchEnd=function(e,a){return o(this,void 0,void 0,function(){var r,t,i,n,o=this;return c(this,function(e){switch(e.label){case 0:return[4,this.autoYielder.maybeYieldOnBatch(a)];case 1:for(n in e.sent(),null==a&&(a={}),r=null==a.size?0:a.size,this.seen+=r,t=function(e){var t=a[e];if("number"==typeof t)i.totals.hasOwnProperty(e)||(i.totals[e]=0),i.totals[e]=i.totals[e]+t*r;else{var n=void 0;e in i.totals?n=i.totals[e]:i.totals[e]=l.getScalar(0),i.totals[e]=u.tidy(function(){return u.add(o.totals[e],u.mul(t,l.getScalar(r)))}),null!=n&&n.dispose()}},i=this,a)t(n);return[2]}})})},e.prototype.onEpochEnd=function(e,s){return o(this,void 0,void 0,function(){var t,n,r,i,o,a=this;return c(this,function(e){switch(e.label){case 0:return[4,this.autoYielder.maybeYieldOnEpoch()];case 1:if(e.sent(),null!=s)for(t=function(e){if(null==n.totals[e])return"continue";"number"==typeof n.totals[e]?s[e]=n.totals[e]/n.seen:u.tidy(function(){s[e]=u.mul(u.div(l.getScalar(1),l.getScalar(a.seen)),a.totals[e]),a.totals[e].dispose(),u.keep(s[e])})},r=0,i=(n=this).params.metrics;r<i.length;r++)o=i[r],t(o);return[2]}})})},e}(p);n.BaseLogger=d;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.onTrainBegin=function(e){return o(this,void 0,void 0,function(){return c(this,function(e){return this.epoch=[],this.history={},[2]})})},t.prototype.onEpochEnd=function(n,r){return o(this,void 0,void 0,function(){var t;return c(this,function(e){for(t in null==r&&(r={}),this.epoch.push(n),r)null==this.history[t]&&(this.history[t]=[]),this.history[t].push(r[t]);return[2]})})},t.prototype.syncData=function(){return o(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,l;return c(this,function(e){switch(e.label){case 0:for(i in t=[],n=[],r=[],this.history)for(o=this.history[i],a=0;a<o.length;++a)"number"!=typeof o[a]&&(s=o[a],t.push(s.data()),n.push(i),r.push(a));return[4,Promise.all(t)];case 1:for(u=e.sent(),l=0;l<u.length;++l)this.history[n[l]][r[l]].dispose(),this.history[n[l]][r[l]]=u[l][0];return[2]}})})},t}(p);n.History=m;var y=function(n){function e(e){var t=n.call(this)||this;return t.trainBegin=e.onTrainBegin,t.trainEnd=e.onTrainEnd,t.epochBegin=e.onEpochBegin,t.epochEnd=e.onEpochEnd,t.batchBegin=e.onBatchBegin,t.batchEnd=e.onBatchEnd,t}return i(e,n),e.prototype.onEpochBegin=function(t,n){return o(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return null==this.epochBegin?[3,3]:[4,a.resolveScalarsInLogs(n)];case 1:return e.sent(),[4,this.epochBegin(t,n)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.onEpochEnd=function(t,n){return o(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return null==this.epochEnd?[3,3]:[4,a.resolveScalarsInLogs(n)];case 1:return e.sent(),[4,this.epochEnd(t,n)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.onBatchBegin=function(t,n){return o(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return null==this.batchBegin?[3,3]:[4,a.resolveScalarsInLogs(n)];case 1:return e.sent(),[4,this.batchBegin(t,n)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.onBatchEnd=function(t,n){return o(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return null==this.batchEnd?[3,3]:[4,a.resolveScalarsInLogs(n)];case 1:return e.sent(),[4,this.batchEnd(t,n)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.onTrainBegin=function(t){return o(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return null==this.trainBegin?[3,3]:[4,a.resolveScalarsInLogs(t)];case 1:return e.sent(),[4,this.trainBegin(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.onTrainEnd=function(t){return o(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return null==this.trainEnd?[3,3]:[4,a.resolveScalarsInLogs(t)];case 1:return e.sent(),[4,this.trainEnd(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e}(p);n.CustomCallback=y,n.standardizeCallbacks=function(e){return null==e?null:e instanceof p?[e]:Array.isArray(e)&&e[0]instanceof p?e:s.toList(e).map(function(e){return new y(e)})}},{"./backend/state":192,"./logs":224,"./utils/generic_utils":231,"@tensorflow/tfjs-core":66}],195:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("./base_callbacks"),a=e("./engine/training"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.model=null,e}return i(e,t),e.prototype.setModel=function(e){if(!(e instanceof a.Model))throw new Error("model must be a Model, not some other Container");this.model=e},e}(o.BaseCallback);n.Callback=s},{"./base_callbacks":194,"./engine/training":202}],196:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./utils/generic_utils"),i=new Map;n.VALID_DATA_FORMAT_VALUES=["channelsFirst","channelsLast"],n.checkDataFormat=function(e){r.checkStringTypeUnionValue(n.VALID_DATA_FORMAT_VALUES,"DataFormat",e)},n.VALID_PADDING_MODE_VALUES=["valid","same","causal"],n.checkPaddingMode=function(e){r.checkStringTypeUnionValue(n.VALID_PADDING_MODE_VALUES,"PaddingMode",e)},n.VALID_POOL_MODE_VALUES=["max","avg"],n.checkPoolMode=function(e){r.checkStringTypeUnionValue(n.VALID_POOL_MODE_VALUES,"PoolMode",e)};var o=[],a="/";n.nameScope=function(e,t){o.push(e);try{var n=t();return o.pop(),n}catch(e){throw o.pop(),e}},n.getScopedTensorName=function(e){if(!u(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===o.length?"":o.join(a)+a)+e},n.getUniqueTensorName=function(e){if(!u(e))throw new Error("Not a valid tensor name: '"+e+"'");i.has(e)||i.set(e,0);var t=i.get(e);if(i.set(e,i.get(e)+1),0<t){var n=e+"_"+t;return i.set(n,1),n}return e};var s=new RegExp(/^[A-Za-z][A-Za-z0-9\._\/]*$/);function u(e){return!!e.match(s)}n.isValidTensorName=u},{"./utils/generic_utils":231}],197:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("@tensorflow/tfjs-core"),s=e("./backend/common"),u=e("./backend/state"),l=e("./utils/generic_utils");function c(e,t){return a.tidy(function(){return o.sqrt(o.sum(o.mulStrict(e,e),t,!0))})}var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.getConfig=function(){return{}},t}(a.serialization.Serializable),h=function(n){function e(e){var t=n.call(this)||this;return t.defaultMaxValue=2,t.defaultAxis=0,t.maxValue=null!=e.maxValue?e.maxValue:t.defaultMaxValue,t.axis=null!=e.axis?e.axis:t.defaultAxis,t}return i(e,n),e.prototype.apply=function(n){var r=this;return a.tidy(function(){var e=c(n,r.axis),t=o.clipByValue(e,0,r.maxValue);return o.mul(n,o.div(t,o.add(u.getScalar(s.epsilon()),e)))})},e.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},e.className="MaxNorm",e}(n.Constraint=p);n.MaxNorm=h,a.serialization.SerializationMap.register(h);var f=function(n){function e(e){var t=n.call(this)||this;return t.defaultAxis=0,t.axis=null!=e.axis?e.axis:t.defaultAxis,t}return i(e,n),e.prototype.apply=function(e){var t=this;return a.tidy(function(){return o.div(e,o.add(u.getScalar(s.epsilon()),c(e,t.axis)))})},e.prototype.getConfig=function(){return{axis:this.axis}},e.className="UnitNorm",e}(p);n.UnitNorm=f,a.serialization.SerializationMap.register(f);var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){return o.relu(e)},t.className="NonNeg",t}(p);n.NonNeg=d,a.serialization.SerializationMap.register(d);var m=function(n){function e(e){var t=n.call(this)||this;return t.defaultMinValue=0,t.defaultMaxValue=1,t.defaultRate=1,t.defaultAxis=0,t.minValue=null!=e.minValue?e.minValue:t.defaultMinValue,t.maxValue=null!=e.maxValue?e.maxValue:t.defaultMaxValue,t.rate=null!=e.rate?e.rate:t.defaultRate,t.axis=null!=e.axis?e.axis:t.defaultAxis,t}return i(e,n),e.prototype.apply=function(n){var r=this;return a.tidy(function(){var e=c(n,r.axis),t=o.add(o.mul(u.getScalar(r.rate),o.clipByValue(e,r.minValue,r.maxValue)),o.mul(u.getScalar(1-r.rate),e));return o.mul(n,o.div(t,o.add(u.getScalar(s.epsilon()),e)))})},e.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},e.className="MinMaxNorm",e}(p);function y(e,t){return void 0===t&&(t={}),l.deserializeKerasObject(e,a.serialization.SerializationMap.getMap().classNameMap,t,"constraint")}n.MinMaxNorm=m,a.serialization.SerializationMap.register(m),n.CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"},n.serializeConstraint=function(e){return l.serializeKerasObject(e)},n.deserializeConstraint=y,n.getConstraint=function(e){return null==e?null:"string"==typeof e?y({className:e in n.CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP?n.CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP[e]:e,config:{}}):e instanceof p?e:y(e)}},{"./backend/common":191,"./backend/state":192,"./utils/generic_utils":231,"@tensorflow/tfjs-core":66}],198:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var P=e("@tensorflow/tfjs-core"),oe=e("../backend/state"),ae=e("../errors"),A=e("../layers/serialization"),se=e("../utils/generic_utils"),o=e("../utils/serialization_utils"),N=e("../utils/types_utils"),O=e("../variables"),a=e("../version"),ue=e("./input_layer"),le=e("./topology");function k(e,t,n,r){if(!n.startsWith("2."))throw new ae.ValueError("Unsupported Keras version in weights being loaded: "+n);return t}function s(e,t,n){void 0===n&&(n=!1);for(var r=e.keras_version,i=(e.backend,t.map(function(e){return e.name})),o={},a=0,s=t;a<s.length;a++){null!=(S=s[a]).name&&(null==o[S.name]&&(o[S.name]=[]),o[S.name].push(S))}for(var u,l,c,p,h=e.weights,f=[],d=0;d<i.length;++d){var m=i[d],y=h[m];null==y&&(y=[]);for(var g=[],v=0;v<y.length;++v){var b=y[v];g.push(new O.LayerVariable((u=b.dtype,l=b.shape,c=b.value,void 0,p=se.stringToDType(u),P.Tensor.make(l,{values:0===l.length?c:P.util.flatten(c)},p))))}for(var _=0,w=o[m];_<w.length;_++){var S,x=(S=w[_]).weights;if((g=k(0,g,r)).length!==x.length){if(!n)throw new ae.ValueError("Layer #"+d+' (named "'+S.name+'") expects '+x.length+" weight(s), but the saved weights have "+g.length+" element(s).");console.warn("Skipping loading of weights of layer "+S.name+" due to mismatch in number of weights: ("+g.length+" vs "+x.length+").")}for(var T=0;T<g.length;++T)!n||P.util.arraysEqual(x[T].shape,g[T].shape)?f.push([x[T],g[T].read()]):console.warn("Skipping loading of weights for layer "+S.name+" due to mismatch in shape ("+x[T].shape+" vs "+g[T].shape+")")}}O.batchSetValue(f)}function u(e,t,n){void 0===n&&(n=!0);for(var r={},i=0,o=0,a=t;o<a.length;o++)for(var s=0,u=a[o].weights;s<u.length;s++){var l=u[s];if(null!=r[l.originalName])throw new ae.ValueError("Duplicate weight name: "+l.originalName);r[l.originalName]=l,i++}var c=[];for(var p in e){if(null!=r[p])c.push([r[p],e[p]]);else if(n)throw new ae.ValueError("Provided weight data has no target variable: "+p);delete r[p]}if(n){var h=[];for(var f in r)h.push(f);if(0<h.length)throw new ae.ValueError(h.length+" of "+i+" weights are not set: "+h)}O.batchSetValue(c)}n.loadWeightsFromJson=s,n.loadWeightsFromNamedTensorMap=u;var l=function(re){function ie(e){var f=re.call(this,{})||this;if(f.containerNodes=new Set,f.name=e.name,null==f.name){var t=f.getClassName().toLowerCase();f.name=oe.getUid(t)}if(f.supportsMasking=!1,f.trainable=!0,f.updatable=!0,Array.isArray(e.inputs)?f.inputs=e.inputs.slice():f.inputs=[e.inputs],Array.isArray(e.outputs)?f.outputs=e.outputs.slice():f.outputs=[e.outputs],se.unique(f.inputs).length!==f.inputs.length)throw new ae.ValueError("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+f.inputs.map(function(e){return e.name}));se.unique(f.outputs).length!==f.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+f.outputs.map(function(e){return e.name})),f.inputLayers=[],f.inputLayersNodeIndices=[],f.inputLayersTensorIndices=[],f.outputLayers=[],f.outputLayersNodeIndices=[],f.outputLayersTensorIndices=[],f.layers=[];for(var n=0,r=f.outputs;n<r.length;n++){var i=(T=r[n]).sourceLayer,o=T.nodeIndex,a=T.tensorIndex;f.outputLayers.push(i),f.outputLayersNodeIndices.push(o),f.outputLayersTensorIndices.push(a)}for(var s=0,u=f.inputs;s<u.length;s++){i=(T=u[s]).sourceLayer,o=T.nodeIndex,a=T.tensorIndex;se.assert(0===o,"input layer has >1 nodes"),se.assert(0===a,"input layer has >1 tensors"),f.inputLayers.push(i),f.inputLayersNodeIndices.push(o),f.inputLayersTensorIndices.push(a)}f.inputNames=[],f.outputNames=[],f.feedInputShapes=[],f.feedInputNames=[],f.feedOutputNames=[];for(var l=0;l<f.inputLayers.length;l++){if(!((i=f.inputLayers[l])instanceof ue.InputLayer))throw new TypeError("Input layers to a Model must be InputLayer objects. Received inputs: "+e.inputs+". Input "+l+" (0-based) originates from layer type "+i.getClassName()+".");f.inputNames.push(i.name),f.feedInputShapes.push(i.batchInputShape),f.feedInputNames.push(i.name)}for(var c=0,p=f.outputLayers;c<p.length;c++){i=p[c];f.outputNames.push(i.name)}f.internalInputShapes=f.inputs.map(function(e){return e.shape}),f.internalOutputShapes=f.outputs.map(function(e){return e.shape});for(var h={},d={},m={},y={},g={},v=[],b=function(e,t,n,r,i,o){null!=r&&null!=i&&null!=o||(r=e.sourceLayer,i=e.nodeIndex,o=e.tensorIndex);var a=r.inboundNodes[i];if(-1!==n.indexOf(a))throw new ae.RuntimeError("The tensor "+e.name+' at layer "'+r.name+'" is part of a cycle.');if(-1===t.indexOf(a)){f.containerNodes.add(ie.nodeKey(r,i)),r.id in g||(g[r.id]=Object.keys(g).length),-1===n.indexOf(a)&&n.push(a);for(var s=a.inboundLayers.length,u=0;u<s;u++){var l=a.inputTensors[u],c=a.inboundLayers[u],p=a.nodeIndices[u],h=a.tensorIndices[u];b(l,t,n,c,p,h)}for(t.push(a);0<=n.indexOf(a);)n.splice(n.indexOf(a),1);v.push(a)}},_=[],w=[],S=0,x=f.outputs;S<x.length;S++){var T=x[S];b(T,_,w)}for(var P=0,N=v.slice().reverse();P<N.length;P++){(d[(K=N[P]).id]=K).id in h||(h[K.id]=0);var A=h[K.id],O=null==m[K.outboundLayer.id]?0:m[K.outboundLayer.id];A=Math.max(A,O),m[K.outboundLayer.id]=A,y[K.outboundLayer.id]=K.outboundLayer,h[K.id]=A;for(l=0;l<K.inboundLayers.length;l++){var k=K.inboundLayers[l],E=(o=K.nodeIndices[l],k.inboundNodes[o]),I=null==h[E.id]?0:h[E.id];h[E.id]=Math.max(A+1,I),d[E.id]=E}}var M={};for(var C in h){(A=h[C])in M||(M[A]=[]),M[A].push(d[C])}var R={};for(var z in m){(A=m[z])in R||(R[A]=[]),R[A].push(y[z])}var D=Object.keys(R).map(function(e){return parseInt(e,10)}).sort(se.reverseNumberCompare);f.layers=[];for(var L=0,F=D;L<F.length;L++){var q=R[A=F[L]];q.sort(function(e,t){var n=g[e.id],r=g[t.id];return n<r?-1:r<n?1:0});for(var V=0,j=q;V<j.length;V++){i=j[V];f.layers.push(i)}}f.layersByDepth=R,D=Object.keys(M).map(function(e){return parseInt(e,10)}).sort(se.reverseNumberCompare);for(var B=f.inputs.slice(),U=[],G=0,W=D;G<W.length;G++)for(var H=0,Q=M[A=W[G]];H<Q.length;H++){var K;if(null!=(i=(K=Q[H]).outboundLayer)){for(var $=0,X=K.inputTensors;$<X.length;$++){T=X[$];if(-1===B.indexOf(T))throw new ae.RuntimeError("Graph disconnected: cannot obtain value for tensor "+T+' at layer "'+i.name+'". The following previous layers were accessed without issue: '+U)}for(var Y=0,J=K.outputTensors;Y<J.length;Y++){T=J[Y];B.push(T)}U.push(i.name)}}f.nodesByDepth=M;for(var Z=f.layers.map(function(e){return e.name}),ee=function(t){var e=Z.filter(function(e){return e===t}).length;if(1!==e)throw new ae.RuntimeError('The name "'+t+'" is used '+e+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(Z))},te=0,ne=Z;te<ne.length;te++){ee(ne[te])}return f.outboundNodes=[],f.inboundNodes=[],new le.Node({outboundLayer:f,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:f.inputs,outputTensors:f.outputs,inputMasks:f.inputs.map(function(e){return null}),outputMasks:f.outputs.map(function(e){return null}),inputShapes:f.inputs.map(function(e){return e.shape}),outputShapes:f.outputs.map(function(e){return e.shape})}),f.built=!0,f._refCount=1,f}return i(ie,re),ie.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Container '"+this.name+"' is already disposed.")},ie.prototype.dispose=function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount)for(var t=0,n=this.layers;t<n.length;t++){var r=n[t];e.numDisposedVariables+=r.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e},Object.defineProperty(ie.prototype,"trainableWeights",{get:function(){if(0<this._trainableWeights.length)throw new ae.ValueError("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var e=[],t=0,n=this.layers;t<n.length;t++){var r=n[t];e=e.concat(r.trainableWeights)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(ie.prototype,"nonTrainableWeights",{get:function(){for(var e=[],t=0,n=this.layers;t<n.length;t++){var r=n[t];e.push.apply(e,r.nonTrainableWeights)}if(!this.trainable){for(var i=[],o=0,a=this.layers;o<a.length;o++){r=a[o];i.push.apply(i,r.trainableWeights)}return i.concat(e)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(ie.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),ie.prototype.loadWeights=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===r&&(r=!0),n?u(e,this.layers,r):s(e,this.layers,t)},ie.prototype.updatedConfig=function(){var e=this.getConfig();return{className:this.getClassName(),config:e,kerasVersion:"tfjs-layers "+a.version,backend:"TensorFlow.js"}},ie.prototype.toJSON=function(e,t){void 0===t&&(t=!0);var n=o.convertTsToPythonic(this.updatedConfig());return t?JSON.stringify(n):n},ie.prototype.call=function(t,n){var r=this;return P.tidy(function(){var e;return t=se.toList(t),e="mask"in n?se.toList(n.mask):se.pyListRepeat(null,t.length),r.runInternalGraph(t,e)[0]})},ie.prototype.computeMask=function(t,n){var r=this;return P.tidy(function(){var e;return t=se.toList(t),e=null==n?se.pyListRepeat(null,t.length):se.toList(n),r.runInternalGraph(t,e)[1]})},ie.prototype.computeOutputShape=function(e){var t=N.normalizeShapeList(e);if(t.length!==this.inputLayers.length)throw new ae.ValueError("Invalid inputShape argument "+e+": model has "+this.inputLayers.length+" tensor inputs.");for(var n={},r=0;r<t.length;r++){var i=this.inputLayers[r],o=t[r];n[T=i.name+"_0_0"]=o}var a=Object.keys(this.nodesByDepth).map(function(e){return parseInt(e,10)}).sort(se.reverseNumberCompare);if(1<a.length)for(var s=0,u=a;s<u.length;s++)for(var l=u[s],c=0,p=this.nodesByDepth[l];c<p.length;c++){var h=p[c];i=h.outboundLayer;if(-1===this.inputLayers.map(function(e){return e.id}).indexOf(i.id)){for(var f=[],d=0;d<h.inboundLayers.length;d++){var m=h.inboundLayers[d],y=h.nodeIndices[d],g=h.tensorIndices[d],v=n[T=m.name+"_"+y+"_"+g];f.push(v)}var b=i.computeOutputShape(se.singletonOrArray(f)),_=N.normalizeShapeList(b),w=i.inboundNodes.indexOf(h);for(d=0;d<_.length;d++){n[T=i.name+"_"+w+"_"+d]=_[d]}}}var S=[],x=[];for(r=0;r<this.outputLayers.length;r++){i=this.outputLayers[r],w=this.outputLayersNodeIndices[r],g=this.outputLayersTensorIndices[r];var T=i.name+"_"+w+"_"+g;x.push(T)}for(r=0;r<x.length;r++){var P=x[r];se.assert(P in n),S.push(n[P])}return se.singletonOrArray(S)},ie.prototype.runInternalGraph=function(e,t){null==t&&(t=se.pyListRepeat(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var i=this.inputs[r],o=e[r],a=t[r];n[i.id]=[o,a]}for(var s=0,u=Object.keys(this.nodesByDepth).map(function(e){return parseInt(e,10)}).sort(se.reverseNumberCompare);s<u.length;s++)for(var l=u[s],c=0,p=this.nodesByDepth[l];c<p.length;c++){for(var h=p[c],f=h.outboundLayer,d=h.inputTensors,m=h.outputTensors,y=new Array,g=0,v=d;g<v.length;g++){(i=v[g]).id in n&&y.push(n[i.id])}if(y.length===d.length){var b={},_=void 0,w=void 0,S=void 0,x=void 0;if(null!=h.callArgs&&(b=h.callArgs),1===y.length){var T=y[0],P=T[0],N=T[1];null==b.mask&&(b.mask=N),S=se.toList(f.call(P,b)),x=se.toList(f.computeMask(P,N)),_=[P],w=[N]}else _=y.map(function(e){return e[0]}),w=y.map(function(e){return e[1]}),null==b.mask&&(b.mask=w),S=se.toList(f.call(_,b)),x=se.toList(f.computeMask(_,w));if(f.activityRegularizer)throw new ae.NotImplementedError("Model invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(r=0;r<m.length;++r){i=m[r],o=S[r],a=x[r];n[i.id]=[o,a]}}}for(var A=[],O=[],k=[],E=0,I=this.outputs;E<I.length;E++){i=I[E];se.assert(i.id in n,"Could not compute output "+i.name+" : "+i.id);var M=n[i.id],C=M[0];a=M[1];k.push(C.shape),A.push(C),O.push(a)}return[A,O,k]},ie.prototype.buildNodeConversionMap=function(e){for(var t,n={},r=0,i=this.layers;r<i.length;r++){var o=i[r];t=o instanceof ie?1:0;for(var a=0;a<o.inboundNodes.length;a++){var s=ie.nodeKey(o,a);s in this.containerNodes&&(n[s]=t,t+=1)}}return n},ie.prototype.getLayer=function(e,t){if(null!=t){if(this.layers.length<=t)throw new ae.ValueError("Was asked to retrieve layer at index "+t+", but model only has "+this.layers.length+" layer(s).");return this.layers[t]}if(null==e)throw new ae.ValueError("Provide either a layer name or layer index");for(var n=0,r=this.layers;n<r.length;n++){var i=r[n];if(i.name===e)return i}throw new ae.ValueError("No such layer: "+e)},ie.prototype.calculateLosses=function(){var a=this;return P.tidy(function(){for(var e=[],t=0,n=a.layers;t<n.length;t++)for(var r=n[t],i=0;i<r.inboundNodes.length;++i){var o=ie.nodeKey(r,i);a.containerNodes.has(o)&&e.push.apply(e,r.calculateLosses())}return e})},ie.prototype.getConfig=function(){for(var e={name:this.name},t=this.buildNodeConversionMap(this.layers),n=[],r=0,i=this.layers;r<i.length;r++){for(var o=(v=i[r]).getClassName(),a=v.getConfig(),s=[],u=0;u<v.inboundNodes.length;u++){var l=v.inboundNodes[u],c=ie.nodeKey(v,u),p={};if(this.containerNodes.has(c)){if(l.callArgs)try{JSON.stringify(l.callArgs),p=l.callArgs}catch(e){console.warn("Layer "+v.name+" was passed non-serializable keyword arguments: "+l.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),p={}}if(0<l.inboundLayers.length){for(var h=[],f=0;f<l.inboundLayers.length;f++){var d=l.inboundLayers[f],m=l.nodeIndices[f],y=l.tensorIndices[f];null==(_=t[ie.nodeKey(d,m)])&&(_=0),h.push([d.name,_,y,p])}s.push(h)}}}n.push({name:v.name,className:o,config:a,inboundNodes:s})}e.layers=n;var g=[];for(f=0;f<this.inputLayers.length;f++){var v=this.inputLayers[f];m=this.inputLayersNodeIndices[f],c=ie.nodeKey(v,m);if(this.containerNodes.has(c)){null==(_=t[c])&&(_=0);y=this.inputLayersTensorIndices[f];g.push([v.name,_,y])}}e.inputLayers=g;var b=[];for(f=0;f<this.outputLayers.length;f++){v=this.outputLayers[f],m=this.outputLayersNodeIndices[f],c=ie.nodeKey(v,m);if(this.containerNodes.has(c)){var _;null==(_=t[c])&&(_=0);y=this.outputLayersTensorIndices[f];b.push([v.name,_,y])}}return e.outputLayers=b,e},ie.fromConfig=function(e,a){var h={},n={};function f(e,t){e.name in n?n[e.name].push(t):n[e.name]=[t]}function t(e,t){for(var n,r=[],i=0,o=t;i<o.length;i++){var a=o[i],s=a[0],u=a[1],l=a[2];if(3===a.length)n={};else{if(4!==a.length)throw new ae.ValueError("Improperly formatted model config for layer "+JSON.stringify(e)+": "+JSON.stringify(a));n=a[3]}if(!(s in h))return void f(e,t);var c=h[s];if(c.inboundNodes.length<=u)return void f(e,t);var p=c.inboundNodes[u];r.push(p.outputTensors[l])}0<r.length&&e.apply(se.singletonOrArray(r),n)}function r(e){var t=e.name,n=A.deserialize(e,null!=a.customObjects?a.customObjects:{});h[t]=n;for(var r=0,i=e.inboundNodes;r<i.length;r++){var o=i[r];if(!(o instanceof Array))throw new ae.ValueError("Corrupted configuration, expected array for nodeData: "+o);f(n,o)}}for(var i=a.name,o=a.layers,s=0,u=o;s<u.length;s++){r(p=u[s])}for(;!se.isObjectEmpty(n);)for(var l=0,c=o;l<c.length;l++){var p=c[l];if((N=h[p.name]).name in n){for(var d=0,m=n[N.name];d<m.length;d++){t(N,m[d])}delete n[N.name]}}for(var y=[],g=[],v=0,b=a.inputLayers;v<b.length;v++){var _=(p=b[v])[0],w=p[1],S=p[2];se.assert(_ in h);var x=(N=h[_]).inboundNodes[w].outputTensors;y.push(x[S])}for(var T=0,P=a.outputLayers;T<P.length;T++){_=(p=P[T])[0],w=p[1],S=p[2];se.assert(_ in h);var N;x=(N=h[_]).inboundNodes[w].outputTensors;g.push(x[S])}return new e({inputs:y,outputs:g,name:i})},Object.defineProperty(ie.prototype,"stateful",{get:function(){if(this._stateful)throw new ae.ValueError("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var e=0,t=this.layers;e<t.length;e++){if(t[e].stateful)return!0}return!1},enumerable:!0,configurable:!0}),ie}(le.Layer);n.Container=l},{"../backend/state":192,"../errors":203,"../layers/serialization":222,"../utils/generic_utils":231,"../utils/serialization_utils":234,"../utils/types_utils":235,"../variables":237,"../version":238,"./input_layer":200,"./topology":201,"@tensorflow/tfjs-core":66}],199:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),p=e("../errors"),h=e("./input_layer");var c=function(){function o(e){if(this.id2Value={},e instanceof o)for(var t in e.id2Value)this.id2Value[t]=e.id2Value[t];else{if(null==e)return;for(var n=0,r=e;n<r.length;n++){var i=r[n];this.add(i.key,i.value)}}}return o.prototype.add=function(e,t){if(null!=this.id2Value[e.id])throw new p.ValueError("Duplicate key: name="+e.name+", id="+e.id);return this.id2Value[e.id]=function(t,n){if(null!=t.shape){if(t.shape.length!==n.shape.length)throw new p.ValueError("The rank of feed ("+n.shape.length+") does not match the rank of the key ("+t.shape.length+").");for(var e=0;e<t.shape.length;++e)if(null!=t.shape[e]&&t.shape[e]!==n.shape[e])throw new p.ValueError("The "+e+"-th dimension of the feed ("+n.shape[e]+") is incompatible with that of the key ("+t.shape[e]+").")}if(null==t.dtype||t.dtype===n.dtype)return n;try{return r.cast(n,t.dtype)}catch(e){throw new p.ValueError("The dtype of the feed ("+n.dtype+") can not be cast to the dtype of the key '"+t.name+"' ("+t.dtype+").")}}(e,t),this},o.prototype.addFeed=function(e){this.add(e.key,e.value)},o.prototype.hasKey=function(e){return null!=this.id2Value[e.id]},o.prototype.getValue=function(e){if(null==this.id2Value[e.id])throw new p.ValueError("Nonexistent key: "+JSON.stringify(e));return this.id2Value[e.id]},o}();function f(e,t,n){if(t.hasKey(e))return t.getValue(e);if(e.sourceLayer instanceof h.InputLayer)throw new p.ValueError("Missing a feed value for SymbolicTensor from InputLayer '"+h.InputLayer.name+"'");for(var r=[],i=0,o=e.inputs;i<o.length;i++){var a=f(o[i],t,n);r.push(a)}var s=e.sourceLayer.apply(r,n);Array.isArray(s)||(s=[s]);for(var u=function(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r)for(var i=0,o=e.sourceLayer.inboundNodes[r].outputTensors;i<o.length;i++){var a=o[i];if(a.id===e.id){n=r;break}}t=e.sourceLayer.getOutputAt(n)}return t}(e),l=Array.isArray(u)?u:[u],c=0;c<l.length;++c)t.add(l[c],s[c]);return 1===s.length?s[0]:s[e.outputTensorIndex]}n.FeedDict=c,n.execute=function(e,t,n){for(var r=Array.isArray(e),i=r?e:[e],o=[],a=new c(t),s=0,u=i;s<u.length;s++){var l=u[s];o.push(f(l,a,n))}return r?o:o[0]}},{"../errors":203,"./input_layer":200,"@tensorflow/tfjs-core":66}],200:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("../backend/state"),s=e("../errors"),u=e("./topology"),l=function(o){function e(e){var t=o.call(this,{dtype:e.dtype,name:null!=e.name?e.name:a.getUid("input").toString()})||this;if(null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),t.trainable=!1,t.built=!0,t.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new s.ValueError("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var n=e.batchInputShape;if(null==n){if(null==e.inputShape)throw new s.ValueError("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new s.ValueError("Cannot specify batchSize if batchInputShape isspecified when creating an InputLayer.");var r=e.dtype||"float32";t.batchInputShape=n,t.dtype=r,t.inputSpec=[{shape:n}];var i=new u.SymbolicTensor(t.dtype,t.batchInputShape,t,[],{},t.name);return i.nodeIndex=0,i.tensorIndex=0,new u.Node({outboundLayer:t,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]}),t}return i(e,o),e.prototype.apply=function(e,t){throw new s.ValueError("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},e.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e.className="InputLayer",e}(u.Layer);n.InputLayer=l,o.serialization.SerializationMap.register(l),n.Input=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new s.ValueError("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new l({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}},{"../backend/state":192,"../errors":203,"./topology":201,"@tensorflow/tfjs-core":66}],201:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var l=e("@tensorflow/tfjs-core"),u=e("../backend/state"),c=e("../common"),y=e("../errors"),g=e("../utils/generic_utils"),m=e("../utils/types_utils"),o=e("../utils/variable_utils"),p=e("../variables"),a=function(e){this.dtype=e.dtype,this.shape=e.shape,null!=e.shape?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}};n.InputSpec=a;var v=function(e,t,n,r,i,o,a){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=u.getNextUniqueTensorId(),null!=o&&(this.originalName=c.getScopedTensorName(o),this.name=c.getUniqueTensorName(this.originalName)),this.rank=t.length};n.SymbolicTensor=v;var s=0,b=function(){function e(e,t){this.callArgs=t,this.id=s++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(var n=0,r=e.inboundLayers;n<r.length;n++){var i=r[n];null!=i&&i.outboundNodes.push(this)}e.outboundLayer.inboundNodes.push(this)}return e.prototype.getConfig=function(){for(var e=[],t=0,n=this.inboundLayers;t<n.length;t++){var r=n[t];null!=r?e.push(r.name):e.push(null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},e}();n.Node=b;var h=0,f=function(s){function e(e){var t=s.call(this)||this;t._callHook=null,t._addedWeightNames=[],t._stateful=!1,t.id=h++,t.activityRegularizer=null,t.inputSpec=null,t.supportsMasking=!1,t._trainableWeights=[],t._nonTrainableWeights=[],t._losses=[],t._updates=[],t._built=!1,t.inboundNodes=[],t.outboundNodes=[];var n=e.name;if(!n){var r=t.getClassName();n=g.toSnakeCase(r)+"_"+u.getUid(r)}if(t.name=n,t.trainable=null==e.trainable||e.trainable,t.updatable=null==e.updatable||e.updatable,null!=e.inputShape||null!=e.batchInputShape){var i=void 0;if(null!=e.batchInputShape)i=e.batchInputShape;else if(null!=e.inputShape){var o=null;null!=e.batchSize&&(o=e.batchSize),i=[o].concat(e.inputShape)}t.batchInputShape=i;var a=e.dtype;null==a&&(a=e.inputDType),null==a&&(a="float32"),t.dtype=a}return null!=e.weights?t.initialWeights=e.weights:t.initialWeights=null,t._refCount=null,t}return i(e,s),e.nodeKey=function(e,t){return e.name+"_ib-"+t.toString()},e.prototype.getNodeAtIndex=function(e,t){if(0===this.inboundNodes.length)throw new y.RuntimeError("The layer has never been called and thus has no defined "+t+".");if(this.inboundNodes.length<=e)throw new y.ValueError("Asked to get "+t+" at node "+e+", but the layer has only "+this.inboundNodes.length+" inbound nodes.");return this.inboundNodes[e]},e.prototype.getInputAt=function(e){return g.singletonOrArray(this.getNodeAtIndex(e,"input").inputTensors)},e.prototype.getOutputAt=function(e){return g.singletonOrArray(this.getNodeAtIndex(e,"output").outputTensors)},Object.defineProperty(e.prototype,"input",{get:function(){if(1<this.inboundNodes.length)throw new y.AttributeError("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new y.AttributeError("Layer "+this.name+" is not connected, no input to return.");return g.singletonOrArray(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){if(0===this.inboundNodes.length)throw new y.AttributeError("Layer "+this.name+" has no inbound nodes.");if(1<this.inboundNodes.length)throw new y.AttributeError("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return g.singletonOrArray(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),e.prototype.calculateLosses=function(){return this.losses.map(function(e){return e()})},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"built",{get:function(){return this._built},set:function(e){this._built=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this._trainableWeights:[]},set:function(e){this._trainableWeights=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._nonTrainableWeights:this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),e.prototype.assertInputCompatibility=function(e){if(e=g.toList(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=g.toList(this.inputSpec);if(e.length!==t.length)throw new y.ValueError("Layer "+this.name+" expects "+t.length+" inputs, but it received "+e.length+" input tensors. Input received: "+e);for(var n=0;n<e.length;n++){var r=e[n],i=t[n];if(null!=i){var o=r.rank;if(null!=i.ndim&&o!==i.ndim)throw new y.ValueError("Input "+n+" is incompatible with layer "+this.name+": expected ndim="+i.ndim+", found ndim="+o);if(null!=i.maxNDim&&o>i.maxNDim)throw new y.ValueError("Input "+n+" is incompatible with layer "+this.name+": expected max_ndim="+i.maxNDim+", found ndim="+o);if(null!=i.minNDim&&o<i.minNDim)throw new y.ValueError("Input "+n+" is incompatible with layer "+this.name+": expected min_ndim="+i.minNDim+", found ndim="+o+".");if(null!=i.dtype&&r.dtype!==i.dtype)throw new y.ValueError("Input "+n+" is incompatible with layer "+this.name+" : expected dtype="+i.dtype+", found dtype="+r.dtype+".");if(i.axes){var a=r.shape;for(var s in i.axes){var u=Number(s),l=i.axes[s],c=0<=u?a[u]:a[a.length+u];if(null!=l&&-1===[l,null].indexOf(c))throw new y.ValueError("Input "+n+" is incompatible with layer "+this.name+": expected axis "+u+" of input shape to have value "+l+" but got shape "+a+".")}}if(null!=i.shape)for(var p=0;p<i.shape.length;++p){var h=i.shape[p],f=r.shape[p];if(null!=h&&null!=f&&h!==f)throw new y.ValueError("Input "+n+" is incompatible with layer "+this.name+": expected shape="+i.shape+", found shape=${xShape}.")}}}}},e.prototype.call=function(e,t){return e},e.prototype.invokeCallHook=function(e,t){null!=this._callHook&&this._callHook(e,t)},e.prototype.setCallHook=function(e){this._callHook=e},e.prototype.clearCallHook=function(){this._callHook=null},e.prototype.apply=function(p,h){var f=this;h=h||{},this.assertNotDisposed();for(var d=g.toList(p),e=!0,t=0,n=d;t<n.length;t++){if(!(n[t]instanceof v)){e=!1;break}}for(var m=!0,r=0,i=d;r<i.length;r++){if(i[r]instanceof v){m=!1;break}}if(e===m)throw new y.ValueError("Arguments to apply() must be all SymbolicTensors or all Tensors");return c.nameScope(this.name,function(){if(!f.built){f.assertInputCompatibility(p);for(var e=[],t=0,n=g.toList(p);t<n.length;t++){var r=n[t];e.push(r.shape)}f.build(g.singletonOrArray(e)),f.built=!0,f.initialWeights&&f.setWeights(f.initialWeights),null===f._refCount&&m&&(f._refCount=1)}if(f.assertInputCompatibility(p),m){for(var i=f.call(p,h),o=[],a=0,s=g.toList(i);a<s.length;a++){var u=s[a];-1!==d.indexOf(u)&&(u=u.clone()),o.push(u)}if(i=g.singletonOrArray(o),null!=f.activityRegularizer)throw new y.NotImplementedError("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}var l=function(e){e=g.toList(e);for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];t.push(i.shape)}return g.singletonOrArray(t)}(p),c=f.computeOutputShape(l);i=void 0;if(f.warnOnIncompatibleInputShape(Array.isArray(p)?l[0]:l),i=null!=c&&0<c.length&&Array.isArray(c[0])?c.map(function(e,t){return new v("float32",e,f,g.toList(p),h,f.name,t)}):new v("float32",c,f,g.toList(p),h,f.name),f.addInboundNode(p,i,null,null,l,c,h),f._refCount++,null!=f.activityRegularizer)throw new y.NotImplementedError("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i})},e.prototype.warnOnIncompatibleInputShape=function(n){if(null!=this.batchInputShape)if(n.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(n)+") does not match that of the batchInputShape ("+JSON.stringify(this.batchInputShape)+") of the layer "+this.name);else{var r=!1;this.batchInputShape.forEach(function(e,t){null!=e&&null!=n[t]&&n[t]!==e&&(r=!0)}),r&&console.warn("The shape of the input tensor ("+JSON.stringify(n)+") does not match the expectation of layer "+this.name+": "+JSON.stringify(this.batchInputShape))}},Object.defineProperty(e.prototype,"outputShape",{get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new y.AttributeError("The layer "+this.name+" has never been called and thus has no defined output shape.");for(var e=[],t=0,n=this.inboundNodes;t<n.length;t++){var r=n[t],i=JSON.stringify(r.outputShapes);-1===e.indexOf(i)&&e.push(i)}if(1===e.length){var o=this.inboundNodes[0].outputShapes;return Array.isArray(o)&&Array.isArray(o[0])&&1===o.length?o[0]:o}throw new y.AttributeError("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),e.prototype.countParams=function(){if(!this.built)throw new y.RuntimeError("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return o.countParamsInWeights(this.weights)},e.prototype.build=function(e){this.built=!0},e.prototype.getWeights=function(e){return void 0===e&&(e=!1),p.batchGetValue(e?this.trainableWeights:this.weights)},e.prototype.setWeights=function(s){var u=this;l.tidy(function(){var e=u.weights;if(e.length!==s.length)throw new y.ValueError('You called setWeights(weights) on layer "'+u.name+'" with a weight list of length '+s.length+", but the layer was expecting "+e.length+" weights. Provided weights: "+s+"...");if(0!==e.length){for(var t=[],n=p.batchGetValue(e),r=0;r<n.length;++r){var i=n[r],o=e[r],a=s[r];if(!l.util.arraysEqual(i.shape,a.shape))throw new y.ValueError("Layer weight shape "+i.shape+" not compatible with provided weight shape "+a.shape);t.push([o,a])}p.batchSetValue(t)}})},e.prototype.addWeight=function(e,t,n,r,i,o,a){if(-1!==this._addedWeightNames.indexOf(e))throw new y.ValueError("Duplicate weight name "+e+" for layer "+this.name);this._addedWeightNames.push(e),null==n&&(n="float32");var s=new p.LayerVariable(r.apply(t,n),n,e,o,a);return null!=i&&this.addLoss(function(){return i.apply(s.read())}),null==o&&(o=!0),o?this._trainableWeights.push(s):this._nonTrainableWeights.push(s),s},e.prototype.addLoss=function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=g.toList(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,e))},e.prototype.computeOutputShape=function(e){return e},e.prototype.computeMask=function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer "+this.name+" does not support masking,but was passed an inputMask.");t.forEach(function(e){if(null!=e)throw new TypeError("Layer "+n.name+" does not support masking,but was passed an inputMask.")})}return null}return t},e.prototype.addInboundNode=function(e,t,n,r,i,o,a){void 0===a&&(a=null);var s=g.toList(e);t=g.toList(t),n=g.toList(n),r=g.toList(r),i=m.normalizeShapeList(i),o=m.normalizeShapeList(o);for(var u=[],l=[],c=[],p=0,h=s;p<h.length;p++){var f=h[p];u.push(f.sourceLayer),l.push(f.nodeIndex),c.push(f.tensorIndex)}new b({outboundLayer:this,inboundLayers:u,nodeIndices:l,tensorIndices:c,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:o},a);for(var d=0;d<t.length;d++)t[d].sourceLayer=this,t[d].nodeIndex=this.inboundNodes.length-1,t[d].tensorIndex=d},e.prototype.getConfig=function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e},e.prototype.disposeWeights=function(){return this.weights.forEach(function(e){return e.dispose()}),this.weights.length},e.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Layer '"+this.name+"' is already disposed.")},e.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var e=0;return 0==--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}},e}(l.serialization.Serializable);n.Layer=f,n.getSourceInputs=function e(t,n,r){if((null==n||null!=r&&0<r)&&(n=t.sourceLayer,r=t.nodeIndex),0===n.inboundNodes.length)return[t];var i=n.inboundNodes[r];if(0===i.inboundLayers.length)return i.inputTensors;for(var o=[],a=0;a<i.inboundLayers.length;a++)for(var s=0,u=e(i.inputTensors[a],i.inboundLayers[a],i.nodeIndices[a]);s<u.length;s++){var l=u[s];-1===o.indexOf(l)&&o.push(l)}return o}},{"../backend/state":192,"../common":196,"../errors":203,"../utils/generic_utils":231,"../utils/types_utils":235,"../utils/variable_utils":236,"../variables":237,"@tensorflow/tfjs-core":66}],202:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},P=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var o,N=e("@tensorflow/tfjs-core"),A=e("@tensorflow/tfjs-core"),v=e("../backend/state"),O=e("../backend/tfjs_backend"),k=e("../base_callbacks"),f=e("../common"),E=e("../errors"),I=e("../logs"),d=e("../losses"),m=e("../metrics"),p=e("../optimizers"),h=e("../utils/generic_utils"),s=e("../utils/layer_utils"),M=e("../utils/math_utils"),u=e("./container"),T=e("./executor");function l(e){return e instanceof A.Tensor}function y(e){return Array.isArray(e)}function g(e){return!l(e)&&!y(e)}function c(e,t,n,r,i){if(void 0===r&&(r=!0),void 0===i&&(i=""),null==t||0===t.length){if(null!=e){var o=!1;if(y(e)&&0<e.length)o=!0;else if(g(e)){for(var a in e)if(e.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new E.ValueError("Error when checking model "+i+" expected no data, but got "+e)}return[]}if(null==e)return t.map(function(e){return null});var s;if(g(e)){e=e,s=[];for(var u=0,l=t;u<l.length;u++){var c=l[u];if(null==e[c])throw new E.ValueError('No data provided for "'+c+'". Need data for each key in: '+t);s.push(e[c])}}else if(y(e)){if((e=e).length!==t.length)throw new E.ValueError("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see "+t.length+" Tensor(s), but instead got the following list of Tensor(s): "+e);s=e}else{if(e=e,1<t.length)throw new E.ValueError("The model "+i+" expects "+t.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+e.shape);s=[e]}for(var p=0;p<t.length;++p){1===(h=s[p]).shape.length&&(s[p]=O.expandDims(h,1))}if(null!=n)for(p=0;p<t.length;++p)if(null!=n[p]){var h;if((h=s[p]).shape.length!==n[p].length)throw new E.ValueError("Error when checking "+i+": expected "+t[p]+" to have "+n[p].length+" dimension(s). but got array with shape "+h.shape);for(var f=0;f<n[p].length;++f)if(0!==f||r){var d=h.shape[f],m=n[p][f];if(null!=m&&0<=m&&d!==m)throw new E.ValueError("Error when checking "+i+": expected "+t[p]+" to have shape ["+n[p]+"], but got array with shape ["+h.shape+"].")}}return s}function b(e,t,n){var r=h.unique(e.map(function(e){return e.shape[0]}));r.sort();var i=h.unique(t.map(function(e){return e.shape[0]}));if(i.sort(),1<r.length)throw new E.ValueError("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(e.map(function(e){return e.shape})));if(1<i.length)throw new E.ValueError("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(t.map(function(e){return e.shape})));if(0<r.length&&0<i.length&&!A.util.arraysEqual(r,i))throw new E.ValueError("Input Tensors should have the same number of samples as target Tensors. Found "+r[0]+" input sample(s) and "+i[0]+" target sample(s).")}function C(e,t){for(var n=[],r=0,i=null;r<e;)e<=(i=r+t)&&(i=e),n.push([r,i]),r=i;return n}function R(e,t,n){return null==e?[null]:Array.isArray(e)?e.map(function(e){return O.sliceAlongFirstAxis(e,t,n-t)}):O.sliceAlongFirstAxis(e,t,n-t)}function z(e,t){return N.tidy(function(){return null==e?null:Array.isArray(e)?e.map(function(e){return z(e,t)}):O.gather(e,"int32"===t.dtype?t:t.toInt())})}function _(e,t,n,r,i){var o;if(void 0===r&&(r=!0),void 0===i&&(i=""),Array.isArray(e)){if(e.length!==t.length)throw new E.ValueError("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see "+t.length+" Tensor(s), but instead got "+e.length+" Tensors(s).");o=e}else{if(1<t.length)throw new E.ValueError("The model expects "+t.length+" "+i+" Tensors, but only received one Tensor. Found: array with shape "+JSON.stringify(e.shape)+".");o=[e]}if(null!=n)for(var a=0;a<t.length;++a)if(null!=n[a]){var s=o[a];if(s.shape.length!==n[a].length)throw new E.ValueError("Error when checking "+i+": expected "+t[a]+" to have "+n[a].length+" dimension(s), but got array with shape "+JSON.stringify(s.shape));for(var u=0;u<n[a].length;++u)if(0!==u||r){var l=s.shape[u],c=n[a][u];if(null!=c&&c!==l)throw new E.ValueError("Error when checking "+i+": expected "+t[a]+" to have shape "+JSON.stringify(n[a])+" but got array with shape "+JSON.stringify(s.shape)+".")}}}n.isDataTensor=l,n.isDataArray=y,n.isDataDict=g,n.standardizeInputData=c,n.checkArrayLengths=b,n.makeBatches=C,n.sliceArraysByIndices=z,(o=n.ModelLoggingVerbosity||(n.ModelLoggingVerbosity={}))[o.SILENT=0]="SILENT",o[o.VERBOSE=1]="VERBOSE";var w=function(n){function e(e){var t=n.call(this,e)||this;return t.isTraining=!1,t}return i(e,n),e.prototype.summary=function(e,t,n){if(void 0===n&&(n=console.log),!this.built)throw new E.ValueError("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");s.printSummary(this,e,t,n)},e.prototype.compile=function(e){var h=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer=p.getOptimizer(e.optimizer);else{if(!(e.optimizer instanceof A.Optimizer))throw new E.ValueError("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer=e.optimizer}var t=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new E.ValueError("When passing an Array as loss, it should have one entry per model output. The model has "+this.outputs.length+" output(s), but you passed loss="+e.loss+".");var n=e.loss;t=n.map(function(e){return d.get(e)})}else{var r=d.get(e.loss);this.outputs.map(function(e){t.push(r)})}else{for(var i in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(i))throw new E.ValueError('Unknown entry in loss dictionary: "'+i+'". Only expect the following keys: '+this.outputNames);for(var o in this.outputNames)null==e.loss[o]&&console.warn('Output "'+o+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to '+o+" during training"),t.push(d.get(e.loss[o]))}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var a=0;a<this.outputs.length;++a){var s=this.internalOutputShapes[a],u=this.outputNames[a];this.feedOutputNames.push(u),this.feedOutputShapes.push(s),this.feedLossFns.push(this.lossFunctions[a])}var l=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],f.nameScope("loss",function(){for(var e=0;e<h.outputs.length;++e)if(-1===l.indexOf(e)){var t=h.lossFunctions[e];1<h.outputs.length&&(h.metricsTensors.push([t,e]),h.metricsNames.push(h.outputNames[e]+"_loss"))}});var c=function(t,e){if(null==t||Array.isArray(t)&&0===t.length)return e.map(function(e){return[]});if(Array.isArray(t))return e.map(function(e){return t});if(null!=t){for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r],a=t.hasOwnProperty(o)?t[o]:[];Array.isArray(a)||(a=[a]),n.push(a)}return n}throw new TypeError("Type of metrics argument not understood. Expected an Array or Object, found: "+t)}(e.metrics,this.outputNames);f.nameScope("metric",function(){for(var e=function(p){if(-1!==l.indexOf(p))return"continue";!function(e){for(var u,l,c,t=function(e){if(-1!==["accuracy","acc","crossentropy","ce"].indexOf(e)){var t=h.internalOutputShapes[p];1===t[t.length-1]||h.lossFunctions[p]===d.binaryCrossentropy?-1!==["accuracy","acc"].indexOf(e)?l=m.binaryAccuracy:-1!==["crossentropy","ce"].indexOf(e)&&(l=m.binaryCrossentropy):h.lossFunctions[p]===d.sparseCategoricalCrossentropy?-1!==["accuracy","acc"].indexOf(e)?l=m.sparseCategoricalAccuracy:-1!==["crossentropy","ce"].indexOf(e)&&(l=m.sparseCategoricalCrossentropy):-1!==["accuracy","acc"].indexOf(e)?l=m.categoricalAccuracy:-1!==["crossentropy","ce"].indexOf(e)&&(l=m.categoricalCrossentropy);var n=void 0;-1!==["accuracy","acc"].indexOf(e)?n="acc":-1!==["crossentropy","ce"].indexOf(e)&&(n="ce"),c=l,u=""+n}else{var r=m.get(e);c=r,u=""+e}var i,o,a,s;f.nameScope(u,function(){i=c}),o=p,a=u,s=i,1<h.outputNames.length&&(a=h.outputNames[o]+"_"+a),h.metricsNames.push(a),h.metricsTensors.push([s,o])},n=0,r=e;n<r.length;n++)t(r[n])}(c[p])},t=0;t<h.outputs.length;++t)e(t)}),this.collectedTrainableWeights=this.trainableWeights},e.prototype.checkTrainableWeightsConsistency=function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},e.prototype.evaluate=function(e,t,n){void 0===n&&(n={});var r=null==n.batchSize?32:n.batchSize,i=this.standardizeUserData(e,t,!0,r),o=i[0].concat(i[1]);this.makeTestFunction();var a=this.testFunction,s=this.testLoop(a,o,r,n.verbose,n.steps);return h.singletonOrArray(s)},e.prototype.checkNumSamples=function(e,t,n,r){var i;if(void 0===r&&(r="steps"),null!=n){if((i=null)!=t)throw new E.ValueError("If "+r+" is set, batchSize must be null or undefined.Got batchSize = "+t)}else{if(null==e)throw new E.ValueError("Either the input data should have a defined shape, or "+r+" shoud be specified.");i=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return i},e.prototype.execute=function(e,t){if(Array.isArray(t)&&0===t.length)throw new E.ValueError("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=n?t:[t],i=this.retrieveSymbolicTensors(r),o=new T.FeedDict;if(e instanceof A.Tensor&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new E.ValueError("The number of inputs provided ("+e.length+") does not match the number of inputs of this model ("+this.inputs.length+").");for(var a=0;a<this.inputs.length;++a)o.add(this.inputs[a],e[a])}else for(var s=0,u=this.inputs;s<u.length;s++){var l=u[s],c=e[l.name];if(null==c)throw new E.ValueError("No value is provided for the model's input "+l.name);o.add(l,c)}var p=T.execute(i,o);return n?p:p[0]},e.prototype.retrieveSymbolicTensors=function(n){for(var e=h.pyListRepeat(null,n.length),t=n.length,r=0,i=this.layers;r<i.length;r++){for(var o=i[r],a=Array.isArray(o.output)?o.output:[o.output],s=a.map(function(e){return e.name}),u=0;u<n.length;++u){var l=s.indexOf(n[u]);if(-1!==l&&(e[u]=a[l],t--),0===t)break}if(0===t)break}if(0<t){var c=[];throw e.forEach(function(e,t){null==e&&c.push(n[t])}),new E.ValueError("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(c))}return e},e.prototype.predictLoop=function(u,r,i){var l=this;return void 0===r&&(r=32),void 0===i&&(i=!1),N.tidy(function(){var e=l.checkNumSamples(u);if(i)throw new E.NotImplementedError("Verbose predictLoop() is not implemented yet.");for(var s=C(e,r),o=[],t=function(a){var e=N.tidy(function(){var e=s[a][0],t=s[a][1],n=R(u,e,t),r=[];if(Array.isArray(n))for(var i=0;i<n.length;++i)r.push({key:l.inputs[i],value:n[i]});else r.push({key:l.inputs[0],value:n});var o=new T.FeedDict(r);return T.execute(l.outputs,o)});if(0===a)for(var t=0,n=e;t<n.length;t++){var r=n[t];o.push(r)}else for(var i=0;i<e.length;++i)o[i]=O.concatAlongFirstAxis(o[i],e[i])},n=0;n<s.length;++n)t(n);return h.singletonOrArray(o)})},e.prototype.predict=function(e,t){void 0===t&&(t={}),_(e,this.inputNames,this.feedInputShapes,!1);var n=null==t.batchSize?32:t.batchSize;return this.predictLoop(e,n)},e.prototype.predictOnBatch=function(e){return _(e,this.inputNames,this.feedInputShapes,!0),this.predictLoop(e,e.shape[0])},e.prototype.standardizeUserData=function(e,t,n,r){if(void 0===n&&(n=!0),null==this.optimizer)throw new E.RuntimeError("You must compile a model before training/testing. Use Model.compile(modelCompileConfig).");for(var i=[],o=0;o<this.feedOutputShapes.length;++o){var a=this.feedOutputShapes[o];this.feedLossFns[o]===d.sparseCategoricalCrossentropy?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(b(e=c(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=c(t,this.feedOutputNames,i,!1,"target")),function(e,t,n){for(var r=[d.meanSquaredError,d.binaryCrossentropy,d.categoricalCrossentropy],i=0;i<e.length;++i){var o=e[i],a=t[i],s=n[i];if(null!=a){if(a===d.categoricalCrossentropy&&1===o.shape[o.shape.length-1])throw new E.ValueError("You are passing a target array of shape "+o.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(a))for(var u=o.shape.slice(1),l=s.slice(1),c=0;c<u.length;++c){var p=u[c],h=l[c];if(null!=h&&p!==h)throw new E.ValueError("A target Tensor with shape "+o.shape+" was passed for an output of shape "+s+", while using a loss function that expects targets to have the same shape as the output.")}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=r&&0<r&&e[0].shape[0]%r!=0)throw new E.ValueError("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+r+". Found: "+e[0].shape[0]+" sample(s).");return[e,t,null]},e.prototype.fitLoop=function(y,g,v,b,u,l,c,_,w,S,p,h,x,f,T){return a(this,void 0,void 0,function(){var d,i,o,t,a,n,s,r,m=this;return P(this,function(e){switch(e.label){case 0:if(null==b&&(b=32),null==u&&(u=1),null==S&&(S=!0),null==h&&(h=0),d=!1,null!=_&&null!=w&&(d=!0),null!=f&&(d=!0,null==x))throw new E.ValueError("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");if(null!=(i=this.checkNumSamples(g,b,x,"steps_per_epoch"))&&(o=M.range(0,i)),this.history=new k.History,t=new k.BaseLogger(T),c=(c=null==c?[t]:[t].concat(c)).concat([this.history]),0<l)throw new E.NotImplementedError("Verbose mode is not implemented yet.");return(a=new k.CallbackList(c)).setModel(this),a.setParams({epochs:u,initialEpoch:h,steps:x,verbose:l,doValidation:d,metrics:p}),[4,a.onTrainBegin()];case 1:e.sent(),this.stopTraining_=!1,n=function(t){var p,h,f,n,r;return P(this,function(e){switch(e.label){case 0:return[4,a.onEpochBegin(t)];case 1:if(e.sent(),p={},null==x)return[3,2];throw new E.NotImplementedError("stepsPerEpoch mode is not implemented yet.");case 2:if("batch"===S)throw new E.NotImplementedError("batch shuffling is not implemneted yet");S&&A.util.shuffle(o),h=A.tensor1d(o),f=C(i,b),n=function(l){var c;return P(this,function(e){switch(e.label){case 0:return c={},[4,a.onBatchBegin(l,c)];case 1:return e.sent(),N.tidy(function(){var e=f[l][0],t=f[l][1],n=O.sliceAlongFirstAxis(h,e,t-e);c.batch=l,c.size=t-e;for(var r=z(g,n),i=y(r),o=0;o<v.length;++o){var a=v[o],s=i[o];c[a]=s,N.keep(s)}if(l===f.length-1&&d){var u=m.testLoop(_,w,b);for(o=0;o<v.length;++o){a=v[o],s=u[o];N.keep(s),p["val_"+a]=s}}}),[4,a.onBatchEnd(l,c)];case 2:return e.sent(),I.disposeTensorsInLogs(c),s.stopTraining_?[2,"break"]:[2]}})},r=0,e.label=3;case 3:return r<f.length?[5,n(r)]:[3,6];case 4:if("break"===e.sent())return[3,6];e.label=5;case 5:return++r,[3,3];case 6:h.dispose(),e.label=7;case 7:return[4,a.onEpochEnd(t,p)];case 8:return e.sent(),s.stopTraining_?[2,"break"]:[2]}})},s=this,r=h,e.label=2;case 2:return r<u?[5,n(r)]:[3,5];case 3:if("break"===e.sent())return[3,5];e.label=4;case 4:return++r,[3,2];case 5:return[4,a.onTrainEnd()];case 6:return e.sent(),[4,this.history.syncData()];case 7:return e.sent(),[2,this.history]}})})},e.prototype.testLoop=function(h,f,d,m,y){var g=this;return void 0===m&&(m=0),N.tidy(function(){var e=g.checkNumSamples(f,d,y,"steps"),t=[];if(1===m)throw new E.NotImplementedError("Verbose mode is not implemented yet.");if(null!=y)throw new E.NotImplementedError("steps mode in testLoop() is not implemented yet");for(var n=C(e,d),r=A.tensor1d(M.range(0,e)),i=0;i<n.length;++i){var o=n[i][0],a=n[i][1],s=O.sliceAlongFirstAxis(r,o,a-o),u=z(f,s),l=h(u);if(0===i)for(var c=0;c<l.length;++c)t.push(v.getScalar(0));for(c=0;c<l.length;++c){var p=l[c];t[c]=N.add(t[c],N.mul(v.getScalar(a-o),p))}}for(c=0;c<t.length;++c)t[c]=N.div(t[c],v.getScalar(e));return t})},e.prototype.getDedupedMetricsNames=function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],i=r;if(1<h.count(e,r))i+="_"+h.count(e.slice(0,n),r);t.push(i)}return t},e.prototype.makeTestFunction=function(){var d=this;this.testFunction=function(f){return N.tidy(function(){for(var e,t=[],n=f.slice(0,d.inputs.length),r=f.slice(d.inputs.length,d.inputs.length+d.outputs.length),i=[],o=0;o<d.inputs.length;++o)i.push({key:d.inputs[o],value:n[o]});var a=new T.FeedDict(i),s=T.execute(d.outputs,a);for(o=0;o<d.lossFunctions.length;++o){var u=d.lossFunctions[o],l=N.mean(u(r[o],s[o]));e=0===o?l:N.add(e,l),t.push(e)}for(o=0;o<d.metricsTensors.length;++o){var c=d.metricsTensors[o][0],p=d.metricsTensors[o][1],h=N.mean(c(r[p],s[p]));t.push(h)}return t})}},e.prototype.fit=function(w,S,x){return void 0===x&&(x={}),a(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,l,c,p,h,f,d,m,y,g,v,b,_=this;return P(this,function(e){switch(e.label){case 0:if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");if(this.isTraining=!0,t=null==x.batchSize?32:x.batchSize,n=this.standardizeUserData(w,S,!1,t),r=n[0],i=n[1],l=o=!1,null!=x.validationData&&0<x.validationData.length){if(o=!0,2!==x.validationData.length)throw 3===x.validationData.length?new E.NotImplementedError("validationData including sample weights is not supported yet."):new E.ValueError("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+x.validationData+" is invalid.");a=x.validationData[0],s=x.validationData[1],c=this.standardizeUserData(a,s,!0,t),a=c[0],s=c[1],u=a.concat(s)}else null!=x.validationSplit&&0<x.validationSplit&&x.validationSplit<1?(o=!0,p=Math.floor(r[0].shape[0]*(1-x.validationSplit)),h=r[0].shape[0],a=R(r,p,h),r=R(r,0,p),s=R(i,p,h),i=R(i,0,p),l=!0,u=a.concat(s)):null!=x.validationSteps&&(o=!0);return f=r.concat(i),this.checkTrainableWeightsConsistency(),d=function(e){var c=[],p=[],h=e.slice(0,_.inputs.length),f=e.slice(_.inputs.length,_.inputs.length+_.outputs.length),d=[],t=_.collectedTrainableWeights.map(function(e){return e.read()});return[_.optimizer.minimize(function(){for(var e=[],t=0;t<_.inputs.length;++t)e.push({key:_.inputs[t],value:h[t]});var n,r=new T.FeedDict(e),i=T.execute(_.outputs,r,{training:!0});for(t=0;t<_.lossFunctions.length;++t){var o=(0,_.lossFunctions[t])(f[t],i[t]);c.push(o);var a=N.mean(o);p.push(a),n=0===t?o:N.add(n,o)}for(t=0;t<_.metricsTensors.length;++t){var s=_.metricsTensors[t][0],u=_.metricsTensors[t][1],l=N.mean(s(f[u],i[u]));N.keep(l),d.push(l)}return n=N.mean(n),_.calculateLosses().forEach(function(e){n=N.add(n,e)}),n},!0,t)].concat(d)},m=this.getDedupedMetricsNames(),o?(this.makeTestFunction(),y=this.testFunction,g=m.slice().concat(m.map(function(e){return"val_"+e}))):(y=null,u=[],g=m.slice()),v=k.standardizeCallbacks(x.callbacks),[4,this.fitLoop(d,f,m,t,x.epochs,x.verbose,v,y,u,x.shuffle,g,x.initialEpoch,null,null,x.yieldEvery)];case 1:return b=e.sent(),l&&(u.forEach(function(e){return e.dispose()}),r.forEach(function(e){return e.dispose()}),i.forEach(function(e){return e.dispose()})),this.isTraining=!1,[2,b]}})})},e.prototype.getNamedWeights=function(e){for(var t={},n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n),o=0;o<r.length;++o)n&&!r[o].trainable||(t[r[o].originalName]=i[o]);return t},Object.defineProperty(e.prototype,"stopTraining",{set:function(e){this.stopTraining_=e},enumerable:!0,configurable:!0}),e.prototype.save=function(i,o){return a(this,void 0,void 0,function(){var t,n,r;return P(this,function(e){switch(e.label){case 0:if("string"==typeof i){if(0===(t=A.io.getSaveHandlers(i)).length)throw new E.ValueError("Cannot find any save handlers for URL '"+i+"'");if(1<t.length)throw new E.ValueError("Found more than one ("+t.length+") save handlers for URL '"+i+"'");i=t[0]}if(null==i.save)throw new E.ValueError("Model.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,A.io.encodeWeights(this.getNamedWeights(o))];case 1:return n=e.sent(),!1,null,r=this.toJSON(null,!1),[2,i.save({modelTopology:r,weightData:n.data,weightSpecs:n.specs})]}})})},e.className="Model",e}(u.Container);n.Model=w,A.serialization.SerializationMap.register(w)},{"../backend/state":192,"../backend/tfjs_backend":193,"../base_callbacks":194,"../common":196,"../errors":203,"../logs":224,"../losses":225,"../metrics":226,"../optimizers":228,"../utils/generic_utils":231,"../utils/layer_utils":232,"../utils/math_utils":233,"./container":198,"./executor":199,"@tensorflow/tfjs-core":66}],203:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=function(n){function r(e){var t=n.call(this,e)||this;return Object.setPrototypeOf(t,r.prototype),t}return i(r,n),r}(Error);n.AttributeError=o;var a=function(n){function r(e){var t=n.call(this,e)||this;return Object.setPrototypeOf(t,r.prototype),t}return i(r,n),r}(Error);n.RuntimeError=a;var s=function(n){function r(e){var t=n.call(this,e)||this;return Object.setPrototypeOf(t,r.prototype),t}return i(r,n),r}(Error);n.ValueError=s;var u=function(n){function r(e){var t=n.call(this,e)||this;return Object.setPrototypeOf(t,r.prototype),t}return i(r,n),r}(Error);n.NotImplementedError=u;var l=function(n){function r(e){var t=n.call(this,e)||this;return Object.setPrototypeOf(t,r.prototype),t}return i(r,n),r}(Error);n.AssertionError=l;var c=function(n){function r(e){var t=n.call(this,e)||this;return Object.setPrototypeOf(t,r.prototype),t}return i(r,n),r}(Error);n.IndexError=c},{}],204:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./engine/input_layer"),i=e("./engine/training"),o=e("./models");n.model=function(e){return new i.Model(e)},n.sequential=function(e){return new o.Sequential(e)},n.loadModel=function(e,t){return void 0===t&&(t=!0),o.loadModelInternal(e,t)},n.input=function(e){return r.Input(e)}},{"./engine/input_layer":200,"./engine/training":202,"./models":227}],205:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./constraints");n.maxNorm=function(e){return new r.MaxNorm(e)},n.unitNorm=function(e){return new r.UnitNorm(e)},n.nonNeg=function(){return new r.NonNeg},n.minMaxNorm=function(e){return new r.MinMaxNorm(e)}},{"./constraints":197}],206:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./initializers");n.zeros=function(){return new r.Zeros},n.ones=function(){return new r.Ones},n.constant=function(e){return new r.Constant(e)},n.randomUniform=function(e){return new r.RandomUniform(e)},n.randomNormal=function(e){return new r.RandomNormal(e)},n.truncatedNormal=function(e){return new r.TruncatedNormal(e)},n.identity=function(e){return new r.Identity(e)},n.varianceScaling=function(e){return new r.VarianceScaling(e)},n.glorotUniform=function(e){return new r.GlorotUniform(e)},n.glorotNormal=function(e){return new r.GlorotNormal(e)},n.heNormal=function(e){return new r.HeNormal(e)},n.leCunNormal=function(e){return new r.LeCunNormal(e)},n.orthogonal=function(e){return new r.Orthogonal(e)}},{"./initializers":211}],207:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./engine/input_layer"),i=e("./engine/topology");n.Layer=i.Layer;var o=e("./exports");n.input=o.input;var a=e("./layers/advanced_activations"),s=e("./layers/convolutional"),u=e("./layers/convolutional_depthwise"),l=e("./layers/core"),c=e("./layers/embeddings"),p=e("./layers/merge"),h=e("./layers/normalization"),f=e("./layers/padding"),d=e("./layers/pooling"),m=e("./layers/recurrent");n.RNN=m.RNN,n.RNNCell=m.RNNCell;var y=e("./layers/wrappers");function g(e){return new d.AveragePooling1D(e)}function v(e){return new d.AveragePooling2D(e)}function b(e){return new d.GlobalMaxPooling1D(e)}function _(e){return new d.GlobalMaxPooling2D(e)}function w(e){return new d.MaxPooling1D(e)}function S(e){return new d.MaxPooling2D(e)}n.inputLayer=function(e){return new r.InputLayer(e)},n.elu=function(e){return new a.ELU(e)},n.leakyReLU=function(e){return new a.LeakyReLU(e)},n.softmax=function(e){return new a.Softmax(e)},n.thresholdedReLU=function(e){return new a.ThresholdedReLU(e)},n.conv1d=function(e){return new s.Conv1D(e)},n.conv2d=function(e){return new s.Conv2D(e)},n.conv2dTranspose=function(e){return new s.Conv2DTranspose(e)},n.separableConv2d=function(e){return new s.SeparableConv2D(e)},n.cropping2D=function(e){return new s.Cropping2D(e)},n.upSampling2d=function(e){return new s.UpSampling2D(e)},n.depthwiseConv2d=function(e){return new u.DepthwiseConv2D(e)},n.activation=function(e){return new l.Activation(e)},n.dense=function(e){return new l.Dense(e)},n.dropout=function(e){return new l.Dropout(e)},n.flatten=function(e){return new l.Flatten(e)},n.repeatVector=function(e){return new l.RepeatVector(e)},n.reshape=function(e){return new l.Reshape(e)},n.permute=function(e){return new l.Permute(e)},n.embedding=function(e){return new c.Embedding(e)},n.add=function(e){return new p.Add(e)},n.average=function(e){return new p.Average(e)},n.concatenate=function(e){return new p.Concatenate(e)},n.maximum=function(e){return new p.Maximum(e)},n.minimum=function(e){return new p.Minimum(e)},n.multiply=function(e){return new p.Multiply(e)},n.batchNormalization=function(e){return new h.BatchNormalization(e)},n.zeroPadding2d=function(e){return new f.ZeroPadding2D(e)},n.averagePooling1d=g,n.avgPool1d=function(e){return g(e)},n.avgPooling1d=function(e){return g(e)},n.averagePooling2d=v,n.avgPool2d=function(e){return v(e)},n.avgPooling2d=function(e){return v(e)},n.globalAveragePooling1d=function(e){return new d.GlobalAveragePooling1D(e)},n.globalAveragePooling2d=function(e){return new d.GlobalAveragePooling2D(e)},n.globalMaxPooling1d=b,n.globalMaxPooling2d=_,n.maxPooling1d=w,n.maxPooling2d=S,n.gru=function(e){return new m.GRU(e)},n.gruCell=function(e){return new m.GRUCell(e)},n.lstm=function(e){return new m.LSTM(e)},n.lstmCell=function(e){return new m.LSTMCell(e)},n.simpleRNN=function(e){return new m.SimpleRNN(e)},n.simpleRNNCell=function(e){return new m.SimpleRNNCell(e)},n.rnn=function(e){return new m.RNN(e)},n.stackedRNNCells=function(e){return new m.StackedRNNCells(e)},n.bidirectional=function(e){return new y.Bidirectional(e)},n.timeDistributed=function(e){return new y.TimeDistributed(e)},n.globalMaxPool1d=b,n.globalMaxPool2d=_,n.maxPool1d=w,n.maxPool2d=S},{"./engine/input_layer":200,"./engine/topology":201,"./exports":204,"./layers/advanced_activations":212,"./layers/convolutional":213,"./layers/convolutional_depthwise":214,"./layers/core":215,"./layers/embeddings":216,"./layers/merge":217,"./layers/normalization":218,"./layers/padding":219,"./layers/pooling":220,"./layers/recurrent":221,"./layers/wrappers":223}],208:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./losses"),i=e("./metrics");n.binaryAccuracy=function(e,t){return i.binaryAccuracy(e,t)},n.binaryCrossentropy=function(e,t){return i.binaryCrossentropy(e,t)},n.categoricalAccuracy=function(e,t){return i.categoricalAccuracy(e,t)},n.categoricalCrossentropy=function(e,t){return i.categoricalCrossentropy(e,t)},n.cosineProximity=function(e,t){return r.cosineProximity(e,t)},n.meanAbsoluteError=function(e,t){return r.meanAbsoluteError(e,t)},n.meanAbsolutePercentageError=function(e,t){return r.meanAbsolutePercentageError(e,t)},n.MAPE=function(e,t){return r.meanAbsolutePercentageError(e,t)},n.mape=function(e,t){return r.meanAbsolutePercentageError(e,t)},n.meanSquaredError=function(e,t){return r.meanSquaredError(e,t)},n.MSE=function(e,t){return r.meanSquaredError(e,t)},n.mse=function(e,t){return r.meanSquaredError(e,t)}},{"./losses":225,"./metrics":226}],209:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./regularizers"),i=e("./regularizers");n.l1l2=function(e){return new i.L1L2(e)},n.l1=function(e){return r.l1(e)},n.l2=function(e){return r.l2(e)}},{"./regularizers":229}],210:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./exports_constraints");n.constraints=r;var i=e("./exports_initializers");n.initializers=i;var o=e("./exports_layers");n.layers=o;var a=e("./exports_metrics");n.metrics=a;var s=e("./exports_regularizers");n.regularizers=s;var u=e("./base_callbacks");n.CallbackList=u.CallbackList,n.CustomCallback=u.CustomCallback,n.History=u.History;var l=e("./callbacks");n.Callback=l.Callback;var c=e("./engine/topology");n.SymbolicTensor=c.SymbolicTensor;var p=e("./engine/training");n.Model=p.Model;var h=e("./exports");n.input=h.input,n.loadModel=h.loadModel,n.model=h.model,n.sequential=h.sequential;var f=e("./layers/recurrent");n.RNN=f.RNN;var d=e("./models");n.Sequential=d.Sequential;var m=e("./variables");n.LayerVariable=m.LayerVariable;var y=e("./version");n.version_layers=y.version},{"./base_callbacks":194,"./callbacks":195,"./engine/topology":201,"./engine/training":202,"./exports":204,"./exports_constraints":205,"./exports_initializers":206,"./exports_layers":207,"./exports_metrics":208,"./exports_regularizers":209,"./layers/recurrent":221,"./models":227,"./variables":237,"./version":238}],211:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var u=e("@tensorflow/tfjs-core"),o=e("./backend/state"),a=e("./backend/tfjs_backend"),l=e("./common"),c=e("./errors"),s=e("./utils/generic_utils"),p=e("./utils/math_utils");function h(e){s.checkStringTypeUnionValue(n.VALID_FAN_MODE_VALUES,"FanMode",e)}function f(e){s.checkStringTypeUnionValue(n.VALID_DISTRIBUTION_VALUES,"Distribution",e)}n.VALID_FAN_MODE_VALUES=["fanIn","fanOut","fanAvg"],n.checkFanMode=h,n.VALID_DISTRIBUTION_VALUES=["normal","uniform"],n.checkDistribution=f;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.fromConfigUsesCustomObjects=function(){return!1},t.prototype.getConfig=function(){return{}},t}(u.serialization.Serializable),m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e,t){return u.zeros(e,t)},t.className="Zeros",t}(n.Initializer=d);n.Zeros=m,u.serialization.SerializationMap.register(m);var y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e,t){return u.ones(e,t)},t.className="Ones",t}(d);n.Ones=y,u.serialization.SerializationMap.register(y);var g=function(n){function e(e){var t=n.call(this)||this;if("object"!=typeof e)throw new c.ValueError("Expected argument of type ConstantConfig but got "+e);if(void 0===e.value)throw new c.ValueError("config must have value set but got "+e);return t.value=e.value,t}return i(e,n),e.prototype.apply=function(e,t){var n=this;return u.tidy(function(){return u.mul(u.scalar(n.value),u.ones(e,t))})},e.prototype.getConfig=function(){return{value:this.value}},e.className="Constant",e}(d);n.Constant=g,u.serialization.SerializationMap.register(g);var v=function(n){function e(e){var t=n.call(this)||this;return t.DEFAULT_MINVAL=-.05,t.DEFAULT_MAXVAL=.05,t.minval=e.minval||t.DEFAULT_MINVAL,t.maxval=e.maxval||t.DEFAULT_MAXVAL,t.seed=e.seed,t}return i(e,n),e.prototype.apply=function(e,t){return u.randomUniform(e,this.minval,this.maxval,t)},e.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},e.className="RandomUniform",e}(d);n.RandomUniform=v,u.serialization.SerializationMap.register(v);var b=function(n){function e(e){var t=n.call(this)||this;return t.DEFAULT_MEAN=0,t.DEFAULT_STDDEV=.05,t.mean=e.mean||t.DEFAULT_MEAN,t.stddev=e.stddev||t.DEFAULT_STDDEV,t.seed=e.seed,t}return i(e,n),e.prototype.apply=function(e,t){if("bool"===t)throw new c.NotImplementedError("randomNormal does not support dType bool.");return a.randomNormal(e,this.mean,this.stddev,t,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e.className="RandomNormal",e}(d);n.RandomNormal=b,u.serialization.SerializationMap.register(b);var _=function(n){function e(e){var t=n.call(this)||this;return t.DEFAULT_MEAN=0,t.DEFAULT_STDDEV=.05,t.mean=e.mean||t.DEFAULT_MEAN,t.stddev=e.stddev||t.DEFAULT_STDDEV,t.seed=e.seed,t}return i(e,n),e.prototype.apply=function(e,t){if("bool"===t)throw new c.NotImplementedError("truncatedNormal does not support dType bool.");return u.truncatedNormal(e,this.mean,this.stddev,t,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e.className="TruncatedNormal",e}(d);n.TruncatedNormal=_,u.serialization.SerializationMap.register(_);var w=function(n){function e(e){var t=n.call(this)||this;return t.gain=null!=e.gain?u.scalar(e.gain):o.getScalar(1),t}return i(e,n),e.prototype.apply=function(e,t){var n=this;return u.tidy(function(){if(2!==e.length||e[0]!==e[1])throw new c.ValueError("Identity matrix initializer can only be used for 2D square matrices.");return u.mul(n.gain,u.eye(e[0]))})},e.prototype.getConfig=function(){return{gain:this.gain.get()}},e.className="Identity",e}(d);n.Identity=w,u.serialization.SerializationMap.register(w);var S=function(n){function e(e){var t=n.call(this)||this;if(e.scale<0)throw new c.ValueError("scale must be a positive float. Got: "+e.scale);return t.scale=null==e.scale?1:e.scale,t.mode=e.mode,h(t.mode),t.distribution=e.distribution,f(t.distribution),t.seed=e.seed,t}return i(e,n),e.prototype.apply=function(e,t){var n=function(e,t){var n,r;if(void 0===t&&(t="channelsLast"),l.checkDataFormat(t),2===e.length)n=e[0],r=e[1];else if(-1!==[3,4,5].indexOf(e.length))if("channelsFirst"===t){var i=p.arrayProd(e,2);n=e[1]*i,r=e[0]*i}else"channelsLast"===t&&(i=p.arrayProd(e,0,e.length-2),n=e[e.length-2]*i,r=e[e.length-1]*i);else{var o=p.arrayProd(e);n=Math.sqrt(o),r=Math.sqrt(o)}return[n,r]}(e),r=n[0],i=n[1],o=this.scale;if("fanIn"===this.mode?o/=Math.max(1,r):"fanOut"===this.mode?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),"normal"===this.distribution){var a=Math.sqrt(o);if("bool"===t)throw new c.NotImplementedError(this.getClassName()+" does not support dType bool.");return u.truncatedNormal(e,0,a,t,this.seed)}var s=Math.sqrt(3*o);return u.randomUniform(e,-s,s,t)},e.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},e.className="VarianceScaling",e}(d);n.VarianceScaling=S,u.serialization.SerializationMap.register(S);var x=function(t){function e(e){return t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})||this}return i(e,t),e.prototype.getClassName=function(){return S.className},e}(S);n.GlorotUniform=x;var T=function(t){function e(e){return t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})||this}return i(e,t),e.prototype.getClassName=function(){return S.className},e}(S);n.GlorotNormal=T;var P=function(t){function e(e){return t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})||this}return i(e,t),e.prototype.getClassName=function(){return S.className},e}(S);n.HeNormal=P;var N=function(t){function e(e){return t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})||this}return i(e,t),e.prototype.getClassName=function(){return S.className},e}(S);n.LeCunNormal=N;var A=function(n){function e(e){var t=n.call(this)||this;if(t.DEFAULT_GAIN=1,t.gain=null==e.gain?t.DEFAULT_GAIN:e.gain,t.seed=e.seed,null!=t.seed)throw new c.NotImplementedError("Random seed is not implemented for Orthogonal Initializer yet.");return t}return i(e,n),e.prototype.apply=function(r,e){var i=this;return u.tidy(function(){if(2!==r.length)throw new c.NotImplementedError("The Orthogonal Initializer does not support non-2D shapes yet.");2e3<r[0]*r[1]&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 ("+r[0]*r[1]+") elements: Slowness may result.");var e=r[0]>r[1]?[r[1],r[0]]:r,t=a.randomNormal(e,0,1,"float32"),n=u.linalg.gramSchmidt(t);return r[0]>r[1]&&(n=n.transpose()),u.mul(o.getScalar(i.gain),n)})},e.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},e.className="Orthogonal",e}(d);function O(e,t){return void 0===t&&(t={}),s.deserializeKerasObject(e,u.serialization.SerializationMap.getMap().classNameMap,t,"initializer")}n.Orthogonal=A,u.serialization.SerializationMap.register(A),n.INITIALIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",identity:"Identity",leCunNormal:"LeCunNormal",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"},n.serializeInitializer=function(e){return s.serializeKerasObject(e)},n.getInitializer=function(e){if("string"==typeof e){var t=e in n.INITIALIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP?n.INITIALIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP[e]:e;return"GlorotUniform"===t?new x:"GlorotNormal"===t?new T:"HeNormal"===t?new P:"LeCunNormal"===t?new N:O({className:t,config:{}})}return e instanceof d?e:O(e)}},{"./backend/state":192,"./backend/tfjs_backend":193,"./common":196,"./errors":203,"./utils/generic_utils":231,"./utils/math_utils":233,"@tensorflow/tfjs-core":66}],212:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("../activations"),s=e("../backend/tfjs_backend"),u=e("../engine/topology"),l=e("../backend/state"),c=e("../errors"),p=e("../utils/types_utils"),h=function(n){function e(e){var t=n.call(this,null==e?{}:e)||this;return t.DEFAULT_ALPHA=.3,null==e&&(e={}),t.alpha=null==e.alpha?t.DEFAULT_ALPHA:e.alpha,t}return i(e,n),e.prototype.call=function(e,t){var n=p.getExactlyOneTensor(e);return o.leakyRelu(n,this.alpha)},e.prototype.computeOutputShape=function(e){return e},e.prototype.getConfig=function(){var e={alpha:this.alpha},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="LeakyReLU",e}(u.Layer);n.LeakyReLU=h,o.serialization.SerializationMap.register(h);var f=function(n){function e(e){var t=n.call(this,null==e?{}:e)||this;if(t.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==t.DEFAULT_ALPHA)throw new c.NotImplementedError("Non-default alpha value ("+e.alpha+") is not supported by the ELU layer yet.");return t.alpha=null==e.alpha?t.DEFAULT_ALPHA:e.alpha,t}return i(e,n),e.prototype.call=function(e,t){var n=p.getExactlyOneTensor(e);return o.elu(n)},e.prototype.computeOutputShape=function(e){return e},e.prototype.getConfig=function(){var e={alpha:this.alpha},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="ELU",e}(u.Layer);n.ELU=f,o.serialization.SerializationMap.register(f);var d=function(n){function e(e){var t=n.call(this,null==e?{}:e)||this;return t.DEFAULT_THETA=1,null==e&&(e={}),t.theta=null==e.theta?t.DEFAULT_THETA:e.theta,t.thetaTensor=l.getScalar(t.theta),t}return i(e,n),e.prototype.call=function(e,t){var n=p.getExactlyOneTensor(e);return n.mul(s.cast(n.greater(this.thetaTensor),"float32"))},e.prototype.computeOutputShape=function(e){return e},e.prototype.getConfig=function(){var e={theta:this.theta},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="ThresholdedReLU",e}(u.Layer);n.ThresholdedReLU=d,o.serialization.SerializationMap.register(d);var m=function(n){function e(e){var t=n.call(this,null==e?{}:e)||this;return t.DEFAULT_AXIS=1,null==e&&(e={}),t.softmax=(new a.Softmax).apply,t.axis=null==e.axis?t.DEFAULT_AXIS:e.axis,t}return i(e,n),e.prototype.call=function(e,t){var n=p.getExactlyOneTensor(e);return this.softmax(n,this.axis)},e.prototype.computeOutputShape=function(e){return e},e.prototype.getConfig=function(){var e={axis:this.axis},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="Softmax",e}(u.Layer);n.Softmax=m,o.serialization.SerializationMap.register(m)},{"../activations":190,"../backend/state":192,"../backend/tfjs_backend":193,"../engine/topology":201,"../errors":203,"../utils/types_utils":235,"@tensorflow/tfjs-core":66}],213:[function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var m=e("@tensorflow/tfjs-core"),u=e("@tensorflow/tfjs-core"),a=e("../activations"),l=e("../backend/common"),y=e("../backend/tfjs_backend"),c=e("../common"),s=e("../constraints"),p=e("../engine/topology"),g=e("../errors"),h=e("../initializers"),f=e("../regularizers"),v=e("../utils/conv_utils"),d=e("../utils/generic_utils"),b=e("../utils/types_utils");function _(e,t){return u.tidy(function(){return c.checkDataFormat(t),"channelsFirst"===t?m.transpose(e,[0,2,3,1]):e})}function w(t,n,r,i,o,a,s){return void 0===i&&(i=1),void 0===o&&(o="valid"),void 0===s&&(s=1),u.tidy(function(){if(null==a&&(a=l.imageDataFormat()),c.checkDataFormat(a),3!==t.shape.length)throw new g.ValueError("The input of a conv1dWithBias operation should be 3, but is "+t.shape.length+" instead.");if(3!==n.shape.length)throw new g.ValueError("The kernel for a conv1dWithBias operation should be 3, but is "+n.shape.length+" instead");if(null!=r&&1!==r.shape.length)throw new g.ValueError("The bias for a conv1dWithBias operation should be 1, but is "+n.shape.length+" instead");if("channelsFirst"===a&&(t=m.transpose(t,[0,2,1])),"causal"===o)throw new g.NotImplementedError("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var e=m.conv1d(t,n,i,"same"===o?"same":"valid","NWC",s);return null!=r&&(e=y.biasAdd(e,r)),e})}function S(t,n,r,i,o,a,s){return void 0===i&&(i=[1,1]),void 0===o&&(o="valid"),u.tidy(function(){if(null==a&&(a=l.imageDataFormat()),c.checkDataFormat(a),3!==t.rank&&4!==t.rank)throw new g.ValueError("conv2dWithBias expects input to be of rank 3 or 4, but received "+t.rank+".");if(3!==n.rank&&4!==n.rank)throw new g.ValueError("conv2dWithBias expects kernel to be of rank 3 or 4, but received "+t.rank+".");var e=_(t,a);if("causal"===o)throw new g.NotImplementedError("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return e=m.conv2d(e,n,i,"same"===o?"same":"valid","NHWC",s),null!=r&&(e=y.biasAdd(e,r)),"channelsFirst"===a&&(e=m.transpose(e,[0,3,1,2])),e})}n.preprocessConv2DInput=_,n.conv1dWithBias=w,n.conv1d=function(e,t,n,r,i,o){return void 0===n&&(n=1),void 0===r&&(r="valid"),void 0===o&&(o=1),u.tidy(function(){return c.checkDataFormat(i),w(e,t,null,n,r,i,o)})},n.conv2d=function(e,t,n,r,i,o){return void 0===n&&(n=[1,1]),void 0===r&&(r="valid"),u.tidy(function(){return c.checkDataFormat(i),S(e,t,null,n,r,i,o)})},n.conv2dWithBias=S;var i=function(r){function i(e,t){var n=r.call(this,t)||this;if(n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",i.verifyConfig(t),n.rank=e,1!==n.rank&&2!==n.rank)throw new g.NotImplementedError("Convolution layer for rank other than 1 or 2 ("+n.rank+") is not implemented yet.");if(n.kernelSize=v.normalizeArray(t.kernelSize,e,"kernelSize"),n.strides=v.normalizeArray(null==t.strides?1:t.strides,e,"strides"),n.padding=null==t.padding?"valid":t.padding,c.checkPaddingMode(n.padding),n.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,c.checkDataFormat(n.dataFormat),n.activation=a.getActivation(t.activation),n.useBias=null==t.useBias||t.useBias,n.biasInitializer=h.getInitializer(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.biasConstraint=s.getConstraint(t.biasConstraint),n.biasRegularizer=f.getRegularizer(t.biasRegularizer),n.activityRegularizer=f.getRegularizer(t.activityRegularizer),n.dilationRate=v.normalizeArray(null==t.dilationRate?1:t.dilationRate,e,"dilationRate"),1===n.rank&&Array.isArray(n.dilationRate)&&1!==n.dilationRate.length)throw new g.ValueError("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(n.dilationRate));if(2===n.rank)if("number"==typeof n.dilationRate)n.dilationRate=[n.dilationRate,n.dilationRate];else if(2!==n.dilationRate.length)throw new g.ValueError("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(n.dilationRate));return n}return o(i,r),i.verifyConfig=function(e){if(d.assert("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!d.checkArrayTypeAndLength(e.kernelSize,"number",1,2))throw new g.ValueError("BaseConv expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(e.kernelSize)+".")},i.prototype.getConfig=function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:a.serializeActivation(this.activation),useBias:this.useBias,biasInitializer:h.serializeInitializer(this.biasInitializer),biasRegularizer:f.serializeRegularizer(this.biasRegularizer),activityRegularizer:f.serializeRegularizer(this.activityRegularizer),biasConstraint:s.serializeConstraint(this.biasConstraint)},t=r.prototype.getConfig.call(this);return Object.assign(e,t),e},i}(p.Layer),x=function(r){function i(e,t){var n=r.call(this,e,t)||this;return n.kernel=null,i.verifyConfig(t),n.filters=t.filters,n.kernelInitializer=h.getInitializer(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.kernelConstraint=s.getConstraint(t.kernelConstraint),n.kernelRegularizer=f.getRegularizer(t.kernelRegularizer),n}return o(i,r),i.prototype.build=function(e){e=b.getExactlyOneShape(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new g.ValueError("The channel dimension of the input should be defined. Found "+e[t]);var n,r=e[t],i=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(n={},n[t]=r,n)}],this.built=!0},i.prototype.call=function(n,e){var r=this;return u.tidy(function(){var e;n=b.getExactlyOneTensor(n);var t=null==r.bias?null:r.bias.read();if(1===r.rank)e=w(n,r.kernel.read(),t,r.strides[0],r.padding,r.dataFormat,r.dilationRate[0]);else if(2===r.rank)e=S(n,r.kernel.read(),t,r.strides,r.padding,r.dataFormat,r.dilationRate);else if(3===r.rank)throw new g.NotImplementedError("3D convolution is not implemented yet.");return null!=r.activation&&(e=r.activation.apply(e)),e})},i.prototype.computeOutputShape=function(e){e=b.getExactlyOneShape(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var i=v.convOutputLength(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(i)}var o=[e[0]];return"channelsLast"===this.dataFormat?(o=o.concat(t)).push(this.filters):(o.push(this.filters),o=o.concat(t)),o},i.prototype.getConfig=function(){var e={filters:this.filters,kernelInitializer:h.serializeInitializer(this.kernelInitializer),kernelRegularizer:f.serializeRegularizer(this.kernelRegularizer),kernelConstraint:s.serializeConstraint(this.kernelConstraint)},t=r.prototype.getConfig.call(this);return Object.assign(e,t),e},i.verifyConfig=function(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new g.ValueError("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(e.filters))},i}(n.BaseConv=i),T=function(n){function r(e){var t=n.call(this,2,e)||this;return r.verifyConfig(e),t}return o(r,n),r.prototype.getConfig=function(){var e=n.prototype.getConfig.call(this);return delete e.rank,e},r.verifyConfig=function(e){if("number"!=typeof e.kernelSize&&!d.checkArrayTypeAndLength(e.kernelSize,"number",1,2))throw new g.ValueError("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received "+JSON.stringify(e.kernelSize)+".")},r.className="Conv2D",r}(n.Conv=x);n.Conv2D=T,u.serialization.SerializationMap.register(T);var P=function(n){function e(e){var t=n.call(this,e)||this;if(t.inputSpec=[new p.InputSpec({ndim:4})],"same"!==t.padding&&"valid"!==t.padding)throw new g.ValueError("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+t.padding);return t}return o(e,n),e.prototype.build=function(e){if(4!==(e=b.getExactlyOneShape(e)).length)throw new g.ValueError("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new g.ValueError("The channel dimension of the inputs should be defined. Found `None`.");var n,r=e[t],i=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new p.InputSpec({ndim:4,axes:(n={},n[t]=r,n)})],this.built=!0},e.prototype.call=function(f,e){var d=this;return m.tidy(function(){var e=b.getExactlyOneTensor(f);if(4!==e.shape.length)throw new g.ValueError("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+e.shape.length);var t,n,r=e.shape,i=r[0];"channelsFirst"===d.dataFormat?(t=2,n=3):(t=1,n=2);var o=r[t],a=r[n],s=d.kernelSize[0],u=d.kernelSize[1],l=d.strides[0],c=d.strides[1],p=[i,v.deconvLength(o,l,s,d.padding),v.deconvLength(a,c,u,d.padding),d.filters];"channelsLast"!==d.dataFormat&&(e=m.transpose(e,[0,2,3,1]));var h=m.conv2dTranspose(e,d.kernel.read(),p,d.strides,d.padding);return"channelsLast"!==d.dataFormat&&(h=m.transpose(h,[0,3,1,2])),null!=d.bias&&(h=y.biasAdd(h,d.bias.read(),d.dataFormat)),null!=d.activation&&(h=d.activation.apply(h)),h})},e.prototype.computeOutputShape=function(e){var t,n,r,i=(e=b.getExactlyOneShape(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var o=this.kernelSize[0],a=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return i[t]=this.filters,i[n]=v.deconvLength(i[n],s,o,this.padding),i[r]=v.deconvLength(i[r],u,a,this.padding),i},e.prototype.getConfig=function(){var e=n.prototype.getConfig.call(this);return delete e.dilationRate,e},e.className="Conv2DTranspose",e}(T);n.Conv2DTranspose=P,u.serialization.SerializationMap.register(P);var N=function(r){function e(e,t){var n=r.call(this,e,t)||this;if(n.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",n.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",n.depthwiseKernel=null,(n.pointwiseKernel=null)==t.filters)throw new g.ValueError("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=t.kernelInitializer||null!=t.kernelRegularizer||null!=t.kernelConstraint)throw new g.ValueError("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=t.padding&&"same"!==t.padding&&"valid"!==t.padding)throw new g.ValueError("SeparableConv"+n.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(t.padding));return n.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,n.depthwiseInitializer=h.getInitializer(t.depthwiseInitializer||n.DEFAULT_DEPTHWISE_INITIALIZER),n.depthwiseRegularizer=f.getRegularizer(t.depthwiseRegularizer),n.depthwiseConstraint=s.getConstraint(t.depthwiseConstraint),n.pointwiseInitializer=h.getInitializer(t.depthwiseInitializer||n.DEFAULT_POINTWISE_INITIALIZER),n.pointwiseRegularizer=f.getRegularizer(t.pointwiseRegularizer),n.pointwiseConstraint=s.getConstraint(t.pointwiseConstraint),n}return o(e,r),e.prototype.build=function(e){if((e=b.getExactlyOneShape(e)).length<this.rank+2)throw new g.ValueError("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2)+", but received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new g.ValueError("The channel dimension of the inputs should be defined, but found "+JSON.stringify(e[t]));for(var n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),i=[],o=0;o<this.rank;++o)i.push(1);i.push(n*this.depthMultiplier,this.filters);var a;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.inputSpec=[new p.InputSpec({ndim:this.rank+2,axes:(a={},a[t]=n,a)})],this.built=!0},e.prototype.call=function(t,e){var n=this;return u.tidy(function(){var e;if(t=b.getExactlyOneTensor(t),1===n.rank)throw new g.NotImplementedError("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(t=m.transpose(t,[0,2,3,1])),e=m.separableConv2d(t,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(e=y.biasAdd(e,n.bias.read(),n.dataFormat)),null!=n.activation&&(e=n.activation.apply(e)),"channelsFirst"===n.dataFormat&&(e=m.transpose(e,[0,3,1,2])),e})},e.prototype.getConfig=function(){var e=r.prototype.getConfig.call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=h.serializeInitializer(this.depthwiseInitializer),e.pointwiseInitializer=h.serializeInitializer(this.pointwiseInitializer),e.depthwiseRegularizer=f.serializeRegularizer(this.depthwiseRegularizer),e.pointwiseRegularizer=f.serializeRegularizer(this.pointwiseRegularizer),e.depthwiseConstraint=s.serializeConstraint(this.depthwiseConstraint),e.pointwiseConstraint=s.serializeConstraint(this.pointwiseConstraint),e},e.className="SeparableConv",e}(x),A=function(t){function e(e){return t.call(this,2,e)||this}return o(e,t),e.className="SeparableConv2D",e}(n.SeparableConv=N);n.SeparableConv2D=A,u.serialization.SerializationMap.register(A);var O=function(n){function r(e){var t=n.call(this,1,e)||this;return r.verifyConfig(e),t.inputSpec=[{ndim:3}],t}return o(r,n),r.prototype.getConfig=function(){var e=n.prototype.getConfig.call(this);return delete e.rank,delete e.dataFormat,e},r.verifyConfig=function(e){if("number"!=typeof e.kernelSize&&!d.checkArrayTypeAndLength(e.kernelSize,"number",1,1))throw new g.ValueError("Conv1D expects config.kernelSize to be number or number[] with length 1, but received "+JSON.stringify(e.kernelSize)+".")},r.className="Conv1D",r}(x);n.Conv1D=O,u.serialization.SerializationMap.register(O);var k=function(n){function e(e){var t=n.call(this,e)||this;return"number"==typeof e.cropping?t.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?t.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:t.cropping=e.cropping,t.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,t.inputSpec=[{ndim:4}],t}return o(e,n),e.prototype.computeOutputShape=function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]},e.prototype.call=function(t,e){var n=this;return u.tidy(function(){if(t=b.getExactlyOneTensor(t),"channelsLast"===n.dataFormat){var e=y.sliceAlongAxis(t,n.cropping[0][0],t.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return y.sliceAlongAxis(e,n.cropping[1][0],t.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}e=y.sliceAlongAxis(t,n.cropping[0][0],t.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return y.sliceAlongAxis(e,n.cropping[1][0],t.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)})},e.prototype.getConfig=function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="Cropping2D",e}(p.Layer);n.Cropping2D=k,u.serialization.SerializationMap.register(k);var E=function(n){function e(e){var t=n.call(this,e)||this;return t.DEFAULT_SIZE=[2,2],t.inputSpec=[{ndim:4}],t.size=null==e.size?t.DEFAULT_SIZE:e.size,t.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,t}return o(e,n),e.prototype.computeOutputShape=function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}t=null==e[1]?null:this.size[0]*e[1],n=null==e[2]?null:this.size[1]*e[2];return[e[0],t,n,e[3]]},e.prototype.call=function(o,e){var a=this;return m.tidy(function(){var e=b.getExactlyOneTensor(o),t=e.shape;if("channelsFirst"===a.dataFormat){e=m.transpose(e,[0,2,3,1]);var n=a.size[0]*t[2],r=a.size[1]*t[3],i=e.resizeNearestNeighbor([n,r]);return m.transpose(i,[0,3,1,2])}n=a.size[0]*t[1],r=a.size[1]*t[2];return e.resizeNearestNeighbor([n,r])})},e.prototype.getConfig=function(){var e={size:this.size,dataFormat:this.dataFormat},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="UpSampling2D",e}(p.Layer);n.UpSampling2D=E,u.serialization.SerializationMap.register(E)},{"../activations":190,"../backend/common":191,"../backend/tfjs_backend":193,"../common":196,"../constraints":197,"../engine/topology":201,"../errors":203,"../initializers":211,"../regularizers":229,"../utils/conv_utils":230,"../utils/generic_utils":231,"../utils/types_utils":235,"@tensorflow/tfjs-core":66}],214:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var s=e("@tensorflow/tfjs-core"),u=e("@tensorflow/tfjs-core"),l=e("../backend/common"),o=e("../backend/tfjs_backend"),c=e("../common"),a=e("../constraints"),p=e("../errors"),h=e("../initializers"),f=e("../regularizers"),d=e("../utils/conv_utils"),m=e("../utils/types_utils"),y=e("./convolutional");function g(t,n,r,i,o,a){return void 0===r&&(r=[1,1]),void 0===i&&(i="valid"),u.tidy(function(){null==o&&(o=l.imageDataFormat()),c.checkDataFormat(o);var e=y.preprocessConv2DInput(t,o);if(4!==t.rank)throw new p.ValueError("Input for depthwiseConv2d is required to be 4-D, but is instead "+t.rank+"-D");if(4!==n.rank)throw new p.ValueError("depthwiseKernel is required to be 4-D, but is instead "+n.rank+"-D");return e=s.depthwiseConv2d(e,n,r,"same"===i?"same":"valid","NHWC",a),"channelsFirst"===o&&(e=s.transpose(e,[0,3,1,2])),e})}n.depthwiseConv2d=g;var v=function(n){function e(e){var t=n.call(this,2,e)||this;return t.depthwiseKernel=null,t.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,t.depthwiseInitializer=h.getInitializer(e.depthwiseInitializer||t.DEFAULT_KERNEL_INITIALIZER),t.depthwiseConstraint=a.getConstraint(e.depthwiseConstraint),t.depthwiseRegularizer=f.getRegularizer(e.depthwiseRegularizer),t}return i(e,n),e.prototype.build=function(e){if((e=m.getExactlyOneShape(e)).length<4)throw new p.ValueError("Inputs to DepthwiseConv2D should have rank 4. Received input shape: "+JSON.stringify(e)+".");var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new p.ValueError("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not ("+e[t]+").");var n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,e){var n=this;return u.tidy(function(){var e=g(t=m.getExactlyOneTensor(t),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(e=o.biasAdd(e,n.bias.read(),n.dataFormat)),null!=n.activation&&(e=n.activation.apply(e)),e})},e.prototype.computeOutputShape=function(e){e=m.getExactlyOneShape(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=d.convOutputLength(t,this.kernelSize[0],this.padding,this.strides[0]),o=d.convOutputLength(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,i,o]:[e[0],i,o,r]},e.prototype.getConfig=function(){var e=n.prototype.getConfig.call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=h.serializeInitializer(this.depthwiseInitializer),e.depthwiseRegularizer=f.serializeRegularizer(this.depthwiseRegularizer),e.depthwiseConstraint=a.serializeConstraint(this.depthwiseRegularizer),e},e.className="DepthwiseConv2D",e}(y.BaseConv);n.DepthwiseConv2D=v,u.serialization.SerializationMap.register(v)},{"../backend/common":191,"../backend/tfjs_backend":193,"../common":196,"../constraints":197,"../errors":203,"../initializers":211,"../regularizers":229,"../utils/conv_utils":230,"../utils/types_utils":235,"./convolutional":213,"@tensorflow/tfjs-core":66}],215:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=e("@tensorflow/tfjs-core"),o=e("../activations"),s=e("../backend/state"),u=e("../backend/tfjs_backend"),l=e("../constraints"),c=e("../engine/topology"),p=e("../errors"),h=e("../initializers"),f=e("../regularizers"),d=e("../utils/math_utils"),m=e("../utils/types_utils"),y=function(n){function e(e){var t=n.call(this,e)||this;if(t.rate=Math.max(Math.min(e.rate,1),0),t.rateScalar=s.getScalar(t.rate),t.noiseShape=e.noiseShape,t.seed=e.seed,null!=t.seed)throw new p.NotImplementedError("Non-default seed is not implemented in Dropout layer yet: "+t.seed);return t.supportsMasking=!0,t}return i(e,n),e.prototype.getNoiseShape=function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n},e.prototype.call=function(r,i){var o=this;return a.tidy(function(){o.invokeCallHook(r,i);var e=m.getExactlyOneTensor(r);if(null!=o.noiseShape&&!a.util.arraysEqual(e.shape,o.noiseShape))throw new p.NotImplementedError("Non-default noise shape is not implemented in Dropout layer yet: "+JSON.stringify(o.noiseShape));if(0<o.rate&&o.rate<1){var t=null!=i.training&&i.training,n=o.getNoiseShape(e);return u.inTrainPhase(function(){return u.dropout(e,o.rateScalar,n,o.seed)},function(){return e},t)}return r})},e.prototype.getConfig=function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="Dropout",e}(c.Layer);n.Dropout=y,a.serialization.SerializationMap.register(y);var g=function(r){function e(e){var t=r.call(this,e)||this;if(t.activation=null,t.useBias=!0,t.kernel=null,t.bias=null,t.DEFAULT_KERNEL_INITIALIZER="glorotNormal",t.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var n=null;null!=e.batchSize&&(n=e.batchSize),t.batchInputShape=[n,e.inputDim]}return t.units=e.units,t.activation=o.getActivation(e.activation),null!=e.useBias&&(t.useBias=e.useBias),t.kernelInitializer=h.getInitializer(e.kernelInitializer||t.DEFAULT_KERNEL_INITIALIZER),t.biasInitializer=h.getInitializer(e.biasInitializer||t.DEFAULT_BIAS_INITIALIZER),t.kernelConstraint=l.getConstraint(e.kernelConstraint),t.biasConstraint=l.getConstraint(e.biasConstraint),t.kernelRegularizer=f.getRegularizer(e.kernelRegularizer),t.biasRegularizer=f.getRegularizer(e.biasRegularizer),t.activityRegularizer=f.getRegularizer(e.activityRegularizer),t.inputSpec=[{minNDim:2}],t}return i(e,r),e.prototype.build=function(e){var t,n=(e=m.getExactlyOneShape(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(t={},t[-1]=n,t)}],this.built=!0},e.prototype.computeOutputShape=function(e){var t=(e=m.getExactlyOneShape(e)).slice();return t[t.length-1]=this.units,t},e.prototype.call=function(n,r){var i=this;return a.tidy(function(){i.invokeCallHook(n,r);var e=m.getExactlyOneTensor(n),t=u.dot(e,i.kernel.read());return null!=i.bias&&(t=u.biasAdd(t,i.bias.read())),null!=i.activation&&(t=i.activation.apply(t)),t})},e.prototype.getConfig=function(){var e={units:this.units,activation:o.serializeActivation(this.activation),useBias:this.useBias,kernelInitializer:h.serializeInitializer(this.kernelInitializer),biasInitializer:h.serializeInitializer(this.biasInitializer),kernelRegularizer:f.serializeRegularizer(this.kernelRegularizer),biasRegularizer:f.serializeRegularizer(this.biasRegularizer),activityRegularizer:f.serializeRegularizer(this.activityRegularizer),kernelConstraint:l.serializeConstraint(this.kernelConstraint),biasConstraint:l.serializeConstraint(this.biasConstraint)},t=r.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="Dense",e}(c.Layer);n.Dense=g,a.serialization.SerializationMap.register(g);var v=function(n){function e(e){var t=n.call(this,e||{})||this;return t.inputSpec=[{minNDim:3}],t}return i(e,n),e.prototype.computeOutputShape=function(e){for(var t=0,n=(e=m.getExactlyOneShape(e)).slice(1);t<n.length;t++){if(null==n[t])throw new p.ValueError('The shape of the input to "Flatten" is not fully defined (got '+e.slice(1)+'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.')}return[e[0],d.arrayProd(e,1)]},e.prototype.call=function(e,t){var n=this;return a.tidy(function(){return n.invokeCallHook(e,t),u.batchFlatten(m.getExactlyOneTensor(e))})},e.className="Flatten",e}(c.Layer);n.Flatten=v,a.serialization.SerializationMap.register(v);var b=function(n){function e(e){var t=n.call(this,e)||this;return t.supportsMasking=!0,t.activation=o.getActivation(e.activation),t}return i(e,n),e.prototype.call=function(t,n){var r=this;return a.tidy(function(){r.invokeCallHook(t,n);var e=m.getExactlyOneTensor(t);return r.activation.apply(e)})},e.prototype.getConfig=function(){var e={activation:o.serializeActivation(this.activation)},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="Activation",e}(c.Layer);n.Activation=b,a.serialization.SerializationMap.register(b);var _=function(n){function e(e){var t=n.call(this,e)||this;return t.n=e.n,t.inputSpec=[{ndim:2}],t}return i(e,n),e.prototype.computeOutputShape=function(e){return[e[0],this.n,e[1]]},e.prototype.call=function(e,t){var n=this;return a.tidy(function(){return e=m.getExactlyOneTensor(e),u.repeat(e,n.n)})},e.prototype.getConfig=function(){var e={n:this.n},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="RepeatVector",e}(c.Layer);n.RepeatVector=_,a.serialization.SerializationMap.register(_);var w=function(r){function e(e){var t=r.call(this,e)||this;t.targetShape=e.targetShape;for(var n=0;n<t.targetShape.length;++n)t.isUnknown(t.targetShape[n])&&(t.targetShape[n]=null);return t}return i(e,r),e.prototype.isUnknown=function(e){return e<0||null==e},e.prototype.fixUnknownDimension=function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),i=1,o=null,a=0;a<r.length;++a){var s=r[a];if(this.isUnknown(s)){if(null!==o)throw new p.ValueError("Can only specifiy one unknown dimension.");o=a}else i*=s}var u=d.arrayProd(e);if(null!==o){if(0===i||u%i!=0)throw new p.ValueError(n);r[o]=u/i}else if(u!==i)throw new p.ValueError(n);return r},e.prototype.computeOutputShape=function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))},e.prototype.call=function(r,i){var o=this;return a.tidy(function(){o.invokeCallHook(r,i);var e=m.getExactlyOneTensor(r),t=e.shape,n=t.slice(0,1).concat(o.fixUnknownDimension(t.slice(1),o.targetShape));return e.reshape(n)})},e.prototype.getConfig=function(){var e={targetShape:this.targetShape},t=r.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="Reshape",e}(c.Layer);n.Reshape=w,a.serialization.SerializationMap.register(w);var S=function(r){function e(e){var t=r.call(this,e)||this;if(null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+e.dims+" instead.");var n=d.range(1,e.dims.length+1);if(!a.util.arraysEqual(e.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return t.dims=e.dims,t.dimsIncludingBatch=[0].concat(t.dims),t.inputSpec=[new c.InputSpec({ndim:t.dims.length+1})],t}return i(e,r),e.prototype.computeOutputShape=function(n){var r=(n=m.getExactlyOneShape(n)).slice();return this.dims.forEach(function(e,t){r[t+1]=n[e]}),r},e.prototype.call=function(e,t){return a.transpose(m.getExactlyOneTensor(e),this.dimsIncludingBatch)},e.prototype.getConfig=function(){var e={dims:this.dims},t=r.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="Permute",e}(c.Layer);n.Permute=S,a.serialization.SerializationMap.register(S)},{"../activations":190,"../backend/state":192,"../backend/tfjs_backend":193,"../constraints":197,"../engine/topology":201,"../errors":203,"../initializers":211,"../regularizers":229,"../utils/math_utils":233,"../utils/types_utils":235,"@tensorflow/tfjs-core":66}],216:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core"),a=e("../backend/tfjs_backend"),s=e("../constraints"),u=e("../engine/topology"),l=e("../errors"),c=e("../initializers"),p=e("../regularizers"),h=e("../utils/generic_utils"),f=e("../utils/types_utils"),d=function(r){function e(e){var t=r.call(this,e)||this;if(t.embeddings=null,t.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var n=null;null!=e.batchSize&&(n=e.batchSize),null==e.inputLength?t.batchInputShape=[n,null]:t.batchInputShape=[n].concat(h.toList(e.inputLength))}return t.inputDim=e.inputDim,t.outputDim=e.outputDim,t.embeddingsInitializer=c.getInitializer(e.embeddingsInitializer||t.DEFAULT_EMBEDDINGS_INITIALIZER),t.embeddingsRegularizer=p.getRegularizer(e.embeddingsRegularizer),t.activityRegularizer=p.getRegularizer(e.activityRegularizer),t.embeddingsConstraint=s.getConstraint(e.embeddingsConstraint),t.maskZero=e.maskZero,t.inputLength=e.inputLength,t}return i(e,r),e.prototype.build=function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},e.prototype.warnOnIncompatibleInputShape=function(e){},e.prototype.computeMask=function(e,t){throw new l.NotImplementedError("computeMask has not been implemented for Embedding yet")},e.prototype.computeOutputShape=function(e){if(e=f.getExactlyOneShape(e),null==this.inputLength)return e.concat([this.outputDim]);var t=h.toList(this.inputLength);if(t.length!==e.length-1)throw new l.ValueError('"inputLength" is '+this.inputLength+", but received input shape has shape "+e);for(var n=0,r=0;r<t.length;++r){var i=t[r],o=e[r+1];if(null!=i&&null!=o&&i!==o)throw new l.ValueError('"inputLength" is '+this.inputLength+", but received input shape has shape "+e);null==i&&(t[n]=o),n++}return[e[0]].concat(t,[this.outputDim])},e.prototype.call=function(t,n){var r=this;return o.tidy(function(){r.invokeCallHook(t,n);var e=f.getExactlyOneTensor(t);return"int32"!==e.dtype&&(e=a.cast(e,"int32")),a.gather(r.embeddings.read(),e.as1D()).reshape(f.getExactlyOneShape(r.computeOutputShape(e.shape)))})},e.prototype.getConfig=function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:c.serializeInitializer(this.embeddingsInitializer),embeddingsRegularizer:p.serializeRegularizer(this.embeddingsRegularizer),activityRegularizer:p.serializeRegularizer(this.activityRegularizer),embeddingsConstraint:s.serializeConstraint(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=r.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="Embedding",e}(u.Layer);n.Embedding=d,o.serialization.SerializationMap.register(d)},{"../backend/tfjs_backend":193,"../constraints":197,"../engine/topology":201,"../errors":203,"../initializers":211,"../regularizers":229,"../utils/generic_utils":231,"../utils/types_utils":235,"@tensorflow/tfjs-core":66}],217:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var w=e("@tensorflow/tfjs-core"),p=e("@tensorflow/tfjs-core"),S=e("../backend/tfjs_backend"),o=e("../engine/topology"),a=e("../backend/state"),h=e("../errors"),u=e("../utils/generic_utils"),x=e("../utils/math_utils"),l=e("../utils/types_utils"),s=function(n){function e(e){var t=n.call(this,e||{})||this;return t.supportsMasking=!0,t}return i(e,n),e.prototype.mergeFunction=function(e){throw new h.NotImplementedError},e.prototype.computeElementwiseOpOutputShape=function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var i=e[e.length-t.length+r],o=t[r];if(null==i||null==o||i<0||o<0)n.push(null);else if(1===i)n.push(o);else if(1===o)n.push(i);else{if(i!==o)throw new h.ValueError("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(i)}}return n},e.prototype.build=function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[l.getExactlyOneShape(e)]),(e=e).length<2)throw new h.ValueError("A merge layer should be called on an Array of at least 2 inputs. Got "+e.length+" input(s).");for(var t=[],n=0,r=e;n<r.length;n++){null!=(a=r[n])&&null!==a[0]&&t.push(a[0])}if(1<(t=u.unique(t)).length)throw new h.ValueError("Can not merge tensors with different batch sizes. Got tensors with shapes: "+JSON.stringify(e)+".");for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var a=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,a)}var s=e.map(function(e){return e.length});-1===e.indexOf(null)&&1===u.unique(s).length?this.reshapeRequired=!1:this.reshapeRequired=!0},e.prototype.call=function(b,e){var _=this;return p.tidy(function(){if(b=b,_.reshapeRequired){var e=[],t=b.map(function(e){return e.rank});if(-1===t.indexOf(null)){for(var n=x.max(t),r=0,i=b;r<i.length;r++){for(var o=(c=i[r]).rank,a=0;a<n-o;++a)c=S.expandDims(c,1);e.push(c)}return _.mergeFunction(e)}for(var s=!1,u=0,l=b;u<l.length;u++){var c;if(null==(o=(c=l[u]).rank)){var p=c.shape,h=p[0],f=p.slice(1).concat([h]),d=c.reshape([h].concat(x.arrayProd(p.slice(1))));d=(d=w.transpose(d,[1,0])).reshape(f),e.push(d),s=!0}else if(1<o){var m=x.range(1,o).concat([0]);e.push(w.transpose(c,m)),s=!0}else e.push(c)}var y=_.mergeFunction(e),g=y.rank;if(s)if(null==g){var v=y.shape;f=[h=v[v.length-1]].concat(v.slice(0,v.length-1));y=w.transpose(y.reshape([-1,h]),[1,0]).reshape(f)}else if(1<g){m=[g-1].concat(x.range(0,g-1));y=w.transpose(y,m)}return y}return _.mergeFunction(b)})},e.prototype.computeOutputShape=function(e){var t;t=null==(e=e)[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}for(var i=[],o=0,a=e;o<a.length;o++){null!=(r=a[o])&&null!==r[0]&&i.push(r[0])}return t=1===(i=u.unique(i)).length?i.concat(t):[null].concat(t)},e}(o.Layer),c=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.mergeFunction=function(i){return p.tidy(function(){for(var e=w.zeros(i[0].shape),t=0,n=i;t<n.length;t++){var r=n[t];e=w.add(e,r)}return e})},e.className="Add",e}(n.Merge=s);n.Add=c,p.serialization.SerializationMap.register(c),n.add=function(e){return Array.isArray(e)?new c({}).apply(e):new c(e)};var f=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.mergeFunction=function(i){return p.tidy(function(){for(var e=w.ones(i[0].shape),t=0,n=i;t<n.length;t++){var r=n[t];e=w.mul(e,r)}return e})},e.className="Multiply",e}(s);n.Multiply=f,p.serialization.SerializationMap.register(f),n.multiply=function(e){return Array.isArray(e)?new f({}).apply(e):new f(e)};var d=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.mergeFunction=function(i){return p.tidy(function(){for(var e=w.zeros(i[0].shape),t=0,n=i;t<n.length;t++){var r=n[t];e=w.add(e,r)}return w.mul(a.getScalar(1/i.length),e)})},e.className="Average",e}(s);n.Average=d,p.serialization.SerializationMap.register(d),n.average=function(e){return Array.isArray(e)?new d({}).apply(e):new d(e)};var m=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.mergeFunction=function(n){return p.tidy(function(){for(var e=n[0],t=1;t<n.length;++t)e=w.maximum(e,n[t]);return e})},e.className="Maximum",e}(s);n.Maximum=m,p.serialization.SerializationMap.register(m),n.maximum=function(e){return Array.isArray(e)?new m({}).apply(e):new m(e)};var y=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.mergeFunction=function(n){return p.tidy(function(){for(var e=n[0],t=1;t<n.length;++t)e=w.minimum(e,n[t]);return e})},e.className="Minimum",e}(s);n.Minimum=y,p.serialization.SerializationMap.register(y),n.minimum=function(e){return Array.isArray(e)?new y({}).apply(e):new y(e)};var g=function(n){function e(e){var t=n.call(this,e)||this;return t.DEFAULT_AXIS=-1,null==e&&(e={}),t.axis=null==e.axis?t.DEFAULT_AXIS:e.axis,t.supportsMasking=!0,t.reshapeRequired=!1,t}return i(e,n),e.prototype.build=function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new h.ValueError("A `Concatenate` layer should be called on a list of at least 2 inputs");for(var t=!0,n=0,r=e=e;n<r.length;n++){if(null!=(c=r[n])){t=!1;break}}if(!t){for(var i=[],o=0;o<e.length;++o){var a=e[o].slice();a.splice(this.axis,1);for(var s=!1,u=0,l=i;u<l.length;u++){var c=l[u];if(p.util.arraysEqual(c,a)){s=!0;break}}s||i.push(a)}if(1<i.length)throw new h.ValueError("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}},e.prototype.mergeFunction=function(e){var t=this;return p.tidy(function(){return S.concatenate(e,t.axis)})},e.prototype.computeOutputShape=function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new h.ValueError("A `Concatenate` layer should be called on a list of inputs.");for(var t=e,n=t[0].slice(),r=this.axis<0?n.length+this.axis:this.axis,i=0,o=t.slice(1);i<o.length;i++){var a=o[i];if(null==n[r]||null==a[r]){n[r]=null;break}n[r]+=a[r]}return n},e.prototype.getConfig=function(){var e={axis:this.axis},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="Concatenate",e}(s);n.Concatenate=g,p.serialization.SerializationMap.register(g),n.concatenate=function(e){return Array.isArray(e)?new g({}).apply(e):new g(e)}},{"../backend/state":192,"../backend/tfjs_backend":193,"../engine/topology":201,"../errors":203,"../utils/generic_utils":231,"../utils/math_utils":233,"../utils/types_utils":235,"@tensorflow/tfjs-core":66}],218:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var v=e("@tensorflow/tfjs-core"),b=e("@tensorflow/tfjs-core"),o=e("../constraints"),a=e("../engine/topology"),_=e("../backend/state"),s=e("../errors"),u=e("../initializers"),l=e("../regularizers"),w=e("../utils/generic_utils"),S=e("../utils/math_utils"),x=e("../utils/types_utils");function T(e,t,n,r,i,o){var a;if(void 0===o&&(o=.001),2===e.rank)a=v.batchNormalization2d(e,t,n,o,i,r);else if(3===e.rank)a=v.batchNormalization3d(e,t,n,o,i,r);else{if(4!==e.rank)throw new s.NotImplementedError("batchNormalization is not implememnted for array of rank "+e.rank+" yet");a=v.batchNormalization4d(e,t,n,o,i,r)}return a}function P(e,t,n,r,i){return void 0===i&&(i=.001),b.util.arraysEqual(r.slice().sort(),S.range(0,e.rank-1))?(o=e,a=t,s=n,u=r,void 0===(l=i)&&(l=.001),b.tidy(function(){var e=v.moments(o,u),t=e.mean,n=e.variance;return[T(o,t,n,s,a,l),t,n]})):(p=e,h=t,f=n,d=r,void 0===(m=i)&&(m=.001),b.tidy(function(){for(var e=v.moments(p,d),t=e.mean,n=e.variance,r=[],i=0,o=S.range(0,p.rank);i<o.length;i++){var a=o[i];-1!==d.indexOf(a)?r.push(1):r.push(p.shape[a])}var s=t.reshape(r),u=n.reshape(r),l=null==h?null:h.reshape(r),c=null==f?null:f.reshape(r);return[T(p,s,u,c,l,m),t,n]}));var p,h,f,d,m,o,a,s,u,l}n.batchNormalization=T,n.normalizeBatchInTraining=P;var c=function(n){function e(e){var t=n.call(this,e)||this;return t.supportsMasking=!0,t.axis=null==e.axis?-1:e.axis,t.momentum=null==e.momentum?.99:e.momentum,t.epsilon=null==e.epsilon?.001:e.epsilon,t.center=null==e.center||e.center,t.scale=null==e.scale||e.scale,t.betaInitializer=u.getInitializer(e.betaInitializer||"zeros"),t.gammaInitializer=u.getInitializer(e.gammaInitializer||"ones"),t.movingMeanInitializer=u.getInitializer(e.movingMeanInitializer||"zeros"),t.movingVarianceInitializer=u.getInitializer(e.movingVarianceInitializer||"ones"),t.betaConstraint=o.getConstraint(e.betaConstraint),t.gammaConstraint=o.getConstraint(e.gammaConstraint),t.betaRegularizer=l.getRegularizer(e.betaRegularizer),t.gammaRegularizer=l.getRegularizer(e.gammaRegularizer),t.stepCount=0,t}return i(e,n),e.prototype.build=function(e){e=x.getExactlyOneShape(e);var t=0<=this.axis?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new s.ValueError("Axis "+t+" of input tensor should have a defined dimension but the layer received an input with shape "+JSON.stringify(e)+".");this.inputSpec=[new a.InputSpec({ndim:e.length,axes:(r={},r[t]=n,r)})];var r,i=[n];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0},e.prototype.call=function(m,y){var g=this;return b.tidy(function(){var e=null!=y.training&&y.training,i=x.getExactlyOneTensor(m),t=i.shape,n=t.length,r=S.range(0,n),o=0<=g.axis?g.axis:g.axis+n;r.splice(o,1);var a=w.pyListRepeat(1,n);a[o]=t[o];var s=r.slice();s.sort();var u=!b.util.arraysEqual(s,S.range(0,n).slice(0,n-1));if(!e)return function(){if(u){var e=g.movingMean.read().reshape(a),t=g.movingVariance.read().reshape(a),n=g.center?g.beta.read().reshape(a):null,r=g.scale?g.gamma.read().reshape(a):null;return T(i,e,t,n,r,g.epsilon)}return T(i,g.movingMean.read(),g.movingVariance.read(),null==g.beta?null:g.beta.read(),null==g.gamma?null:g.gamma.read(),g.epsilon)}();var l=P(i,g.gamma.read(),g.beta.read(),r,g.epsilon),c=l[0],p=l[1],h=l[2],f=S.arrayProd(r.map(function(e){return i.shape[e]})),d=h.mul(_.getScalar(f/(f-(1+g.epsilon))));return function(){g.stepCount++;var e=v.movingAverage(g.movingMean.read(),p,g.momentum,g.stepCount);g.movingMean.write(e);var t=v.movingAverage(g.movingVariance.read(),d,g.momentum,g.stepCount);g.movingVariance.write(t)}(),c})},e.prototype.getConfig=function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:u.serializeInitializer(this.betaInitializer),gammaInitializer:u.serializeInitializer(this.gammaInitializer),movingMeanInitializer:u.serializeInitializer(this.movingMeanInitializer),movingVarianceInitializer:u.serializeInitializer(this.movingVarianceInitializer),betaRegularizer:l.serializeRegularizer(this.betaRegularizer),gammaRegularizer:l.serializeRegularizer(this.gammaRegularizer),betaConstraint:o.serializeConstraint(this.betaConstraint),gammaConstraint:o.serializeConstraint(this.gammaConstraint)},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="BatchNormalization",e}(a.Layer);n.BatchNormalization=c,b.serialization.SerializationMap.register(c)},{"../backend/state":192,"../constraints":197,"../engine/topology":201,"../errors":203,"../initializers":211,"../regularizers":229,"../utils/generic_utils":231,"../utils/math_utils":233,"../utils/types_utils":235,"@tensorflow/tfjs-core":66}],219:[function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var i=e("@tensorflow/tfjs-core"),a=e("@tensorflow/tfjs-core"),s=e("../backend/common"),u=e("../engine/topology"),l=e("../errors"),c=e("../utils/types_utils");function p(t,n,r){return a.tidy(function(){if(4!==t.rank)throw new l.ValueError("temporalPadding expects input tensor to be 4-D, but received a "+t.rank+"-D tensor.");if(null==n&&(n=[[1,1],[1,1]]),2!==n.length||2!==n[0].length||2!==n[1].length)throw new l.ValueError("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==r&&(r=s.imageDataFormat()),"channelsLast"!==r&&"channelsFirst"!==r)throw new l.ValueError("Unknown data format: "+r+". Supported data formats are 'channelsLast' and 'channelsFirst.");var e;return e="channelsFirst"===r?[[0,0],[0,0],n[0],n[1]]:[[0,0],n[0],n[1],[0,0]],i.pad(t,e)})}n.temporalPadding=function(t,n){return a.tidy(function(){if(3!==t.rank)throw new l.ValueError("temporalPadding expects input tensor to be 3-D, but received a "+t.rank+"-D tensor.");if(null==n&&(n=[1,1]),2!==n.length)throw new l.ValueError("temporalPadding expects input padding pattern to be a length-2 array, but received a length-"+n.length+" array.");var e=[[0,0],n,[0,0]];return i.pad(t,e)})},n.spatial2dPadding=p;var h=function(i){function e(e){var t=this;if(null==e&&(e={}),(t=i.call(this,e)||this).dataFormat=null==e.dataFormat?s.imageDataFormat():e.dataFormat,null==e.padding)t.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)t.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new l.ValueError("ZeroPadding2D expects padding to be a length-2 array, but received a length-"+e.padding.length+" array.");var n=void 0,r=void 0;if("number"==typeof e.padding[0])n=[e.padding[0],e.padding[0]],r=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new l.ValueError("ZeroPadding2D expects height padding to be a length-2 array, but received a length-"+e.padding[0].length+" array.");if(n=e.padding[0],2!==e.padding[1].length)throw new l.ValueError("ZeroPadding2D expects width padding to be a length-2 array, but received a length-"+e.padding[1].length+" array.");r=e.padding[1]}t.padding=[n,r]}return t.inputSpec=[new u.InputSpec({ndim:4})],t}return o(e,i),e.prototype.computeOutputShape=function(e){var t,n;return e=c.getExactlyOneShape(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&0<=e[2]?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&0<=e[3]?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&0<=e[1]?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&0<=e[2]?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])},e.prototype.call=function(e,t){var n=this;return a.tidy(function(){return p(c.getExactlyOneTensor(e),n.padding,n.dataFormat)})},e.prototype.getConfig=function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=i.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="ZeroPadding2D",e}(u.Layer);n.ZeroPadding2D=h,a.serialization.SerializationMap.register(h)},{"../backend/common":191,"../engine/topology":201,"../errors":203,"../utils/types_utils":235,"@tensorflow/tfjs-core":66}],220:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var u=e("@tensorflow/tfjs-core"),l=e("@tensorflow/tfjs-core"),c=e("../backend/common"),o=e("../backend/tfjs_backend"),p=e("../common"),a=e("../engine/topology"),s=e("../engine/topology"),h=e("../errors"),f=e("../utils/conv_utils"),d=e("../utils/types_utils"),m=e("./convolutional");function y(n,r,i,o,a,s){return l.tidy(function(){var e;p.checkDataFormat(a),p.checkPoolMode(s),p.checkPaddingMode(o),null==i&&(i=[1,1]),null==o&&(o="valid"),null==a&&(a=c.imageDataFormat()),null==s&&(s="max"),n=m.preprocessConv2DInput(n,a);var t="same"===o?"same":"valid";return e="max"===s?u.maxPool(n,r,i,t):u.avgPool(n,r,i,t),"channelsFirst"===a&&(e=u.transpose(e,[0,3,1,2])),e})}n.pool2d=y;var g=function(n){function e(e){var t=this;if(null==e.poolSize&&(e.poolSize=2),t=n.call(this,e)||this,"number"==typeof e.poolSize)t.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new h.ValueError("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.poolSize));t.poolSize=e.poolSize}if(null==e.strides)t.strides=t.poolSize;else if("number"==typeof e.strides)t.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new h.ValueError("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.strides));t.strides=e.strides}return t.padding=null==e.padding?"valid":e.padding,p.checkPaddingMode(t.padding),t.inputSpec=[new a.InputSpec({ndim:3})],t}return i(e,n),e.prototype.computeOutputShape=function(e){e=d.getExactlyOneShape(e);var t=f.convOutputLength(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]},e.prototype.call=function(t,n){var r=this;return l.tidy(function(){r.invokeCallHook(t,n),t=o.expandDims(d.getExactlyOneTensor(t),2);var e=r.poolingFunction(d.getExactlyOneTensor(t),[r.poolSize[0],1],[r.strides[0],1],r.padding,"channelsLast");return u.squeeze(e,[2])})},e.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e}(s.Layer),v=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.poolingFunction=function(e,t,n,r,i){return p.checkDataFormat(i),p.checkPaddingMode(r),y(e,t,n,r,i,"max")},e.className="MaxPooling1D",e}(n.Pooling1D=g);n.MaxPooling1D=v,l.serialization.SerializationMap.register(v);var b=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.poolingFunction=function(e,t,n,r,i){return p.checkDataFormat(i),p.checkPaddingMode(r),y(e,t,n,r,i,"avg")},e.className="AveragePooling1D",e}(g);n.AveragePooling1D=b,l.serialization.SerializationMap.register(b);var _=function(n){function e(e){var t=this;if(null==e.poolSize&&(e.poolSize=[2,2]),(t=n.call(this,e)||this).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)t.strides=t.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new h.ValueError("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+e.strides.length+".");t.strides=e.strides}else t.strides=[e.strides,e.strides];return t.padding=null==e.padding?"valid":e.padding,t.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,p.checkDataFormat(t.dataFormat),p.checkPaddingMode(t.padding),t.inputSpec=[new a.InputSpec({ndim:4})],t}return i(e,n),e.prototype.computeOutputShape=function(e){e=d.getExactlyOneShape(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=f.convOutputLength(t,this.poolSize[0],this.padding,this.strides[0]),n=f.convOutputLength(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]},e.prototype.call=function(e,t){var n=this;return l.tidy(function(){return n.invokeCallHook(e,t),n.poolingFunction(d.getExactlyOneTensor(e),n.poolSize,n.strides,n.padding,n.dataFormat)})},e.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e}(s.Layer),w=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.poolingFunction=function(e,t,n,r,i){return p.checkDataFormat(i),p.checkPaddingMode(r),y(e,t,n,r,i,"max")},e.className="MaxPooling2D",e}(n.Pooling2D=_);n.MaxPooling2D=w,l.serialization.SerializationMap.register(w);var S=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.poolingFunction=function(e,t,n,r,i){return p.checkDataFormat(i),p.checkPaddingMode(r),y(e,t,n,r,i,"avg")},e.className="AveragePooling2D",e}(_);n.AveragePooling2D=S,l.serialization.SerializationMap.register(S);var x=function(n){function e(e){var t=n.call(this,e)||this;return t.inputSpec=[new a.InputSpec({ndim:3})],t}return i(e,n),e.prototype.computeOutputShape=function(e){return[e[0],e[2]]},e.prototype.call=function(e,t){throw new h.NotImplementedError},e}(s.Layer),T=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.call=function(t,e){return l.tidy(function(){var e=d.getExactlyOneTensor(t);return u.mean(e,1)})},e.className="GlobalAveragePooling1D",e}(n.GlobalPooling1D=x);n.GlobalAveragePooling1D=T,l.serialization.SerializationMap.register(T);var P=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.call=function(t,e){return l.tidy(function(){var e=d.getExactlyOneTensor(t);return u.max(e,1)})},e.className="GlobalMaxPooling1D",e}(x);n.GlobalMaxPooling1D=P,l.serialization.SerializationMap.register(P);var N=function(n){function e(e){var t=n.call(this,e)||this;return t.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,p.checkDataFormat(t.dataFormat),t.inputSpec=[new a.InputSpec({ndim:4})],t}return i(e,n),e.prototype.computeOutputShape=function(e){return e=e,"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]},e.prototype.call=function(e,t){throw new h.NotImplementedError},e.prototype.getConfig=function(){var e={dataFormat:this.dataFormat},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e}(s.Layer),A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.call=function(t,e){var n=this;return l.tidy(function(){var e=d.getExactlyOneTensor(t);return"channelsLast"===n.dataFormat?u.mean(e,[1,2]):u.mean(e,[2,3])})},t.className="GlobalAveragePooling2D",t}(n.GlobalPooling2D=N);n.GlobalAveragePooling2D=A,l.serialization.SerializationMap.register(A);var O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.call=function(t,e){var n=this;return l.tidy(function(){var e=d.getExactlyOneTensor(t);return"channelsLast"===n.dataFormat?u.max(e,[1,2]):u.max(e,[2,3])})},t.className="GlobalMaxPooling2D",t}(N);n.GlobalMaxPooling2D=O,l.serialization.SerializationMap.register(O)},{"../backend/common":191,"../backend/tfjs_backend":193,"../common":196,"../engine/topology":201,"../errors":203,"../utils/conv_utils":230,"../utils/types_utils":235,"./convolutional":213,"@tensorflow/tfjs-core":66}],221:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var B=e("@tensorflow/tfjs-core"),l=e("@tensorflow/tfjs-core"),o=e("../activations"),R=e("../backend/state"),U=e("../backend/tfjs_backend"),s=e("../constraints"),m=e("../engine/topology"),a=e("../engine/topology"),G=e("../errors"),u=e("../initializers"),c=e("../regularizers"),g=e("../utils/math_utils"),f=e("../utils/types_utils"),p=e("../variables"),h=e("./serialization");function y(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new G.ValueError("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),1<e.length&&(t=e.slice(1,e.length)),e=e[0]}function i(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=i(t),constants:n=i(n)}}function v(e,t,n,r,i,o,a,s){void 0===r&&(r=!1),void 0===a&&(a=!1);var u=t.shape.length;if(u<3)throw new G.ValueError("Input should be at least 3D, but is "+u+"D.");var l,c,p=[1,0].concat(g.range(2,u));if(t=B.transpose(t,p),null!=i)throw new G.NotImplementedError("The rnn() function of the deeplearn.js backend does not support masking yet.");if(null!=o)throw new G.NotImplementedError("The rnn() functoin of the deeplearn.js backend does not support constants yet.");a&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r&&(t=B.reverse(t,0));for(var h=n,f=t.shape[0],d=0;d<f;++d){var m=U.sliceAlongFirstAxis(t,d,1),y=e(m=m.reshape(m.shape.slice(1)),h);c=y[0],l=0===d?c.reshape([1].concat(c.shape)):U.concatAlongFirstAxis(l,c.reshape([1].concat(c.shape))),h=y[1]}return[c,B.transpose(l,[1,0].concat(g.range(2,l.shape.length))),h]}n.standardizeArgs=y,n.rnn=v;var d=function(d){function e(e){var t,n=d.call(this,e)||this;if(null==e.cell)throw new G.ValueError("cell property is missing for the constructor of RNN.");if(null==(t=Array.isArray(e.cell)?new N({cells:e.cell}):e.cell).stateSize)throw new G.ValueError("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return n.cell=t,n.returnSequences=null!=e.returnSequences&&e.returnSequences,n.returnState=null!=e.returnState&&e.returnState,n.goBackwards=null!=e.goBackwards&&e.goBackwards,n._stateful=null!=e.stateful&&e.stateful,n.unroll=null!=e.unroll&&e.unroll,n.supportsMasking=!0,n.inputSpec=[new m.InputSpec({ndim:3})],n.stateSpec=null,n.states=null,n.numConstants=null,n}return i(e,d),e.prototype.getStates=function(){if(null==this.states){var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return g.range(0,e).map(function(e){return null})}return this.states},e.prototype.setStates=function(e){this.states=e},e.prototype.computeOutputShape=function(e){f.isArrayOfShapes(e)&&(e=e[0]),e=e;var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){for(var i=[],o=0,a=t;o<a.length;o++){var s=a[o];i.push([e[0],s])}return[n].concat(i)}return n},e.prototype.computeMask=function(e,t){throw new G.NotImplementedError("computeMask has not been implemented for RNN yet")},e.prototype.build=function(e){if(null!=this.numConstants)throw new G.NotImplementedError("Constants support is not implemented in RNN yet.");f.isArrayOfShapes(e)&&(e=e[0]),e=e;var t=this.stateful?e[0]:null,n=e[e.length-1];this.inputSpec[0]=new m.InputSpec({shape:[t,null,n]});var r,i=[e[0]].concat(e.slice(2));if(this.cell.build(i),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!l.util.arraysEqual(this.stateSpec.map(function(e){return e.shape[e.shape.length-1]}),r))throw new G.ValueError("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec="+this.stateSpec+"; However cell.stateSize is "+this.cell.stateSize)}else this.stateSpec=r.map(function(e){return new m.InputSpec({shape:[null,e]})});if(this.stateful)throw new G.NotImplementedError("stateful RNN layer is not implemented yet")},e.prototype.resetStates=function(o){var a=this;l.tidy(function(){if(!a.stateful)throw new G.AttributeError("Cannot call resetState() on an RNN Layer that is not stateful.");var t=a.inputSpec[0].shape[0];if(null==t)throw new G.ValueError("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==a.states)Array.isArray(a.cell.stateSize)?a.states=a.cell.stateSize.map(function(e){return B.zeros([t,e])}):a.states=[B.zeros([t,a.cell.stateSize])];else if(null==o)Array.isArray(a.cell.stateSize)?a.states=a.cell.stateSize.map(function(e){return B.zeros([t,e])}):a.states[0]=B.zeros([t,a.cell.stateSize]);else{if(Array.isArray(o)||(o=[o]),o.length!==a.states.length)throw new G.ValueError("Layer "+a.name+" expects "+a.states.length+" state(s), but it received "+o.length+" state value(s). Input received: "+o);for(var e=0;e<a.states.length;++e){var n=o[e],r=Array.isArray(a.cell.stateSize)?a.cell.stateSize[e]:a.cell.stateSize,i=[t,r];if(!l.util.arraysEqual(n.shape,i))throw new G.ValueError("State "+e+" is incompatible with layer "+a.name+": expected shape="+i+", received shape="+n.shape);a.states[e]=n}}})},e.prototype.apply=function(e,t){var n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});var i=y(e,n,r,this.numConstants);e=i.inputs,n=i.initialState,r=i.constants;var o=[],a=[];if(null!=n){t.initialState=n,o=o.concat(n),this.stateSpec=[];for(var s=0,u=n;s<u.length;s++){var l=u[s];this.stateSpec.push(new m.InputSpec({shape:l.shape}))}a=a.concat(this.stateSpec)}if(null!=r&&(t.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof m.SymbolicTensor){var c=[e].concat(o),p=this.inputSpec.concat(a),h=this.inputSpec;this.inputSpec=p;var f=d.prototype.apply.call(this,c,t);return this.inputSpec=h,f}return d.prototype.apply.call(this,e,t)},e.prototype.call=function(c,p){var h=this;return l.tidy(function(){var e=null==p?null:p.mask,t=null==p?null:p.training,n=null==p?null:p.initialState;if(c=f.getExactlyOneTensor(c),null==n){if(h.stateful)throw new G.NotImplementedError("stateful RNN layer is not implemented yet.");n=h.getInitialState(c)}if(null!=e)throw new G.NotImplementedError("Masking is not implemented for RNN yet");var r=Array.isArray(h.cell.stateSize)?h.cell.stateSize.length:1;if(n.length!==r)throw new G.ValueError("RNN Layer has "+r+" state(s) but was passed "+n.length+" initial state(s).");c.shape[1];h.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var i={training:t},o=v(function(e,t){var n=h.cell.call([e].concat(t),i);return[n[0],n.slice(1)]},c,n,h.goBackwards,null,null,h.unroll),a=o[0],s=o[1],u=o[2];if(h.stateful)throw new G.NotImplementedError("stateful RNN layer is not implemented yet");var l=h.returnSequences?s:a;return h.returnState?[l].concat(u):l})},e.prototype.getInitialState=function(e){var n=this;return l.tidy(function(){var t=B.zeros(e.shape);return t=B.sum(t,[1,2]),t=U.expandDims(t),Array.isArray(n.cell.stateSize)?n.cell.stateSize.map(function(e){return 1<e?U.tile(t,[1,e]):t}):1<n.cell.stateSize?[U.tile(t,[1,n.cell.stateSize])]:[t]})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(e.numConstants=this.numConstants);var t=this.cell.getConfig();e.cell={className:this.cell.getClassName(),config:t};var n=d.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="RNN",e}(a.Layer);n.RNN=d,l.serialization.SerializationMap.register(d);var b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(a.Layer),_=function(n){function e(e){var t=n.call(this,e)||this;return t.DEFAULT_ACTIVATION="tanh",t.DEFAULT_KERNEL_INITIALIZER="glorotNormal",t.DEFAULT_RECURRENT_INITIALIZER="orthogonal",t.DEFAULT_BIAS_INITIALIZER="zeros",t.units=e.units,t.activation=o.getActivation(null==e.activation?t.DEFAULT_ACTIVATION:e.activation),t.useBias=null==e.useBias||e.useBias,t.kernelInitializer=u.getInitializer(e.kernelInitializer||t.DEFAULT_KERNEL_INITIALIZER),t.recurrentInitializer=u.getInitializer(e.recurrentInitializer||t.DEFAULT_RECURRENT_INITIALIZER),t.biasInitializer=u.getInitializer(e.biasInitializer||t.DEFAULT_BIAS_INITIALIZER),t.kernelRegularizer=c.getRegularizer(e.kernelRegularizer),t.recurrentRegularizer=c.getRegularizer(e.recurrentRegularizer),t.biasRegularizer=c.getRegularizer(e.biasRegularizer),t.kernelConstraint=s.getConstraint(e.kernelConstraint),t.recurrentConstraint=s.getConstraint(e.recurrentConstraint),t.biasConstraint=s.getConstraint(e.biasConstraint),t.dropout=g.min([1,g.max([0,null==e.dropout?0:e.dropout])]),t.recurrentDropout=g.min([1,g.max([0,null==e.recurrentDropout?0:e.recurrentDropout])]),t.stateSize=t.units,t.dropoutMask=null,t.recurrentDropoutMask=null,t}return i(e,n),e.prototype.build=function(e){e=f.getExactlyOneShape(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(a,s){var u=this;return l.tidy(function(){if(2!==(a=a).length)throw new G.ValueError("SimpleRNNCell expects 2 input Tensors, got "+a.length+".");var e=a[1];a=a[0];var t,n=null!=s.training&&s.training;0<u.dropout&&u.dropout<1&&null==u.dropoutMask&&(u.dropoutMask=W(function(){return B.onesLike(a)},u.dropout,n)),0<u.recurrentDropout&&u.recurrentDropout<1&&null==u.recurrentDropoutMask&&(u.recurrentDropoutMask=W(function(){return B.onesLike(e)},u.recurrentDropout,n));var r=u.dropoutMask,i=u.recurrentDropoutMask;t=null!=r?U.dot(B.mul(a,r),u.kernel.read()):U.dot(a,u.kernel.read()),null!=u.bias&&(t=U.biasAdd(t,u.bias.read())),null!=i&&(e=B.mul(e,i));var o=B.add(t,U.dot(e,u.recurrentKernel.read()));return null!=u.activation&&(o=u.activation.apply(o)),[o,o]})},e.prototype.getConfig=function(){var e={units:this.units,activation:o.serializeActivation(this.activation),useBias:this.useBias,kernelInitializer:u.serializeInitializer(this.kernelInitializer),recurrentInitializer:u.serializeInitializer(this.recurrentInitializer),biasInitializer:u.serializeInitializer(this.biasInitializer),kernelRegularizer:c.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:c.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:c.serializeRegularizer(this.biasRegularizer),activityRegularizer:c.serializeRegularizer(this.activityRegularizer),kernelConstraint:s.serializeConstraint(this.kernelConstraint),recurrentConstraint:s.serializeConstraint(this.recurrentConstraint),biasConstraint:s.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="SimpleRNNCell",e}(n.RNNCell=b);n.SimpleRNNCell=_,l.serialization.SerializationMap.register(_);var w=function(a){function e(e){return e.cell=new _(e),a.call(this,e)||this}return i(e,a),e.prototype.call=function(r,i){var o=this;return l.tidy(function(){null!=o.cell.dropoutMask&&(B.dispose(o.cell.dropoutMask),o.cell.dropoutMask=null),null!=o.cell.recurrentDropoutMask&&(B.dispose(o.cell.recurrentDropoutMask),o.cell.recurrentDropoutMask=null);var e=null==i?null:i.mask,t=null==i?null:i.training,n=null==i?null:i.initialState;return a.prototype.call.call(o,r,{mask:e,training:t,initialState:n})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:o.serializeActivation(this.activation),useBias:this.useBias,kernelInitializer:u.serializeInitializer(this.kernelInitializer),recurrentInitializer:u.serializeInitializer(this.recurrentInitializer),biasInitializer:u.serializeInitializer(this.biasInitializer),kernelRegularizer:c.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:c.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:c.serializeRegularizer(this.biasRegularizer),activityRegularizer:c.serializeRegularizer(this.activityRegularizer),kernelConstraint:s.serializeConstraint(this.kernelConstraint),recurrentConstraint:s.serializeConstraint(this.recurrentConstraint),biasConstraint:s.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},t=a.prototype.getConfig.call(this);return delete t.cell,Object.assign(e,t),e},e.className="SimpleRNN",e}(d);n.SimpleRNN=w,l.serialization.SerializationMap.register(w);var S=function(n){function e(e){var t=n.call(this,e)||this;return t.DEFAULT_ACTIVATION="tanh",t.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",t.DEFAULT_KERNEL_INITIALIZER="glorotNormal",t.DEFAULT_RECURRENT_INITIALIZER="orthogonal",t.DEFAULT_BIAS_INITIALIZER="zeros",t.units=e.units,t.activation=o.getActivation(void 0===e.activation?t.DEFAULT_ACTIVATION:e.activation),t.recurrentActivation=o.getActivation(void 0===e.recurrentActivation?t.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),t.useBias=null==e.useBias||e.useBias,t.kernelInitializer=u.getInitializer(e.kernelInitializer||t.DEFAULT_KERNEL_INITIALIZER),t.recurrentInitializer=u.getInitializer(e.recurrentInitializer||t.DEFAULT_RECURRENT_INITIALIZER),t.biasInitializer=u.getInitializer(e.biasInitializer||t.DEFAULT_BIAS_INITIALIZER),t.kernelRegularizer=c.getRegularizer(e.kernelRegularizer),t.recurrentRegularizer=c.getRegularizer(e.recurrentRegularizer),t.biasRegularizer=c.getRegularizer(e.biasRegularizer),t.kernelConstraint=s.getConstraint(e.kernelConstraint),t.recurrentConstraint=s.getConstraint(e.recurrentConstraint),t.biasConstraint=s.getConstraint(e.biasConstraint),t.dropout=g.min([1,g.max([0,null==e.dropout?0:e.dropout])]),t.recurrentDropout=g.min([1,g.max([0,null==e.recurrentDropout?0:e.recurrentDropout])]),t.implementation=e.implementation,t.stateSize=t.units,t.dropoutMask=null,t.recurrentDropoutMask=null,t}return i(e,n),e.prototype.build=function(e){var t=(e=f.getExactlyOneShape(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(I,M){var C=this;return l.tidy(function(){if(2!==(I=I).length)throw new G.ValueError("GRUCell expects 2 input Tensors (inputs, h, c), got "+I.length+".");var e=null!=M.training&&M.training,t=I[1];I=I[0],0<C.dropout&&C.dropout<1&&null==C.dropoutMask&&(C.dropoutMask=W(function(){return B.onesLike(I)},C.dropout,e,3)),0<C.recurrentDropout&&C.recurrentDropout<1&&null==C.recurrentDropoutMask&&(C.recurrentDropoutMask=W(function(){return B.onesLike(t)},C.recurrentDropout,e,3));var n,r,i,o=C.dropoutMask,a=C.recurrentDropoutMask;if(1===C.implementation){var s=U.sliceAlongLastAxis(C.kernel.read(),0,C.units),u=U.sliceAlongLastAxis(C.kernel.read(),C.units,C.units),l=U.sliceAlongLastAxis(C.kernel.read(),2*C.units,C.units),c=U.sliceAlongLastAxis(C.recurrentKernel.read(),0,C.units),p=U.sliceAlongLastAxis(C.recurrentKernel.read(),C.units,C.units),h=U.sliceAlongLastAxis(C.recurrentKernel.read(),2*C.units,C.units),f=void 0,d=void 0,m=void 0;0<C.dropout&&C.dropout<1?(f=B.mul(I,o[0]),d=B.mul(I,o[1]),m=B.mul(I,o[2])):m=d=f=I;var y=U.dot(f,s),g=U.dot(d,u),v=U.dot(m,l);if(C.useBias){var b=U.sliceAlongFirstAxis(C.bias.read(),0,C.units),_=U.sliceAlongFirstAxis(C.bias.read(),C.units,C.units),w=U.sliceAlongFirstAxis(C.bias.read(),2*C.units,C.units);y=U.biasAdd(y,b),g=U.biasAdd(g,_),v=U.biasAdd(v,w)}var S=void 0,x=void 0,T=void 0;0<C.recurrentDropout&&C.recurrentDropout<1?(S=B.mul(t,a[0]),x=B.mul(t,a[1]),T=B.mul(t,a[2])):T=x=S=t,n=C.recurrentActivation.apply(B.add(y,U.dot(S,c))),r=C.recurrentActivation.apply(B.add(g,U.dot(x,p))),i=C.activation.apply(B.add(v,U.dot(B.mul(r,T),h)))}else{0<C.dropout&&C.dropout<1&&(I=B.mul(I,o[0]));var P=U.dot(I,C.kernel.read());C.useBias&&(P=U.biasAdd(P,C.bias.read())),0<C.dropout&&C.dropout<1&&(t=B.mul(t,a[0]));var N=U.dot(t,U.sliceAlongLastAxis(C.recurrentKernel.read(),0,2*C.units)),A=(y=U.sliceAlongLastAxis(P,0,C.units),g=U.sliceAlongLastAxis(P,C.units,C.units),U.sliceAlongLastAxis(N,0,C.units)),O=U.sliceAlongLastAxis(N,C.units,C.units);n=C.recurrentActivation.apply(B.add(y,A)),r=C.recurrentActivation.apply(B.add(g,O));v=U.sliceAlongLastAxis(P,2*C.units,C.units);var k=U.dot(B.mul(r,t),U.sliceAlongLastAxis(C.recurrentKernel.read(),2*C.units,C.units));i=C.activation.apply(B.add(v,k))}var E=B.add(B.mul(n,t),B.mul(B.add(R.getScalar(1),B.neg(n)),i));return[E,E]})},e.prototype.getConfig=function(){var e={units:this.units,activation:o.serializeActivation(this.activation),recurrentActivation:o.serializeActivation(this.recurrentActivation),useBias:this.useBias,kernelInitializer:u.serializeInitializer(this.kernelInitializer),recurrentInitializer:u.serializeInitializer(this.recurrentInitializer),biasInitializer:u.serializeInitializer(this.biasInitializer),kernelRegularizer:c.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:c.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:c.serializeRegularizer(this.biasRegularizer),activityRegularizer:c.serializeRegularizer(this.activityRegularizer),kernelConstraint:s.serializeConstraint(this.kernelConstraint),recurrentConstraint:s.serializeConstraint(this.recurrentConstraint),biasConstraint:s.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="GRUCell",e}(b);n.GRUCell=S,l.serialization.SerializationMap.register(S);var x=function(a){function e(e){return 0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new S(e),a.call(this,e)||this}return i(e,a),e.prototype.call=function(r,i){var o=this;return l.tidy(function(){null!=o.cell.dropoutMask&&(B.dispose(o.cell.dropoutMask),o.cell.dropoutMask=null),null!=o.cell.recurrentDropoutMask&&(B.dispose(o.cell.recurrentDropoutMask),o.cell.recurrentDropoutMask=null);var e=null==i?null:i.mask,t=null==i?null:i.training,n=null==i?null:i.initialState;return a.prototype.call.call(o,r,{mask:e,training:t,initialState:n})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:o.serializeActivation(this.activation),recurrentActivation:o.serializeActivation(this.recurrentActivation),useBias:this.useBias,kernelInitializer:u.serializeInitializer(this.kernelInitializer),recurrentInitializer:u.serializeInitializer(this.recurrentInitializer),biasInitializer:u.serializeInitializer(this.biasInitializer),kernelRegularizer:c.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:c.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:c.serializeRegularizer(this.biasRegularizer),activityRegularizer:c.serializeRegularizer(this.activityRegularizer),kernelConstraint:s.serializeConstraint(this.kernelConstraint),recurrentConstraint:s.serializeConstraint(this.recurrentConstraint),biasConstraint:s.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},t=a.prototype.getConfig.call(this);return delete t.cell,Object.assign(e,t),e},e.fromConfig=function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)},e.className="GRU",e}(d);n.GRU=x,l.serialization.SerializationMap.register(x);var T=function(n){function e(e){var t=n.call(this,e)||this;return t.DEFAULT_ACTIVATION="tanh",t.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",t.DEFAULT_KERNEL_INITIALIZER="glorotNormal",t.DEFAULT_RECURRENT_INITIALIZER="orthogonal",t.DEFAULT_BIAS_INITIALIZER="zeros",t.units=e.units,t.activation=o.getActivation(void 0===e.activation?t.DEFAULT_ACTIVATION:e.activation),t.recurrentActivation=o.getActivation(void 0===e.recurrentActivation?t.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),t.useBias=null==e.useBias||e.useBias,t.kernelInitializer=u.getInitializer(e.kernelInitializer||t.DEFAULT_KERNEL_INITIALIZER),t.recurrentInitializer=u.getInitializer(e.recurrentInitializer||t.DEFAULT_RECURRENT_INITIALIZER),t.biasInitializer=u.getInitializer(e.biasInitializer||t.DEFAULT_BIAS_INITIALIZER),t.unitForgetBias=e.unitForgetBias,t.kernelRegularizer=c.getRegularizer(e.kernelRegularizer),t.recurrentRegularizer=c.getRegularizer(e.recurrentRegularizer),t.biasRegularizer=c.getRegularizer(e.biasRegularizer),t.kernelConstraint=s.getConstraint(e.kernelConstraint),t.recurrentConstraint=s.getConstraint(e.recurrentConstraint),t.biasConstraint=s.getConstraint(e.biasConstraint),t.dropout=g.min([1,g.max([0,null==e.dropout?0:e.dropout])]),t.recurrentDropout=g.min([1,g.max([0,null==e.recurrentDropout?0:e.recurrentDropout])]),t.implementation=e.implementation,t.stateSize=[t.units,t.units],t.dropoutMask=null,t.recurrentDropoutMask=null,t}return i(e,n),e.prototype.build=function(e){var t,n,r=(e=f.getExactlyOneShape(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var o=this.biasInitializer,a=this.units;(n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e,t){var n=o.apply([a]),r=(new u.Ones).apply([a]),i=o.apply([2*a]);return U.concatAlongFirstAxis(U.concatAlongFirstAxis(n,r),i)},t}(u.Initializer)).className="CustomInit",t=new n}else t=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,t,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},e.prototype.call=function(q,V){var j=this;return l.tidy(function(){var e=null!=V.training&&V.training;if(3!==(q=q).length)throw new G.ValueError("LSTMCell expects 3 input Tensors (inputs, h, c), got "+q.length+".");var t=q[1],n=q[2];q=q[0],0<j.dropout&&j.dropout<1&&null==j.dropoutMask&&(j.dropoutMask=W(function(){return B.onesLike(q)},j.dropout,e,4)),0<j.recurrentDropout&&j.recurrentDropout<1&&null==j.recurrentDropoutMask&&(j.recurrentDropoutMask=W(function(){return B.onesLike(t)},j.recurrentDropout,e,4));var r,i,o,a,s=j.dropoutMask,u=j.recurrentDropoutMask;if(1===j.implementation){var l=U.sliceAlongLastAxis(j.kernel.read(),0,j.units),c=U.sliceAlongLastAxis(j.kernel.read(),j.units,j.units),p=U.sliceAlongLastAxis(j.kernel.read(),2*j.units,j.units),h=U.sliceAlongLastAxis(j.kernel.read(),3*j.units,j.units),f=U.sliceAlongLastAxis(j.recurrentKernel.read(),0,j.units),d=U.sliceAlongLastAxis(j.recurrentKernel.read(),j.units,j.units),m=U.sliceAlongLastAxis(j.recurrentKernel.read(),2*j.units,j.units),y=U.sliceAlongLastAxis(j.recurrentKernel.read(),3*j.units,j.units),g=void 0,v=void 0,b=void 0,_=void 0;0<j.dropout&&j.dropout<1?(g=B.mul(q,s[0]),v=B.mul(q,s[1]),b=B.mul(q,s[2]),_=B.mul(q,s[3])):_=b=v=g=q;var w=U.dot(g,l),S=U.dot(v,c),x=U.dot(b,p),T=U.dot(_,h);if(j.useBias){var P=U.sliceAlongFirstAxis(j.bias.read(),0,j.units),N=U.sliceAlongFirstAxis(j.bias.read(),j.units,j.units),A=U.sliceAlongFirstAxis(j.bias.read(),2*j.units,j.units),O=U.sliceAlongFirstAxis(j.bias.read(),3*j.units,j.units);w=U.biasAdd(w,P),S=U.biasAdd(S,N),x=U.biasAdd(x,A),T=U.biasAdd(T,O)}var k=void 0,E=void 0,I=void 0,M=void 0;0<j.recurrentDropout&&j.recurrentDropout<1?(k=B.mul(t,u[0]),E=B.mul(t,u[1]),I=B.mul(t,u[2]),M=B.mul(t,u[3])):M=I=E=k=t,r=j.recurrentActivation.apply(B.add(w,U.dot(k,f))),i=j.recurrentActivation.apply(B.add(S,U.dot(E,d))),o=B.add(B.mul(i,n),B.mul(r,j.activation.apply(B.add(x,U.dot(I,m))))),a=j.recurrentActivation.apply(B.add(T,U.dot(M,y)))}else{0<j.dropout&&j.dropout<1&&(q=B.mul(q,s[0]));var C=U.dot(q,j.kernel.read());0<j.recurrentDropout&&j.recurrentDropout<1&&(t=B.mul(t,u[0])),C=B.add(C,U.dot(t,j.recurrentKernel.read())),j.useBias&&(C=U.biasAdd(C,j.bias.read()));var R=U.sliceAlongLastAxis(C,0,j.units),z=U.sliceAlongLastAxis(C,j.units,j.units),D=U.sliceAlongLastAxis(C,2*j.units,j.units),L=U.sliceAlongLastAxis(C,3*j.units,j.units);r=j.recurrentActivation.apply(R),i=j.recurrentActivation.apply(z),o=B.add(B.mul(i,n),B.mul(r,j.activation.apply(D))),a=j.recurrentActivation.apply(L)}var F=B.mul(a,j.activation.apply(o));return[F,F,o]})},e.prototype.getConfig=function(){var e={units:this.units,activation:o.serializeActivation(this.activation),recurrentActivation:o.serializeActivation(this.recurrentActivation),useBias:this.useBias,kernelInitializer:u.serializeInitializer(this.kernelInitializer),recurrentInitializer:u.serializeInitializer(this.recurrentInitializer),biasInitializer:u.serializeInitializer(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:c.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:c.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:c.serializeRegularizer(this.biasRegularizer),activityRegularizer:c.serializeRegularizer(this.activityRegularizer),kernelConstraint:s.serializeConstraint(this.kernelConstraint),recurrentConstraint:s.serializeConstraint(this.recurrentConstraint),biasConstraint:s.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.className="LSTMCell",e}(b);n.LSTMCell=T,l.serialization.SerializationMap.register(T);var P=function(a){function e(e){return 0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new T(e),a.call(this,e)||this}return i(e,a),e.prototype.call=function(r,i){var o=this;return l.tidy(function(){null!=o.cell.dropoutMask&&(B.dispose(o.cell.dropoutMask),o.cell.dropoutMask=null),null!=o.cell.recurrentDropoutMask&&(B.dispose(o.cell.recurrentDropoutMask),o.cell.recurrentDropoutMask=null);var e=null==i?null:i.mask,t=null==i?null:i.training,n=null==i?null:i.initialState;return a.prototype.call.call(o,r,{mask:e,training:t,initialState:n})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:o.serializeActivation(this.activation),recurrentActivation:o.serializeActivation(this.recurrentActivation),useBias:this.useBias,kernelInitializer:u.serializeInitializer(this.kernelInitializer),recurrentInitializer:u.serializeInitializer(this.recurrentInitializer),biasInitializer:u.serializeInitializer(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:c.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:c.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:c.serializeRegularizer(this.biasRegularizer),activityRegularizer:c.serializeRegularizer(this.activityRegularizer),kernelConstraint:s.serializeConstraint(this.kernelConstraint),recurrentConstraint:s.serializeConstraint(this.recurrentConstraint),biasConstraint:s.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},t=a.prototype.getConfig.call(this);return delete t.cell,Object.assign(e,t),e},e.fromConfig=function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)},e.className="LSTM",e}(d);n.LSTM=P,l.serialization.SerializationMap.register(P);var N=function(a){function e(e){var t=a.call(this,e)||this;return t.cells=e.cells,t}return i(e,a),Object.defineProperty(e.prototype,"stateSize",{get:function(){for(var e=[],t=0,n=this.cells.slice().reverse();t<n.length;t++){var r=n[t];Array.isArray(r.stateSize)?e.push.apply(e,r.stateSize):e.push(r.stateSize)}return e},enumerable:!0,configurable:!0}),e.prototype.call=function(p,h){var f=this;return l.tidy(function(){for(var e=(p=p).slice(1),t=[],n=0,r=f.cells.slice().reverse();n<r.length;n++){var i=r[n];Array.isArray(i.stateSize)?t.push(e.splice(0,i.stateSize.length)):t.push(e.splice(0,1))}t.reverse();for(var o,a=[],s=0;s<f.cells.length;++s){i=f.cells[s];e=t[s],o=0===s?[p[0]].concat(e):[o[0]].concat(e),o=i.call(o,h),a.push(o.slice(1))}e=[];for(var u=0,l=a.slice().reverse();u<l.length;u++){var c=l[u];e.push.apply(e,c)}return[o[0]].concat(e)})},e.prototype.build=function(e){var t;f.isArrayOfShapes(e)&&(e=e[0]),e=e;for(var n=0,r=this.cells;n<r.length;n++){var i=r[n];i.build(e),t=Array.isArray(i.stateSize)?i.stateSize[0]:i.stateSize,e=[e[0],t]}this.built=!0},e.prototype.getConfig=function(){for(var e=[],t=0,n=this.cells;t<n.length;t++){var r=n[t];e.push({className:this.getClassName(),config:r.getConfig()})}var i={cells:e},o=a.prototype.getConfig.call(this);return Object.assign(i,o),i},e.fromConfig=function(e,t,n){void 0===n&&(n={});for(var r=[],i=0,o=t.cells;i<o.length;i++){var a=o[i];r.push(h.deserialize(a,n))}return new e({cells:r})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var e=[],t=0,n=this.cells;t<n.length;t++){var r=n[t];e.push.apply(e,r.trainableWeights)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){for(var e=[],t=0,n=this.cells;t<n.length;t++){var r=n[t];e.push.apply(e,r.nonTrainableWeights)}if(!this.trainable){for(var i=[],o=0,a=this.cells;o<a.length;o++){r=a[o];i.push.apply(i,r.trainableWeights)}return i.concat(e)}return e},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){for(var e=[],t=0,n=this.cells;t<n.length;t++){var r=n[t];e.push.apply(e,r.weights)}return p.batchGetValue(e)},e.prototype.setWeights=function(e){for(var t=[],n=0,r=this.cells;n<r.length;n++)for(var i=r[n],o=i.weights.length,a=e.splice(o),s=0;s<i.weights.length;++s)t.push([i.weights[s],a[s]]);p.batchSetValue(t)},e.className="StackedRNNCells",e}(b);function W(e,t,n,r){function i(){return U.dropout(e(),R.getScalar(t))}if(void 0===n&&(n=null),void 0===r&&(r=1),1<r){for(var o=[],a=0;a<r;a++)o.push(U.inTrainPhase(i,e,n));return o.forEach(function(e){return B.keep(e)}),o}return B.keep(U.inTrainPhase(i,e,n))}n.StackedRNNCells=N,l.serialization.SerializationMap.register(N)},{"../activations":190,"../backend/state":192,"../backend/tfjs_backend":193,"../constraints":197,"../engine/topology":201,"../errors":203,"../initializers":211,"../regularizers":229,"../utils/math_utils":233,"../utils/types_utils":235,"../variables":237,"./serialization":222,"@tensorflow/tfjs-core":66}],222:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("../utils/generic_utils");n.deserialize=function(e,t){return void 0===t&&(t={}),i.deserializeKerasObject(e,r.serialization.SerializationMap.getMap().classNameMap,t,"layer")}},{"../utils/generic_utils":231,"@tensorflow/tfjs-core":66}],223:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var c=e("@tensorflow/tfjs-core"),o=e("@tensorflow/tfjs-core"),p=e("../backend/state"),h=e("../backend/tfjs_backend"),a=e("../common"),g=e("../engine/topology"),v=e("../errors"),s=e("../utils/generic_utils"),u=e("../utils/types_utils"),b=e("./recurrent"),l=e("./serialization"),f=function(n){function e(e){var t=n.call(this,e)||this;return t.layer=e.layer,t}return i(e,n),e.prototype.build=function(e){this.built=!0},Object.defineProperty(e.prototype,"trainable",{get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.layer.getWeights()},e.prototype.setWeights=function(e){this.layer.setWeights(e)},e.prototype.getConfig=function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=n.prototype.getConfig.call(this);return Object.assign(e,t),e},e.fromConfig=function(e,t,n){void 0===n&&(n={});var r=t.layer,i=l.deserialize(r,n);delete t.layer;var o={layer:i};return Object.assign(o,t),new e(o)},e}(g.Layer),d=function(n){function e(e){var t=n.call(this,e)||this;return t.supportsMasking=!0,t}return i(e,n),e.prototype.build=function(e){if((e=u.getExactlyOneShape(e)).length<3)throw new v.ValueError("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(e));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),n.prototype.build.call(this,e)},e.prototype.computeOutputShape=function(e){var t=[(e=u.getExactlyOneShape(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))},e.prototype.call=function(e,n){var r=this;return o.tidy(function(){e=u.getExactlyOneTensor(e);return b.rnn(function(e,t){return[r.layer.call(e,n),[]]},e,[],!1,null,null,!1,e.shape[1])[1]})},e.className="TimeDistributed",e}(n.Wrapper=f);function m(e){s.checkStringTypeUnionValue(n.VALID_BIDIRECTIONAL_MERGE_MODES,"BidirectionalMergeMode",e)}n.TimeDistributed=d,o.serialization.SerializationMap.register(d),n.VALID_BIDIRECTIONAL_MERGE_MODES=["sum","mul","concat","ave"],n.checkBidirectionalMergeMode=m;var y=function(y){function e(e){var t=y.call(this,e)||this,n=e.layer.getConfig();if(t.forwardLayer=l.deserialize({className:e.layer.getClassName(),config:n}),n.goBackwards=!0!==n.goBackwards,t.backwardLayer=l.deserialize({className:e.layer.getClassName(),config:n}),t.forwardLayer.name="forward_"+t.forwardLayer.name,t.backwardLayer.name="backward_"+t.backwardLayer.name,m(e.mergeMode),t.mergeMode=e.mergeMode,e.weights)throw new v.NotImplementedError("weights support is not implemented for Bidirectional layer yet.");return t._stateful=e.layer.stateful,t.returnSequences=e.layer.returnSequences,t.returnState=e.layer.returnState,t.supportsMasking=!0,t._trainable=!0,t.inputSpec=e.layer.inputSpec,t.numConstants=null,t}return i(e,y),Object.defineProperty(e.prototype,"trainable",{get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},e.prototype.setWeights=function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))},e.prototype.computeOutputShape=function(e){var t,n,r,i=this.forwardLayer.computeOutputShape(e);return Array.isArray(i)&&Array.isArray(i[0])||(i=[i]),i=i,this.returnState&&(r=i.slice(1)),t=t=i[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):s.singletonOrArray(n)},e.prototype.apply=function(e,t){var n=null==t?null:t.initialState,r=null==t?null:t.constants;null==t&&(t={});var i=b.standardizeArgs(e,n,r,this.numConstants);if(e=i.inputs,n=i.initialState,r=i.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(null==n||0===n.length)&&null==r)return y.prototype.apply.call(this,e,t);var o=[],a=[];if(null!=n){var s=n.length;if(0<s%2)throw new v.ValueError("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=n,o.push.apply(o,n);var u=n.map(function(e){return new g.InputSpec({shape:e.shape})});this.forwardLayer.stateSpec=u.slice(0,s/2),this.backwardLayer.stateSpec=u.slice(s/2),a.push.apply(a,u)}if(null!=r)throw new v.NotImplementedError("Support for constants in Bidirectional layers is not implemented yet.");for(var l=o[0]instanceof g.SymbolicTensor,c=0,p=o;c<p.length;c++){if(p[c]instanceof g.SymbolicTensor!==l)throw new v.ValueError("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(l){var h=[e].concat(o),f=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=f;var m=y.prototype.apply.call(this,h,t);return this.inputSpec=d,m}return y.prototype.apply.call(this,e,t)},e.prototype.call=function(s,u){var l=this;return o.tidy(function(){if(null!=u.mask)throw new v.NotImplementedError("The support for masking is not implemented for Bidirectional layers yet.");var e,t,n,r,i=u.initialState;if(null==i)e=l.forwardLayer.call(s,u),t=l.backwardLayer.call(s,u);else{var o=i.slice(0,i.length/2),a=i.slice(i.length/2);e=l.forwardLayer.call(s,Object.assign(u,{initialState:o})),t=l.forwardLayer.call(s,Object.assign(u,{initialState:a}))}return l.returnState&&(Array.isArray(e)&&(n=e.slice(1).concat(t.slice(1))),e=e[0],t=t[0]),l.returnSequences&&(t=c.reverse(t,1)),"concat"===l.mergeMode?r=h.concatenate([e,t]):"sum"===l.mergeMode?r=c.add(e,t):"ave"===l.mergeMode?r=c.mul(p.getScalar(.5),c.add(e,t)):"mul"===l.mergeMode?r=c.mul(e,t):null==l.mergeMode&&(r=[e,t]),l.returnState?null==l.mergeMode?r.concat(n):[r].concat(n):r})},e.prototype.resetStates=function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},e.prototype.build=function(e){var t=this;a.nameScope(this.forwardLayer.name,function(){t.forwardLayer.build(e)}),a.nameScope(this.backwardLayer.name,function(){t.backwardLayer.build(e)}),this.built=!0},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={mergeMode:this.mergeMode},t=y.prototype.getConfig.call(this);return Object.assign(e,t),e},e.fromConfig=function(e,t){var n=l.deserialize(t.layer);if(delete t.layer,null!=t.numConstants)throw new v.NotImplementedError("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)},e.className="Bidirectional",e}(f);n.Bidirectional=y,o.serialization.SerializationMap.register(y)},{"../backend/state":192,"../backend/tfjs_backend":193,"../common":196,"../engine/topology":201,"../errors":203,"../utils/generic_utils":231,"../utils/types_utils":235,"./recurrent":221,"./serialization":222,"@tensorflow/tfjs-core":66}],224:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},c=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var p=e("@tensorflow/tfjs-core");n.resolveScalarsInLogs=function(l){return r(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u;return c(this,function(e){switch(e.label){case 0:if(null==l)return[2];for(i in t=[],n=[],r=[],l)"number"!=typeof(o=l[i])&&(a=o,t.push(a.data()),n.push(i),r.push(a));return[4,Promise.all(t)];case 1:for(s=e.sent(),u=0;u<s.length;++u)l[n[u]]=s[u][0];return p.dispose(r),[2]}})})},n.disposeTensorsInLogs=function(e){if(null!=e)for(var t in e){var n=e[t];"number"!=typeof n&&n.dispose()}}},{"@tensorflow/tfjs-core":66}],225:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var s=e("@tensorflow/tfjs-core"),u=e("@tensorflow/tfjs-core"),l=e("./backend/common"),c=e("./backend/tfjs_backend"),p=e("./backend/state"),r=e("./errors");function o(r,i){return u.tidy(function(){var e=s.sum(c.square(r),i,!0),t=s.mul(u.scalar(l.epsilon()),s.onesLike(r)),n=s.sqrt(s.maximum(e,t));return s.div(r,n)})}function i(e,t){return u.tidy(function(){return s.mean(c.square(s.sub(t,e)),-1)})}function a(e,t){return u.tidy(function(){return s.mean(s.abs(s.sub(t,e)),-1)})}function h(r,i){return u.tidy(function(){var e=s.sub(r,i),t=s.clipByValue(s.abs(r),l.epsilon(),Number.MAX_VALUE),n=s.abs(s.div(e,t));return s.mul(p.getScalar(100),s.mean(n,-1))})}function f(o,a){return u.tidy(function(){var e=p.getScalar(1),t=s.clipByValue(a,l.epsilon(),Number.MAX_VALUE),n=s.log(s.add(e,t)),r=s.clipByValue(o,l.epsilon(),Number.MAX_VALUE),i=s.log(s.add(e,r));return s.mean(c.square(s.sub(n,i)),-1)})}function d(r,i){return u.tidy(function(){var e=p.getScalar(0),t=p.getScalar(1),n=s.maximum(e,s.sub(t,s.mul(r,i)));return s.mean(c.square(n),-1)})}function m(r,i){return u.tidy(function(){var e=p.getScalar(0),t=p.getScalar(1),n=s.maximum(e,s.sub(t,s.mul(r,i)));return s.mean(n,-1)})}function y(i,o){return u.tidy(function(){var e=p.getScalar(0),t=p.getScalar(1),n=s.sum(s.mul(i,o),-1),r=s.max(s.mul(s.sub(t,i),o),-1);return s.maximum(e,s.add(t,s.sub(r,n)))})}function g(r,i){return u.tidy(function(){var e=p.getScalar(Math.log(2)),t=s.sub(i,r),n=s.sub(s.add(t,s.softplus(s.mul(p.getScalar(-2),t))),e);return s.mean(n,-1)})}function v(t,n,r){return void 0===r&&(r=!1),u.tidy(function(){if(r)n=s.softmax(n);else{var e=s.sum(n,n.shape.length-1,!0);n=s.div(n,e)}return n=s.clipByValue(n,l.epsilon(),1-l.epsilon()),s.neg(s.sum(s.mul(t.toFloat(),s.log(n)),n.shape.length-1))})}function b(n,r,i){return void 0===i&&(i=!1),u.tidy(function(){var e=s.floor(c.flatten(n)).toInt(),t=r.shape;return v(s.oneHot(e,t[t.length-1]).reshape(t),r,i)})}function _(r,i){return u.tidy(function(){var e=s.maximum(i,s.zerosLike(i)),t=s.mul(i,r),n=s.log(s.add(p.getScalar(1),s.exp(s.neg(s.abs(i)))));return s.add(s.sub(e,t),n)})}function w(t,n){return u.tidy(function(){var e;return e=s.clipByValue(n,l.epsilon(),1-l.epsilon()),e=s.log(s.div(e,s.sub(s.onesLike(e),e))),s.mean(_(t,e),-1)})}function S(n,r){return u.tidy(function(){var e=s.clipByValue(n,l.epsilon(),1),t=s.clipByValue(r,l.epsilon(),1);return s.sum(s.mul(n,s.log(s.div(e,t))),-1)})}function x(t,n){return u.tidy(function(){var e=s.log(s.add(p.getScalar(l.epsilon()),n));return s.mean(s.sub(n,s.mul(t,e)),-1)})}function T(r,i){return u.tidy(function(){var e=o(r,-1),t=o(i,-1),n=s.mul(e,t);return s.neg(s.sum(n,-1))})}n.l2Normalize=o,n.meanSquaredError=i,n.meanAbsoluteError=a,n.meanAbsolutePercentageError=h,n.meanSquaredLogarithmicError=f,n.squaredHinge=d,n.hinge=m,n.categoricalHinge=y,n.logcosh=g,n.categoricalCrossentropy=v,n.sparseCategoricalCrossentropy=b,n.sigmoidCrossEntropyWithLogits=_,n.binaryCrossentropy=w,n.kullbackLeiblerDivergence=S,n.poisson=x,n.cosineProximity=T,n.mse=i,n.MSE=i,n.mae=a,n.MAE=a,n.mape=h,n.MAPE=h,n.msle=f,n.MSLE=f,n.kld=S,n.KLD=S,n.cosine=T,n.get=function(e){var t={meanSquaredError:i,meanAbsoluteError:a,meanAbsolutePercentageError:h,meanSquaredLogarithmicError:f,squaredHinge:d,hinge:m,categoricalHinge:y,logcosh:g,categoricalCrossentropy:v,sparseCategoricalCrossentropy:b,binaryCrossentropy:w,kullbackLeiblerDivergence:S,poisson:x,cosineProximity:T};if("string"==typeof e){if(e in t)return t[e];throw new r.ValueError("Unknown loss "+e)}return e}},{"./backend/common":191,"./backend/state":192,"./backend/tfjs_backend":193,"./errors":203,"@tensorflow/tfjs-core":66}],226:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("@tensorflow/tfjs-core"),o=e("@tensorflow/tfjs-core"),a=e("./backend/tfjs_backend"),s=e("./backend/state"),r=e("./errors"),u=e("./losses"),l=e("./losses");function c(n,r){return o.tidy(function(){var e=i.mul(s.getScalar(.5),i.onesLike(r)),t=a.cast(i.greater(r,e),n.dtype);return i.mean(i.equal(n,t),-1)})}function p(e,t){return o.tidy(function(){return a.cast(i.equal(i.argMax(e,-1),i.argMax(t,-1)),"float32")})}n.binaryAccuracy=c,n.categoricalAccuracy=p,n.binaryCrossentropy=function(e,t){return l.binaryCrossentropy(e,t)},n.sparseCategoricalAccuracy=function(e,t){throw new r.NotImplementedError},n.topKCategoricalAccuracy=function(e,t){throw new r.NotImplementedError},n.sparseTopKCategoricalAccuracy=function(e,t){throw new r.NotImplementedError},n.mse=u.meanSquaredError,n.MSE=u.meanSquaredError,n.mae=u.meanAbsoluteError,n.MAE=u.meanAbsoluteError,n.mape=u.meanAbsolutePercentageError,n.MAPE=u.meanAbsolutePercentageError,n.categoricalCrossentropy=u.categoricalCrossentropy,n.cosine=u.cosineProximity,n.sparseCategoricalCrossentropy=u.sparseCategoricalCrossentropy,n.get=function(e){var t={binaryAccuracy:c,categoricalAccuracy:p,categoricalCrossentropy:n.categoricalCrossentropy,sparseCategoricalCrossentropy:n.sparseCategoricalCrossentropy,mse:n.mse,MSE:n.MSE,mae:n.mae,MAE:n.MAE,mape:n.mape,MAPE:n.MAPE,cosine:n.cosine};if("string"==typeof e&&e in t)return t[e];if("string"!=typeof e&&null!=e)return e;throw new r.ValueError("Unknown metric "+e)}},{"./backend/state":192,"./backend/tfjs_backend":193,"./errors":203,"./losses":225,"@tensorflow/tfjs-core":66}],227:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),u=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},p=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[0,a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var h=e("@tensorflow/tfjs-core"),a=e("./backend/state"),l=e("./engine/input_layer"),c=e("./engine/topology"),f=e("./engine/training"),d=e("./errors"),m=e("./layers/serialization"),y=e("./utils/generic_utils"),g=e("./utils/serialization_utils"),v=e("./utils/types_utils");function o(i,o,a){return void 0===a&&(a=!0),u(this,void 0,void 0,function(){var t,n,r;return p(this,function(e){switch(e.label){case 0:if(null==i.load)throw new d.ValueError("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,i.load()];case 1:if(t=e.sent(),null!=(n=t.modelTopology).model_config&&(n=n.model_config),r=m.deserialize(g.convertPythonicToTs(n),o),null!=t.weightData){if(null==t.weightSpecs)throw new d.ValueError("Model artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");!!1,r.loadWeights(h.io.decodeWeights(t.weightData,t.weightSpecs),!1,!0,a)}return[2,r]}})})}n.modelFromJSON=function(l,c){return u(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u;return p(this,function(e){switch(e.label){case 0:return null!=(t=l.modelTopology).model_config&&(t=t.model_config),n=g.convertPythonicToTs(t),r=m.deserialize(n,c),null==l.weightsManifest?[3,2]:[4,h.io.loadWeights(l.weightsManifest,l.pathPrefix,r.weights.map(function(e){return e.originalName}))];case 1:for(i=e.sent(),o={},a=0,s=r.weights;a<s.length;a++)u=s[a],o[u.originalName]=i[u.originalName];r.loadWeights(o,null,!0),e.label=2;case 2:return[2,r]}})})},n.loadModelInternal=function(n,r){return void 0===r&&(r=!0),u(this,void 0,void 0,function(){var t;return p(this,function(e){if("string"==typeof n){if(0===(t=h.io.getLoadHandlers(n)).length)t.push(h.io.browserHTTPRequest(n));else if(1<t.length)throw new d.ValueError("Found more than one ("+t.length+") load handlers for URL '"+n+"'");n=t[0]}return[2,o(n,void 0,r)]})})},n.loadModelFromIOHandler=o;var s=function(o){function s(e){var t=o.call(this,{inputs:[],outputs:[]})||this;if(e=e||{},t.trainable=!0,t._updatable=!0,t.built=!1,t.name=null!=e.name?e.name:a.getUid("sequential_"),null!=e.layers)for(var n=0,r=e.layers;n<r.length;n++){var i=r[n];t.add(i)}return t}return i(s,o),s.prototype.add=function(e){var t,n=e instanceof s||e instanceof f.Model;if(n){if(1!==(t=e).outputs.length)throw new d.ValueError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new d.ValueError("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new d.ValueError("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var r=l.Input({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(n)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new d.ValueError("A layer added to a Sequential model must not already be connected somewhere else. Model received layer "+e.name+" which has "+e.inboundNodes.length+" pre-existing inbound connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new d.ValueError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=c.getSourceInputs(this.outputs[0])}this.inboundNodes=[],new c.Node({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:y.pyListRepeat(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(e){return e.shape}),outputShapes:this.outputs[0].shape})}else{var i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1},s.prototype.pop=function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},s.prototype.call=function(e,t){return null==this.model&&this.build(),this.model.call(e,t)},s.prototype.build=function(e){if(v.getExactlyOneShape(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new f.Model({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.model.updatable=this.updatable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},s.prototype.countParams=function(){return this.built||this.build(),o.prototype.countParams.call(this)},s.prototype.summary=function(e,t,n){void 0===n&&(n=console.log),this.built||this.build(),o.prototype.summary.call(this,e,t,n)},s.prototype.setWeights=function(e){null==this.model&&this.build(),this.model.setWeights(e)},Object.defineProperty(s.prototype,"updatable",{get:function(){return this._updatable},set:function(e){this.built&&(this.model.updatable=e),this._updatable=e},enumerable:!0,configurable:!0}),s.prototype.evaluate=function(e,t,n){if(void 0===n&&(n={}),!this.built)throw new d.RuntimeError("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)},s.prototype.predict=function(e,t){return void 0===t&&(t={}),null==this.model&&this.build(),this.model.predict(e,t)},s.prototype.predictOnBatch=function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)},s.prototype.compile=function(e){this.build(),this.model.compile(e),this.optimizer=this.model.optimizer,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},s.prototype.fit=function(t,n,r){return void 0===r&&(r={}),u(this,void 0,void 0,function(){return p(this,function(e){if(!this.built)throw new d.RuntimeError("The model needs to be compiled before being used.");return[2,this.model.fit(t,n,r)]})})},s.fromConfig=function(e,t){var n=new e({});if(!(n instanceof s))throw new d.ValueError("Sequential.fromConfig called on non-Sequential input: "+n);if(!(t instanceof Array))throw new d.ValueError("Sequential.fromConfig called without an array of configs");if(null==t[0].className||"Merge"===t[0].className)throw new d.ValueError("Legacy serialization format not supported yet.");for(var r=0,i=t;r<i.length;r++){var o=i[r],a=m.deserialize(o);n.add(a)}return n},Object.defineProperty(s.prototype,"stopTraining",{set:function(e){this.model.stopTraining=e},enumerable:!0,configurable:!0}),s.prototype.getConfig=function(){for(var e=[],t=0,n=this.layers;t<n.length;t++){var r=n[t];e.push({className:r.getClassName(),config:r.getConfig()})}return e},s.className="Sequential",s}(f.Model);n.Sequential=s,h.serialization.SerializationMap.register(s)},{"./backend/state":192,"./engine/input_layer":200,"./engine/topology":201,"./engine/training":202,"./errors":203,"./layers/serialization":222,"./utils/generic_utils":231,"./utils/serialization_utils":234,"./utils/types_utils":235,"@tensorflow/tfjs-core":66}],228:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("./backend/common"),o=e("./errors");n.getOptimizer=function(e){var t={Adagrad:function(){return r.train.adagrad(.01)},Adadelta:function(){return r.train.adadelta(1,.95,i.epsilon())},Adam:function(){return r.train.adam(.001,.9,.999,i.epsilon())},Adamax:function(){return r.train.adamax(.002,.9,.999,i.epsilon(),0)},RMSProp:function(){return r.train.rmsprop(.001,.9,0,i.epsilon())},SGD:function(){return r.train.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new o.ValueError("Unknown Optimizer "+e)}},{"./backend/common":191,"./errors":203,"@tensorflow/tfjs-core":66}],229:[function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=e("@tensorflow/tfjs-core"),s=e("@tensorflow/tfjs-core"),u=e("./backend/state"),l=e("./backend/tfjs_backend"),i=e("./utils/generic_utils"),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t}(s.serialization.Serializable),p=function(i){function e(e){var t=i.call(this)||this,n=null==e||null==e.l1?.01:e.l1,r=null==e||null==e.l2?.01:e.l2;return t.hasL1=0!==n,t.hasL2=0!==r,t.l1=u.getScalar(n),t.l2=u.getScalar(r),t}return o(e,i),e.prototype.apply=function(t){var n=this;return s.tidy(function(){var e=s.zeros([1]);return n.hasL1&&(e=s.add(e,s.sum(a.mul(n.l1,s.abs(t))))),n.hasL2&&(e=s.add(e,s.sum(a.mul(n.l2,l.square(t))))),e.asScalar()})},e.prototype.getConfig=function(){return{l1:this.l1.dataSync()[0],l2:this.l2.dataSync()[0]}},e.fromConfig=function(e,t){return new e({l1:t.l1,l2:t.l2})},e.className="L1L2",e}(n.Regularizer=c);function h(e,t){return void 0===t&&(t={}),i.deserializeKerasObject(e,s.serialization.SerializationMap.getMap().classNameMap,t,"regularizer")}n.L1L2=p,s.serialization.SerializationMap.register(p),n.l1=function(e){return new p({l1:null!=e?e.l1:null,l2:0})},n.l2=function(e){return new p({l2:null!=e?e.l2:null,l1:0})},n.REGULARIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP={l1l2:"L1L2"},n.serializeRegularizer=function(e){return i.serializeKerasObject(e)},n.deserializeRegularizer=h,n.getRegularizer=function(e){return null==e?null:"string"==typeof e?h({className:e in n.REGULARIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP?n.REGULARIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP[e]:e,config:{}}):e instanceof c?e:h(e)}},{"./backend/state":192,"./backend/tfjs_backend":193,"./utils/generic_utils":231,"@tensorflow/tfjs-core":66}],230:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("../errors"),a=e("./generic_utils"),s=e("./math_utils");n.normalizeArray=function(e,t,n){if("number"==typeof e)return a.pyListRepeat(e,t);if(e.length!==t)throw new o.ValueError("The "+n+" argument must be a tuple of "+t+" integers. Received: "+e.length+" elements.");for(var r=0;r<t;++r){var i=e[r];if(!s.isInteger(i))throw new o.ValueError("The "+n+" argument must be a tuple of "+t+" integers. Received: "+JSON.stringify(e)+" including a non-integer number "+i)}return e},n.convOutputLength=function(e,t,n,r,i){return void 0===i&&(i=1),null==e?e:(o="same"===n?e:e-(t+(t-1)*(i-1))+1,Math.floor((o+r-1)/r));var o},n.deconvLength=function(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+s.max([n-t,0]);else{if("same"!==r)throw new o.ValueError("Unsupport padding mode: "+r+".");e*=t}return e}},{"../errors":203,"./generic_utils":231,"./math_utils":233}],231:[function(e,t,n){"use strict";var P=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};Object.defineProperty(n,"__esModule",{value:!0});var N=e("../errors");function i(e,t){if(!e)throw new N.AssertionError(t)}function o(e){return Array.isArray(e)?e:[e]}n.pyListRepeat=function(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}return(n=new Array(t)).fill(e),n},n.assert=i,n.count=function(e,t){for(var n=0,r=0,i=e;r<i.length;r++)i[r]===t&&n++;return n},n.singletonOrArray=function(e){return 1===e.length?e[0]:e},n.toList=o,n.objectListUid=function(e){for(var t="",n=0,r=o(e);n<r.length;n++){var i=r[n];if(null==i.id)throw new N.ValueError("Object "+i+" passed to objectListUid without an id");""!==t&&(t+=", "),t+=Math.abs(i.id)}return t},n.toSnakeCase=function(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t},n.toCamelCase=function(e){return e.length<=1?e:-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,function(e,t){return t.toUpperCase()})};var A={};function r(e,t){return e<t?-1:t<e?1:0}n.serializeKerasObject=function(e){return null==e?null:{className:e.getClassName(),config:e.getConfig()}},n.deserializeKerasObject=function(e,t,n,r){if(void 0===t&&(t={}),void 0===n&&(n={}),void 0===r&&(r="object"),"string"==typeof e){var i=e,o=void 0;if(i in n)o=n[i];else if(i in A)o=A[i];else if(null==(o=t[i]))throw new N.ValueError("Unknown "+r+": "+e);return o}var a=e;if(null==a.className||null==a.config)throw new N.ValueError(r+": Improper config format: "+JSON.stringify(a)+".\n'className' and 'config' must set.");var s,u,l,c=a.className,p=void 0,h=void 0;if(c in n?(p=(s=n.get(c))[0],h=s[1]):c in A?(p=(u=A.className)[0],h=u[1]):c in t&&(p=(l=t[c])[0],h=l[1]),null==p)throw new N.ValueError("Unknown "+r+": "+c);if(null!=h){for(var f={},d=0,m=Object.keys(A);d<m.length;d++)f[w=m[d]]=A[w];for(var y=0,g=Object.keys(n);y<g.length;y++)f[w=g[y]]=n[w];a.config.customObjects=f;for(var v=P({},A),b=0,_=Object.keys(n);b<_.length;b++){var w=_[b];A[w]=n[w]}var S=h(p,a.config);return A=P({},v),S}v=P({},A);for(var x=0,T=Object.keys(n);x<T.length;x++)w=T[x],A[w]=n[w];return S=new p(a.config),A=P({},v),S},n.numberCompare=r,n.reverseNumberCompare=function(e,t){return-1*r(e,t)},n.stringToDType=function(e){switch(e){case"float32":return"float32";default:throw new N.ValueError("Invalid dtype: "+e)}},n.stringsEqual=function(e,t){if(null==e||null==t)return e===t;if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0},n.unique=function(e){if(null==e)return e;for(var t=[],n=0,r=e;n<r.length;n++){var i=r[n];-1===t.indexOf(i)&&t.push(i)}return t},n.isObjectEmpty=function(e){if(null==e)throw new N.ValueError("Invalid value in obj: "+JSON.stringify(e));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},n.checkStringTypeUnionValue=function(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new N.ValueError(n+" is not a valid "+t+".  Valid values are "+e+" or null/undefined.")},n.checkArrayTypeAndLength=function(e,t,n,r){return void 0===n&&(n=0),void 0===r&&(r=1/0),i(0<=n),i(n<=r),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every(function(e){return typeof e===t})}},{"../errors":203}],232:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var f=e("./variable_utils");function y(e,t,n){void 0===n&&(n=console.log);for(var r="",i=0;i<e.length;++i)0<i&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[i]).slice(0,t[i]),r+=" ".repeat(t[i]-r.length);n(r)}function d(e,t,n){var r;try{r=JSON.stringify(e.outputShape)}catch(e){r="multiple"}y([e.name+" ("+e.getClassName()+")",r,e.countParams().toString()],t,n)}function m(e,t,n,r){var i;try{i=JSON.stringify(e.outputShape)}catch(e){i="multiple"}for(var o=[],a=0,s=e.inboundNodes;a<s.length;a++){var u=s[a];if(!(null!=n&&0<n.length&&-1===n.indexOf(u)))for(var l=0;l<u.inboundLayers.length;++l){var c=u.inboundLayers[l].name,p=u.nodeIndices[l],h=u.tensorIndices[l];o.push(c+"["+p+"]["+h+"]")}}var f=e.name,d=e.getClassName(),m=0===o.length?"":o[0];y([f+" ("+d+")",i,e.countParams().toString(),m],t,r);for(l=1;l<o.length;++l)y(["","","",o[l]],t,r)}n.printSummary=function(e,t,n,r){void 0===r&&(r=console.log);var i,o=function(e){var t=!0,n=[],r=[];for(var i in e.nodesByDepth)n.push(e.nodesByDepth[i]);for(var o=0,a=n;o<a.length;o++){var s=a[o];if(1<s.length||1===s.length&&1<s[0].inboundLayers.length){t=!1;break}r.push.apply(r,s)}if(t)for(var u=0,l=e.layers;u<l.length;u++){for(var c=l[u],p=!1,h=0,f=c.inboundNodes;h<f.length;h++){var d=f[h];if(-1!==r.indexOf(d)){if(p){t=!1;break}p=!0}}if(!t)break}return t}(e),a=["Layer (type)","Output shape","Param #"];if(o?(t=t||65,n=n||[.45,.85,1]):(t=t||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map(function(e){return Math.floor(t*e)})),!o)for(var s in a.push("Receives inputs"),i=[],e.nodesByDepth)i.push.apply(i,e.nodesByDepth[s]);r("_".repeat(t)),y(a,n,r),r("=".repeat(t));for(var u=e.layers,l=0;l<u.length;++l)o?d(u[l],n,r):m(u[l],n,i,r),r((l===u.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var c=(h=e,null!=h.collectedTrainableWeights?f.countParamsInWeights(h.collectedTrainableWeights):f.countParamsInWeights(h.trainableWeights)),p=f.countParamsInWeights(e.nonTrainableWeights);var h;r("Total params: "+(c+p)),r("Trainable params: "+c),r("Non-trainable params: "+p),r("_".repeat(t))}},{"./variable_utils":236}],233:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@tensorflow/tfjs-core"),i=e("@tensorflow/tfjs-core"),o=e("../errors");function a(e){return e=Array.isArray(e)?new Float32Array(e):e,i.tensor1d(e)}function s(e){return r.sum(a(e)).dataSync()[0]}function u(e){return s(e)/e.length}n.isInteger=function(e){return e===parseInt(e.toString(),10)},n.arrayProd=function(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,i=t;i<n;++i)r*=e[i];return r},n.min=function(e){return r.min(a(e)).dataSync()[0]},n.max=function(e){return r.max(a(e)).dataSync()[0]},n.sum=s,n.mean=u,n.variance=function(e){var t=r.sub(a(e),i.scalar(u(e)));return r.sum(r.mulStrict(t,t)).dataSync()[0]/e.length},n.median=function(e){var t=e.slice().sort(function(e,t){return e-t}),n=Math.floor((t.length-1)/2),r=Math.ceil((t.length-1)/2);return n===r?t[n]:(t[n]+t[r])/2},n.range=function(e,t){if(t<e)throw new o.ValueError("end ("+t+") < begin ("+e+") is forbidden.");for(var n=[],r=e;r<t;++r)n.push(r);return n}},{"../errors":203,"@tensorflow/tfjs-core":66}],234:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var f=e("../utils/generic_utils");function d(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}n.convertPythonicToTs=function e(t,n){if(null===t)return null;if("string"==typeof t)return f.toCamelCase(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var r=[],i=t.length,o=0;o<i;++o){var a=t[o];d(n,o,a)?r.push(a):r.push(e(a,n))}return r}for(var s={},u=0,l=Object.keys(t);u<l.length;u++){var c=l[u],p=t[c];if("name"===c&&"string"==typeof p)s[c]=p;else{var h=f.toCamelCase(c);s[h]=e(p,h)}}return s},n.convertTsToPythonic=function e(t,n){if(null==t)return null;if("string"==typeof t)return f.toSnakeCase(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var r=[],i=t.length,o=0;o<i;++o){var a=t[o];d(n,o,a)?r.push(a):r.push(e(a,n))}return r}for(var s={},u=0,l=Object.keys(t);u<l.length;u++){var c=l[u],p=t[c],h=f.toSnakeCase(c);s[h]="name"!==c&&"className"!==c||"string"!=typeof p?e(p,c):p}return s}},{"../utils/generic_utils":231}],235:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../errors");n.isArrayOfShapes=function(e){return Array.isArray(e)&&Array.isArray(e[0])},n.normalizeShapeList=function(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]},n.getExactlyOneTensor=function(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new r.ValueError("Expected Tensor length to be 1; got "+e.length);t=e[0]}else t=e;return t},n.getExactlyOneShape=function(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return(e=e)[0];throw new r.ValueError("Expected exactly 1 Shape; got "+e.length)}return e}},{"../errors":203}],236:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.countParamsInWeights=function(e){for(var t=0,n=0,r=e;n<r.length;n++){var i=r[n];0===i.shape.length?t+=1:t+=i.shape.reduce(function(e,t){return e*t})}return t}},{}],237:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("@tensorflow/tfjs-core"),i=e("@tensorflow/tfjs-core"),o=e("./backend/state"),s=e("./common"),u=e("./errors"),l=function(){function e(e,t,n,r,i){void 0===t&&(t="float32"),void 0===n&&(n="Variable"),void 0===r&&(r=!0),void 0===i&&(i=null),this.dtype=null==t?"float32":t,this.shape=e.shape,this.id=o.getNextUniqueTensorId(),n=null==n?"Variable":n,this.originalName=s.getScopedTensorName(n),this.name=s.getUniqueTensorName(this.originalName),this.trainable=r,this.constraint=i,this.val=a.variable(e,this.trainable,this.name,this.dtype)}return e.prototype.read=function(){return this.assertNotDisposed(),this.val},e.prototype.write=function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this},e.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},e.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},e}();n.LayerVariable=l,n.variable=function(e,t,n,r){return new l(e,t,n,!0,r)},n.zerosVariable=function(e,t,n){return new l(a.zeros(e),t,n)},n.zerosLike=function(e,t,n){return new l(a.zerosLike(e),t,n)},n.onesVariable=function(e,t,n){var r=a.ones(e);return new l(r,t,n)},n.onesLike=function(e,t,n){var r=a.onesLike(e);return new l(r,t,n)},n.eyeVariable=function(e,t,n){return new l(a.eye(e),t,n)},n.randomUniformVariable=function(e,t,n,r,i,o){return void 0===o&&(o="randomUniform"),new l(a.randomUniform(e,t,n,r),r,o)},n.truncatedNormalVariable=function(e,t,n,r,i,o){if(void 0===t&&(t=0),void 0===n&&(n=1),void 0===o&&(o="truncatedNormal"),"bool"===r)throw new u.NotImplementedError("randomNormal does not support dType bool.");return new l(a.truncatedNormal(e,t,n,r,i),r,o)},n.randomNormalVariable=function(e,t,n,r,i,o){if(void 0===t&&(t=0),void 0===n&&(n=1),void 0===o&&(o="randomNormal"),"bool"===r)throw new u.NotImplementedError("randomNormalVariable does not support dType bool.");return new l(a.randomNormal(e,t,n,r,i),r,o)},n.update=function(e,t){return e.write(t)},n.updateAdd=function(e,t){return e.write(a.add(e.read(),t))},n.updateSub=function(e,t){return e.write(a.sub(e.read(),t))},n.batchGetValue=function(e){return e.map(function(e){return e.read()})},n.batchSetValue=function(e){e.map(function(e){e[0].write(e[1])})},n.gradients=function(e,t){var n=t.map(function(e){return e.read()}),r=i.variableGrads(e,n);return t.map(function(e){return r.grads[e.name]})}},{"./backend/state":192,"./common":196,"./errors":203,"@tensorflow/tfjs-core":66}],238:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.version="0.7.4"},{}],239:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),r(e("@tensorflow/tfjs-core")),r(e("@tensorflow/tfjs-layers")),r(e("@tensorflow/tfjs-converter"));var i=e("@tensorflow/tfjs-core"),o=e("@tensorflow/tfjs-layers"),a=e("@tensorflow/tfjs-converter"),s=e("./version");n.version={"tfjs-core":i.version_core,"tfjs-layers":o.version_layers,"tfjs-converter":a.version_converter,tfjs:s.version}},{"./version":240,"@tensorflow/tfjs-converter":13,"@tensorflow/tfjs-core":66,"@tensorflow/tfjs-layers":210}],240:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.version="0.12.5"},{}],241:[function(e,t,n){"use strict";n.byteLength=function(e){return 3*e.length/4-p(e)},n.toByteArray=function(e){var t,n,r,i,o,a=e.length;i=p(e),o=new c(3*a/4-i),n=0<i?a-4:a;var s=0;for(t=0;t<n;t+=4)r=l[e.charCodeAt(t)]<<18|l[e.charCodeAt(t+1)]<<12|l[e.charCodeAt(t+2)]<<6|l[e.charCodeAt(t+3)],o[s++]=r>>16&255,o[s++]=r>>8&255,o[s++]=255&r;2===i?(r=l[e.charCodeAt(t)]<<2|l[e.charCodeAt(t+1)]>>4,o[s++]=255&r):1===i&&(r=l[e.charCodeAt(t)]<<10|l[e.charCodeAt(t+1)]<<4|l[e.charCodeAt(t+2)]>>2,o[s++]=r>>8&255,o[s++]=255&r);return o},n.fromByteArray=function(e){for(var t,n=e.length,r=n%3,i="",o=[],a=0,s=n-r;a<s;a+=16383)o.push(h(e,a,s<a+16383?s:a+16383));1===r?(t=e[n-1],i+=u[t>>2],i+=u[t<<4&63],i+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],i+=u[t>>10],i+=u[t>>4&63],i+=u[t<<2&63],i+="=");return o.push(i),o.join("")};for(var u=[],l=[],c="undefined"!=typeof Uint8Array?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,o=r.length;i<o;++i)u[i]=r[i],l[r.charCodeAt(i)]=i;function p(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function h(e,t,n){for(var r,i,o=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(u[(i=r)>>18&63]+u[i>>12&63]+u[i>>6&63]+u[63&i]);return o.join("")}l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},{}],242:[function(e,t,n){},{}],243:[function(e,t,n){"use strict";var r=e("base64-js"),o=e("ieee754");n.Buffer=p,n.SlowBuffer=function(e){+e!=e&&(e=0);return p.alloc(+e)},n.INSPECT_MAX_BYTES=50;var i=2147483647;function a(e){if(i<e)throw new RangeError("Invalid typed array length");var t=new Uint8Array(e);return t.__proto__=p.prototype,t}function p(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(e)}return s(e,t,n)}function s(e,t,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return D(e)||e&&D(e.buffer)?function(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n);return r.__proto__=p.prototype,r}(e,t,n):"string"==typeof e?function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!p.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|f(e,t),r=a(n),i=r.write(e,t);i!==n&&(r=r.slice(0,i));return r}(e,t):function(e){if(p.isBuffer(e)){var t=0|h(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}if(e){if(ArrayBuffer.isView(e)||"length"in e)return"number"!=typeof e.length||L(e.length)?a(0):c(e);if("Buffer"===e.type&&Array.isArray(e.data))return c(e.data)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object.")}(e)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e){return u(e),a(e<0?0:0|h(e))}function c(e){for(var t=e.length<0?0:0|h(e.length),n=a(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function h(e){if(i<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return 0|e}function f(e,t){if(p.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||D(e))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return C(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return R(e).length;default:if(r)return C(e).length;t=(""+t).toLowerCase(),r=!0}}function d(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function m(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):2147483647<n?n=2147483647:n<-2147483648&&(n=-2147483648),L(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=p.from(t,r)),p.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var o,a=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s/=a=2,u/=2,n/=2}function l(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var c=-1;for(o=n;o<s;o++)if(l(e,o)===l(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===u)return c*a}else-1!==c&&(o-=o-c),c=-1}else for(s<n+u&&(n=s-u),o=n;0<=o;o--){for(var p=!0,h=0;h<u;h++)if(l(e,o+h)!==l(t,h)){p=!1;break}if(p)return o}return-1}function g(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?i<(r=Number(r))&&(r=i):r=i;var o=t.length;o/2<r&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(L(s))return a;e[n+a]=s}return a}function v(e,t,n,r){return z(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function b(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function _(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,a,s,u,l=e[i],c=null,p=239<l?4:223<l?3:191<l?2:1;if(i+p<=n)switch(p){case 1:l<128&&(c=l);break;case 2:128==(192&(o=e[i+1]))&&127<(u=(31&l)<<6|63&o)&&(c=u);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&2047<(u=(15&l)<<12|(63&o)<<6|63&a)&&(u<55296||57343<u)&&(c=u);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&65535<(u=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)&&u<1114112&&(c=u)}null===c?(c=65533,p=1):65535<c&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),i+=p}return function(e){var t=e.length;if(t<=w)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=w));return n}(r)}n.kMaxLength=i,(p.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(p.prototype,"parent",{get:function(){if(this instanceof p)return this.buffer}}),Object.defineProperty(p.prototype,"offset",{get:function(){if(this instanceof p)return this.byteOffset}}),"undefined"!=typeof Symbol&&Symbol.species&&p[Symbol.species]===p&&Object.defineProperty(p,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),p.poolSize=8192,p.from=function(e,t,n){return s(e,t,n)},p.prototype.__proto__=Uint8Array.prototype,p.__proto__=Uint8Array,p.alloc=function(e,t,n){return i=t,o=n,u(r=e),r<=0?a(r):void 0!==i?"string"==typeof o?a(r).fill(i,o):a(r).fill(i):a(r);var r,i,o},p.allocUnsafe=function(e){return l(e)},p.allocUnsafeSlow=function(e){return l(e)},p.isBuffer=function(e){return null!=e&&!0===e._isBuffer},p.compare=function(e,t){if(!p.isBuffer(e)||!p.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},p.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},p.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return p.alloc(0);var n;if(void 0===t)for(n=t=0;n<e.length;++n)t+=e[n].length;var r=p.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(ArrayBuffer.isView(o)&&(o=p.from(o)),!p.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},p.byteLength=f,p.prototype._isBuffer=!0,p.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)d(this,t,t+1);return this},p.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)d(this,t,t+3),d(this,t+1,t+2);return this},p.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)d(this,t,t+7),d(this,t+1,t+6),d(this,t+2,t+5),d(this,t+3,t+4);return this},p.prototype.toLocaleString=p.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?_(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return T(this,t,n);case"utf8":case"utf-8":return _(this,t,n);case"ascii":return S(this,t,n);case"latin1":case"binary":return x(this,t,n);case"base64":return b(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},p.prototype.equals=function(e){if(!p.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===p.compare(this,e)},p.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return 0<this.length&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},p.prototype.compare=function(e,t,n,r,i){if(!p.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(i<=r&&n<=t)return 0;if(i<=r)return-1;if(n<=t)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),a=(n>>>=0)-(t>>>=0),s=Math.min(o,a),u=this.slice(r,i),l=e.slice(t,n),c=0;c<s;++c)if(u[c]!==l[c]){o=u[c],a=l[c];break}return o<a?-1:a<o?1:0},p.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},p.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},p.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)},p.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||i<n)&&(n=i),0<e.length&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o,a,s,u,l,c,p,h,f,d=!1;;)switch(r){case"hex":return g(this,e,t,n);case"utf8":case"utf-8":return h=t,f=n,z(C(e,(p=this).length-h),p,h,f);case"ascii":return v(this,e,t,n);case"latin1":case"binary":return v(this,e,t,n);case"base64":return u=this,l=t,c=n,z(R(e),u,l,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return a=t,s=n,z(function(e,t){for(var n,r,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(e,(o=this).length-a),o,a,s);default:if(d)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),d=!0}},p.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var w=4096;function S(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function x(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function T(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||r<n)&&(n=r);for(var i="",o=t;o<n;++o)i+=M(e[o]);return i}function P(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function N(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(n<e+t)throw new RangeError("Trying to access beyond buffer length")}function A(e,t,n,r,i,o){if(!p.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<t||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function O(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function k(e,t,n,r,i){return t=+t,n>>>=0,i||O(e,0,n,4),o.write(e,t,n,r,23,4),n+4}function E(e,t,n,r,i){return t=+t,n>>>=0,i||O(e,0,n,8),o.write(e,t,n,r,52,8),n+8}p.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):n<e&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):n<t&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return r.__proto__=p.prototype,r},p.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},p.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);for(var r=this[e+--t],i=1;0<t&&(i*=256);)r+=this[e+--t]*i;return r},p.prototype.readUInt8=function(e,t){return e>>>=0,t||N(e,1,this.length),this[e]},p.prototype.readUInt16LE=function(e,t){return e>>>=0,t||N(e,2,this.length),this[e]|this[e+1]<<8},p.prototype.readUInt16BE=function(e,t){return e>>>=0,t||N(e,2,this.length),this[e]<<8|this[e+1]},p.prototype.readUInt32LE=function(e,t){return e>>>=0,t||N(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},p.prototype.readUInt32BE=function(e,t){return e>>>=0,t||N(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},p.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return(i*=128)<=r&&(r-=Math.pow(2,8*t)),r},p.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||N(e,t,this.length);for(var r=t,i=1,o=this[e+--r];0<r&&(i*=256);)o+=this[e+--r]*i;return(i*=128)<=o&&(o-=Math.pow(2,8*t)),o},p.prototype.readInt8=function(e,t){return e>>>=0,t||N(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},p.prototype.readInt16LE=function(e,t){e>>>=0,t||N(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},p.prototype.readInt16BE=function(e,t){e>>>=0,t||N(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},p.prototype.readInt32LE=function(e,t){return e>>>=0,t||N(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},p.prototype.readInt32BE=function(e,t){return e>>>=0,t||N(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},p.prototype.readFloatLE=function(e,t){return e>>>=0,t||N(e,4,this.length),o.read(this,e,!0,23,4)},p.prototype.readFloatBE=function(e,t){return e>>>=0,t||N(e,4,this.length),o.read(this,e,!1,23,4)},p.prototype.readDoubleLE=function(e,t){return e>>>=0,t||N(e,8,this.length),o.read(this,e,!0,52,8)},p.prototype.readDoubleBE=function(e,t){return e>>>=0,t||N(e,8,this.length),o.read(this,e,!1,52,8)},p.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t>>>=0,n>>>=0,r)||A(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},p.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t>>>=0,n>>>=0,r)||A(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;0<=--i&&(o*=256);)this[t+i]=e/o&255;return t+n},p.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,1,255,0),this[t]=255&e,t+1},p.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},p.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},p.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},p.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},p.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);A(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},p.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);A(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;0<=--o&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},p.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},p.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},p.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},p.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},p.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||A(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},p.prototype.writeFloatLE=function(e,t,n){return k(this,e,t,!0,n)},p.prototype.writeFloatBE=function(e,t,n){return k(this,e,t,!1,n)},p.prototype.writeDoubleLE=function(e,t,n){return E(this,e,t,!0,n)},p.prototype.writeDoubleBE=function(e,t,n){return E(this,e,t,!1,n)},p.prototype.copy=function(e,t,n,r){if(!p.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),0<r&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var o=i-1;0<=o;--o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return i},p.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!p.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var i=e.charCodeAt(0);("utf8"===r&&i<128||"latin1"===r)&&(e=i)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=p.isBuffer(e)?e:new p(e,r),s=a.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<n-t;++o)this[o+t]=a[o%s]}return this};var I=/[^+/0-9A-Za-z-_]/g;function M(e){return e<16?"0"+e.toString(16):e.toString(16)}function C(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],a=0;a<r;++a){if(55295<(n=e.charCodeAt(a))&&n<57344){if(!i){if(56319<n){-1<(t-=3)&&o.push(239,191,189);continue}if(a+1===r){-1<(t-=3)&&o.push(239,191,189);continue}i=n;continue}if(n<56320){-1<(t-=3)&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&-1<(t-=3)&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function R(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(I,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function z(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function D(e){return e instanceof ArrayBuffer||null!=e&&null!=e.constructor&&"ArrayBuffer"===e.constructor.name&&"number"==typeof e.byteLength}function L(e){return e!=e}},{"base64-js":241,ieee754:244}],244:[function(e,t,n){n.read=function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,p=n?i-1:0,h=n?-1:1,f=e[t+p];for(p+=h,o=f&(1<<-c)-1,f>>=-c,c+=s;0<c;o=256*o+e[t+p],p+=h,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;0<c;a=256*a+e[t+p],p+=h,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),o-=l}return(f?-1:1)*a*Math.pow(2,o-r)},n.write=function(e,t,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,p=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,d=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),2<=(t+=1<=a+p?h/u:h*Math.pow(2,1-p))*u&&(a++,u/=2),c<=a+p?(s=0,a=c):1<=a+p?(s=(t*u-1)*Math.pow(2,i),a+=p):(s=t*Math.pow(2,p-1)*Math.pow(2,i),a=0));8<=i;e[n+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;0<l;e[n+f]=255&a,f+=d,a/=256,l-=8);e[n+f-d]|=128*m}},{}],245:[function(e,t,n){var r,i;r=this,i=function(){return function(n){function r(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,r),t.l=!0,t.exports}var i={};return r.m=n,r.c=i,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return o});var r=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],i=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","ethnic","percussive","sound effects"],o={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}},function(e,t,n){"use strict";t.b=function(e){return e.replace(/\u0000/g,"")},t.a=function(e,t){return 60/t.bpm*(e/t.PPQ)},t.c=function(e){return"number"==typeof e},n.d(t,"d",function(){return a}),t.e=function(e){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]+(Math.floor(e/12)-1)},n.d(t,"f",function(){return s});var i,o,r,a=(r=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,function(e){return"string"==typeof e&&r.test(e)}),s=(i=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,o={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},function(e){var t=i.exec(e),n=t[1],r=t[2];return o[n.toLowerCase()]+12*(parseInt(r)+1)})},function(e,t,o){"use strict";o.d(t,"a",function(){return r});var a=o(11),i=(o.n(a),o(10)),s=(o.n(i),o(1)),u=o(9),l=o(5),n=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),r=function(){function r(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,r),this.header={bpm:120,timeSignature:[4,4],PPQ:480},this.tracks=[]}return n(r,null,[{key:"fromJSON",value:function(e){var n=new r;return n.header=e.header,e.tracks.forEach(function(e){var t=u.a.fromJSON(e);n.tracks.push(t)}),n}}]),n(r,[{key:"load",value:function(r){var i=this,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"GET";return new Promise(function(e,t){var n=new XMLHttpRequest;n.open(a,r),n.responseType="arraybuffer",n.addEventListener("load",function(){4===n.readyState&&200===n.status?e(i.decode(n.response)):t(n.status)}),n.addEventListener("error",t),n.send(o)}).catch(function(e){console.log(e)})}},{key:"decode",value:function(e){var i=this;if(e instanceof ArrayBuffer){var t=new Uint8Array(e);e=String.fromCharCode.apply(null,t)}var n=a(e);return this.header=o.i(l.a)(n),this.tracks=[],n.tracks.forEach(function(e,t){var n=new u.a;n.id=t,i.tracks.push(n);var r=0;e.forEach(function(e){r+=s.a(e.deltaTime,i.header),"meta"===e.type&&"trackName"===e.subtype?n.name=s.b(e.text):"noteOn"===e.subtype?(n.noteOn(e.noteNumber,r,e.velocity/127),-1===n.channelNumber&&(n.channelNumber=e.channel)):"noteOff"===e.subtype?n.noteOff(e.noteNumber,r):"controller"===e.subtype&&e.controllerType?n.cc(e.controllerType,r,e.value/127):"meta"===e.type&&"instrumentName"===e.subtype?n.instrument=e.text:"channel"===e.type&&"programChange"===e.subtype&&(n.patch(e.programNumber),n.channelNumber=e.channel)}),i.header.name||n.length||!n.name||(i.header.name=n.name)}),this}},{key:"encode",value:function(){var n=this,r=new i.File({ticks:this.header.PPQ}),e=this.tracks.filter(function(e){return!e.length})[0];return!this.header.name||e&&e.name===this.header.name||r.addTrack().addEvent(new i.MetaEvent({time:0,type:i.MetaEvent.TRACK_NAME,data:this.header.name})),this.tracks.forEach(function(e){var t=r.addTrack();t.setTempo(n.bpm),e.name&&t.addEvent(new i.MetaEvent({time:0,type:i.MetaEvent.TRACK_NAME,data:e.name})),e.encode(t,n.header)}),r.toBytes()}},{key:"toArray",value:function(){for(var e=this.encode(),t=new Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}},{key:"toJSON",value:function(){var e={header:this.header,startTime:this.startTime,duration:this.duration,tracks:(this.tracks||[]).map(function(e){return e.toJSON()})};return e.header.name||(e.header.name=""),e}},{key:"track",value:function(e){var t=new u.a(e);return this.tracks.push(t),t}},{key:"get",value:function(t){return s.c(t)?this.tracks[t]:this.tracks.find(function(e){return e.name===t})}},{key:"slice",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.duration,e=new r;return e.header=this.header,e.tracks=this.tracks.map(function(e){return e.slice(t,n)}),e}},{key:"startTime",get:function(){var e=this.tracks.map(function(e){return e.startTime});return e.length&&Math.min.apply(Math,e)||0}},{key:"bpm",get:function(){return this.header.bpm},set:function(e){var t=this.header.bpm/(this.header.bpm=e);this.tracks.forEach(function(e){return e.scale(t)})}},{key:"timeSignature",get:function(){return this.header.timeSignature},set:function(e){this.header.timeSignature=e}},{key:"duration",get:function(){var e=this.tracks.map(function(e){return e.duration});return e.length&&Math.max.apply(Math,e)||0}}]),r}()},function(e,t,n){"use strict";function r(e,t){if(e.length){var n=function(e,t){var n=0,r=e.length,i=r;if(0<r&&e[r-1].time<=t)return r-1;for(;n<i;){var o=Math.floor(n+(i-n)/2),a=e[o],s=e[o+1];if(a.time===t){for(var u=o;u<e.length;u++)e[u].time===t&&(o=u);return o}if(a.time<t&&s.time>t)return o;a.time>t?i=o:a.time<t&&(n=o+1)}return-1}(e,t.time);e.splice(n+1,0,t)}else e.push(t)}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoContro"},r=function(){function r(e,t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,r),this.number=e,this.time=t,this.value=n}return i(r,[{key:"name",get:function(){if(o.hasOwnProperty(this.number))return o[this.number]}}]),r}()},function(e,t,n){"use strict";function r(e){for(var t={PPQ:e.header.ticksPerBeat},n=0;n<e.tracks.length;n++)for(var r=e.tracks[n],i=0;i<r.length;i++){var o=r[i];"meta"===o.type&&("timeSignature"===o.subtype?t.timeSignature=[o.numerator,o.denominator]:"setTempo"===o.subtype&&(t.bpm||(t.bpm=6e7/o.microsecondsPerBeat)))}return t.bpm=t.bpm||120,t}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";function a(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=t[n];if(r.length>i)return!0}return!1}function s(e,t,n){for(var r=0,i=1/0,o=0;o<e.length;o++){var a=e[o],s=t[o];a[s]&&a[s].time<i&&(r=o,i=a[s].time)}n[r](e[r][t[r]]),t[r]+=1}function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=t.filter(function(e,t){return t%2==0}),i=new Uint32Array(r.length),o=t.filter(function(e,t){return t%2==1});a(r,i);)s(r,i,o)}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=function(e){return(new r.a).decode(e)},t.load=function(e,t){var n=(new r.a).load(e);return t&&n.then(t),n},t.create=function(){return new r.a},t.fromJSON=function(e){return r.a.fromJSON(e)};var r=n(2),i=n(0);n.d(t,"instrumentByPatchID",function(){return i.a}),n.d(t,"instrumentFamilyByID",function(){return i.b}),n.d(t,"drumKitByPatchID",function(){return i.c})},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(1),r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=function(){function i(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),o.c(e))this.midi=e;else{if(!o.d(e))throw new Error("the midi value must either be in Pitch Notation (e.g. C#4) or a midi value");this.name=e}this.time=t,this.duration=n,this.velocity=r}return r(i,null,[{key:"fromJSON",value:function(e){return new i(e.midi,e.time,e.duration,e.velocity)}}]),r(i,[{key:"match",value:function(e){return o.c(e)?this.midi===e:o.d(e)?this.name.toLowerCase()===e.toLowerCase():void 0}},{key:"toJSON",value:function(){return{name:this.name,midi:this.midi,time:this.time,velocity:this.velocity,duration:this.duration}}},{key:"name",get:function(){return o.e(this.midi)},set:function(e){this.midi=o.f(e)}},{key:"noteOn",get:function(){return this.time},set:function(e){this.time=e}},{key:"noteOff",get:function(){return this.time+this.duration},set:function(e){this.duration=e-this.time}}]),i}()},function(e,t,a){"use strict";a.d(t,"a",function(){return o});var s=a(3),i=a(4),u=a(6),l=a(8),n=a(0),r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=function(){function o(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,o),this.name=e,this.channelNumber=n,this.notes=[],this.controlChanges={},this.instrumentNumber=t}return r(o,null,[{key:"fromJSON",value:function(e){var n=new o(e.name,e.instrumentNumber,e.channelNumber);return n.id=e.id,e.notes&&e.notes.forEach(function(e){var t=l.a.fromJSON(e);n.notes.push(t)}),e.controlChanges&&(n.controlChanges=e.controlChanges),n}}]),r(o,[{key:"note",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,i=new l.a(e,t,n,r);return a.i(s.a)(this.notes,i),this}},{key:"noteOn",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,r=new l.a(e,t,0,n);return a.i(s.a)(this.notes,r),this}},{key:"noteOff",value:function(e,t){for(var n=0;n<this.notes.length;n++){var r=this.notes[n];if(r.match(e)&&0===r.duration){r.noteOff=t;break}}return this}},{key:"cc",value:function(e,t,n){this.controlChanges.hasOwnProperty(e)||(this.controlChanges[e]=[]);var r=new i.a(e,t,n);return a.i(s.a)(this.controlChanges[e],r),this}},{key:"patch",value:function(e){return this.instrumentNumber=e,this}},{key:"channel",value:function(e){return this.channelNumber=e,this}},{key:"scale",value:function(t){return this.notes.forEach(function(e){e.time*=t,e.duration*=t}),this}},{key:"slice",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.duration,e=Math.max(this.notes.findIndex(function(e){return e.time>=t}),0),r=this.notes.findIndex(function(e){return e.noteOff>=n})+1,i=new o(this.name);return i.notes=this.notes.slice(e,r),i.notes.forEach(function(e){return e.time=e.time-t}),i}},{key:"encode",value:function(t,e){function n(e){var t=Math.floor(r*e),n=Math.max(t-i,0);return i=t,n}var r=e.PPQ/(60/e.bpm),i=0,o=Math.max(0,this.channelNumber);-1!==this.instrumentNumber&&t.instrument(o,this.instrumentNumber),a.i(u.a)(this.noteOns.sort(function(e,t){return e.time-t.time}),function(e){t.addNoteOn(o,e.name,n(e.time),Math.floor(127*e.velocity))},this.noteOffs.sort(function(e,t){return e.time-t.time}),function(e){t.addNoteOff(o,e.name,n(e.time))})}},{key:"toJSON",value:function(){var e={startTime:this.startTime,duration:this.duration,length:this.length,notes:[],controlChanges:{}};return void 0!==this.id&&(e.id=this.id),e.name=this.name,-1!==this.instrumentNumber&&(e.instrumentNumber=this.instrumentNumber,e.instrument=this.instrument,e.instrumentFamily=this.instrumentFamily),-1!==this.channelNumber&&(e.channelNumber=this.channelNumber,e.isPercussion=this.isPercussion),this.notes.length&&(e.notes=this.notes.map(function(e){return e.toJSON()})),Object.keys(this.controlChanges).length&&(e.controlChanges=this.controlChanges),e}},{key:"noteOns",get:function(){var t=[];return this.notes.forEach(function(e){t.push({time:e.noteOn,midi:e.midi,name:e.name,velocity:e.velocity})}),t}},{key:"noteOffs",get:function(){var t=[];return this.notes.forEach(function(e){t.push({time:e.noteOff,midi:e.midi,name:e.name})}),t}},{key:"length",get:function(){return this.notes.length}},{key:"startTime",get:function(){return this.notes.length?this.notes[0].noteOn:0}},{key:"duration",get:function(){return this.notes.length?this.notes[this.notes.length-1].noteOff:0}},{key:"instrument",get:function(){return this.isPercussion?n.c[this.instrumentNumber]:n.a[this.instrumentNumber]},set:function(e){var t=n.a.indexOf(e);-1!==t&&(this.instrumentNumber=t)}},{key:"isPercussion",get:function(){return[9,10].includes(this.channelNumber)}},{key:"instrumentFamily",get:function(){return this.isPercussion?"drums":n.b[Math.floor(this.instrumentNumber/8)]}}]),o}()},function(e,n,t){(function(e){var t={};!function(e){var i=e.DEFAULT_VOLUME=90,o=(e.DEFAULT_DURATION=128,e.DEFAULT_CHANNEL=0,{midi_letter_pitches:{a:21,b:23,c:12,d:14,e:16,f:17,g:19},midiPitchFromNote:function(e){var t=/([a-g])(#+|b+)?([0-9]+)$/i.exec(e),n=t[1].toLowerCase(),r=t[2]||"";return 12*parseInt(t[3],10)+o.midi_letter_pitches[n]+("#"==r.substr(0,1)?1:-1)*r.length},ensureMidiPitch:function(e){return"number"!=typeof e&&/[^0-9]/.test(e)?o.midiPitchFromNote(e):parseInt(e,10)},midi_pitches_letter:{12:"c",13:"c#",14:"d",15:"d#",16:"e",17:"f",18:"f#",19:"g",20:"g#",21:"a",22:"a#",23:"b"},midi_flattened_notes:{"a#":"bb","c#":"db","d#":"eb","f#":"gb","g#":"ab"},noteFromMidiPitch:function(e,t){var n,r=0,i=e;t=t||!1;return 23<e&&(i=e-12*(r=Math.floor(e/12)-1)),n=o.midi_pitches_letter[i],t&&0<n.indexOf("#")&&(n=o.midi_flattened_notes[n]),n+r},mpqnFromBpm:function(e){for(var t=Math.floor(6e7/e),n=[];n.unshift(255&t),t>>=8;);for(;n.length<3;)n.push(0);return n},bpmFromMpqn:function(e){if(void 0!==e[0])for(var t=0,n=e.length-1;0<=n;++t,--n)e[t]<<n;return Math.floor(6e7/e)},codes2Str:function(e){return String.fromCharCode.apply(null,e)},str2Bytes:function(e,t){if(t)for(;e.length/2<t;)e="0"+e;for(var n=[],r=e.length-1;0<=r;r-=2){var i=0===r?e[r]:e[r-1]+e[r];n.unshift(parseInt(i,16))}return n},translateTickTime:function(e){for(var t=127&e;e>>=7;)t<<=8,t|=127&e|128;for(var n=[];n.push(255&t),128&t;)t>>=8;return n}}),a=function(e){if(!this)return new a(e);!e||null===e.type&&void 0===e.type||null===e.channel&&void 0===e.channel||null===e.param1&&void 0===e.param1||(this.setTime(e.time),this.setType(e.type),this.setChannel(e.channel),this.setParam1(e.param1),this.setParam2(e.param2))};a.NOTE_OFF=128,a.NOTE_ON=144,a.AFTER_TOUCH=160,a.CONTROLLER=176,a.PROGRAM_CHANGE=192,a.CHANNEL_AFTERTOUCH=208,a.PITCH_BEND=224,a.prototype.setTime=function(e){this.time=o.translateTickTime(e||0)},a.prototype.setType=function(e){if(e<a.NOTE_OFF||e>a.PITCH_BEND)throw new Error("Trying to set an unknown event: "+e);this.type=e},a.prototype.setChannel=function(e){if(e<0||15<e)throw new Error("Channel is out of bounds.");this.channel=e},a.prototype.setParam1=function(e){this.param1=e},a.prototype.setParam2=function(e){this.param2=e},a.prototype.toBytes=function(){var e=[],t=this.type|15&this.channel;return e.push.apply(e,this.time),e.push(t),e.push(this.param1),void 0!==this.param2&&null!==this.param2&&e.push(this.param2),e};var n=function(e){if(!this)return new n(e);this.setTime(e.time),this.setType(e.type),this.setData(e.data)};n.SEQUENCE=0,n.TEXT=1,n.COPYRIGHT=2,n.TRACK_NAME=3,n.INSTRUMENT=4,n.LYRIC=5,n.MARKER=6,n.CUE_POINT=7,n.CHANNEL_PREFIX=32,n.END_OF_TRACK=47,n.TEMPO=81,n.SMPTE=84,n.TIME_SIG=88,n.KEY_SIG=89,n.SEQ_EVENT=127,n.prototype.setTime=function(e){this.time=o.translateTickTime(e||0)},n.prototype.setType=function(e){this.type=e},n.prototype.setData=function(e){this.data=e},n.prototype.toBytes=function(){if(!this.type)throw new Error("Type for meta-event not specified.");var e=[];if(e.push.apply(e,this.time),e.push(255,this.type),Array.isArray(this.data))e.push(this.data.length),e.push.apply(e,this.data);else if("number"==typeof this.data)e.push(1,this.data);else if(null!==this.data&&void 0!==this.data){e.push(this.data.length);var t=this.data.split("").map(function(e){return e.charCodeAt(0)});e.push.apply(e,t)}else e.push(0);return e};var s=function(e){if(!this)return new s(e);var t=e||{};this.events=t.events||[]};s.START_BYTES=[77,84,114,107],s.END_BYTES=[0,255,47,0],s.prototype.addEvent=function(e){return this.events.push(e),this},s.prototype.addNoteOn=s.prototype.noteOn=function(e,t,n,r){return this.events.push(new a({type:a.NOTE_ON,channel:e,param1:o.ensureMidiPitch(t),param2:r||i,time:n||0})),this},s.prototype.addNoteOff=s.prototype.noteOff=function(e,t,n,r){return this.events.push(new a({type:a.NOTE_OFF,channel:e,param1:o.ensureMidiPitch(t),param2:r||i,time:n||0})),this},s.prototype.addNote=s.prototype.note=function(e,t,n,r,i){return this.noteOn(e,t,r,i),n&&this.noteOff(e,t,n,i),this},s.prototype.addChord=s.prototype.chord=function(n,e,r,t){if(!Array.isArray(e)&&!e.length)throw new Error("Chord must be an array of pitches");return e.forEach(function(e){this.noteOn(n,e,0,t)},this),e.forEach(function(e,t){0===t?this.noteOff(n,e,r):this.noteOff(n,e)},this),this},s.prototype.setInstrument=s.prototype.instrument=function(e,t,n){return this.events.push(new a({type:a.PROGRAM_CHANGE,channel:e,param1:t,time:n||0})),this},s.prototype.setTempo=s.prototype.tempo=function(e,t){return this.events.push(new n({type:n.TEMPO,data:o.mpqnFromBpm(e),time:t||0})),this},s.prototype.toBytes=function(){var n=0,r=[],e=s.START_BYTES,t=s.END_BYTES;this.events.forEach(function(e){var t=e.toBytes();n+=t.length,r.push.apply(r,t)}),n+=t.length;var i=o.str2Bytes(n.toString(16),4);return e.concat(i,r,t)};var r=function(e){if(!this)return new r(e);var t=e||{};if(t.ticks){if("number"!=typeof t.ticks)throw new Error("Ticks per beat must be a number!");if(t.ticks<=0||32768<=t.ticks||t.ticks%1!=0)throw new Error("Ticks per beat must be an integer between 1 and 32767!")}this.ticks=t.ticks||128,this.tracks=t.tracks||[]};r.HDR_CHUNKID="MThd",r.HDR_CHUNK_SIZE="\0\0\0",r.HDR_TYPE0="\0\0",r.HDR_TYPE1="\0",r.prototype.addTrack=function(e){return e?(this.tracks.push(e),this):(e=new s,this.tracks.push(e),e)},r.prototype.toBytes=function(){var e=this.tracks.length.toString(16),t=r.HDR_CHUNKID+r.HDR_CHUNK_SIZE;return 1<parseInt(e,16)?t+=r.HDR_TYPE1:t+=r.HDR_TYPE0,t+=o.codes2Str(o.str2Bytes(e,2)),t+=String.fromCharCode(this.ticks/256,this.ticks%256),this.tracks.forEach(function(e){t+=o.codes2Str(e.toBytes())}),t},e.Util=o,e.File=r,e.Track=s,e.Event=a,e.MetaEvent=n}(t),null!=e?e.exports=t:null!=n?n=t:this.Midi=t}).call(n,t(12)(e))},function(e,t){function d(n){function r(e){var t=n.charCodeAt(i);return e&&127<t&&(t-=256),i+=1,t}var i=0;return{eof:function(){return i>=n.length},read:function(e){var t=n.substr(i,e);return i+=e,t},readInt32:function(){var e=(n.charCodeAt(i)<<24)+(n.charCodeAt(i+1)<<16)+(n.charCodeAt(i+2)<<8)+n.charCodeAt(i+3);return i+=4,e},readInt16:function(){var e=(n.charCodeAt(i)<<8)+n.charCodeAt(i+1);return i+=2,e},readInt8:r,readVarInt:function(){for(var e=0;;){var t=r();if(!(128&t))return e+t;e+=127&t,e<<=7}}}}e.exports=function(e){return function(e){function t(e){var t=e.read(4),n=e.readInt32();return{id:t,length:n,data:e.read(n)}}var u;stream=d(e);var n=t(stream);if("MThd"!=n.id||6!=n.length)throw"Bad .mid file - header not found";var r=d(n.data),i=r.readInt16(),o=r.readInt16(),a=r.readInt16();if(32768&a)throw"Expressing time division in SMTPE frames is not supported yet";ticksPerBeat=a;for(var s={formatType:i,trackCount:o,ticksPerBeat:ticksPerBeat},l=[],c=0;c<s.trackCount;c++){l[c]=[];var p=t(stream);if("MTrk"!=p.id)throw"Unexpected chunk - expected MTrk, got "+p.id;for(var h=d(p.data);!h.eof();){var f=function(e){var t={};t.deltaTime=e.readVarInt();var n,r=e.readInt8();if(240==(240&r)){if(255==r){t.type="meta";var i=e.readInt8(),o=e.readVarInt();switch(i){case 0:if(t.subtype="sequenceNumber",2!=o)throw"Expected length for sequenceNumber event is 2, got "+o;return t.number=e.readInt16(),t;case 1:return t.subtype="text",t.text=e.read(o),t;case 2:return t.subtype="copyrightNotice",t.text=e.read(o),t;case 3:return t.subtype="trackName",t.text=e.read(o),t;case 4:return t.subtype="instrumentName",t.text=e.read(o),t;case 5:return t.subtype="lyrics",t.text=e.read(o),t;case 6:return t.subtype="marker",t.text=e.read(o),t;case 7:return t.subtype="cuePoint",t.text=e.read(o),t;case 32:if(t.subtype="midiChannelPrefix",1!=o)throw"Expected length for midiChannelPrefix event is 1, got "+o;return t.channel=e.readInt8(),t;case 47:if(t.subtype="endOfTrack",0!=o)throw"Expected length for endOfTrack event is 0, got "+o;return t;case 81:if(t.subtype="setTempo",3!=o)throw"Expected length for setTempo event is 3, got "+o;return t.microsecondsPerBeat=(e.readInt8()<<16)+(e.readInt8()<<8)+e.readInt8(),t;case 84:if(t.subtype="smpteOffset",5!=o)throw"Expected length for smpteOffset event is 5, got "+o;var a=e.readInt8();return t.frameRate={0:24,32:25,64:29,96:30}[96&a],t.hour=31&a,t.min=e.readInt8(),t.sec=e.readInt8(),t.frame=e.readInt8(),t.subframe=e.readInt8(),t;case 88:if(t.subtype="timeSignature",4!=o)throw"Expected length for timeSignature event is 4, got "+o;return t.numerator=e.readInt8(),t.denominator=Math.pow(2,e.readInt8()),t.metronome=e.readInt8(),t.thirtyseconds=e.readInt8(),t;case 89:if(t.subtype="keySignature",2!=o)throw"Expected length for keySignature event is 2, got "+o;return t.key=e.readInt8(!0),t.scale=e.readInt8(),t;case 127:return t.subtype="sequencerSpecific",t.data=e.read(o),t;default:return t.subtype="unknown",t.data=e.read(o),t}return t.data=e.read(o),t}if(240==r)return t.type="sysEx",o=e.readVarInt(),t.data=e.read(o),t;if(247==r)return t.type="dividedSysEx",o=e.readVarInt(),t.data=e.read(o),t;throw"Unrecognised MIDI event type byte: "+r}0==(128&r)?(n=r,r=u):(n=e.readInt8(),u=r);var s=r>>4;switch(t.channel=15&r,t.type="channel",s){case 8:return t.subtype="noteOff",t.noteNumber=n,t.velocity=e.readInt8(),t;case 9:return t.noteNumber=n,t.velocity=e.readInt8(),0==t.velocity?t.subtype="noteOff":t.subtype="noteOn",t;case 10:return t.subtype="noteAftertouch",t.noteNumber=n,t.amount=e.readInt8(),t;case 11:return t.subtype="controller",t.controllerType=n,t.value=e.readInt8(),t;case 12:return t.subtype="programChange",t.programNumber=n,t;case 13:return t.subtype="channelAftertouch",t.amount=n,t;case 14:return t.subtype="pitchBend",t.value=n+(e.readInt8()<<7),t;default:throw"Unrecognised MIDI event type: "+s}}(h);l[c].push(f)}}return{header:s,tracks:l}}(e)}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}}])},"object"==typeof n&&"object"==typeof t?t.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof n?n.MidiConvert=i():r.MidiConvert=i()},{}],246:[function(e,t,n){var r,i,o=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function u(t){if(r===setTimeout)return setTimeout(t,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var l,c=[],p=!1,h=-1;function f(){p&&l&&(p=!1,l.length?c=l.concat(c):h=-1,c.length&&d())}function d(){if(!p){var e=u(f);p=!0;for(var t=c.length;t;){for(l=c,c=[];++h<t;)l&&l[h].run();h=-1,t=c.length}l=null,p=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function y(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new m(e,t)),1!==c.length||p||u(d)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=y,o.addListener=y,o.once=y,o.off=y,o.removeListener=y,o.removeAllListeners=y,o.emit=y,o.prependListener=y,o.prependOnceListener=y,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],247:[function(e,t,n){arguments[4][48][0].apply(n,arguments)},{"./src/index-minimal":248,dup:48}],248:[function(e,t,n){"use strict";var r=n;function i(){r.Reader._configure(r.BufferReader),r.util._configure()}r.build="minimal",r.Writer=e("./writer"),r.BufferWriter=e("./writer_buffer"),r.Reader=e("./reader"),r.BufferReader=e("./reader_buffer"),r.util=e("./util/minimal"),r.rpc=e("./rpc"),r.roots=e("./roots"),r.configure=i,r.Writer._configure(r.BufferWriter),i()},{"./reader":249,"./reader_buffer":250,"./roots":251,"./rpc":252,"./util/minimal":255,"./writer":256,"./writer_buffer":257}],249:[function(e,t,n){"use strict";t.exports=u;var r,i=e("./util/minimal"),o=i.LongBits,a=i.utf8;function s(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function u(e){this.buf=e,this.pos=0,this.len=e.length}var l,c="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new u(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new u(e);throw Error("illegal buffer")};function p(){var e=new o(0,0),t=0;if(!(4<this.len-this.pos)){for(;t<3;++t){if(this.pos>=this.len)throw s(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,4<this.len-this.pos){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw s(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function h(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw s(this,8);return new o(h(this.buf,this.pos+=4),h(this.buf,this.pos+=4))}u.create=i.Buffer?function(e){return(u.create=function(e){return i.Buffer.isBuffer(e)?new r(e):c(e)})(e)}:c,u.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,u.prototype.uint32=(l=4294967295,function(){if(l=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return l;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return l}),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},u.prototype.bool=function(){return 0!==this.uint32()},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return h(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|h(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},u.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},u.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw s(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},u.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},u.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw s(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;;){if(4==(e=7&this.uint32()))break;this.skipType(e)}break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},u._configure=function(e){r=e;var t=i.Long?"toLong":"toNumber";i.merge(u.prototype,{int64:function(){return p.call(this)[t](!1)},uint64:function(){return p.call(this)[t](!0)},sint64:function(){return p.call(this).zzDecode()[t](!1)},fixed64:function(){return f.call(this)[t](!0)},sfixed64:function(){return f.call(this)[t](!1)}})}},{"./util/minimal":255}],250:[function(e,t,n){arguments[4][51][0].apply(n,arguments)},{"./reader":249,"./util/minimal":255,dup:51}],251:[function(e,t,n){arguments[4][52][0].apply(n,arguments)},{dup:52}],252:[function(e,t,n){arguments[4][53][0].apply(n,arguments)},{"./rpc/service":253,dup:53}],253:[function(e,t,n){arguments[4][54][0].apply(n,arguments)},{"../util/minimal":255,dup:54}],254:[function(e,t,n){arguments[4][55][0].apply(n,arguments)},{"../util/minimal":255,dup:55}],255:[function(n,e,o){(function(e){"use strict";var r=o;function i(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function t(e){function n(e,t){if(!(this instanceof n))return new n(e,t);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,n):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),t&&i(this,t)}return(n.prototype=Object.create(Error.prototype)).constructor=n,Object.defineProperty(n.prototype,"name",{get:function(){return e}}),n.prototype.toString=function(){return this.name+": "+this.message},n}r.asPromise=n("@protobufjs/aspromise"),r.base64=n("@protobufjs/base64"),r.EventEmitter=n("@protobufjs/eventemitter"),r.float=n("@protobufjs/float"),r.inquire=n("@protobufjs/inquire"),r.utf8=n("@protobufjs/utf8"),r.pool=n("@protobufjs/pool"),r.LongBits=n("./longbits"),r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isNode=Boolean(e.process&&e.process.versions&&e.process.versions.node),r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||0<(Array.isArray(n)?n.length:Object.keys(n).length))},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=e.dcodeIO&&e.dcodeIO.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=i,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=t,r.ProtocolError=t("ProtocolError"),r.oneOfGetter=function(e){for(var n={},t=0;t<e.length;++t)n[e[t]]=1;return function(){for(var e=Object.keys(this),t=e.length-1;-1<t;--t)if(1===n[e[t]]&&void 0!==this[e[t]]&&null!==this[e[t]])return e[t]}},r.oneOfSetter=function(n){return function(e){for(var t=0;t<n.length;++t)n[t]!==e&&delete this[n[t]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var n=r.Buffer;n?(r._Buffer_from=n.from!==Uint8Array.from&&n.from||function(e,t){return new n(e,t)},r._Buffer_allocUnsafe=n.allocUnsafe||function(e){return new n(e)}):r._Buffer_from=r._Buffer_allocUnsafe=null}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./longbits":254,"@protobufjs/aspromise":1,"@protobufjs/base64":2,"@protobufjs/eventemitter":3,"@protobufjs/float":4,"@protobufjs/inquire":5,"@protobufjs/pool":6,"@protobufjs/utf8":7}],256:[function(e,t,n){arguments[4][57][0].apply(n,arguments)},{"./util/minimal":255,dup:57}],257:[function(e,t,n){arguments[4][58][0].apply(n,arguments)},{"./util/minimal":255,"./writer":256,dup:58}],258:[function(e,t,n){var r=e("./lib/alea"),i=e("./lib/xor128"),o=e("./lib/xorwow"),a=e("./lib/xorshift7"),s=e("./lib/xor4096"),u=e("./lib/tychei"),l=e("./seedrandom");l.alea=r,l.xor128=i,l.xorwow=o,l.xorshift7=a,l.xor4096=s,l.tychei=u,t.exports=l},{"./lib/alea":259,"./lib/tychei":260,"./lib/xor128":261,"./lib/xor4096":262,"./lib/xorshift7":263,"./lib/xorwow":264,"./seedrandom":265}],259:[function(e,t,n){!function(e,t,n){function o(e){var r,t=this,n=(r=4022871197,function(e){e=e.toString();for(var t=0;t<e.length;t++){var n=.02519603282416938*(r+=e.charCodeAt(t));n-=r=n>>>0,r=(n*=r)>>>0,r+=4294967296*(n-=r)}return 2.3283064365386963e-10*(r>>>0)});t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function r(e,t){var n=new o(e),r=t&&t.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,r&&("object"==typeof r&&a(r,n),i.state=function(){return a(n,{})}),i}t&&t.exports?t.exports=r:n&&n.amd?n(function(){return r}):this.alea=r}(0,"object"==typeof t&&t,"function"==typeof define&&define)},{}],260:[function(e,t,n){!function(e,t,n){function o(e){var i=this,t="";i.next=function(){var e=i.b,t=i.c,n=i.d,r=i.a;return e=e<<25^e>>>7^t,t=t-n|0,n=n<<24^n>>>8^r,r=r-e|0,i.b=e=e<<20^e>>>12^t,i.c=t=t-n|0,i.d=n<<16^t>>>16^r,i.a=r-e|0},i.a=0,i.b=0,i.c=-1640531527,i.d=1367130551,e===Math.floor(e)?(i.a=e/4294967296|0,i.b=0|e):t+=e;for(var n=0;n<t.length+20;n++)i.b^=0|t.charCodeAt(n),i.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function r(e,t){var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&a(r,n),i.state=function(){return a(n,{})}),i}t&&t.exports?t.exports=r:n&&n.amd?n(function(){return r}):this.tychei=r}(0,"object"==typeof t&&t,"function"==typeof define&&define)},{}],261:[function(e,t,n){!function(e,t,n){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function r(e,t){var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&a(r,n),i.state=function(){return a(n,{})}),i}t&&t.exports?t.exports=r:n&&n.amd?n(function(){return r}):this.xor128=r}(0,"object"==typeof t&&t,"function"==typeof define&&define)},{}],262:[function(e,t,n){!function(e,t,n){function o(e){var o=this;o.next=function(){var e,t,n=o.w,r=o.X,i=o.i;return o.w=n=n+1640531527|0,t=r[i+34&127],e=r[i=i+1&127],t^=t<<13,e^=e<<17,t^=t>>>15,e^=e>>>12,t=r[i]=t^e,o.i=i,t+(n^n>>>16)|0},function(e,t){var n,r,i,o,a,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),i=0,o=-32;o<u;++o)t&&(r^=t.charCodeAt((o+32)%t.length)),0===o&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,0<=o&&(a=a+1640531527|0,i=0==(n=s[127&o]^=r+a)?i+1:0);for(128<=i&&(s[127&(t&&t.length||0)]=-1),i=127,o=512;0<o;--o)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;e.w=a,e.X=s,e.i=i}(o,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function r(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.X&&a(r,n),i.state=function(){return a(n,{})}),i}t&&t.exports?t.exports=r:n&&n.amd?n(function(){return r}):this.xor4096=r}(0,"object"==typeof t&&t,"function"==typeof define&&define)},{}],263:[function(e,t,n){!function(e,t,n){function o(e){var i=this;i.next=function(){var e,t,n=i.x,r=i.i;return e=n[r],t=(e^=e>>>7)^e<<24,t^=(e=n[r+1&7])^e>>>10,t^=(e=n[r+3&7])^e>>>3,t^=(e=n[r+4&7])^e<<7,e=n[r+7&7],t^=(e^=e<<13)^e<<9,n[r]=t,i.i=r+1&7,t},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;0<n;--n)e.next()}(i,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function r(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&(r.x&&a(r,n),i.state=function(){return a(n,{})}),i}t&&t.exports?t.exports=r:n&&n.amd?n(function(){return r}):this.xorshift7=r}(0,"object"==typeof t&&t,"function"==typeof define&&define)},{}],264:[function(e,t,n){!function(e,t,n){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,e===((t.v=0)|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function r(e,t){var n=new o(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&a(r,n),i.state=function(){return a(n,{})}),i}t&&t.exports?t.exports=r:n&&n.amd?n(function(){return r}):this.xorwow=r}(0,"object"==typeof t&&t,"function"==typeof define&&define)},{}],265:[function(t,n,e){!function(s,u){var l,c=this,p=256,h=6,f="random",d=u.pow(p,h),m=u.pow(2,52),y=2*m,g=p-1;function e(e,t,n){var r=[],i=_(function e(t,n){var r,i=[],o=typeof t;if(n&&"object"==o)for(r in t)try{i.push(e(t[r],n-1))}catch(e){}return i.length?i:"string"==o?t:t+"\0"}((t=1==t?{entropy:!0}:t||{}).entropy?[e,w(s)]:null==e?function(){try{var e;return l&&(e=l.randomBytes)?e=e(p):(e=new Uint8Array(p),(c.crypto||c.msCrypto).getRandomValues(e)),w(e)}catch(e){var t=c.navigator,n=t&&t.plugins;return[+new Date,c,n,c.screen,w(s)]}}():e,3),r),o=new v(r),a=function(){for(var e=o.g(h),t=d,n=0;e<m;)e=(e+n)*p,t*=p,n=o.g(1);for(;y<=e;)e/=2,t/=2,n>>>=1;return(e+n)/t};return a.int32=function(){return 0|o.g(4)},a.quick=function(){return o.g(4)/4294967296},a.double=a,_(w(o.S),s),(t.pass||n||function(e,t,n,r){return r&&(r.S&&b(r,o),e.state=function(){return b(o,{})}),n?(u[f]=e,t):e})(a,i,"global"in t?t.global:this==u,t.state)}function v(e){var t,n=e.length,a=this,r=0,i=a.i=a.j=0,o=a.S=[];for(n||(e=[n++]);r<p;)o[r]=r++;for(r=0;r<p;r++)o[r]=o[i=g&i+e[r%n]+(t=o[r])],o[i]=t;(a.g=function(e){for(var t,n=0,r=a.i,i=a.j,o=a.S;e--;)t=o[r=g&r+1],n=n*p+o[g&(o[r]=o[i=g&i+t])+(o[i]=t)];return a.i=r,a.j=i,n})(p)}function b(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function _(e,t){for(var n,r=e+"",i=0;i<r.length;)t[g&i]=g&(n^=19*t[g&i])+r.charCodeAt(i++);return w(t)}function w(e){return String.fromCharCode.apply(0,e)}if(u["seed"+f]=e,_(u.random(),s),"object"==typeof n&&n.exports){n.exports=e;try{l=t("crypto")}catch(e){}}else"function"==typeof define&&define.amd&&define(function(){return e})}([],Math)},{crypto:242}],266:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tonal-note");var i=function(e){return e.filter(function(e){return 0===e||e})},o=function(e){var t=r.midi(e);return null!==t?t:r.midi(e+"-100")};function a(e){return i(e.map(r.name)).sort(function(e,t){return o(e)>o(t)})}var s=function(i){return 0===i.length?[[]]:s(i.slice(1)).reduce(function(e,r){return e.concat(i.map(function(e,t){var n=r.slice();return n.splice(t,0,i[0]),n}))},[])};n.range=function(e,t){return null===e||null===t?[]:e<t?function(e,t){for(var n=[];t--;n[t]=t+e);return n}(e,t-e+1):function(e,t){for(var n=[];t--;n[t]=e-t);return n}(e,e-t+1)},n.rotate=function(e,t){var n=t.length,r=(e%n+n)%n;return t.slice(r,n).concat(t.slice(0,r))},n.compact=i,n.sort=a,n.unique=function(e){return a(e).filter(function(e,t,n){return 0===t||e!==n[t-1]})},n.shuffle=function(e,t){var n,r;void 0===t&&(t=Math.random);for(var i=e.length;i;)n=t()*i--|0,r=e[i],e[i]=e[n],e[n]=r;return e},n.permutations=s},{"tonal-note":271}],267:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i,o=e("tonal-note"),a=e("tonal-distance"),s=e("tonal-dictionary"),u=e("tonal-pcset"),l=s.chord.names,c=Object.freeze({name:null,names:[],intervals:[],chroma:null,setnum:null}),p=(r=function(e){var t=s.chord(e);if(!t)return c;var n={intervals:t,name:e};return n.chroma=u.chroma(t),n.setnum=parseInt(n.chroma,2),n.names=s.chord.names(n.chroma),n},void 0===i&&(i={}),function(e){return i[e]||(i[e]=r(e))}),h=function(e){return p(d(e)[1]).intervals};var f=/^(6|64|7|9|11|13)$/;function d(e){var t=o.tokenize(e);return""===t[0]?["",e]:"A"===t[0]&&"ug"===t[3]?["","aug"]:f.test(t[2])?[t[0]+t[1],t[2]+t[3]]:[t[0]+t[1]+t[2],t[3]]}n.names=l,n.props=p,n.intervals=h,n.notes=function(e,t){var n=d(e);return t=t||n[1],p(t).intervals.map(a.transpose(n[0]))},n.exists=function(e){return void 0!==s.chord(d(e)[1])},n.supersets=function(e){if(!h(e).length)return[];var t=u.isSupersetOf(h(e));return s.chord.names().filter(function(e){return t(s.chord(e))})},n.subsets=function(e){var t=u.isSubsetOf(h(e));return s.chord.names().filter(function(e){return t(s.chord(e))})},n.tokenize=d},{"tonal-dictionary":268,"tonal-distance":269,"tonal-note":271,"tonal-pcset":272}],268:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var s=e("tonal-pcset"),r={M:["1P 3M 5P",["Major",""]],M13:["1P 3M 5P 7M 9M 13M",["maj13","Maj13"]],M6:["1P 3M 5P 13M",["6"]],M69:["1P 3M 5P 6M 9M",["69"]],M7add13:["1P 3M 5P 6M 7M 9M"],M7b5:["1P 3M 5d 7M"],M7b6:["1P 3M 6m 7M"],M7b9:["1P 3M 5P 7M 9m"],M7sus4:["1P 4P 5P 7M"],M9:["1P 3M 5P 7M 9M",["maj9","Maj9"]],M9b5:["1P 3M 5d 7M 9M"],M9sus4:["1P 4P 5P 7M 9M"],Madd9:["1P 3M 5P 9M",["2","add9","add2"]],Maj7:["1P 3M 5P 7M",["maj7","M7"]],Mb5:["1P 3M 5d"],Mb6:["1P 3M 13m"],Msus2:["1P 2M 5P",["add9no3","sus2"]],Msus4:["1P 4P 5P",["sus","sus4"]],Maddb9:["1P 3M 5P 9m"],m:["1P 3m 5P"],m11:["1P 3m 5P 7m 9M 11P",["_11"]],m11b5:["1P 3m 7m 12d 2M 4P",["h11","_11b5"]],m13:["1P 3m 5P 7m 9M 11P 13M",["_13"]],m6:["1P 3m 4P 5P 13M",["_6"]],m69:["1P 3m 5P 6M 9M",["_69"]],m7:["1P 3m 5P 7m",["minor7","_","_7"]],m7add11:["1P 3m 5P 7m 11P",["m7add4"]],m7b5:["1P 3m 5d 7m",["half-diminished","h7","_7b5"]],m9:["1P 3m 5P 7m 9M",["_9"]],m9b5:["1P 3m 7m 12d 2M",["h9","-9b5"]],mMaj7:["1P 3m 5P 7M",["mM7","_M7"]],mMaj7b6:["1P 3m 5P 6m 7M",["mM7b6"]],mM9:["1P 3m 5P 7M 9M",["mMaj9","-M9"]],mM9b6:["1P 3m 5P 6m 7M 9M",["mMaj9b6"]],mb6M7:["1P 3m 6m 7M"],mb6b9:["1P 3m 6m 9m"],o:["1P 3m 5d",["mb5","dim"]],o7:["1P 3m 5d 13M",["diminished","m6b5","dim7"]],o7M7:["1P 3m 5d 6M 7M"],oM7:["1P 3m 5d 7M"],sus24:["1P 2M 4P 5P",["sus4add9"]],madd4:["1P 3m 4P 5P"],madd9:["1P 3m 5P 9M"],4:["1P 4P 7m 10m",["quartal"]],5:["1P 5P"],7:["1P 3M 5P 7m",["Dominant","Dom"]],9:["1P 3M 5P 7m 9M",["79"]],11:["1P 5P 7m 9M 11P"],13:["1P 3M 5P 7m 9M 13M",["13_"]],64:["5P 8P 10M"],"M#5":["1P 3M 5A",["augmented","maj#5","Maj#5","+","aug"]],"M#5add9":["1P 3M 5A 9M",["+add9"]],"M13#11":["1P 3M 5P 7M 9M 11A 13M",["maj13#11","Maj13#11","M13+4","M13#4"]],"M6#11":["1P 3M 5P 6M 11A",["M6b5","6#11","6b5"]],"M69#11":["1P 3M 5P 6M 9M 11A"],"M7#11":["1P 3M 5P 7M 11A",["maj7#11","Maj7#11","M7+4","M7#4"]],"M7#5":["1P 3M 5A 7M",["maj7#5","Maj7#5","maj9#5","M7+"]],"M7#5sus4":["1P 4P 5A 7M"],"M7#9#11":["1P 3M 5P 7M 9A 11A"],"M9#11":["1P 3M 5P 7M 9M 11A",["maj9#11","Maj9#11","M9+4","M9#4"]],"M9#5":["1P 3M 5A 7M 9M",["Maj9#5"]],"M9#5sus4":["1P 4P 5A 7M 9M"],"11b9":["1P 5P 7m 9m 11P"],"13#11":["1P 3M 5P 7m 9M 11A 13M",["13+4","13#4"]],"13#9":["1P 3M 5P 7m 9A 13M",["13#9_"]],"13#9#11":["1P 3M 5P 7m 9A 11A 13M"],"13b5":["1P 3M 5d 6M 7m 9M"],"13b9":["1P 3M 5P 7m 9m 13M"],"13b9#11":["1P 3M 5P 7m 9m 11A 13M"],"13no5":["1P 3M 7m 9M 13M"],"13sus4":["1P 4P 5P 7m 9M 13M",["13sus"]],"69#11":["1P 3M 5P 6M 9M 11A"],"7#11":["1P 3M 5P 7m 11A",["7+4","7#4","7#11_","7#4_"]],"7#11b13":["1P 3M 5P 7m 11A 13m",["7b5b13"]],"7#5":["1P 3M 5A 7m",["+7","7aug","aug7"]],"7#5#9":["1P 3M 5A 7m 9A",["7alt","7#5#9_","7#9b13_"]],"7#5b9":["1P 3M 5A 7m 9m"],"7#5b9#11":["1P 3M 5A 7m 9m 11A"],"7#5sus4":["1P 4P 5A 7m"],"7#9":["1P 3M 5P 7m 9A",["7#9_"]],"7#9#11":["1P 3M 5P 7m 9A 11A",["7b5#9"]],"7#9#11b13":["1P 3M 5P 7m 9A 11A 13m"],"7#9b13":["1P 3M 5P 7m 9A 13m"],"7add6":["1P 3M 5P 7m 13M",["67","7add13"]],"7b13":["1P 3M 7m 13m"],"7b5":["1P 3M 5d 7m"],"7b6":["1P 3M 5P 6m 7m"],"7b9":["1P 3M 5P 7m 9m"],"7b9#11":["1P 3M 5P 7m 9m 11A",["7b5b9"]],"7b9#9":["1P 3M 5P 7m 9m 9A"],"7b9b13":["1P 3M 5P 7m 9m 13m"],"7b9b13#11":["1P 3M 5P 7m 9m 11A 13m",["7b9#11b13","7b5b9b13"]],"7no5":["1P 3M 7m"],"7sus4":["1P 4P 5P 7m",["7sus"]],"7sus4b9":["1P 4P 5P 7m 9m",["susb9","7susb9","7b9sus","7b9sus4","phryg"]],"7sus4b9b13":["1P 4P 5P 7m 9m 13m",["7b9b13sus4"]],"9#11":["1P 3M 5P 7m 9M 11A",["9+4","9#4","9#11_","9#4_"]],"9#11b13":["1P 3M 5P 7m 9M 11A 13m",["9b5b13"]],"9#5":["1P 3M 5A 7m 9M",["9+"]],"9#5#11":["1P 3M 5A 7m 9M 11A"],"9b13":["1P 3M 7m 9M 13m"],"9b5":["1P 3M 5d 7m 9M"],"9no5":["1P 3M 7m 9M"],"9sus4":["1P 4P 5P 7m 9M",["9sus"]],"m#5":["1P 3m 5A",["m+","mb6"]],"m11A 5":["1P 3m 6m 7m 9M 11P"],"m7#5":["1P 3m 6m 7m"],"m9#5":["1P 3m 6m 7m 9M"],"+add#9":["1P 3M 5A 9A"]},i=function(i){var t=Object.keys(i).sort(),r=[],o=[],a=function(e,t,n){r[e]=t,o[n]=o[n]||[],o[n].push(e)};t.forEach(function(e){var t=i[e][0].split(" "),n=i[e][1],r=s.chroma(t);a(e,t,r),n&&n.forEach(function(e){return a(e,t,r)})});var n=Object.keys(r).sort(),e=function(e){return r[e]};return e.names=function(e){return"string"==typeof e?(o[e]||[]).slice():(!0===e?n:t).slice()},e},o=function(t,n){var e=function(e){return t(e)||n(e)};return e.names=function(e){return t.names(e).concat(n.names(e))},e},a=i({chromatic:["1P 2m 2M 3m 3M 4P 4A 5P 6m 6M 7m 7M"],lydian:["1P 2M 3M 4A 5P 6M 7M"],major:["1P 2M 3M 4P 5P 6M 7M",["ionian"]],mixolydian:["1P 2M 3M 4P 5P 6M 7m",["dominant"]],dorian:["1P 2M 3m 4P 5P 6M 7m"],aeolian:["1P 2M 3m 4P 5P 6m 7m",["minor"]],phrygian:["1P 2m 3m 4P 5P 6m 7m"],locrian:["1P 2m 3m 4P 5d 6m 7m"],altered:["1P 2m 3m 3M 5d 6m 7m",["super locrian","diminished whole tone","pomeroy"]],iwato:["1P 2m 4P 5d 7m"],hirajoshi:["1P 2M 3m 5P 6m"],kumoijoshi:["1P 2m 4P 5P 6m"],pelog:["1P 2m 3m 5P 6m"],prometheus:["1P 2M 3M 4A 6M 7m"],ritusen:["1P 2M 4P 5P 6M"],scriabin:["1P 2m 3M 5P 6M"],piongio:["1P 2M 4P 5P 6M 7m"],augmented:["1P 2A 3M 5P 5A 7M"],neopolitan:["1P 2m 3m 4P 5P 6m 7M"],diminished:["1P 2M 3m 4P 5d 6m 6M 7M"],egyptian:["1P 2M 4P 5P 7m"],oriental:["1P 2m 3M 4P 5d 6M 7m"],spanish:["1P 2m 3M 4P 5P 6m 7m",["phrygian major"]],flamenco:["1P 2m 3m 3M 4A 5P 7m"],balinese:["1P 2m 3m 4P 5P 6m 7M"],persian:["1P 2m 3M 4P 5d 6m 7M"],bebop:["1P 2M 3M 4P 5P 6M 7m 7M"],enigmatic:["1P 2m 3M 5d 6m 7m 7M"],ichikosucho:["1P 2M 3M 4P 5d 5P 6M 7M"],"melodic minor":["1P 2M 3m 4P 5P 6M 7M"],"melodic minor second mode":["1P 2m 3m 4P 5P 6M 7m"],"lydian augmented":["1P 2M 3M 4A 5A 6M 7M"],"lydian dominant":["1P 2M 3M 4A 5P 6M 7m",["lydian b7"]],"melodic minor fifth mode":["1P 2M 3M 4P 5P 6m 7m",["hindu","mixolydian b6M"]],"locrian #2":["1P 2M 3m 4P 5d 6m 7m"],"locrian major":["1P 2M 3M 4P 5d 6m 7m",["arabian"]],"major pentatonic":["1P 2M 3M 5P 6M",["pentatonic"]],"lydian pentatonic":["1P 3M 4A 5P 7M",["chinese"]],"mixolydian pentatonic":["1P 3M 4P 5P 7m",["indian"]],"locrian pentatonic":["1P 3m 4P 5d 7m",["minor seven flat five pentatonic"]],"minor pentatonic":["1P 3m 4P 5P 7m"],"minor six pentatonic":["1P 3m 4P 5P 6M"],"minor hexatonic":["1P 2M 3m 4P 5P 7M"],"flat three pentatonic":["1P 2M 3m 5P 6M",["kumoi"]],"flat six pentatonic":["1P 2M 3M 5P 6m"],"major flat two pentatonic":["1P 2m 3M 5P 6M"],"whole tone pentatonic":["1P 3M 5d 6m 7m"],"ionian pentatonic":["1P 3M 4P 5P 7M"],"lydian #5P pentatonic":["1P 3M 4A 5A 7M"],"lydian dominant pentatonic":["1P 3M 4A 5P 7m"],"minor #7M pentatonic":["1P 3m 4P 5P 7M"],"super locrian pentatonic":["1P 3m 4d 5d 7m"],"in-sen":["1P 2m 4P 5P 7m"],"vietnamese 1":["1P 3m 4P 5P 6m"],"vietnamese 2":["1P 3m 4P 5P 7m"],"prometheus neopolitan":["1P 2m 3M 4A 6M 7m"],"major blues":["1P 2M 3m 3M 5P 6M"],"minor blues":["1P 3m 4P 5d 5P 7m",["blues"]],"composite blues":["1P 2M 3m 3M 4P 5d 5P 6M 7m"],"augmented heptatonic":["1P 2A 3M 4P 5P 5A 7M"],"dorian #4":["1P 2M 3m 4A 5P 6M 7m"],"lydian diminished":["1P 2M 3m 4A 5P 6M 7M"],"whole tone":["1P 2M 3M 4A 5A 7m"],"leading whole tone":["1P 2M 3M 4A 5A 7m 7M"],"harmonic minor":["1P 2M 3m 4P 5P 6m 7M"],"lydian minor":["1P 2M 3M 4A 5P 6m 7m"],"neopolitan minor":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan major":["1P 2m 3m 4P 5P 6M 7M",["dorian b2"]],"neopolitan major pentatonic":["1P 3M 4P 5d 7m"],"romanian minor":["1P 2M 3m 5d 5P 6M 7m"],"double harmonic lydian":["1P 2m 3M 4A 5P 6m 7M"],"harmonic major":["1P 2M 3M 4P 5P 6m 7M"],"double harmonic major":["1P 2m 3M 4P 5P 6m 7M",["gypsy"]],"hungarian minor":["1P 2M 3m 4A 5P 6m 7M"],"hungarian major":["1P 2A 3M 4A 5P 6M 7m"],"spanish heptatonic":["1P 2m 3m 3M 4P 5P 6m 7m"],"todi raga":["1P 2m 3m 4A 5P 6m 7M"],"malkos raga":["1P 3m 4P 6m 7m"],"kafi raga":["1P 3m 3M 4P 5P 6M 7m 7M"],"purvi raga":["1P 2m 3M 4P 4A 5P 6m 7M"],"bebop dominant":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop minor":["1P 2M 3m 3M 4P 5P 6M 7m"],"bebop major":["1P 2M 3M 4P 5P 5A 6M 7M"],"bebop locrian":["1P 2m 3m 4P 5d 5P 6m 7m"],"minor bebop":["1P 2M 3m 4P 5P 6m 7m 7M"],"mystery #1":["1P 2m 3M 5d 6m 7m"],"minor six diminished":["1P 2M 3m 4P 5P 6m 6M 7M"],"ionian augmented":["1P 2M 3M 4P 5A 6M 7M"],"lydian #9":["1P 2m 3M 4A 5P 6M 7M"],"six tone symmetric":["1P 2m 3M 4P 5A 6M"]}),u=i(r),l=o(a,u);n.dictionary=i,n.combine=o,n.scale=a,n.chord=u,n.pcset=l},{"tonal-pcset":272}],269:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=e("tonal-note"),a=e("tonal-interval"),s=[0,2,4,-1,1,3,5],u=s.map(function(e){return Math.floor(7*e/12)}),l=[3,0,4,1,5,2,6];var c=function(e,t,n){var r,i,o=l[(r=e,i=(r+1)%7,i<0?7+i:i)],a=Math.floor((e+1)/7);return void 0===t?{step:o,alt:a,dir:n}:{step:o,alt:a,oct:t+4*a+u[o],dir:n}},r=function(n){return t=function(e){var t=n(e);return null===t.name?null:function(e){var t=e.step,n=e.alt,r=e.oct,i=e.dir;void 0===i&&(i=1);var o=s[t]+7*n;return null===r?[i*o]:[i*o,i*(r-u[t]-4*n)]}(t)},void 0===r&&(r={}),function(e){return r[e]||(r[e]=t(e))};var t,r},p=r(o.props),h=r(a.props);function f(t,e){if(1===arguments.length)return function(e){return f(t,e)};var n=p(t),r=h(e);if(null===n||null===r)return null;var i=1===n.length?[n[0]+r[0]]:[n[0]+r[0],n[1]+r[1]];return o.build(c(i[0],i[1]))}var d=function(e){return 7*(t=e)[0]+12*t[1]<0?c(-e[0],-e[1],-1):c(e[0],e[1],1);var t};function i(e,t,n){var r=h(e),i=h(t);if(null===r||null===i)return null;var o=[r[0]+n*i[0],r[1]+n*i[1]];return a.build(d(o))}function m(t,e){return 1===arguments.length?function(e){return m(t,e)}:i(t,e,1)}n.transpose=f,n.trFifths=function t(n,e){if(1===arguments.length)return function(e){return t(n,e)};var r=p(n);return null===r?null:o.build(c(r[0]+e))},n.fifths=function t(n,e){if(1===arguments.length)return function(e){return t(n,e)};var r=p(n),i=p(e);return null===i||null===r?null:i[0]-r[0]},n.transposeBy=function(t,e){return 1===arguments.length?function(e){return f(e,t)}:f(e,t)},n.addIntervals=i,n.add=m,n.subtract=function(t,e){return 1===arguments.length?function(e){return m(t,e)}:i(t,e,-1)},n.interval=function t(n,e){if(1===arguments.length)return function(e){return t(n,e)};var r=p(n),i=p(e);if(null===r||null===i||r.length!==i.length)return null;var o=1===r.length?[i[0]-r[0],-Math.floor(7*(i[0]-r[0])/12)]:[i[0]-r[0],i[1]-r[1]];return a.build(d(o))},n.semitones=function t(n,e){if(1===arguments.length)return function(e){return t(n,e)};var r=o.props(n),i=o.props(e);return null!==r.midi&&null!==i.midi?i.midi-r.midi:null!==r.chroma&&null!==i.chroma?(i.chroma-r.chroma+12)%12:null}},{"tonal-interval":270,"tonal-note":271}],270:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=new RegExp("^([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})|(AA|A|P|M|m|d|dd)([-+]?\\d+)$"),o=[0,2,4,5,7,9,11],i=[0,1,2,3,4,5,6,5,4,3,2,1],a="1P 2m 2M 3m 3M 4P 5P 6m 6M 7m 7M 8P".split(" "),s=function(e){var t=r.exec(e);return null===t?null:t[1]?[t[1],t[2]]:[t[4],t[3]]},u=Object.freeze({name:null,num:null,q:null,step:null,alt:null,dir:null,type:null,simple:null,semitones:null,chroma:null}),c=function(e,t){return Array(Math.abs(t)+1).join(e)},p=function(e){return(Math.abs(e)-1)%7},l={};function h(e){return"string"!=typeof e?u:l[e]||(l[e]=function(e){var t=s(e);if(null===t)return u;var n,r,i={num:+t[0],q:t[1]};return i.step=p(i.num),i.type="PMMPPMM"[i.step],"M"===i.type&&"P"===i.q?u:(i.name=""+i.num+i.q,i.dir=i.num<0?-1:1,i.simple=8===i.num||-8===i.num?i.num:i.dir*(i.step+1),i.alt=(n=i.type,"M"===(r=i.q)&&"M"===n?0:"P"===r&&"P"===n?0:"m"===r&&"M"===n?-1:/^A+$/.test(r)?r.length:/^d+$/.test(r)?"P"===n?-r.length:-r.length-1:null),i.oct=Math.floor((Math.abs(i.num)-1)/7),i.semitones=i.dir*(o[i.step]+i.alt+12*i.oct),i.chroma=(i.dir*(o[i.step]+i.alt)%12+12)%12,Object.freeze(i))}(e))}var f=function(e){void 0===e&&(e={});var t=e.num,n=e.step,r=e.alt,i=e.oct;void 0===i&&(i=1);var o=e.dir;if(void 0!==n&&(t=n+1+7*i),void 0===t)return null;var a,s,u=o<0?"-":"",l="PMMPPMM"[p(t)];return u+t+(a=l,0===(s=r)?"M"===a?"M":"P":-1===s&&"M"===a?"m":0<s?c("A",s):s<0?c("d","P"===a?s:s+1):null)},d=[1,2,2,3,3,4,5,5,6,6,7,7],m="P m M m M P d P m M m M".split(" ");n.names=function(t){return"string"!=typeof t?a.slice():a.filter(function(e){return-1!==t.indexOf(e[1])})},n.tokenize=s,n.props=h,n.num=function(e){return h(e).num},n.name=function(e){return h(e).name},n.semitones=function(e){return h(e).semitones},n.chroma=function(e){return h(e).chroma},n.ic=function(e){return"string"==typeof e&&(e=h(e).chroma),"number"==typeof e?i[e%12]:null},n.build=f,n.simplify=function(e){var t=h(e);return t===u?null:t.simple+t.q},n.invert=function(e){var t=h(e);if(t===u)return null;var n=(7-t.step)%7,r="P"===t.type?-t.alt:-(t.alt+1);return f({step:n,alt:r,oct:t.oct,dir:t.dir})},n.fromSemitones=function(e){var t=e<0?-1:1,n=Math.abs(e),r=n%12,i=Math.floor(n/12);return t*(d[r]+7*i)+m[r]}},{}],271:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="C C# Db D D# Eb E F F# Gb G G# Ab A A# Bb B".split(" "),i=function(n){return"string"!=typeof n?r.slice():r.filter(function(e){var t=e[1]||" ";return-1!==n.indexOf(t)})},o=i(" #"),a=i(" b"),s=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function u(e){"string"!=typeof e&&(e="");var t=s.exec(e);return t?[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]:null}var l,c,p=Object.freeze({pc:null,name:null,step:null,alt:null,oct:null,octStr:null,chroma:null,midi:null,freq:null}),h=[0,2,4,5,7,9,11],f=(l=function(e){var t=u(e);if(""===t[0]||""!==t[3])return p;var n=t[0],r=t[1],i=t[2],o={letter:n,acc:r,octStr:i};return o.pc=o.letter+o.acc,o.name=o.pc+i,o.step=(o.letter.charCodeAt(0)+3)%7,o.alt="b"===o.acc[0]?-o.acc.length:o.acc.length,o.oct=i.length?+i:null,o.chroma=(h[o.step]+o.alt+120)%12,o.midi=null!==o.oct?h[o.step]+o.alt+12*(o.oct+1):null,o.freq=m(o.midi),Object.freeze(o)},void 0===c&&(c={}),function(e){return c[e]||(c[e]=l(e))}),d=function(e){return f(e).pc},m=function(e,t){return void 0===t&&(t=440),"number"==typeof e?Math.pow(2,(e-69)/12)*t:null},y=Math.log(2),g=Math.log(440),v=function(e){return"CDEFGAB"[e]},b=function(e,t){return Array(t+1).join(e)},_=function(e){return n=function(e){return e<0?b("b",-e):b("#",e)},"number"!=typeof(t=e)?"":n(t);var t,n},w=function(e,t){void 0===e&&(e={}),void 0===t&&(t=null);var n=t?Object.assign({},f(t),e):e,r=n.step,i=n.alt,o=n.oct,a=v(r);if(!a)return null;var s=a+_(i);return o||0===o?s+o:s},S=w;function x(e,t){return e=Math.round(e),(!0===t?o:a)[e%12]+(Math.floor(e/12)-1)}var T=function(e,t){var n=f(e),r=n.alt,i=n.chroma,o=n.midi;if(null===i)return null;var a=!1===t?r<0:0<r;return null===o?d(x(i,a)):x(o,a)};n.names=i,n.tokenize=u,n.props=f,n.name=function(e){return f(e).name},n.pc=d,n.midi=function(e){return f(e).midi||+e||null},n.midiToFreq=m,n.freq=function(e){return f(e).freq||m(e)},n.freqToMidi=function(e){var t=12*(Math.log(e)-g)/y+69;return Math.round(100*t)/100},n.chroma=function(e){return f(e).chroma},n.oct=function(e){return f(e).oct},n.stepToLetter=v,n.altToAcc=_,n.from=w,n.build=S,n.fromMidi=x,n.simplify=T,n.enharmonic=function(e){return T(e,!1)}},{}],272:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tonal-note"),i=e("tonal-interval"),o=e("tonal-array"),a=function(e){return r.chroma(e)||i.chroma(e)||0},s=function(e){return parseInt(u(e),2)};function u(e){if(p(e))return e;if(!Array.isArray(e))return"";var t=[0,0,0,0,0,0,0,0,0,0,0,0];return e.map(a).forEach(function(e){t[e]=1}),t.join("")}var l=null;var c=/^[01]{12}$/;function p(e){return c.test(e)}var h="1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M".split(" ");function f(t,e){return 1<arguments.length?f(t)(e):(t=u(t),function(e){return"1"===t[a(e)]})}n.chroma=u,n.chromas=function(t){return l=l||o.range(2048,4095).map(function(e){return e.toString(2)}),"number"==typeof t?l.filter(function(e){return e.replace(/0/g,"").length===t}):l.slice()},n.modes=function(e,r){r=!1!==r;var i=u(e).split("");return o.compact(i.map(function(e,t){var n=o.rotate(t,i);return r&&"0"===n[0]?null:n.join("")}))},n.isChroma=p,n.intervals=function(e){return p(e)?o.compact(e.split("").map(function(e,t){return"1"===e?h[t]:null})):[]},n.isEqual=function t(n,e){return 1===arguments.length?function(e){return t(n,e)}:u(n)===u(e)},n.isSubsetOf=function e(t,n){return 1<arguments.length?e(t)(n):(t=s(t),function(e){return(e=s(e))!==t&&(e&t)===e})},n.isSupersetOf=function e(t,n){return 1<arguments.length?e(t)(n):(t=s(t),function(e){return(e=s(e))!==t&&(e|t)===e})},n.includes=f,n.filter=function t(n,e){return 1===arguments.length?function(e){return t(n,e)}:e.filter(f(n))}},{"tonal-array":266,"tonal-interval":270,"tonal-note":271}],273:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,i,o=e("tonal-note"),a=e("tonal-pcset"),s=e("tonal-distance"),u=e("tonal-dictionary"),l=e("tonal-array"),c=Object.freeze({name:null,intervals:[],names:[],chroma:null,setnum:null}),p=(r=function(e){var t=u.scale(e);if(!t)return c;var n={intervals:t,name:e};return n.chroma=a.chroma(t),n.setnum=parseInt(n.chroma,2),n.names=u.scale.names(n.chroma),Object.freeze(n)},i={},function(e){return i[e]||(i[e]=r(e))}),h=u.scale.names,f=function(e){var t=m(e);return p(t[1]).intervals};function d(e,t){var n=m(e);return t=t||n[1],f(t).map(s.transpose(n[0]))}function m(e){if("string"!=typeof e)return["",""];var t=e.indexOf(" "),n=o.name(e.substring(0,t))||o.name(e)||"",r=""!==n?e.substring(n.length+1):e;return[n,r.length?r:""]}n.props=p,n.names=h,n.intervals=f,n.notes=d,n.exists=function(e){var t=m(e);return void 0!==u.scale(t[1])},n.tokenize=m,n.modeNames=function(e){var r=f(e),i=d(e);return a.modes(r).map(function(e,t){var n=u.scale.names(e)[0];if(n)return[i[t]||r[t],n]}).filter(function(e){return e})},n.chords=function(e){var t=a.isSubsetOf(f(e));return u.chord.names().filter(function(e){return t(u.chord(e))})},n.toScale=function(e){var t=l.compact(e.map(o.pc));if(!t.length)return t;var n=t[0],r=l.unique(t);return l.rotate(r.indexOf(n),r)},n.supersets=function(e){if(!f(e).length)return[];var t=a.isSupersetOf(f(e));return u.scale.names().filter(function(e){return t(u.scale(e))})},n.subsets=function(e){var t=a.isSubsetOf(f(e));return u.scale.names().filter(function(e){return t(u.scale(e))})}},{"tonal-array":266,"tonal-dictionary":268,"tonal-distance":269,"tonal-note":271,"tonal-pcset":272}],274:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tonal-array"),i=e("tonal-note"),o=e("tonal-interval"),a=e("tonal-distance"),s=e("tonal-dictionary"),u=e("tonal-scale"),l=e("tonal-chord"),c=e("tonal-pcset"),p=a.transpose,h=a.interval,f=i.props,d=i.midi,m=i.freq,y=s.chord,g=s.scale;n.Array=r,n.Note=i,n.Interval=o,n.Distance=a,n.Scale=u,n.Chord=l,n.PcSet=c,n.Dictionary=s,n.transpose=p,n.interval=h,n.note=f,n.midi=d,n.freq=m,n.chord=y,n.scale=g},{"tonal-array":266,"tonal-chord":267,"tonal-dictionary":268,"tonal-distance":269,"tonal-interval":270,"tonal-note":271,"tonal-pcset":272,"tonal-scale":273}],275:[function(e,t,n){var r,i;r=this,i=function(){"use strict";var t;function e(e){e(t)}return t=function(){var c=function(){if(!(this instanceof c))throw new Error("constructor needs to be called with the 'new' keyword")};c.prototype.toString=function(){for(var e in c){var t=e[0].match(/^[A-Z]$/),n=c[e]===this.constructor;if(c.isFunction(c[e])&&t&&n)return e}return"Tone"},c.prototype.dispose=function(){return this},c.prototype.set=function(e,t,n){if(c.isObject(e))n=t;else if(c.isString(e)){var r={};r[e]=t,e=r}e:for(var i in e){t=e[i];var o=this;if(-1!==i.indexOf(".")){for(var a=i.split("."),s=0;s<a.length-1;s++)if((o=o[a[s]])instanceof c){a.splice(0,s+1);var u=a.join(".");o.set(u,t);continue e}i=a[a.length-1]}var l=o[i];c.isUndef(l)||(c.Signal&&l instanceof c.Signal||c.Param&&l instanceof c.Param?l.value!==t&&(c.isUndef(n)?l.value=t:l.rampTo(t,n)):l instanceof AudioParam?l.value!==t&&(l.value=t):c.TimeBase&&l instanceof c.TimeBase?o[i]=t:l instanceof c?l.set(t):l!==t&&(o[i]=t))}return this},c.prototype.get=function(e){c.isUndef(e)?e=this._collectDefaults(this.constructor):c.isString(e)&&(e=[e]);for(var t={},n=0;n<e.length;n++){var r=e[n],i=this,o=t;if(-1!==r.indexOf(".")){for(var a=r.split("."),s=0;s<a.length-1;s++){var u=a[s];o[u]=o[u]||{},o=o[u],i=i[u]}r=a[a.length-1]}var l=i[r];c.isObject(e[r])?o[r]=l.get():c.Signal&&l instanceof c.Signal?o[r]=l.value:c.Param&&l instanceof c.Param?o[r]=l.value:l instanceof AudioParam?o[r]=l.value:l instanceof c?o[r]=l.get():!c.isFunction(l)&&c.isDefined(l)&&(o[r]=l)}return t},c.prototype._collectDefaults=function(e){var t=[];if(c.isDefined(e.defaults)&&(t=Object.keys(e.defaults)),c.isDefined(e._super))for(var n=this._collectDefaults(e._super),r=0;r<n.length;r++)-1===t.indexOf(n[r])&&t.push(n[r]);return t},c.defaults=function(e,t,n){var r={};if(1===e.length&&c.isObject(e[0]))r=e[0];else for(var i=0;i<t.length;i++)r[t[i]]=e[i];return c.isDefined(n.defaults)?c.defaultArg(r,n.defaults):c.isObject(n)?c.defaultArg(r,n):r},c.defaultArg=function(e,t){if(c.isObject(e)&&c.isObject(t)){var n={};for(var r in e)n[r]=c.defaultArg(t[r],e[r]);for(var i in t)n[i]=c.defaultArg(e[i],t[i]);return n}return c.isUndef(e)?t:e},c.connectSeries=function(){for(var e=arguments[0],t=1;t<arguments.length;t++){var n=arguments[t];e.connect(n),e=n}return c},c.isUndef=function(e){return void 0===e},c.isDefined=function(e){return!c.isUndef(e)},c.isFunction=function(e){return"function"==typeof e},c.isNumber=function(e){return"number"==typeof e},c.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)&&e.constructor===Object},c.isBoolean=function(e){return"boolean"==typeof e},c.isArray=function(e){return Array.isArray(e)},c.isString=function(e){return"string"==typeof e},c.isNote=function(e){return c.isString(e)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(e)},c.noOp=function(){},c.prototype._readOnly=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this._readOnly(e[t]);else Object.defineProperty(this,e,{writable:!1,enumerable:!0})},c.prototype._writable=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this._writable(e[t]);else Object.defineProperty(this,e,{writable:!0})},c.State={Started:"started",Stopped:"stopped",Paused:"paused"},c.equalPowerScale=function(e){var t=.5*Math.PI;return Math.sin(e*t)},c.dbToGain=function(e){return Math.pow(10,e/20)},c.gainToDb=function(e){return Math.log(e)/Math.LN10*20},c.intervalToFrequencyRatio=function(e){return Math.pow(2,e/12)},c.prototype.now=function(){return c.context.now()},c.now=function(){return c.context.now()},c.extend=function(e,t){function n(){}c.isUndef(t)&&(t=c),n.prototype=t.prototype,e.prototype=new n,(e.prototype.constructor=e)._super=t};var t=null;return Object.defineProperty(c,"context",{get:function(){return t},set:function(e){t=c.Context&&e instanceof c.Context?e:new c.Context(e),c.Context.emit("init",t)}}),Object.defineProperty(c.prototype,"context",{get:function(){return c.context}}),c.setContext=function(e){c.context=e},Object.defineProperty(c.prototype,"blockTime",{get:function(){return 128/this.context.sampleRate}}),Object.defineProperty(c.prototype,"sampleTime",{get:function(){return 1/this.context.sampleRate}}),Object.defineProperty(c,"supported",{get:function(){var e=window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"),t=window.hasOwnProperty("Promise"),n=window.hasOwnProperty("Worker");return e&&t&&n}}),Object.defineProperty(c,"initialized",{get:function(){return null!==t}}),c.getContext=function(e){if(c.initialized)e(c.context);else{var t=function(){e(c.context),c.Context.off("init",t)};c.Context.on("init",t)}return c},c.version="r12",c}(),e(function(a){return a.Emitter=function(){a.call(this),this._events={}},a.extend(a.Emitter),a.Emitter.prototype.on=function(e,t){for(var n=e.split(/\W+/),r=0;r<n.length;r++){var i=n[r];this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(t)}return this},a.Emitter.prototype.once=function(e,t){var n=function(){t.apply(this,arguments),this.off(e,n)}.bind(this);return this.on(e,n),this},a.Emitter.prototype.off=function(e,t){for(var n=e.split(/\W+/),r=0;r<n.length;r++)if(e=n[r],this._events.hasOwnProperty(e))if(a.isUndef(t))this._events[e]=[];else for(var i=this._events[e],o=0;o<i.length;o++)i[o]===t&&i.splice(o,1);return this},a.Emitter.prototype.emit=function(e){if(this._events){var t=Array.apply(null,arguments).slice(1);if(this._events.hasOwnProperty(e))for(var n=this._events[e].slice(0),r=0,i=n.length;r<i;r++)n[r].apply(this,t)}return this},a.Emitter.mixin=function(e){var t=["on","once","off","emit"];e._events={};for(var n=0;n<t.length;n++){var r=t[n],i=a.Emitter.prototype[r];e[r]=i}return a.Emitter},a.Emitter.prototype.dispose=function(){return a.prototype.dispose.call(this),this._events=null,this},a.Emitter}),e(function(l){return l.Timeline=function(){var e=l.defaults(arguments,["memory"],l.Timeline);l.call(this),this._timeline=[],this.memory=e.memory},l.extend(l.Timeline),l.Timeline.defaults={memory:1/0},Object.defineProperty(l.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),l.Timeline.prototype.add=function(e){if(l.isUndef(e.time))throw new Error("Tone.Timeline: events must have a time attribute");e.time=e.time.valueOf();var t=this._search(e.time);if(this._timeline.splice(t+1,0,e),this.length>this.memory){var n=this.length-this.memory;this._timeline.splice(0,n)}return this},l.Timeline.prototype.remove=function(e){var t=this._timeline.indexOf(e);return-1!==t&&this._timeline.splice(t,1),this},l.Timeline.prototype.get=function(e,t){t=l.defaultArg(t,"time");var n=this._search(e,t);return-1!==n?this._timeline[n]:null},l.Timeline.prototype.peek=function(){return this._timeline[0]},l.Timeline.prototype.shift=function(){return this._timeline.shift()},l.Timeline.prototype.getAfter=function(e,t){t=l.defaultArg(t,"time");var n=this._search(e,t);return n+1<this._timeline.length?this._timeline[n+1]:null},l.Timeline.prototype.getBefore=function(e,t){t=l.defaultArg(t,"time");var n=this._timeline.length;if(0<n&&this._timeline[n-1][t]<e)return this._timeline[n-1];var r=this._search(e,t);return 0<=r-1?this._timeline[r-1]:null},l.Timeline.prototype.cancel=function(e){if(1<this._timeline.length){var t=this._search(e);if(0<=t)if(this._timeline[t].time===e){for(var n=t;0<=n&&this._timeline[n].time===e;n--)t=n;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else 1===this._timeline.length&&this._timeline[0].time>=e&&(this._timeline=[]);return this},l.Timeline.prototype.cancelBefore=function(e){var t=this._search(e);return 0<=t&&(this._timeline=this._timeline.slice(t+1)),this},l.Timeline.prototype.previousEvent=function(e){var t=this._timeline.indexOf(e);return 0<t?this._timeline[t-1]:null},l.Timeline.prototype._search=function(e,t){if(0===this._timeline.length)return-1;t=l.defaultArg(t,"time");var n=0,r=this._timeline.length,i=r;if(0<r&&this._timeline[r-1][t]<=e)return r-1;for(;n<i;){var o=Math.floor(n+(i-n)/2),a=this._timeline[o],s=this._timeline[o+1];if(a[t]===e){for(var u=o;u<this._timeline.length;u++){this._timeline[u][t]===e&&(o=u)}return o}if(a[t]<e&&s[t]>e)return o;a[t]>e?i=o:n=o+1}return-1},l.Timeline.prototype._iterate=function(t,e,n){e=l.defaultArg(e,0),n=l.defaultArg(n,this._timeline.length-1),this._timeline.slice(e,n+1).forEach(function(e){t.call(this,e)}.bind(this))},l.Timeline.prototype.forEach=function(e){return this._iterate(e),this},l.Timeline.prototype.forEachBefore=function(e,t){var n=this._search(e);return-1!==n&&this._iterate(t,0,n),this},l.Timeline.prototype.forEachAfter=function(e,t){var n=this._search(e);return this._iterate(t,n+1),this},l.Timeline.prototype.forEachBetween=function(e,t,n){var r=this._search(e),i=this._search(t);return-1!==r&&-1!==i?(this._timeline[r].time!==e&&(r+=1),this._timeline[i].time===t&&(i-=1),this._iterate(n,r,i)):-1===r&&this._iterate(n,0,i),this},l.Timeline.prototype.forEachFrom=function(e,t){for(var n=this._search(e);0<=n&&this._timeline[n].time>=e;)n--;return this._iterate(t,n+1),this},l.Timeline.prototype.forEachAtTime=function(t,n){var e=this._search(t);return-1!==e&&this._iterate(function(e){e.time===t&&n.call(this,e)},0,e),this},l.Timeline.prototype.dispose=function(){return l.prototype.dispose.call(this),this._timeline=null,this},l.Timeline}),e(function(e){e.supported&&(!window.hasOwnProperty("OfflineAudioContext")&&window.hasOwnProperty("webkitOfflineAudioContext")&&(window.OfflineAudioContext=window.webkitOfflineAudioContext),new OfflineAudioContext(1,1,44100).startRendering()instanceof Promise||(OfflineAudioContext.prototype._native_startRendering=OfflineAudioContext.prototype.startRendering,OfflineAudioContext.prototype.startRendering=function(){return new Promise(function(t){this.oncomplete=function(e){t(e.renderedBuffer)},this._native_startRendering()}.bind(this))}))}),e(function(e){if(e.supported){!window.hasOwnProperty("AudioContext")&&window.hasOwnProperty("webkitAudioContext")&&(window.AudioContext=window.webkitAudioContext),AudioContext.prototype.close||(AudioContext.prototype.close=function(){return e.isFunction(this.suspend)&&this.suspend(),Promise.resolve()}),AudioContext.prototype.resume||(AudioContext.prototype.resume=function(){return Promise.resolve()}),!AudioContext.prototype.createGain&&AudioContext.prototype.createGainNode&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),!AudioContext.prototype.createDelay&&AudioContext.prototype.createDelayNode&&(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode);var t=!1,n=new OfflineAudioContext(1,1,44100),r=new Uint32Array([1179011410,48,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,8,0,0,0,0]).buffer;try{n.decodeAudioData(r)instanceof Promise&&(t=!0)}catch(e){t=!1}t||(AudioContext.prototype._native_decodeAudioData=AudioContext.prototype.decodeAudioData,AudioContext.prototype.decodeAudioData=function(n){return new Promise(function(e,t){this._native_decodeAudioData(n,e,t)}.bind(this))})}}),e(function(o){o.Context=function(){o.Emitter.call(this);var e=o.defaults(arguments,["context"],o.Context);if(!e.context&&(e.context=new window.AudioContext,!e.context))throw new Error("could not create AudioContext. Possibly too many AudioContexts running already.");for(var t in this._context=e.context,this._context)this._defineProperty(this._context,t);this._latencyHint=e.latencyHint,this._constants={},this.lookAhead=e.lookAhead,this._computedUpdateInterval=0,this._ticker=new n(this.emit.bind(this,"tick"),e.clockSource,e.updateInterval),this._timeouts=new o.Timeline,this._timeoutIds=0,this.on("tick",this._timeoutLoop.bind(this))},o.extend(o.Context,o.Emitter),o.Emitter.mixin(o.Context),o.Context.defaults={clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.03},o.Context.prototype._defineProperty=function(t,n){o.isUndef(this[n])&&Object.defineProperty(this,n,{get:function(){return"function"==typeof t[n]?t[n].bind(t):t[n]},set:function(e){t[n]=e}})},o.Context.prototype.now=function(){return this._context.currentTime+this.lookAhead},o.Context.prototype.ready=function(){return new Promise(function(e){"running"===this._context.state?e():this._context.resume().then(function(){e()})}.bind(this))},o.Context.prototype.close=function(){return this._context.close().then(function(){o.Context.emit("close",this)}.bind(this))},o.Context.prototype.getConstant=function(e){if(this._constants[e])return this._constants[e];for(var t=this._context.createBuffer(1,128,this._context.sampleRate),n=t.getChannelData(0),r=0;r<n.length;r++)n[r]=e;var i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=t,i.loop=!0,i.start(0),this._constants[e]=i},o.Context.prototype._timeoutLoop=function(){for(var e=this.now();this._timeouts&&this._timeouts.length&&this._timeouts.peek().time<=e;)this._timeouts.shift().callback()},o.Context.prototype.setTimeout=function(e,t){this._timeoutIds++;var n=this.now();return this._timeouts.add({callback:e,time:n+t,id:this._timeoutIds}),this._timeoutIds},o.Context.prototype.clearTimeout=function(t){return this._timeouts.forEach(function(e){e.id===t&&this.remove(e)}),this},Object.defineProperty(o.Context.prototype,"updateInterval",{get:function(){return this._ticker.updateInterval},set:function(e){this._ticker.updateInterval=e}}),Object.defineProperty(o.Context.prototype,"clockSource",{get:function(){return this._ticker.type},set:function(e){this._ticker.type=e}}),Object.defineProperty(o.Context.prototype,"latencyHint",{get:function(){return this._latencyHint},set:function(e){var t=e;if(this._latencyHint=e,o.isString(e))switch(e){case"interactive":t=.1,this._context.latencyHint=e;break;case"playback":t=.8,this._context.latencyHint=e;break;case"balanced":t=.25,this._context.latencyHint=e;break;case"fastest":this._context.latencyHint="interactive",t=.01}this.lookAhead=t,this.updateInterval=t/3}}),o.Context.prototype.dispose=function(){return this.close().then(function(){for(var e in o.Emitter.prototype.dispose.call(this),this._ticker.dispose(),this._ticker=null,this._timeouts.dispose(),this._timeouts=null,this._constants)this._constants[e].disconnect();this._constants=null}.bind(this))};var n=function(e,t,n){this._type=t,this._updateInterval=n,this._callback=o.defaultArg(e,o.noOp),this._createClock()};return n.Type={Worker:"worker",Timeout:"timeout",Offline:"offline"},n.prototype._createWorker=function(){window.URL=window.URL||window.webkitURL;var e=new Blob(["var timeoutTime = "+(1e3*this._updateInterval).toFixed(1)+";self.onmessage = function(msg){\ttimeoutTime = parseInt(msg.data);};function tick(){\tsetTimeout(tick, timeoutTime);\tself.postMessage('tick');}tick();"]),t=URL.createObjectURL(e),n=new Worker(t);n.onmessage=this._callback.bind(this),this._worker=n},n.prototype._createTimeout=function(){this._timeout=setTimeout(function(){this._createTimeout(),this._callback()}.bind(this),1e3*this._updateInterval)},n.prototype._createClock=function(){if(this._type===n.Type.Worker)try{this._createWorker()}catch(e){this._type=n.Type.Timeout,this._createClock()}else this._type===n.Type.Timeout&&this._createTimeout()},Object.defineProperty(n.prototype,"updateInterval",{get:function(){return this._updateInterval},set:function(e){this._updateInterval=Math.max(e,128/44100),this._type===n.Type.Worker&&this._worker.postMessage(Math.max(1e3*e,1))}}),Object.defineProperty(n.prototype,"type",{get:function(){return this._type},set:function(e){this._disposeClock(),this._type=e,this._createClock()}}),n.prototype._disposeClock=function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=null),this._worker&&(this._worker.terminate(),this._worker.onmessage=null,this._worker=null)},n.prototype.dispose=function(){this._disposeClock(),this._callback=null},o.getContext(function(){var r=AudioNode.prototype.connect,i=AudioNode.prototype.disconnect;function e(t,e,n){if(t.input)return n=o.defaultArg(n,0),o.isArray(t.input)?this.connect(t.input[n]):this.connect(t.input,e,n);try{return t instanceof AudioNode?r.call(this,t,e,n):r.call(this,t,e),t}catch(e){throw new Error("error connecting to node: "+t+"\n"+e)}}AudioNode.prototype.connect!==e&&(AudioNode.prototype.connect=e,AudioNode.prototype.disconnect=function(t,e,n){if(t&&t.input&&o.isArray(t.input))n=o.defaultArg(n,0),this.disconnect(t.input[n],e,0);else if(t&&t.input)this.disconnect(t.input,e,n);else try{i.apply(this,arguments)}catch(e){throw new Error("error disconnecting node: "+t+"\n"+e)}})}),o.supported&&!o.initialized?(o.context=new o.Context,window.TONE_SILENCE_VERSION_LOGGING||console.log("%c * Tone.js "+o.version+" * ","background: #000; color: #fff")):o.supported||console.warn("This browser does not support Tone.js"),o.Context}),e(function(r){return r.AudioNode=function(){r.call(this);var e=r.defaults(arguments,["context"],{context:r.context});this._context=e.context},r.extend(r.AudioNode),Object.defineProperty(r.AudioNode.prototype,"context",{get:function(){return this._context}}),r.AudioNode.prototype.createInsOuts=function(e,t){1===e?this.input=this.context.createGain():1<e&&(this.input=new Array(e)),1===t?this.output=this.context.createGain():1<t&&(this.output=new Array(t))},Object.defineProperty(r.AudioNode.prototype,"channelCount",{get:function(){return this.output.channelCount},set:function(e){return this.output.channelCount=e}}),Object.defineProperty(r.AudioNode.prototype,"channelCountMode",{get:function(){return this.output.channelCountMode},set:function(e){return this.output.channelCountMode=e}}),Object.defineProperty(r.AudioNode.prototype,"channelInterpretation",{get:function(){return this.output.channelInterpretation},set:function(e){return this.output.channelInterpretation=e}}),Object.defineProperty(r.AudioNode.prototype,"numberOfInputs",{get:function(){return this.input?r.isArray(this.input)?this.input.length:1:0}}),Object.defineProperty(r.AudioNode.prototype,"numberOfOutputs",{get:function(){return this.output?r.isArray(this.output)?this.output.length:1:0}}),r.AudioNode.prototype._onConnect=function(){},r.AudioNode.prototype.connect=function(e,t,n){return e._onConnect&&e._onConnect(this),r.isArray(this.output)?(t=r.defaultArg(t,0),this.output[t].connect(e,0,n)):this.output.connect(e,t,n),this},r.AudioNode.prototype.disconnect=function(e,t,n){r.isArray(this.output)?r.isNumber(e)?this.output[e].disconnect():(t=r.defaultArg(t,0),this.output[t].disconnect(e,0,n)):this.output.disconnect.apply(this.output,arguments)},r.AudioNode.prototype.chain=function(){for(var e=this,t=0;t<arguments.length;t++){var n=arguments[t];e.connect(n),e=n}return this},r.AudioNode.prototype.fan=function(){for(var e=0;e<arguments.length;e++)this.connect(arguments[e]);return this},window.AudioNode&&(AudioNode.prototype.chain=r.AudioNode.prototype.chain,AudioNode.prototype.fan=r.AudioNode.prototype.fan),r.AudioNode.prototype.dispose=function(){return r.isDefined(this.input)&&(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),r.isDefined(this.output)&&(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this._context=null,this},r.AudioNode}),e(function(r){return r.SignalBase=function(){r.AudioNode.call(this)},r.extend(r.SignalBase,r.AudioNode),r.SignalBase.prototype.connect=function(e,t,n){return r.Signal&&r.Signal===e.constructor||r.Param&&r.Param===e.constructor?(e._param.cancelScheduledValues(0),e._param.value=0,e.overridden=!0):e instanceof AudioParam&&(e.cancelScheduledValues(0),e.value=0),r.AudioNode.prototype.connect.call(this,e,t,n),this},r.SignalBase}),e(function(e){if(e.supported){var t=navigator.userAgent.toLowerCase();if(t.includes("safari")&&!t.includes("chrome")){var n=function(e){for(var t in this._internalNode=this.input=this.output=e._native_createWaveShaper(),this._curve=null,this._internalNode)this._defineProperty(this._internalNode,t)};Object.defineProperty(n.prototype,"curve",{get:function(){return this._curve},set:function(e){this._curve=e;var t=new Float32Array(e.length+1);t.set(e,1),t[0]=e[0],this._internalNode.curve=t}}),n.prototype._defineProperty=function(t,n){e.isUndef(this[n])&&Object.defineProperty(this,n,{get:function(){return"function"==typeof t[n]?t[n].bind(t):t[n]},set:function(e){t[n]=e}})},AudioContext.prototype._native_createWaveShaper=AudioContext.prototype.createWaveShaper,AudioContext.prototype.createWaveShaper=function(){return new n(this)}}}}),e(function(n){return n.WaveShaper=function(e,t){n.SignalBase.call(this),this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(e)?this.curve=e:isFinite(e)||n.isUndef(e)?this._curve=new Float32Array(n.defaultArg(e,1024)):n.isFunction(e)&&(this._curve=new Float32Array(n.defaultArg(t,1024)),this.setMap(e))},n.extend(n.WaveShaper,n.SignalBase),n.WaveShaper.prototype.setMap=function(e){for(var t=new Array(this._curve.length),n=0,r=this._curve.length;n<r;n++){var i=n/(r-1)*2-1;t[n]=e(i,n)}return this.curve=t,this},Object.defineProperty(n.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(e){this._curve=new Float32Array(e),this._shaper.curve=this._curve}}),Object.defineProperty(n.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(e){if(!["none","2x","4x"].includes(e))throw new RangeError("Tone.WaveShaper: oversampling must be either 'none', '2x', or '4x'");this._shaper.oversample=e}}),n.WaveShaper.prototype.dispose=function(){return n.SignalBase.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},n.WaveShaper}),e(function(r){return r.TimeBase=function(e,t){if(!(this instanceof r.TimeBase))return new r.TimeBase(e,t);if(this._val=e,this._units=t,r.isUndef(this._units)&&r.isString(this._val)&&parseFloat(this._val)==this._val&&"+"!==this._val.charAt(0))this._val=parseFloat(this._val),this._units=this._defaultUnits;else if(e&&e.constructor===this.constructor)this._val=e._val,this._units=e._units;else if(e instanceof r.TimeBase)switch(this._defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break;default:throw new Error("Unrecognized default units "+this._defaultUnits)}},r.extend(r.TimeBase),r.TimeBase.prototype._expressions={n:{regexp:/^(\d+)n(\.?)$/i,method:function(e,t){var n="."===t?1.5:1;return 1===(e=parseInt(e))?this._beatsToUnits(this._getTimeSignature())*n:this._beatsToUnits(4/e)*n}},t:{regexp:/^(\d+)t$/i,method:function(e){return e=parseInt(e),this._beatsToUnits(8/(3*parseInt(e)))}},m:{regexp:/^(\d+)m$/i,method:function(e){return this._beatsToUnits(parseInt(e)*this._getTimeSignature())}},i:{regexp:/^(\d+)i$/i,method:function(e){return this._ticksToUnits(parseInt(e))}},hz:{regexp:/^(\d+(?:\.\d+)?)hz$/i,method:function(e){return this._frequencyToUnits(parseFloat(e))}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/,method:function(e,t,n){var r=0;return e&&"0"!==e&&(r+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&"0"!==t&&(r+=this._beatsToUnits(parseFloat(t))),n&&"0"!==n&&(r+=this._beatsToUnits(parseFloat(n)/4)),r}},s:{regexp:/^(\d+(?:\.\d+)?)s$/,method:function(e){return this._secondsToUnits(parseFloat(e))}},samples:{regexp:/^(\d+)samples$/,method:function(e){return parseInt(e)/this.context.sampleRate}},default:{regexp:/^(\d+(?:\.\d+)?)$/,method:function(e){return this._expressions[this._defaultUnits].method.call(this,e)}}},r.TimeBase.prototype._defaultUnits="s",r.TimeBase.prototype._getBpm=function(){return r.Transport?r.Transport.bpm.value:120},r.TimeBase.prototype._getTimeSignature=function(){return r.Transport?r.Transport.timeSignature:4},r.TimeBase.prototype._getPPQ=function(){return r.Transport?r.Transport.PPQ:192},r.TimeBase.prototype._now=function(){return this.now()},r.TimeBase.prototype._frequencyToUnits=function(e){return 1/e},r.TimeBase.prototype._beatsToUnits=function(e){return 60/this._getBpm()*e},r.TimeBase.prototype._secondsToUnits=function(e){return e},r.TimeBase.prototype._ticksToUnits=function(e){return e*(this._beatsToUnits(1)/this._getPPQ())},r.TimeBase.prototype._noArg=function(){return this._now()},r.TimeBase.prototype.valueOf=function(){if(r.isUndef(this._val))return this._noArg();if(r.isString(this._val)&&r.isUndef(this._units))for(var e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}if(r.isDefined(this._units)){var t=this._expressions[this._units],n=this._val.toString().trim().match(t.regexp);return n?t.method.apply(this,n.slice(1)):t.method.call(this,parseFloat(this._val))}return this._val},r.TimeBase.prototype.toSeconds=function(){return this.valueOf()},r.TimeBase.prototype.toFrequency=function(){return 1/this.toSeconds()},r.TimeBase.prototype.toSamples=function(){return this.toSeconds()*this.context.sampleRate},r.TimeBase.prototype.toMilliseconds=function(){return 1e3*this.toSeconds()},r.TimeBase.prototype.dispose=function(){this._val=null,this._units=null},r.TimeBase}),e(function(i){i.Frequency=function(e,t){if(!(this instanceof i.Frequency))return new i.Frequency(e,t);i.TimeBase.call(this,e,t)},i.extend(i.Frequency,i.TimeBase),i.Frequency.prototype._expressions=Object.assign({},i.TimeBase.prototype._expressions,{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method:function(e){return"midi"===this._defaultUnits?e:i.Frequency.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method:function(e,t){var n=r[e.toLowerCase()]+12*(parseInt(t)+1);return"midi"===this._defaultUnits?n:i.Frequency.mtof(n)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(e,t,n){var r=1;return e&&"0"!==e&&(r*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&"0"!==t&&(r*=this._beatsToUnits(parseFloat(t))),n&&"0"!==n&&(r*=this._beatsToUnits(parseFloat(n)/4)),r}}}),i.Frequency.prototype.transpose=function(e){return new this.constructor(this.valueOf()*i.intervalToFrequencyRatio(e))},i.Frequency.prototype.harmonize=function(e){return e.map(function(e){return this.transpose(e)}.bind(this))},i.Frequency.prototype.toMidi=function(){return i.Frequency.ftom(this.valueOf())},i.Frequency.prototype.toNote=function(){var e=this.toFrequency(),t=Math.log2(e/i.Frequency.A4),n=Math.round(12*t)+57,r=Math.floor(n/12);return r<0&&(n+=-12*r),o[n%12]+r.toString()},i.Frequency.prototype.toSeconds=function(){return 1/i.TimeBase.prototype.toSeconds.call(this)},i.Frequency.prototype.toFrequency=function(){return i.TimeBase.prototype.toFrequency.call(this)},i.Frequency.prototype.toTicks=function(){var e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*i.Transport.PPQ)},i.Frequency.prototype._noArg=function(){return 0},i.Frequency.prototype._frequencyToUnits=function(e){return e},i.Frequency.prototype._ticksToUnits=function(e){return 1/(60*e/(i.Transport.bpm.value*i.Transport.PPQ))},i.Frequency.prototype._beatsToUnits=function(e){return 1/i.TimeBase.prototype._beatsToUnits.call(this,e)},i.Frequency.prototype._secondsToUnits=function(e){return 1/e},i.Frequency.prototype._defaultUnits="hz";var r={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return i.Frequency.A4=440,i.Frequency.mtof=function(e){return i.Frequency.A4*Math.pow(2,(e-69)/12)},i.Frequency.ftom=function(e){return 69+Math.round(12*Math.log2(e/i.Frequency.A4))},i.Frequency}),e(function(a){return a.Time=function(e,t){if(!(this instanceof a.Time))return new a.Time(e,t);a.TimeBase.call(this,e,t)},a.extend(a.Time,a.TimeBase),a.Time.prototype._expressions=Object.assign({},a.TimeBase.prototype._expressions,{quantize:{regexp:/^@(.+)/,method:function(e){if(a.Transport){var t=new this.constructor(e);return a.Transport.nextSubdivision(t)}return 0}},now:{regexp:/^\+(.+)/,method:function(e){return this._now()+new this.constructor(e)}}}),a.Time.prototype.quantize=function(e,t){t=a.defaultArg(t,1);var n=new this.constructor(e),r=this.valueOf();return r+(Math.round(r/n)*n-r)*t},a.Time.prototype.toNotation=function(){for(var n=this.toSeconds(),e=["1m"],t=1;t<8;t++){var r=Math.pow(2,t);e.push(r+"n."),e.push(r+"n"),e.push(r+"t")}e.push("0");var i=e[0],o=a.Time(e[0]).toSeconds();return e.forEach(function(e){var t=a.Time(e).toSeconds();Math.abs(t-n)<Math.abs(o-n)&&(i=e,o=t)}),i},a.Time.prototype.toBarsBeatsSixteenths=function(){var e=this._beatsToUnits(1),t=this.valueOf()/e,n=Math.floor(t/this._getTimeSignature()),r=t%1*4;return t=Math.floor(t)%this._getTimeSignature(),3<(r=r.toString()).length&&(r=parseFloat(parseFloat(r).toFixed(3))),[n,t,r].join(":")},a.Time.prototype.toTicks=function(){var e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.round(t*this._getPPQ())},a.Time.prototype.toSeconds=function(){return this.valueOf()},a.Time.prototype.toMidi=function(){return a.Frequency.ftom(this.toFrequency())},a.Time}),e(function(n){return n.TransportTime=function(e,t){if(!(this instanceof n.TransportTime))return new n.TransportTime(e,t);n.Time.call(this,e,t)},n.extend(n.TransportTime,n.Time),n.TransportTime.prototype._now=function(){return n.Transport.seconds},n.TransportTime}),e(function(t){return t.Type={Default:"number",Time:"time",Frequency:"frequency",TransportTime:"transportTime",Ticks:"ticks",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Gain:"gain",Cents:"cents",Degrees:"degrees",MIDI:"midi",BarsBeatsSixteenths:"barsBeatsSixteenths",Samples:"samples",Hertz:"hertz",Note:"note",Milliseconds:"milliseconds",Seconds:"seconds",Notation:"notation"},t.prototype.toSeconds=function(e){return t.isNumber(e)?e:t.isUndef(e)?this.now():t.isString(e)?new t.Time(e).toSeconds():e instanceof t.TimeBase?e.toSeconds():void 0},t.prototype.toFrequency=function(e){return t.isNumber(e)?e:t.isString(e)||t.isUndef(e)?new t.Frequency(e).valueOf():e instanceof t.TimeBase?e.toFrequency():void 0},t.prototype.toTicks=function(e){return t.isNumber(e)||t.isString(e)?new t.TransportTime(e).toTicks():t.isUndef(e)?t.Transport.ticks:e instanceof t.TimeBase?e.toTicks():void 0},t}),e(function(s){return s.Param=function(){var e=s.defaults(arguments,["param","units","convert"],s.Param);s.AudioNode.call(this),this._param=this.input=e.param,this.units=e.units,this.convert=e.convert,this.overridden=!1,this._events=new s.Timeline(1e3),s.isDefined(e.value)&&this._param&&(this.value=e.value)},s.extend(s.Param,s.AudioNode),s.Param.defaults={units:s.Type.Default,convert:!0,param:void 0},Object.defineProperty(s.Param.prototype,"value",{get:function(){var e=this.now();return this._toUnits(this.getValueAtTime(e))},set:function(e){this._initialValue=this._fromUnits(e),this.cancelScheduledValues(this.context.currentTime),this.setValueAtTime(e,this.context.currentTime)}}),Object.defineProperty(s.Param.prototype,"minValue",{get:function(){return this.units===s.Type.Time||this.units===s.Type.Frequency||this.units===s.Type.NormalRange||this.units===s.Type.Positive||this.units===s.Type.BPM?0:this.units===s.Type.AudioRange?-1:this.units===s.Type.Decibels?-1/0:this._param.minValue}}),Object.defineProperty(s.Param.prototype,"maxValue",{get:function(){return this.units===s.Type.NormalRange||this.units===s.Type.AudioRange?1:this._param.maxValue}}),s.Param.prototype._fromUnits=function(e){if(!this.convert&&!s.isUndef(this.convert)||this.overridden)return e;switch(this.units){case s.Type.Time:return this.toSeconds(e);case s.Type.Frequency:return this.toFrequency(e);case s.Type.Decibels:return s.dbToGain(e);case s.Type.NormalRange:return Math.min(Math.max(e,0),1);case s.Type.AudioRange:return Math.min(Math.max(e,-1),1);case s.Type.Positive:return Math.max(e,0);default:return e}},s.Param.prototype._toUnits=function(e){if(!this.convert&&!s.isUndef(this.convert))return e;switch(this.units){case s.Type.Decibels:return s.gainToDb(e);default:return e}},s.Param.prototype._minOutput=1e-5,s.Param.AutomationType={Linear:"linearRampToValueAtTime",Exponential:"exponentialRampToValueAtTime",Target:"setTargetAtTime",SetValue:"setValueAtTime"},s.Param.prototype.setValueAtTime=function(e,t){return t=this.toSeconds(t),e=this._fromUnits(e),this._events.add({type:s.Param.AutomationType.SetValue,value:e,time:t}),this._param.setValueAtTime(e,t),this},s.Param.prototype.getValueAtTime=function(e){e=this.toSeconds(e);var t=this._events.getAfter(e),n=this._events.get(e),r=s.defaultArg(this._initialValue,this._param.defaultValue),i=r;if(null===n)i=r;else if(n.type===s.Param.AutomationType.Target){var o,a=this._events.getBefore(n.time);o=null===a?r:a.value,i=this._exponentialApproach(n.time,o,n.value,n.constant,e)}else i=null===t?n.value:t.type===s.Param.AutomationType.Linear?this._linearInterpolate(n.time,n.value,t.time,t.value,e):t.type===s.Param.AutomationType.Exponential?this._exponentialInterpolate(n.time,n.value,t.time,t.value,e):n.value;return i},s.Param.prototype.setRampPoint=function(e){e=this.toSeconds(e);var t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),0===t&&(t=this._minOutput),this.setValueAtTime(this._toUnits(t),e),this},s.Param.prototype.linearRampToValueAtTime=function(e,t){return e=this._fromUnits(e),t=this.toSeconds(t),this._events.add({type:s.Param.AutomationType.Linear,value:e,time:t}),this._param.linearRampToValueAtTime(e,t),this},s.Param.prototype.exponentialRampToValueAtTime=function(e,t){return e=this._fromUnits(e),e=Math.max(this._minOutput,e),t=this.toSeconds(t),this._events.add({type:s.Param.AutomationType.Exponential,time:t,value:e}),this._param.exponentialRampToValueAtTime(e,t),this},s.Param.prototype.exponentialRampTo=function(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(t)),this},s.Param.prototype.linearRampTo=function(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(e,n+this.toSeconds(t)),this},s.Param.prototype.targetRampTo=function(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(e,n,t),this},s.Param.prototype.exponentialApproachValueAtTime=function(e,t,n){var r=Math.log(this.toSeconds(n)+1)/Math.log(200);return t=this.toSeconds(t),this.setTargetAtTime(e,t,r)},s.Param.prototype.setTargetAtTime=function(e,t,n){if(e=this._fromUnits(e),n<=0)throw new Error("timeConstant must be greater than 0");return t=this.toSeconds(t),this._events.add({type:s.Param.AutomationType.Target,value:e,time:t,constant:n}),this._param.setTargetAtTime(e,t,n),this},s.Param.prototype.setValueCurveAtTime=function(e,t,n,r){r=s.defaultArg(r,1),n=this.toSeconds(n),t=this.toSeconds(t),this.setValueAtTime(e[0]*r,t);for(var i=n/(e.length-1),o=1;o<e.length;o++)this.linearRampToValueAtTime(e[o]*r,t+o*i);return this},s.Param.prototype.cancelScheduledValues=function(e){return e=this.toSeconds(e),this._events.cancel(e),this._param.cancelScheduledValues(e),this},s.Param.prototype.cancelAndHoldAtTime=function(e){var t=this.getValueAtTime(e),n=this._events.get(e),r=this._events.getAfter(e);return n&&n.time===e?r?this._events.cancel(r.time):this._events.cancel(e+1e-6):r&&(this._events.cancel(r.time),this._param.cancelAndHoldAtTime||this._param.cancelScheduledValues(e),r.type===s.Param.AutomationType.Linear?this._param.cancelAndHoldAtTime?this._events.add({type:s.Param.AutomationType.Linear,value:t,time:e}):this.linearRampToValueAtTime(t,e):r.type===s.Param.AutomationType.Exponential&&(this._param.cancelAndHoldAtTime?this._events.add({type:s.Param.AutomationType.Exponential,value:t,time:e}):this.exponentialRampToValueAtTime(t,e))),this._events.add({type:s.Param.AutomationType.SetValue,value:t,time:e}),this._param.cancelAndHoldAtTime?this._param.cancelAndHoldAtTime(e):this._param.setValueAtTime(t,e),this},s.Param.prototype.rampTo=function(e,t,n){return t=s.defaultArg(t,.1),this.units===s.Type.Frequency||this.units===s.Type.BPM||this.units===s.Type.Decibels?this.exponentialRampTo(e,t,n):this.linearRampTo(e,t,n),this},s.Param.prototype._exponentialApproach=function(e,t,n,r,i){return n+(t-n)*Math.exp(-(i-e)/r)},s.Param.prototype._linearInterpolate=function(e,t,n,r,i){return t+(i-e)/(n-e)*(r-t)},s.Param.prototype._exponentialInterpolate=function(e,t,n,r,i){return t*Math.pow(r/t,(i-e)/(n-e))},s.Param.prototype.dispose=function(){return s.AudioNode.prototype.dispose.call(this),this._param=null,this._events=null,this},s.Param}),e(function(i){return i.OfflineContext=function(e,t,n){var r=new OfflineAudioContext(e,t*n,n);i.Context.call(this,{context:r,clockSource:"offline",lookAhead:0,updateInterval:128/n}),this._duration=t,this._currentTime=0},i.extend(i.OfflineContext,i.Context),i.OfflineContext.prototype.now=function(){return this._currentTime},i.OfflineContext.prototype.render=function(){for(;0<=this._duration-this._currentTime;)this.emit("tick"),this._currentTime+=this.blockTime;return this._context.startRendering()},i.OfflineContext.prototype.close=function(){return this._context=null,Promise.resolve()},i.OfflineContext}),e(function(e){if(e.supported){var t=navigator.userAgent.toLowerCase();t.includes("safari")&&!t.includes("chrome")&&t.includes("mobile")&&(e.OfflineContext.prototype.createBufferSource=function(){var t=this._context.createBufferSource(),n=t.start;return t.start=function(e){this.setTimeout(function(){n.call(t,e)}.bind(this),0)}.bind(this),t})}}),e(function(t){return t.Gain=function(){var e=t.defaults(arguments,["gain","units"],t.Gain);t.AudioNode.call(this),this.input=this.output=this._gainNode=this.context.createGain(),this.gain=new t.Param({param:this._gainNode.gain,units:e.units,value:e.gain,convert:e.convert}),this._readOnly("gain")},t.extend(t.Gain,t.AudioNode),t.Gain.defaults={gain:1,convert:!0},t.Gain.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this),this._gainNode.disconnect(),this._gainNode=null,this._writable("gain"),this.gain.dispose(),this.gain=null},t.Gain}),e(function(e){if(e.supported&&!AudioContext.prototype.createConstantSource){var t=function(e){for(var t=(this.context=e).createBuffer(1,128,e.sampleRate),n=t.getChannelData(0),r=0;r<n.length;r++)n[r]=1;this._bufferSource=e.createBufferSource(),this._bufferSource.channelCount=1,this._bufferSource.channelCountMode="explicit",this._bufferSource.buffer=t,this._bufferSource.loop=!0;var i=this._output=e.createGain();this.offset=i.gain,this._bufferSource.connect(i)};t.prototype.start=function(e){return this._bufferSource.start(e),this},t.prototype.stop=function(e){return this._bufferSource.stop(e),this},t.prototype.connect=function(){return this._output.connect.apply(this._output,arguments),this},t.prototype.disconnect=function(){return this._output.disconnect.apply(this._output,arguments),this},AudioContext.prototype.createConstantSource=function(){return new t(this)},e.Context.prototype.createConstantSource=function(){return new t(this)}}}),e(function(r){return r.Signal=function(){var e=r.defaults(arguments,["value","units"],r.Signal);r.Param.call(this,e),this._proxies=[],this._sourceStarted=!1,this._constantSource=this.context.createConstantSource(),this._param=this._constantSource.offset,this.value=e.value,this.output=this._constantSource,this.input=this._param=this.output.offset},r.extend(r.Signal,r.Param),r.Signal.defaults={value:0,units:r.Type.Default,convert:!0},r.Signal.prototype.connect=function(e){return this._isParam(e)&&!this._sourceStarted?(this._proxies.push(e),e.overridden=!0,this._applyAutomations(e)):(r.SignalBase.prototype.connect.apply(this,arguments),this._sourceStarted||(this._sourceStarted=!0,this._constantSource.start(0))),this},r.Signal.prototype._isParam=function(e){return r.Param&&r.Param===e.constructor||e instanceof AudioParam},r.Signal.prototype._connectProxies=function(){this._sourceStarted||(this._sourceStarted=!0,this._constantSource.start(0)),this._proxies.forEach(function(e){r.SignalBase.prototype.connect.call(this,e),e._proxies&&e._connectProxies()}.bind(this))},r.Signal.prototype._onConnect=function(e){this._isParam(e)||this._connectProxies()},r.Signal.prototype._applyAutomations=function(t){var e=this.context.currentTime;t.cancelScheduledValues(e);var n=this.getValueAtTime(e);t.setValueAtTime(n,e),this._events.forEachFrom(e,function(e){t[e.type](e.value,e.time,e.constant)})},r.Signal.prototype.disconnect=function(e){if(this._proxies.includes(e)){var t=this._proxies.indexOf(e);this._proxies.splice(t,1)}else e||(this._proxies=[]);return r.SignalBase.prototype.disconnect.apply(this,arguments)},r.Signal.prototype.getValueAtTime=function(e){return this._param.getValueAtTime?this._param.getValueAtTime(e):r.Param.prototype.getValueAtTime.call(this,e)},["setValueAtTime","linearRampToValueAtTime","exponentialRampToValueAtTime","setTargetAtTime"].forEach(function(n){var e=r.Signal.prototype[n];r.Signal.prototype[n]=function(){var t=arguments;e.apply(this,arguments),t[0]=this._fromUnits(t[0]),t[1]=this.toSeconds(t[1]),this._proxies.forEach(function(e){e[n].apply(e,t)})}}),["cancelScheduledValues","cancelAndHoldAtTime"].forEach(function(n){var e=r.Signal.prototype[n];r.Signal.prototype[n]=function(){var t=arguments;e.apply(this,arguments),t[0]=this.toSeconds(t[0]),this._proxies.forEach(function(e){e[n].apply(e,t)})}}),r.Signal.prototype.dispose=function(){return r.Param.prototype.dispose.call(this),this._constantSource.disconnect(),this._constantSource=null,this._proxies=null,this},r.Signal}),e(function(t){return t.Pow=function(e){t.SignalBase.call(this),this._exp=t.defaultArg(e,1),this._expScaler=this.input=this.output=new t.WaveShaper(this._expFunc(this._exp),8192)},t.extend(t.Pow,t.SignalBase),Object.defineProperty(t.Pow.prototype,"value",{get:function(){return this._exp},set:function(e){this._exp=e,this._expScaler.setMap(this._expFunc(this._exp))}}),t.Pow.prototype._expFunc=function(t){return function(e){return Math.pow(Math.abs(e),t)}},t.Pow.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._expScaler.dispose(),this._expScaler=null,this},t.Pow}),e(function(h){return h.Envelope=function(){var e=h.defaults(arguments,["attack","decay","sustain","release"],h.Envelope);h.AudioNode.call(this),this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this._attackCurve="linear",this._releaseCurve="exponential",this._sig=this.output=new h.Signal(0),this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve},h.extend(h.Envelope,h.AudioNode),h.Envelope.defaults={attack:.01,decay:.1,sustain:.5,release:1,attackCurve:"linear",releaseCurve:"exponential"},Object.defineProperty(h.Envelope.prototype,"value",{get:function(){return this.getValueAtTime(this.now())}}),Object.defineProperty(h.Envelope.prototype,"attackCurve",{get:function(){if(h.isString(this._attackCurve))return this._attackCurve;if(h.isArray(this._attackCurve)){for(var e in h.Envelope.Type)if(h.Envelope.Type[e].In===this._attackCurve)return e;return this._attackCurve}},set:function(e){if(h.Envelope.Type.hasOwnProperty(e)){var t=h.Envelope.Type[e];h.isObject(t)?this._attackCurve=t.In:this._attackCurve=t}else{if(!h.isArray(e))throw new Error("Tone.Envelope: invalid curve: "+e);this._attackCurve=e}}}),Object.defineProperty(h.Envelope.prototype,"releaseCurve",{get:function(){if(h.isString(this._releaseCurve))return this._releaseCurve;if(h.isArray(this._releaseCurve)){for(var e in h.Envelope.Type)if(h.Envelope.Type[e].Out===this._releaseCurve)return e;return this._releaseCurve}},set:function(e){if(h.Envelope.Type.hasOwnProperty(e)){var t=h.Envelope.Type[e];h.isObject(t)?this._releaseCurve=t.Out:this._releaseCurve=t}else{if(!h.isArray(e))throw new Error("Tone.Envelope: invalid curve: "+e);this._releaseCurve=e}}}),h.Envelope.prototype.triggerAttack=function(e,t){e=this.toSeconds(e);var n=this.toSeconds(this.attack),r=n,i=this.toSeconds(this.decay);t=h.defaultArg(t,1);var o=this.getValueAtTime(e);0<o&&(r=(1-o)/(1/r));if("linear"===this._attackCurve)this._sig.linearRampTo(t,r,e);else if("exponential"===this._attackCurve)this._sig.targetRampTo(t,r,e);else if(0<r){this._sig.cancelAndHoldAtTime(e);var a=this._attackCurve;if(r<n){var s=1-r/n,u=Math.floor(s*this._attackCurve.length);(a=this._attackCurve.slice(u))[0]=o}this._sig.setValueCurveAtTime(a,e,r,t)}return i&&this._sig.targetRampTo(t*this.sustain,i,r+e),this},h.Envelope.prototype.triggerRelease=function(e){e=this.toSeconds(e);var t=this.getValueAtTime(e);if(0<t){var n=this.toSeconds(this.release);if("linear"===this._releaseCurve)this._sig.linearRampTo(0,n,e);else if("exponential"===this._releaseCurve)this._sig.targetRampTo(0,n,e);else{var r=this._releaseCurve;h.isArray(r)&&(this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(r,e,n,t))}}return this},h.Envelope.prototype.getValueAtTime=function(e){return this._sig.getValueAtTime(e)},h.Envelope.prototype.triggerAttackRelease=function(e,t,n){return t=this.toSeconds(t),this.triggerAttack(t,n),this.triggerRelease(t+this.toSeconds(e)),this},h.Envelope.prototype.cancel=function(e){return this._sig.cancelScheduledValues(e),this},h.Envelope.prototype.connect=h.SignalBase.prototype.connect,function(){var e,t,n=[];for(e=0;e<128;e++)n[e]=Math.sin(e/127*(Math.PI/2));var r=[];for(e=0;e<127;e++){t=e/127;var i=Math.sin(t*(2*Math.PI)*6.4-Math.PI/2)+1;r[e]=i/10+.83*t}r[127]=1;var o=[];for(e=0;e<128;e++)o[e]=Math.ceil(e/127*5)/5;var a=[];for(e=0;e<128;e++)t=e/127,a[e]=.5*(1-Math.cos(Math.PI*t));var s,u=[];for(e=0;e<128;e++){t=e/127;var l=4*Math.pow(t,3)+.2,c=Math.cos(l*Math.PI*2*t);u[e]=Math.abs(c*(1-t))}function p(e){for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=1-e[n];return t}h.Envelope.Type={linear:"linear",exponential:"exponential",bounce:{In:p(u),Out:u},cosine:{In:n,Out:(s=n,s.slice(0).reverse())},step:{In:o,Out:p(o)},ripple:{In:r,Out:p(r)},sine:{In:a,Out:p(a)}}}(),h.Envelope.prototype.dispose=function(){return h.AudioNode.prototype.dispose.call(this),this._sig.dispose(),this._sig=null,this._attackCurve=null,this._releaseCurve=null,this},h.Envelope}),e(function(e){return e.AmplitudeEnvelope=function(){e.Envelope.apply(this,arguments),this.input=this.output=new e.Gain,this._sig.connect(this.output.gain)},e.extend(e.AmplitudeEnvelope,e.Envelope),e.AmplitudeEnvelope.prototype.dispose=function(){return e.Envelope.prototype.dispose.call(this),this},e.AmplitudeEnvelope}),e(function(e){e.supported&&(AnalyserNode.prototype.getFloatTimeDomainData||(AnalyserNode.prototype.getFloatTimeDomainData=function(e){var t=new Uint8Array(e.length);this.getByteTimeDomainData(t);for(var n=0;n<t.length;n++)e[n]=(t[n]-128)/128}))}),e(function(t){return t.Analyser=function(){var e=t.defaults(arguments,["type","size"],t.Analyser);t.AudioNode.call(this),this._analyser=this.input=this.output=this.context.createAnalyser(),this._type=e.type,this._buffer=null,this.size=e.size,this.type=e.type},t.extend(t.Analyser,t.AudioNode),t.Analyser.defaults={size:1024,type:"fft",smoothing:.8},t.Analyser.Type={Waveform:"waveform",FFT:"fft"},t.Analyser.prototype.getValue=function(){return this._type===t.Analyser.Type.FFT?this._analyser.getFloatFrequencyData(this._buffer):this._type===t.Analyser.Type.Waveform&&this._analyser.getFloatTimeDomainData(this._buffer),this._buffer},Object.defineProperty(t.Analyser.prototype,"size",{get:function(){return this._analyser.frequencyBinCount},set:function(e){this._analyser.fftSize=2*e,this._buffer=new Float32Array(e)}}),Object.defineProperty(t.Analyser.prototype,"type",{get:function(){return this._type},set:function(e){if(e!==t.Analyser.Type.Waveform&&e!==t.Analyser.Type.FFT)throw new TypeError("Tone.Analyser: invalid type: "+e);this._type=e}}),Object.defineProperty(t.Analyser.prototype,"smoothing",{get:function(){return this._analyser.smoothingTimeConstant},set:function(e){this._analyser.smoothingTimeConstant=e}}),t.Analyser.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this),this._analyser.disconnect(),this._analyser=null,this._buffer=null},t.Analyser}),e(function(t){return t.Compressor=function(){var e=t.defaults(arguments,["threshold","ratio"],t.Compressor);t.AudioNode.call(this),this._compressor=this.input=this.output=this.context.createDynamicsCompressor(),this.threshold=new t.Param({param:this._compressor.threshold,units:t.Type.Decibels,convert:!1}),this.attack=new t.Param(this._compressor.attack,t.Type.Time),this.release=new t.Param(this._compressor.release,t.Type.Time),this.knee=new t.Param({param:this._compressor.knee,units:t.Type.Decibels,convert:!1}),this.ratio=new t.Param({param:this._compressor.ratio,convert:!1}),this._readOnly(["knee","release","attack","ratio","threshold"]),this.set(e)},t.extend(t.Compressor,t.AudioNode),t.Compressor.defaults={ratio:12,threshold:-24,release:.25,attack:.003,knee:30},t.Compressor.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["knee","release","attack","ratio","threshold"]),this._compressor.disconnect(),this._compressor=null,this.attack.dispose(),this.attack=null,this.release.dispose(),this.release=null,this.threshold.dispose(),this.threshold=null,this.ratio.dispose(),this.ratio=null,this.knee.dispose(),this.knee=null,this},t.Compressor}),e(function(t){return t.Add=function(e){t.Signal.call(this),this.createInsOuts(2,0),this._sum=this.input[0]=this.input[1]=this.output=new t.Gain,this._param=this.input[1]=new t.Signal(e),this._param.connect(this._sum)},t.extend(t.Add,t.Signal),t.Add.prototype.dispose=function(){return t.Signal.prototype.dispose.call(this),this._sum.dispose(),this._sum=null,this},t.Add}),e(function(t){return t.Multiply=function(e){t.Signal.call(this),this.createInsOuts(2,0),this._mult=this.input[0]=this.output=new t.Gain,this._param=this.input[1]=this.output.gain,this.value=t.defaultArg(e,0)},t.extend(t.Multiply,t.Signal),t.Multiply.prototype.dispose=function(){return t.Signal.prototype.dispose.call(this),this._mult.dispose(),this._mult=null,this._param=null,this},t.Multiply}),e(function(e){return e.Negate=function(){e.SignalBase.call(this),this._multiply=this.input=this.output=new e.Multiply(-1)},e.extend(e.Negate,e.SignalBase),e.Negate.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._multiply.dispose(),this._multiply=null,this},e.Negate}),e(function(t){return t.Subtract=function(e){t.Signal.call(this),this.createInsOuts(2,0),this._sum=this.input[0]=this.output=new t.Gain,this._neg=new t.Negate,this._param=this.input[1]=new t.Signal(e),this._param.chain(this._neg,this._sum)},t.extend(t.Subtract,t.Signal),t.Subtract.prototype.dispose=function(){return t.Signal.prototype.dispose.call(this),this._neg.dispose(),this._neg=null,this._sum.disconnect(),this._sum=null,this},t.Subtract}),e(function(t){return t.EqualPowerGain=function(){t.SignalBase.call(this),this._eqPower=this.input=this.output=new t.WaveShaper(function(e){return Math.abs(e)<.001?0:t.equalPowerScale(e)}.bind(this),4096)},t.extend(t.EqualPowerGain,t.SignalBase),t.EqualPowerGain.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._eqPower.dispose(),this._eqPower=null,this},t.EqualPowerGain}),e(function(t){return t.CrossFade=function(e){t.AudioNode.call(this),this.createInsOuts(2,1),this.a=this.input[0]=new t.Gain,this.b=this.input[1]=new t.Gain,this.fade=new t.Signal(t.defaultArg(e,.5),t.Type.NormalRange),this._equalPowerA=new t.EqualPowerGain,this._equalPowerB=new t.EqualPowerGain,this._one=this.context.getConstant(1),this._invert=new t.Subtract,this.a.connect(this.output),this.b.connect(this.output),this.fade.chain(this._equalPowerB,this.b.gain),this._one.connect(this._invert,0,0),this.fade.connect(this._invert,0,1),this._invert.chain(this._equalPowerA,this.a.gain),this._readOnly("fade")},t.extend(t.CrossFade,t.AudioNode),t.CrossFade.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable("fade"),this._equalPowerA.dispose(),this._equalPowerA=null,this._equalPowerB.dispose(),this._equalPowerB=null,this.fade.dispose(),this.fade=null,this._invert.dispose(),this._invert=null,this._one=null,this.a.dispose(),this.a=null,this.b.dispose(),this.b=null,this},t.CrossFade}),e(function(a){return a.Filter=function(){var e=a.defaults(arguments,["frequency","type","rolloff"],a.Filter);a.AudioNode.call(this),this.createInsOuts(1,1),this._filters=[],this.frequency=new a.Signal(e.frequency,a.Type.Frequency),this.detune=new a.Signal(0,a.Type.Cents),this.gain=new a.Signal({value:e.gain,convert:!1}),this.Q=new a.Signal(e.Q),this._type=e.type,this._rolloff=e.rolloff,this.rolloff=e.rolloff,this._readOnly(["detune","frequency","gain","Q"])},a.extend(a.Filter,a.AudioNode),a.Filter.defaults={type:"lowpass",frequency:350,rolloff:-12,Q:1,gain:0},Object.defineProperty(a.Filter.prototype,"type",{get:function(){return this._type},set:function(e){if(-1===["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e))throw new TypeError("Tone.Filter: invalid type "+e);this._type=e;for(var t=0;t<this._filters.length;t++)this._filters[t].type=e}}),Object.defineProperty(a.Filter.prototype,"rolloff",{get:function(){return this._rolloff},set:function(e){e=parseInt(e,10);var t=[-12,-24,-48,-96].indexOf(e);if(-1===t)throw new RangeError("Tone.Filter: rolloff can only be -12, -24, -48 or -96");t+=1,this._rolloff=e,this.input.disconnect();for(var n=0;n<this._filters.length;n++)this._filters[n].disconnect(),this._filters[n]=null;this._filters=new Array(t);for(var r=0;r<t;r++){var i=this.context.createBiquadFilter();i.type=this._type,this.frequency.connect(i.frequency),this.detune.connect(i.detune),this.Q.connect(i.Q),this.gain.connect(i.gain),this._filters[r]=i}var o=[this.input].concat(this._filters).concat([this.output]);a.connectSeries.apply(a,o)}}),a.Filter.prototype.dispose=function(){a.AudioNode.prototype.dispose.call(this);for(var e=0;e<this._filters.length;e++)this._filters[e].disconnect(),this._filters[e]=null;return this._filters=null,this._writable(["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.frequency=null,this.Q=null,this.detune.dispose(),this.detune=null,this.gain.dispose(),this.gain=null,this},a.Filter}),e(function(t){return t.MultibandSplit=function(){var e=t.defaults(arguments,["lowFrequency","highFrequency"],t.MultibandSplit);t.AudioNode.call(this),this.input=new t.Gain,this.output=new Array(3),this.low=this.output[0]=new t.Filter(0,"lowpass"),this._lowMidFilter=new t.Filter(0,"highpass"),this.mid=this.output[1]=new t.Filter(0,"lowpass"),this.high=this.output[2]=new t.Filter(0,"highpass"),this.lowFrequency=new t.Signal(e.lowFrequency,t.Type.Frequency),this.highFrequency=new t.Signal(e.highFrequency,t.Type.Frequency),this.Q=new t.Signal(e.Q),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.connect(this.low.frequency),this.lowFrequency.connect(this._lowMidFilter.frequency),this.highFrequency.connect(this.mid.frequency),this.highFrequency.connect(this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),this._readOnly(["high","mid","low","highFrequency","lowFrequency"])},t.extend(t.MultibandSplit,t.AudioNode),t.MultibandSplit.defaults={lowFrequency:400,highFrequency:2500,Q:1},t.MultibandSplit.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this.low=null,this._lowMidFilter.dispose(),this._lowMidFilter=null,this.mid.dispose(),this.mid=null,this.high.dispose(),this.high=null,this.lowFrequency.dispose(),this.lowFrequency=null,this.highFrequency.dispose(),this.highFrequency=null,this.Q.dispose(),this.Q=null,this},t.MultibandSplit}),e(function(t){return t.EQ3=function(){var e=t.defaults(arguments,["low","mid","high"],t.EQ3);t.AudioNode.call(this),this.output=new t.Gain,this._multibandSplit=this.input=new t.MultibandSplit({lowFrequency:e.lowFrequency,highFrequency:e.highFrequency}),this._lowGain=new t.Gain(e.low,t.Type.Decibels),this._midGain=new t.Gain(e.mid,t.Type.Decibels),this._highGain=new t.Gain(e.high,t.Type.Decibels),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),this._readOnly(["low","mid","high","lowFrequency","highFrequency"])},t.extend(t.EQ3,t.AudioNode),t.EQ3.defaults={low:0,mid:0,high:0,lowFrequency:400,highFrequency:2500},t.EQ3.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this._multibandSplit=null,this.lowFrequency=null,this.highFrequency=null,this._lowGain.dispose(),this._lowGain=null,this._midGain.dispose(),this._midGain=null,this._highGain.dispose(),this._highGain=null,this.low=null,this.mid=null,this.high=null,this.Q=null,this},t.EQ3}),e(function(n){return n.Scale=function(e,t){n.SignalBase.call(this),this._outputMin=n.defaultArg(e,0),this._outputMax=n.defaultArg(t,1),this._scale=this.input=new n.Multiply(1),this._add=this.output=new n.Add(0),this._scale.connect(this._add),this._setRange()},n.extend(n.Scale,n.SignalBase),Object.defineProperty(n.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(e){this._outputMin=e,this._setRange()}}),Object.defineProperty(n.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(e){this._outputMax=e,this._setRange()}}),n.Scale.prototype._setRange=function(){this._add.value=this._outputMin,this._scale.value=this._outputMax-this._outputMin},n.Scale.prototype.dispose=function(){return n.SignalBase.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},n.Scale}),e(function(r){return r.ScaleExp=function(e,t,n){r.SignalBase.call(this),this._scale=this.output=new r.Scale(e,t),this._exp=this.input=new r.Pow(r.defaultArg(n,2)),this._exp.connect(this._scale)},r.extend(r.ScaleExp,r.SignalBase),Object.defineProperty(r.ScaleExp.prototype,"exponent",{get:function(){return this._exp.value},set:function(e){this._exp.value=e}}),Object.defineProperty(r.ScaleExp.prototype,"min",{get:function(){return this._scale.min},set:function(e){this._scale.min=e}}),Object.defineProperty(r.ScaleExp.prototype,"max",{get:function(){return this._scale.max},set:function(e){this._scale.max=e}}),r.ScaleExp.prototype.dispose=function(){return r.SignalBase.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._exp.dispose(),this._exp=null,this},r.ScaleExp}),e(function(t){return t.Delay=function(){var e=t.defaults(arguments,["delayTime","maxDelay"],t.Delay);t.AudioNode.call(this),this._maxDelay=Math.max(this.toSeconds(e.maxDelay),this.toSeconds(e.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(this._maxDelay),this.delayTime=new t.Param({param:this._delayNode.delayTime,units:t.Type.Time,value:e.delayTime}),this._readOnly("delayTime")},t.extend(t.Delay,t.AudioNode),t.Delay.defaults={maxDelay:1,delayTime:0},Object.defineProperty(t.Delay.prototype,"maxDelay",{get:function(){return this._maxDelay}}),t.Delay.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._delayNode.disconnect(),this._delayNode=null,this._writable("delayTime"),this.delayTime=null,this},t.Delay}),e(function(t){return t.FeedbackCombFilter=function(){var e=t.defaults(arguments,["delayTime","resonance"],t.FeedbackCombFilter);t.AudioNode.call(this),this._delay=this.input=this.output=new t.Delay(e.delayTime),this.delayTime=this._delay.delayTime,this._feedback=new t.Gain(e.resonance,t.Type.NormalRange),this.resonance=this._feedback.gain,this._delay.chain(this._feedback,this._delay),this._readOnly(["resonance","delayTime"])},t.extend(t.FeedbackCombFilter,t.AudioNode),t.FeedbackCombFilter.defaults={delayTime:.1,resonance:.5},t.FeedbackCombFilter.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["resonance","delayTime"]),this._delay.dispose(),this._delay=null,this.delayTime=null,this._feedback.dispose(),this._feedback=null,this.resonance=null,this},t.FeedbackCombFilter}),e(function(t){return t.FFT=function(){var e=t.defaults(arguments,["size"],t.FFT);e.type=t.Analyser.Type.FFT,t.AudioNode.call(this),this._analyser=this.input=this.output=new t.Analyser(e)},t.extend(t.FFT,t.AudioNode),t.FFT.defaults={size:1024},t.FFT.prototype.getValue=function(){return this._analyser.getValue()},Object.defineProperty(t.FFT.prototype,"size",{get:function(){return this._analyser.size},set:function(e){this._analyser.size=e}}),t.FFT.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this),this._analyser.dispose(),this._analyser=null},t.FFT}),e(function(e){return e.Abs=function(){e.SignalBase.call(this),this._abs=this.input=this.output=new e.WaveShaper(function(e){return Math.abs(e)<.001?0:Math.abs(e)},1024)},e.extend(e.Abs,e.SignalBase),e.Abs.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._abs.dispose(),this._abs=null,this},e.Abs}),e(function(r){return r.Follower=function(){var e=r.defaults(arguments,["attack","release"],r.Follower);r.AudioNode.call(this),this.createInsOuts(1,1),this._abs=new r.Abs,this._filter=this.context.createBiquadFilter(),this._filter.type="lowpass",this._filter.frequency.value=0,this._filter.Q.value=-100,this._frequencyValues=new r.WaveShaper,this._sub=new r.Subtract,this._delay=new r.Delay(this.blockTime),this._mult=new r.Multiply(1e4),this._attack=e.attack,this._release=e.release,this.input.chain(this._abs,this._filter,this.output),this._abs.connect(this._sub,0,1),this._filter.chain(this._delay,this._sub),this._sub.chain(this._mult,this._frequencyValues,this._filter.frequency),this._setAttackRelease(this._attack,this._release)},r.extend(r.Follower,r.AudioNode),r.Follower.defaults={attack:.05,release:.5},r.Follower.prototype._setAttackRelease=function(t,n){var e=this.blockTime;t=r.Time(t).toFrequency(),n=r.Time(n).toFrequency(),t=Math.max(t,e),n=Math.max(n,e),this._frequencyValues.setMap(function(e){return e<=0?t:n})},Object.defineProperty(r.Follower.prototype,"attack",{get:function(){return this._attack},set:function(e){this._attack=e,this._setAttackRelease(this._attack,this._release)}}),Object.defineProperty(r.Follower.prototype,"release",{get:function(){return this._release},set:function(e){this._release=e,this._setAttackRelease(this._attack,this._release)}}),r.Follower.prototype.connect=r.SignalBase.prototype.connect,r.Follower.prototype.dispose=function(){return r.AudioNode.prototype.dispose.call(this),this._filter.disconnect(),this._filter=null,this._frequencyValues.disconnect(),this._frequencyValues=null,this._delay.dispose(),this._delay=null,this._sub.disconnect(),this._sub=null,this._abs.dispose(),this._abs=null,this._mult.dispose(),this._mult=null,this._curve=null,this},r.Follower}),e(function(t){return t.ScaledEnvelope=function(){var e=t.defaults(arguments,["attack","decay","sustain","release"],t.Envelope);t.Envelope.call(this,e),e=t.defaultArg(e,t.ScaledEnvelope.defaults),this._exp=this.output=new t.Pow(e.exponent),this._scale=this.output=new t.Scale(e.min,e.max),this._sig.chain(this._exp,this._scale)},t.extend(t.ScaledEnvelope,t.Envelope),t.ScaledEnvelope.defaults={min:0,max:1,exponent:1},Object.defineProperty(t.ScaledEnvelope.prototype,"min",{get:function(){return this._scale.min},set:function(e){this._scale.min=e}}),Object.defineProperty(t.ScaledEnvelope.prototype,"max",{get:function(){return this._scale.max},set:function(e){this._scale.max=e}}),Object.defineProperty(t.ScaledEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(e){this._exp.value=e}}),t.ScaledEnvelope.prototype.dispose=function(){return t.Envelope.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._exp.dispose(),this._exp=null,this},t.ScaledEnvelope}),e(function(t){return t.FrequencyEnvelope=function(){var e=t.defaults(arguments,["attack","decay","sustain","release"],t.Envelope);t.ScaledEnvelope.call(this,e),e=t.defaultArg(e,t.FrequencyEnvelope.defaults),this._octaves=e.octaves,this.baseFrequency=e.baseFrequency,this.octaves=e.octaves},t.extend(t.FrequencyEnvelope,t.Envelope),t.FrequencyEnvelope.defaults={baseFrequency:200,octaves:4,exponent:2},Object.defineProperty(t.FrequencyEnvelope.prototype,"baseFrequency",{get:function(){return this._scale.min},set:function(e){this._scale.min=this.toFrequency(e),this.octaves=this._octaves}}),Object.defineProperty(t.FrequencyEnvelope.prototype,"octaves",{get:function(){return this._octaves},set:function(e){this._octaves=e,this._scale.max=this.baseFrequency*Math.pow(2,e)}}),Object.defineProperty(t.FrequencyEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(e){this._exp.value=e}}),t.FrequencyEnvelope.prototype.dispose=function(){return t.ScaledEnvelope.prototype.dispose.call(this),this},t.FrequencyEnvelope}),e(function(e){return e.GreaterThanZero=function(){e.SignalBase.call(this),this._thresh=this.output=new e.WaveShaper(function(e){return e<=0?0:1},127),this._scale=this.input=new e.Multiply(1e4),this._scale.connect(this._thresh)},e.extend(e.GreaterThanZero,e.SignalBase),e.GreaterThanZero.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._thresh.dispose(),this._thresh=null,this},e.GreaterThanZero}),e(function(t){return t.GreaterThan=function(e){t.Signal.call(this),this.createInsOuts(2,0),this._param=this.input[0]=new t.Subtract(e),this.input[1]=this._param.input[1],this._gtz=this.output=new t.GreaterThanZero,this._param.connect(this._gtz)},t.extend(t.GreaterThan,t.Signal),t.GreaterThan.prototype.dispose=function(){return t.Signal.prototype.dispose.call(this),this._gtz.dispose(),this._gtz=null,this},t.GreaterThan}),e(function(t){return t.Gate=function(){var e=t.defaults(arguments,["threshold","attack","release"],t.Gate);t.AudioNode.call(this),this.createInsOuts(1,1),this._follower=new t.Follower(e.attack,e.release),this._gt=new t.GreaterThan(t.dbToGain(e.threshold)),this.input.connect(this.output),this.input.chain(this._gt,this._follower,this.output.gain)},t.extend(t.Gate,t.AudioNode),t.Gate.defaults={attack:.1,release:.1,threshold:-40},Object.defineProperty(t.Gate.prototype,"threshold",{get:function(){return t.gainToDb(this._gt.value)},set:function(e){this._gt.value=t.dbToGain(e)}}),Object.defineProperty(t.Gate.prototype,"attack",{get:function(){return this._follower.attack},set:function(e){this._follower.attack=e}}),Object.defineProperty(t.Gate.prototype,"release",{get:function(){return this._follower.release},set:function(e){this._follower.release=e}}),t.Gate.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._follower.dispose(),this._gt.dispose(),this._follower=null,this._gt=null,this},t.Gate}),e(function(s){function e(o){return function(e,t){t=this.toSeconds(t),o.apply(this,arguments);var n=this._events.get(t),r=this._events.previousEvent(n),i=this._getTicksUntilEvent(r,t);return n.ticks=Math.max(i,0),this}}return s.TickSignal=function(e){e=s.defaultArg(e,1),s.Signal.call(this,{units:s.Type.Ticks,value:e}),this._events.memory=1/0,this.cancelScheduledValues(0),this._events.add({type:s.Param.AutomationType.SetValue,time:0,value:e})},s.extend(s.TickSignal,s.Signal),s.TickSignal.prototype.setValueAtTime=e(s.Signal.prototype.setValueAtTime),s.TickSignal.prototype.linearRampToValueAtTime=e(s.Signal.prototype.linearRampToValueAtTime),s.TickSignal.prototype.setTargetAtTime=function(e,t,n){t=this.toSeconds(t),this.setRampPoint(t),e=this._fromUnits(e);for(var r=this._events.get(t),i=Math.round(Math.max(1/n,1)),o=0;o<=i;o++){var a=n*o+t,s=this._exponentialApproach(r.time,r.value,e,n,a);this.linearRampToValueAtTime(this._toUnits(s),a)}return this},s.TickSignal.prototype.exponentialRampToValueAtTime=function(e,t){t=this.toSeconds(t),e=this._fromUnits(e);var n=this._events.get(t);null===n&&(n={value:this._initialValue,time:0});for(var r=Math.round(Math.max(10*(t-n.time),1)),i=(t-n.time)/r,o=0;o<=r;o++){var a=i*o+n.time,s=this._exponentialInterpolate(n.time,n.value,t,e,a);this.linearRampToValueAtTime(this._toUnits(s),a)}return this},s.TickSignal.prototype._getTicksUntilEvent=function(e,t){if(null===e)e={ticks:0,time:0};else if(s.isUndef(e.ticks)){var n=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(n,e.time)}var r=this.getValueAtTime(e.time),i=this.getValueAtTime(t);return this._events.get(t).time===t&&this._events.get(t).type===s.Param.AutomationType.SetValue&&(i=this.getValueAtTime(t-this.sampleTime)),.5*(t-e.time)*(r+i)+e.ticks},s.TickSignal.prototype.getTicksAtTime=function(e){e=this.toSeconds(e);var t=this._events.get(e);return Math.max(this._getTicksUntilEvent(t,e),0)},s.TickSignal.prototype.getDurationOfTicks=function(e,t){t=this.toSeconds(t);var n=this.getTicksAtTime(t);return this.getTimeOfTick(n+e)-t},s.TickSignal.prototype.getTimeOfTick=function(e){var t=this._events.get(e,"ticks"),n=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&n&&n.type===s.Param.AutomationType.Linear&&t.value!==n.value){var r=this.getValueAtTime(t.time),i=(this.getValueAtTime(n.time)-r)/(n.time-t.time),o=Math.sqrt(Math.pow(r,2)-2*i*(t.ticks-e)),a=(-r+o)/i;return(0<a?a:(-r-o)/i)+t.time}return t?0===t.value?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue},s.TickSignal.prototype.ticksToTime=function(e,t){return t=this.toSeconds(t),new s.Time(this.getDurationOfTicks(e,t))},s.TickSignal.prototype.timeToTicks=function(e,t){t=this.toSeconds(t),e=this.toSeconds(e);var n=this.getTicksAtTime(t),r=this.getTicksAtTime(t+e);return new s.Ticks(r-n)},s.TickSignal}),e(function(t){return t.TimelineState=function(e){t.Timeline.call(this),this._initial=e},t.extend(t.TimelineState,t.Timeline),t.TimelineState.prototype.getValueAtTime=function(e){var t=this.get(e);return null!==t?t.state:this._initial},t.TimelineState.prototype.setStateAtTime=function(e,t){return this.add({state:e,time:t}),this},t.TimelineState.prototype.getLastState=function(e,t){t=this.toSeconds(t);for(var n=this._search(t);0<=n;n--){var r=this._timeline[n];if(r.state===e)return r}},t.TimelineState.prototype.getNextState=function(e,t){t=this.toSeconds(t);var n=this._search(t);if(-1!==n)for(var r=n;r<this._timeline.length;r++){var i=this._timeline[r];if(i.state===e)return i}},t.TimelineState}),e(function(u){return u.TickSource=function(){var e=u.defaults(arguments,["frequency"],u.TickSource);this.frequency=new u.TickSignal(e.frequency,u.Type.Frequency),this._readOnly("frequency"),this._state=new u.TimelineState(u.State.Stopped),this._state.setStateAtTime(u.State.Stopped,0),this._tickOffset=new u.Timeline,this.setTicksAtTime(0,0)},u.extend(u.TickSource),u.TickSource.defaults={frequency:1},Object.defineProperty(u.TickSource.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),u.TickSource.prototype.start=function(e,t){return e=this.toSeconds(e),this._state.getValueAtTime(e)!==u.State.Started&&(this._state.setStateAtTime(u.State.Started,e),u.isDefined(t)&&this.setTicksAtTime(t,e)),this},u.TickSource.prototype.stop=function(e){if(e=this.toSeconds(e),this._state.getValueAtTime(e)===u.State.Stopped){var t=this._state.get(e);0<t.time&&(this._tickOffset.cancel(t.time),this._state.cancel(t.time))}return this._state.cancel(e),this._state.setStateAtTime(u.State.Stopped,e),this.setTicksAtTime(0,e),this},u.TickSource.prototype.pause=function(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)===u.State.Started&&this._state.setStateAtTime(u.State.Paused,e),this},u.TickSource.prototype.cancel=function(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this},u.TickSource.prototype.getTicksAtTime=function(e){e=this.toSeconds(e);var t=this._state.getLastState(u.State.Stopped,e),n={state:u.State.Paused,time:e};this._state.add(n);var r=t,i=0;return this._state.forEachBetween(t.time,e+this.sampleTime,function(e){var t=r.time,n=this._tickOffset.get(e.time);n.time>=r.time&&(i=n.ticks,t=n.time),r.state===u.State.Started&&e.state!==u.State.Started&&(i+=this.frequency.getTicksAtTime(e.time)-this.frequency.getTicksAtTime(t)),r=e}.bind(this)),this._state.remove(n),i},Object.defineProperty(u.TickSource.prototype,"ticks",{get:function(){return this.getTicksAtTime(this.now())},set:function(e){this.setTicksAtTime(e,this.now())}}),Object.defineProperty(u.TickSource.prototype,"seconds",{get:function(){return this.getSecondsAtTime(this.now())},set:function(e){var t=this.now(),n=this.frequency.timeToTicks(e,t);this.setTicksAtTime(n,t)}}),u.TickSource.prototype.getSecondsAtTime=function(e){e=this.toSeconds(e);var t=this._state.getLastState(u.State.Stopped,e),n={state:u.State.Paused,time:e};this._state.add(n);var r=t,i=0;return this._state.forEachBetween(t.time,e+this.sampleTime,function(e){var t=r.time,n=this._tickOffset.get(e.time);n.time>=r.time&&(i=n.seconds,t=n.time),r.state===u.State.Started&&e.state!==u.State.Started&&(i+=e.time-t),r=e}.bind(this)),this._state.remove(n),i},u.TickSource.prototype.setTicksAtTime=function(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({time:t,ticks:e,seconds:this.frequency.getDurationOfTicks(e,t)}),this},u.TickSource.prototype.getStateAtTime=function(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)},u.TickSource.prototype.getTimeOfTick=function(e,t){t=u.defaultArg(t,this.now());var n=this._tickOffset.get(t),r=this._state.get(t),i=Math.max(n.time,r.time),o=this.frequency.getTicksAtTime(i)+e-n.ticks;return this.frequency.getTimeOfTick(o)},u.TickSource.prototype.forEachTickBetween=function(t,e,n){var r=this._state.get(t);if(this._state.forEachBetween(t,e,function(e){r.state===u.State.Started&&e.state!==u.State.Started&&this.forEachTickBetween(Math.max(r.time,t),e.time-this.sampleTime,n),r=e}.bind(this)),t=Math.max(r.time,t),r.state===u.State.Started&&this._state){var i=this.frequency.getTicksAtTime(t),o=(i-this.frequency.getTicksAtTime(r.time))%1;0!==o&&(o=1-o);for(var a=this.frequency.getTimeOfTick(i+o),s=null;a<e&&this._state;){try{n(a,Math.round(this.getTicksAtTime(a)))}catch(e){s=e;break}this._state&&(a+=this.frequency.getDurationOfTicks(1,a))}}if(s)throw s;return this},u.TickSource.prototype.dispose=function(){return u.Param.prototype.dispose.call(this),this._state.dispose(),this._state=null,this._tickOffset.dispose(),this._tickOffset=null,this._writable("frequency"),this.frequency.dispose(),this.frequency=null,this},u.TickSource}),e(function(n){return n.Clock=function(){var e=n.defaults(arguments,["callback","frequency"],n.Clock);n.Emitter.call(this),this.callback=e.callback,this._nextTick=0,this._tickSource=new n.TickSource(e.frequency),this._lastUpdate=0,this.frequency=this._tickSource.frequency,this._readOnly("frequency"),this._state=new n.TimelineState(n.State.Stopped),this._state.setStateAtTime(n.State.Stopped,0),this._boundLoop=this._loop.bind(this),this.context.on("tick",this._boundLoop)},n.extend(n.Clock,n.Emitter),n.Clock.defaults={callback:n.noOp,frequency:1},Object.defineProperty(n.Clock.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),n.Clock.prototype.start=function(e,t){return e=this.toSeconds(e),this._state.getValueAtTime(e)!==n.State.Started&&(this._state.setStateAtTime(n.State.Started,e),this._tickSource.start(e,t),e<this._lastUpdate&&this.emit("start",e,t)),this},n.Clock.prototype.stop=function(e){return e=this.toSeconds(e),this._state.cancel(e),this._state.setStateAtTime(n.State.Stopped,e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this},n.Clock.prototype.pause=function(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)===n.State.Started&&(this._state.setStateAtTime(n.State.Paused,e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this},Object.defineProperty(n.Clock.prototype,"ticks",{get:function(){return Math.ceil(this.getTicksAtTime(this.now()))},set:function(e){this._tickSource.ticks=e}}),Object.defineProperty(n.Clock.prototype,"seconds",{get:function(){return this._tickSource.seconds},set:function(e){this._tickSource.seconds=e}}),n.Clock.prototype.getSecondsAtTime=function(e){return this._tickSource.getSecondsAtTime(e)},n.Clock.prototype.setTicksAtTime=function(e,t){return this._tickSource.setTicksAtTime(e,t),this},n.Clock.prototype.getTicksAtTime=function(e){return this._tickSource.getTicksAtTime(e)},n.Clock.prototype.nextTickTime=function(e,t){t=this.toSeconds(t);var n=this.getTicksAtTime(t);return this._tickSource.getTimeOfTick(n+e,t)},n.Clock.prototype._loop=function(){var e=this._lastUpdate,t=this.now();e!==(this._lastUpdate=t)&&(this._state.forEachBetween(e,t,function(e){switch(e.state){case n.State.Started:var t=this._tickSource.getTicksAtTime(e.time);this.emit("start",e.time,t);break;case n.State.Stopped:0!==e.time&&this.emit("stop",e.time);break;case n.State.Paused:this.emit("pause",e.time)}}.bind(this)),this._tickSource.forEachTickBetween(e,t,function(e,t){this.callback(e,t)}.bind(this)))},n.Clock.prototype.getStateAtTime=function(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)},n.Clock.prototype.dispose=function(){n.Emitter.prototype.dispose.call(this),this.context.off("tick",this._boundLoop),this._writable("frequency"),this._tickSource.dispose(),this._tickSource=null,this.frequency=null,this._boundLoop=null,this._nextTick=1/0,this.callback=null,this._state.dispose(),this._state=null},n.Clock}),e(function(n){n.IntervalTimeline=function(){n.call(this),this._root=null,this._length=0},n.extend(n.IntervalTimeline),n.IntervalTimeline.prototype.add=function(e){if(n.isUndef(e.time)||n.isUndef(e.duration))throw new Error("Tone.IntervalTimeline: events must have time and duration parameters");e.time=e.time.valueOf();var t=new r(e.time,e.time+e.duration,e);for(null===this._root?this._root=t:this._root.insert(t),this._length++;null!==t;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this},n.IntervalTimeline.prototype.remove=function(e){if(null!==this._root){var t=[];this._root.search(e.time,t);for(var n=0;n<t.length;n++){var r=t[n];if(r.event===e){this._removeNode(r),this._length--;break}}}return this},Object.defineProperty(n.IntervalTimeline.prototype,"length",{get:function(){return this._length}}),n.IntervalTimeline.prototype.cancel=function(e){return this.forEachFrom(e,function(e){this.remove(e)}.bind(this)),this},n.IntervalTimeline.prototype._setRoot=function(e){this._root=e,null!==this._root&&(this._root.parent=null)},n.IntervalTimeline.prototype._replaceNodeInParent=function(e,t){null!==e.parent?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)},n.IntervalTimeline.prototype._removeNode=function(e){if(null===e.left&&null===e.right)this._replaceNodeInParent(e,null);else if(null===e.right)this._replaceNodeInParent(e,e.left);else if(null===e.left)this._replaceNodeInParent(e,e.right);else{var t,n;if(0<e.getBalance())if(null===e.left.right)(t=e.left).right=e.right,n=t;else{for(t=e.left.right;null!==t.right;)t=t.right;t.parent.right=t.left,n=t.parent,t.left=e.left,t.right=e.right}else if(null===e.right.left)(t=e.right).left=e.left,n=t;else{for(t=e.right.left;null!==t.left;)t=t.left;t.parent=t.parent,t.parent.left=t.right,n=t.parent,t.left=e.left,t.right=e.right}null!==e.parent?e.isLeftChild()?e.parent.left=t:e.parent.right=t:this._setRoot(t),this._rebalance(n)}e.dispose()},n.IntervalTimeline.prototype._rotateLeft=function(e){var t=e.parent,n=e.isLeftChild(),r=e.right;e.right=r.left,r.left=e,null!==t?n?t.left=r:t.right=r:this._setRoot(r)},n.IntervalTimeline.prototype._rotateRight=function(e){var t=e.parent,n=e.isLeftChild(),r=e.left;e.left=r.right,r.right=e,null!==t?n?t.left=r:t.right=r:this._setRoot(r)},n.IntervalTimeline.prototype._rebalance=function(e){var t=e.getBalance();1<t?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&(0<e.right.getBalance()?this._rotateRight(e.right):this._rotateLeft(e))},n.IntervalTimeline.prototype.get=function(e){if(null!==this._root){var t=[];if(this._root.search(e,t),0<t.length){for(var n=t[0],r=1;r<t.length;r++)t[r].low>n.low&&(n=t[r]);return n.event}}return null},n.IntervalTimeline.prototype.forEach=function(e){if(null!==this._root){var t=[];this._root.traverse(function(e){t.push(e)});for(var n=0;n<t.length;n++){var r=t[n].event;r&&e(r)}}return this},n.IntervalTimeline.prototype.forEachAtTime=function(e,t){if(null!==this._root){var n=[];this._root.search(e,n);for(var r=n.length-1;0<=r;r--){var i=n[r].event;i&&t(i)}}return this},n.IntervalTimeline.prototype.forEachFrom=function(e,t){if(null!==this._root){var n=[];this._root.searchAfter(e,n);for(var r=n.length-1;0<=r;r--){t(n[r].event)}}return this},n.IntervalTimeline.prototype.dispose=function(){var t=[];null!==this._root&&this._root.traverse(function(e){t.push(e)});for(var e=0;e<t.length;e++)t[e].dispose();return t=null,this._root=null,this};var r=function(e,t,n){this.event=n,this.low=e,this.high=t,this.max=this.high,this._left=null,this._right=null,this.parent=null,this.height=0};return r.prototype.insert=function(e){e.low<=this.low?null===this.left?this.left=e:this.left.insert(e):null===this.right?this.right=e:this.right.insert(e)},r.prototype.search=function(e,t){e>this.max||(null!==this.left&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),this.low>e||null!==this.right&&this.right.search(e,t))},r.prototype.searchAfter=function(e,t){this.low>=e&&(t.push(this),null!==this.left&&this.left.searchAfter(e,t)),null!==this.right&&this.right.searchAfter(e,t)},r.prototype.traverse=function(e){e(this),null!==this.left&&this.left.traverse(e),null!==this.right&&this.right.traverse(e)},r.prototype.updateHeight=function(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0},r.prototype.updateMax=function(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))},r.prototype.getBalance=function(){var e=0;return null!==this.left&&null!==this.right?e=this.left.height-this.right.height:null!==this.left?e=this.left.height+1:null!==this.right&&(e=-(this.right.height+1)),e},r.prototype.isLeftChild=function(){return null!==this.parent&&this.parent.left===this},Object.defineProperty(r.prototype,"left",{get:function(){return this._left},set:function(e){null!==(this._left=e)&&(e.parent=this),this.updateHeight(),this.updateMax()}}),Object.defineProperty(r.prototype,"right",{get:function(){return this._right},set:function(e){null!==(this._right=e)&&(e.parent=this),this.updateHeight(),this.updateMax()}}),r.prototype.dispose=function(){this.parent=null,this._left=null,this._right=null,this.event=null},n.IntervalTimeline}),e(function(n){return n.Ticks=function(e,t){if(!(this instanceof n.Ticks))return new n.Ticks(e,t);n.TransportTime.call(this,e,t)},n.extend(n.Ticks,n.TransportTime),n.Ticks.prototype._defaultUnits="i",n.Ticks.prototype._now=function(){return n.Transport.ticks},n.Ticks.prototype._beatsToUnits=function(e){return this._getPPQ()*e},n.Ticks.prototype._secondsToUnits=function(e){return e/(60/this._getBpm())*this._getPPQ()},n.Ticks.prototype._ticksToUnits=function(e){return e},n.Ticks.prototype.toTicks=function(){return this.valueOf()},n.Ticks.prototype.toSeconds=function(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())},n.Ticks}),e(function(n){return n.TransportEvent=function(e,t){t=n.defaultArg(t,n.TransportEvent.defaults),n.call(this),this.Transport=e,this.id=n.TransportEvent._eventId++,this.time=n.Ticks(t.time),this.callback=t.callback,this._once=t.once},n.extend(n.TransportEvent),n.TransportEvent.defaults={once:!1,callback:n.noOp},n.TransportEvent._eventId=0,n.TransportEvent.prototype.invoke=function(e){this.callback&&(this.callback(e),this._once&&this.Transport&&this.Transport.clear(this.id))},n.TransportEvent.prototype.dispose=function(){return n.prototype.dispose.call(this),this.Transport=null,this.callback=null,this.time=null,this},n.TransportEvent}),e(function(n){return n.TransportRepeatEvent=function(e,t){n.TransportEvent.call(this,e,t),t=n.defaultArg(t,n.TransportRepeatEvent.defaults),this.duration=n.Ticks(t.duration),this._interval=n.Ticks(t.interval),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this),this.Transport.on("start loopStart",this._boundRestart),this._restart()},n.extend(n.TransportRepeatEvent,n.TransportEvent),n.TransportRepeatEvent.defaults={duration:1/0,interval:1},n.TransportRepeatEvent.prototype.invoke=function(e){this._createEvents(e),n.TransportEvent.prototype.invoke.call(this,e)},n.TransportRepeatEvent.prototype._createEvents=function(e){var t=this.Transport.getTicksAtTime(e);t>=this.time&&t>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.Transport.scheduleOnce(this.invoke.bind(this),n.Ticks(this._nextTick)))},n.TransportRepeatEvent.prototype._restart=function(e){this.Transport.clear(this._currentId),this.Transport.clear(this._nextId),this._nextTick=this.time;var t=this.Transport.getTicksAtTime(e);t>this.time&&(this._nextTick=this.time+Math.ceil((t-this.time)/this._interval)*this._interval),this._currentId=this.Transport.scheduleOnce(this.invoke.bind(this),n.Ticks(this._nextTick)),this._nextTick+=this._interval,this._nextId=this.Transport.scheduleOnce(this.invoke.bind(this),n.Ticks(this._nextTick))},n.TransportRepeatEvent.prototype.dispose=function(){return this.Transport.clear(this._currentId),this.Transport.clear(this._nextId),this.Transport.off("start loopStart",this._boundRestart),this._boundCreateEvents=null,n.TransportEvent.prototype.dispose.call(this),this.duration=null,this._interval=null,this},n.TransportRepeatEvent}),e(function(o){o.Transport=function(){o.Emitter.call(this),o.getContext(function(){this.loop=!1,this._loopStart=0,this._loopEnd=0,this._ppq=t.defaults.PPQ,this._clock=new o.Clock({callback:this._processTick.bind(this),frequency:0}),this._bindClockEvents(),this.bpm=this._clock.frequency,this.bpm._toUnits=this._toUnits.bind(this),this.bpm._fromUnits=this._fromUnits.bind(this),this.bpm.units=o.Type.BPM,this.bpm.value=t.defaults.bpm,this._readOnly("bpm"),this._timeSignature=t.defaults.timeSignature,this._scheduledEvents={},this._timeline=new o.Timeline,this._repeatedEvents=new o.IntervalTimeline,this._syncedSignals=[],this._swingTicks=t.defaults.PPQ/2,this._swingAmount=0}.bind(this))},o.extend(o.Transport,o.Emitter),o.Transport.defaults={bpm:120,swing:0,swingSubdivision:"8n",timeSignature:4,loopStart:0,loopEnd:"4m",PPQ:192},o.Transport.prototype._processTick=function(t,e){if(0<this._swingAmount&&e%this._ppq!=0&&e%(2*this._swingTicks)!=0){var n=e%(2*this._swingTicks)/(2*this._swingTicks),r=Math.sin(n*Math.PI)*this._swingAmount;t+=o.Ticks(2*this._swingTicks/3).toSeconds()*r}this.loop&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._timeline.forEachAtTime(e,function(e){e.invoke(t)})},o.Transport.prototype.schedule=function(e,t){var n=new o.TransportEvent(this,{time:o.TransportTime(t),callback:e});return this._addEvent(n,this._timeline)},o.Transport.prototype.scheduleRepeat=function(e,t,n,r){var i=new o.TransportRepeatEvent(this,{callback:e,interval:o.Time(t),time:o.TransportTime(n),duration:o.Time(o.defaultArg(r,1/0))});return this._addEvent(i,this._repeatedEvents)},o.Transport.prototype.scheduleOnce=function(e,t){var n=new o.TransportEvent(this,{time:o.TransportTime(t),callback:e,once:!0});return this._addEvent(n,this._timeline)},o.Transport.prototype.clear=function(e){if(this._scheduledEvents.hasOwnProperty(e)){var t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this},o.Transport.prototype._addEvent=function(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id},o.Transport.prototype.cancel=function(e){return e=o.defaultArg(e,0),e=this.toTicks(e),this._timeline.forEachFrom(e,function(e){this.clear(e.id)}.bind(this)),this._repeatedEvents.forEachFrom(e,function(e){this.clear(e.id)}.bind(this)),this},o.Transport.prototype._bindClockEvents=function(){this._clock.on("start",function(e,t){t=o.Ticks(t).toSeconds(),this.emit("start",e,t)}.bind(this)),this._clock.on("stop",function(e){this.emit("stop",e)}.bind(this)),this._clock.on("pause",function(e){this.emit("pause",e)}.bind(this))},Object.defineProperty(o.Transport.prototype,"state",{get:function(){return this._clock.getStateAtTime(this.now())}}),o.Transport.prototype.start=function(e,t){return o.isDefined(t)&&(t=this.toTicks(t)),this._clock.start(e,t),this},o.Transport.prototype.stop=function(e){return this._clock.stop(e),this},o.Transport.prototype.pause=function(e){return this._clock.pause(e),this},o.Transport.prototype.toggle=function(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!==o.State.Started?this.start(e):this.stop(e),this},Object.defineProperty(o.Transport.prototype,"timeSignature",{get:function(){return this._timeSignature},set:function(e){o.isArray(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}}),Object.defineProperty(o.Transport.prototype,"loopStart",{get:function(){return o.Ticks(this._loopStart).toSeconds()},set:function(e){this._loopStart=this.toTicks(e)}}),Object.defineProperty(o.Transport.prototype,"loopEnd",{get:function(){return o.Ticks(this._loopEnd).toSeconds()},set:function(e){this._loopEnd=this.toTicks(e)}}),o.Transport.prototype.setLoopPoints=function(e,t){return this.loopStart=e,this.loopEnd=t,this},Object.defineProperty(o.Transport.prototype,"swing",{get:function(){return this._swingAmount},set:function(e){this._swingAmount=e}}),Object.defineProperty(o.Transport.prototype,"swingSubdivision",{get:function(){return o.Ticks(this._swingTicks).toNotation()},set:function(e){this._swingTicks=this.toTicks(e)}}),Object.defineProperty(o.Transport.prototype,"position",{get:function(){var e=this.now(),t=this._clock.getTicksAtTime(e);return o.Ticks(t).toBarsBeatsSixteenths()},set:function(e){var t=this.toTicks(e);this.ticks=t}}),Object.defineProperty(o.Transport.prototype,"seconds",{get:function(){return this._clock.seconds},set:function(e){var t=this.now(),n=this.bpm.timeToTicks(e,t);this.ticks=n}}),Object.defineProperty(o.Transport.prototype,"progress",{get:function(){if(this.loop){var e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}}),Object.defineProperty(o.Transport.prototype,"ticks",{get:function(){return this._clock.ticks},set:function(e){if(this._clock.ticks!==e){var t=this.now();this.state===o.State.Started?(this.emit("stop",t),this._clock.setTicksAtTime(e,t),this.emit("start",t,this.seconds)):this._clock.setTicksAtTime(e,t)}}}),o.Transport.prototype.getTicksAtTime=function(e){return Math.round(this._clock.getTicksAtTime(e))},o.Transport.prototype.getSecondsAtTime=function(e){return this._clock.getSecondsAtTime(e)},Object.defineProperty(o.Transport.prototype,"PPQ",{get:function(){return this._ppq},set:function(e){var t=this.bpm.value;this._ppq=e,this.bpm.value=t}}),o.Transport.prototype._fromUnits=function(e){return 1/(60/e/this.PPQ)},o.Transport.prototype._toUnits=function(e){return e/this.PPQ*60},o.Transport.prototype.nextSubdivision=function(e){if(e=this.toTicks(e),this.state!==o.State.Started)return 0;var t=this.now(),n=e-this.getTicksAtTime(t)%e;return this._clock.nextTickTime(n,t)},o.Transport.prototype.syncSignal=function(e,t){if(!t){var n=this.now();t=0!==e.getValueAtTime(n)?e.getValueAtTime(n)/this.bpm.getValueAtTime(n):0}var r=new o.Gain(t);return this.bpm.chain(r,e._param),this._syncedSignals.push({ratio:r,signal:e,initial:e.value}),e.value=0,this},o.Transport.prototype.unsyncSignal=function(e){for(var t=this._syncedSignals.length-1;0<=t;t--){var n=this._syncedSignals[t];n.signal===e&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(t,1))}return this},o.Transport.prototype.dispose=function(){return o.Emitter.prototype.dispose.call(this),this._clock.dispose(),this._clock=null,this._writable("bpm"),this.bpm=null,this._timeline.dispose(),this._timeline=null,this._repeatedEvents.dispose(),this._repeatedEvents=null,this};var t=o.Transport;return o.Transport=new t,o.Context.on("init",function(e){e.Transport instanceof t?o.Transport=e.Transport:o.Transport=new t,e.Transport=o.Transport}),o.Context.on("close",function(e){e.Transport instanceof t&&e.Transport.dispose()}),o.Transport}),e(function(t){return t.Volume=function(){var e=t.defaults(arguments,["volume"],t.Volume);t.AudioNode.call(this),this.output=this.input=new t.Gain(e.volume,t.Type.Decibels),this._unmutedVolume=e.volume,this.volume=this.output.gain,this._readOnly("volume"),this.mute=e.mute},t.extend(t.Volume,t.AudioNode),t.Volume.defaults={volume:0,mute:!1},Object.defineProperty(t.Volume.prototype,"mute",{get:function(){return this.volume.value===-1/0},set:function(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}}),t.Volume.prototype.dispose=function(){return this.input.dispose(),t.AudioNode.prototype.dispose.call(this),this._writable("volume"),this.volume.dispose(),this.volume=null,this},t.Volume}),e(function(t){t.Master=function(){t.AudioNode.call(this),t.getContext(function(){this.createInsOuts(1,0),this._volume=this.output=new t.Volume,this.volume=this._volume.volume,this._readOnly("volume"),this.input.chain(this.output,this.context.destination)}.bind(this))},t.extend(t.Master,t.AudioNode),t.Master.defaults={volume:0,mute:!1},Object.defineProperty(t.Master.prototype,"mute",{get:function(){return this._volume.mute},set:function(e){this._volume.mute=e}}),t.Master.prototype.chain=function(){this.input.disconnect(),this.input.chain.apply(this.input,arguments),arguments[arguments.length-1].connect(this.output)},t.Master.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this),this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null},t.AudioNode.prototype.toMaster=function(){return this.connect(t.Master),this},window.AudioNode&&(AudioNode.prototype.toMaster=function(){return this.connect(t.Master),this});var n=t.Master;return t.Master=new n,t.Context.on("init",function(e){e.Master instanceof n?t.Master=e.Master:t.Master=new n,e.Master=t.Master}),t.Context.on("close",function(e){e.Master instanceof n&&e.Master.dispose()}),t.Master}),e(function(o){return o.Source=function(e){e=o.defaultArg(e,o.Source.defaults),o.AudioNode.call(this),this._volume=this.output=new o.Volume(e.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._state=new o.TimelineState(o.State.Stopped),this._state.memory=100,this._synced=!1,this._scheduled=[],this._volume.output.output.channelCount=2,this._volume.output.output.channelCountMode="explicit",this.mute=e.mute},o.extend(o.Source,o.AudioNode),o.Source.defaults={volume:0,mute:!1},Object.defineProperty(o.Source.prototype,"state",{get:function(){return this._synced?o.Transport.state===o.State.Started?this._state.getValueAtTime(o.Transport.seconds):o.State.Stopped:this._state.getValueAtTime(this.now())}}),Object.defineProperty(o.Source.prototype,"mute",{get:function(){return this._volume.mute},set:function(e){this._volume.mute=e}}),o.Source.prototype._start=o.noOp,o.Source.prototype.restart=o.noOp,o.Source.prototype._stop=o.noOp,o.Source.prototype.start=function(e,t,n){if(e=o.isUndef(e)&&this._synced?o.Transport.seconds:this.toSeconds(e),this._state.getValueAtTime(e)===o.State.Started)this._state.cancel(e),this._state.setStateAtTime(o.State.Started,e),this.restart(e,t,n);else if(this._state.setStateAtTime(o.State.Started,e),this._synced){var r=this._state.get(e);r.offset=o.defaultArg(t,0),r.duration=n;var i=o.Transport.schedule(function(e){this._start(e,t,n)}.bind(this),e);this._scheduled.push(i),o.Transport.state===o.State.Started&&this._syncedStart(this.now(),o.Transport.seconds)}else this._start.apply(this,arguments);return this},o.Source.prototype.stop=function(e){if(e=o.isUndef(e)&&this._synced?o.Transport.seconds:this.toSeconds(e),this._synced){var t=o.Transport.schedule(this._stop.bind(this),e);this._scheduled.push(t)}else this._stop.apply(this,arguments);return this._state.cancel(e),this._state.setStateAtTime(o.State.Stopped,e),this},o.Source.prototype.sync=function(){return this._synced=!0,this._syncedStart=function(e,t){if(0<t){var n=this._state.get(t);if(n&&n.state===o.State.Started&&n.time!==t){var r,i=t-this.toSeconds(n.time);n.duration&&(r=this.toSeconds(n.duration)-i),this._start(e,this.toSeconds(n.offset)+i,r)}}}.bind(this),this._syncedStop=function(e){var t=o.Transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(t)===o.State.Started&&this._stop(e)}.bind(this),o.Transport.on("start loopStart",this._syncedStart),o.Transport.on("stop pause loopEnd",this._syncedStop),this},o.Source.prototype.unsync=function(){this._synced&&(o.Transport.off("stop pause loopEnd",this._syncedStop),o.Transport.off("start loopStart",this._syncedStart)),this._synced=!1;for(var e=0;e<this._scheduled.length;e++){var t=this._scheduled[e];o.Transport.clear(t)}return this._scheduled=[],this._state.cancel(0),this},o.Source.prototype.dispose=function(){o.AudioNode.prototype.dispose.call(this),this.unsync(),this._scheduled=null,this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null,this._state.dispose(),this._state=null},o.Source}),e(function(e){e.supported&&(AudioBuffer.prototype.copyToChannel||(AudioBuffer.prototype.copyToChannel=function(e,t,n){var r=this.getChannelData(t);n=n||0;for(var i=0;i<r.length;i++)r[i+n]=e[i]},AudioBuffer.prototype.copyFromChannel=function(e,t,n){var r=this.getChannelData(t);n=n||0;for(var i=0;i<e.length;i++)e[i]=r[i+n]}))}),e(function(c){return c.Buffer=function(){var e=c.defaults(arguments,["url","onload","onerror"],c.Buffer);c.call(this),this._buffer=null,this._reversed=e.reverse,this._xhr=null,this._onload=c.noOp,e.url instanceof AudioBuffer||e.url instanceof c.Buffer?(this.set(e.url),e.onload&&(this.loaded?e.onload(this):this._onload=e.onload)):c.isString(e.url)&&this.load(e.url).then(e.onload).catch(e.onerror)},c.extend(c.Buffer),c.Buffer.defaults={url:void 0,reverse:!1,onload:c.noOp,onerror:c.noOp},c.Buffer.prototype.set=function(e){return e instanceof c.Buffer?e.loaded?this._buffer=e.get():e._onload=function(){this.set(e),this._onload(this)}.bind(this):this._buffer=e,this},c.Buffer.prototype.get=function(){return this._buffer},c.Buffer.prototype.load=function(e,r,i){return new Promise(function(t,n){this._xhr=c.Buffer.load(e,function(e){this._xhr=null,this.set(e),t(this),this._onload(this),r&&r(this)}.bind(this),function(e){this._xhr=null,n(e),i&&i(e)}.bind(this))}.bind(this))},c.Buffer.prototype.dispose=function(){return c.prototype.dispose.call(this),this._buffer=null,this._xhr&&(c.Buffer._removeFromDownloadQueue(this._xhr),this._xhr.abort(),this._xhr=null),this},Object.defineProperty(c.Buffer.prototype,"loaded",{get:function(){return 0<this.length}}),Object.defineProperty(c.Buffer.prototype,"duration",{get:function(){return this._buffer?this._buffer.duration:0}}),Object.defineProperty(c.Buffer.prototype,"length",{get:function(){return this._buffer?this._buffer.length:0}}),Object.defineProperty(c.Buffer.prototype,"numberOfChannels",{get:function(){return this._buffer?this._buffer.numberOfChannels:0}}),c.Buffer.prototype.fromArray=function(e){var t=0<e[0].length,n=t?e.length:1,r=t?e[0].length:e.length,i=this.context.createBuffer(n,r,this.context.sampleRate);t||1!==n||(e=[e]);for(var o=0;o<n;o++)i.copyToChannel(e[o],o);return this._buffer=i,this},c.Buffer.prototype.toMono=function(e){if(c.isNumber(e))this.fromArray(this.toArray(e));else{for(var t=new Float32Array(this.length),n=this.numberOfChannels,r=0;r<n;r++)for(var i=this.toArray(r),o=0;o<i.length;o++)t[o]+=i[o];t=t.map(function(e){return e/n}),this.fromArray(t)}return this},c.Buffer.prototype.toArray=function(e){if(c.isNumber(e))return this.getChannelData(e);if(1===this.numberOfChannels)return this.toArray(0);for(var t=[],n=0;n<this.numberOfChannels;n++)t[n]=this.getChannelData(n);return t},c.Buffer.prototype.getChannelData=function(e){return this._buffer.getChannelData(e)},c.Buffer.prototype.slice=function(e,t){t=c.defaultArg(t,this.duration);for(var n=Math.floor(this.context.sampleRate*this.toSeconds(e)),r=Math.floor(this.context.sampleRate*this.toSeconds(t)),i=[],o=0;o<this.numberOfChannels;o++)i[o]=this.toArray(o).slice(n,r);return(new c.Buffer).fromArray(i)},c.Buffer.prototype._reverse=function(){if(this.loaded)for(var e=0;e<this.numberOfChannels;e++)Array.prototype.reverse.call(this.getChannelData(e));return this},Object.defineProperty(c.Buffer.prototype,"reverse",{get:function(){return this._reversed},set:function(e){this._reversed!==e&&(this._reversed=e,this._reverse())}}),c.Emitter.mixin(c.Buffer),c.Buffer._downloadQueue=[],c.Buffer.baseUrl="",c.Buffer.fromArray=function(e){return(new c.Buffer).fromArray(e)},c.Buffer.fromUrl=function(e){var t=new c.Buffer;return t.load(e).then(function(){return t})},c.Buffer._removeFromDownloadQueue=function(e){var t=c.Buffer._downloadQueue.indexOf(e);-1!==t&&c.Buffer._downloadQueue.splice(t,1)},c.Buffer.load=function(e,t,n){t=c.defaultArg(t,c.noOp);var r=e.match(/\[(.+\|?)+\]$/);if(r){for(var i=r[1].split("|"),o=i[0],a=0;a<i.length;a++)if(c.Buffer.supportsType(i[a])){o=i[a];break}e=e.replace(r[0],o)}function s(e){if(c.Buffer._removeFromDownloadQueue(l),c.Buffer.emit("error",e),!n)throw e;n(e)}function u(){for(var e=0,t=0;t<c.Buffer._downloadQueue.length;t++)e+=c.Buffer._downloadQueue[t].progress;c.Buffer.emit("progress",e/c.Buffer._downloadQueue.length)}var l=new XMLHttpRequest;return l.open("GET",c.Buffer.baseUrl+e,!0),l.responseType="arraybuffer",l.progress=0,c.Buffer._downloadQueue.push(l),l.addEventListener("load",function(){200===l.status?c.context.decodeAudioData(l.response).then(function(e){l.progress=1,u(),t(e),c.Buffer._removeFromDownloadQueue(l),0===c.Buffer._downloadQueue.length&&c.Buffer.emit("load")}).catch(function(){c.Buffer._removeFromDownloadQueue(l),s("Tone.Buffer: could not decode audio data: "+e)}):s("Tone.Buffer: could not locate file: "+e)}),l.addEventListener("error",s),l.addEventListener("progress",function(e){e.lengthComputable&&(l.progress=e.loaded/e.total*.95,u())}),l.send(),l},c.Buffer.cancelDownloads=function(){return c.Buffer._downloadQueue.slice().forEach(function(e){c.Buffer._removeFromDownloadQueue(e),e.abort()}),c.Buffer},c.Buffer.supportsType=function(e){var t=e.split(".");return t=t[t.length-1],""!==document.createElement("audio").canPlayType("audio/"+t)},c.loaded=function(){var n,r;function t(){c.Buffer.off("load",n),c.Buffer.off("error",r)}return new Promise(function(e,t){n=function(){e()},r=function(){t()},c.Buffer.on("load",n),c.Buffer.on("error",r)}).then(t).catch(function(e){throw t(),new Error(e)})},c.Buffer}),e(function(t){return t.OscillatorNode=function(){var e=t.defaults(arguments,["frequency","type"],t.OscillatorNode);t.AudioNode.call(this,e),this.onended=e.onended,this._startTime=-1,this._stopTime=-1,this._gainNode=this.output=new t.Gain,this._gainNode.gain.setValueAtTime(0,this.context.currentTime),this._oscillator=this.context.createOscillator(),this._oscillator.connect(this._gainNode),this.type=e.type,this.frequency=new t.Param(this._oscillator.frequency,t.Type.Frequency),this.frequency.value=e.frequency,this.detune=new t.Param(this._oscillator.detune,t.Type.Cents),this.detune.value=e.detune,this._gain=1},t.extend(t.OscillatorNode,t.AudioNode),t.OscillatorNode.defaults={frequency:440,detune:0,type:"sine",onended:t.noOp},Object.defineProperty(t.OscillatorNode.prototype,"state",{get:function(){return this.getStateAtTime(this.now())}}),t.OscillatorNode.prototype.getStateAtTime=function(e){return e=this.toSeconds(e),-1!==this._startTime&&e>=this._startTime&&(-1===this._stopTime||e<=this._stopTime)?t.State.Started:t.State.Stopped},t.OscillatorNode.prototype.start=function(e){if(-1!==this._startTime)throw new Error("cannot call OscillatorNode.start more than once");this._startTime=this.toSeconds(e),this._oscillator.start(this._startTime);var t=this.context.currentTime;return this._gainNode.gain.cancelScheduledValues(t),this._gainNode.gain.setValueAtTime(0,t),this._gainNode.gain.setValueAtTime(1,this._startTime),this},t.OscillatorNode.prototype.setPeriodicWave=function(e){return this._oscillator.setPeriodicWave(e),this},t.OscillatorNode.prototype.stop=function(e){return this.cancelStop(),this._stopTime=this.toSeconds(e),this._gainNode.gain.setValueAtTime(0,this._stopTime),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(function(){this._oscillator.stop(this.now()),this.onended()}.bind(this),this._stopTime-this.now()),this},t.OscillatorNode.prototype.cancelStop=function(){return-1!==this._startTime&&(this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this._gainNode.gain.setValueAtTime(1,Math.max(this.now(),this._startTime)),this.context.clearTimeout(this._timeout),this._stopTime=-1),this},Object.defineProperty(t.OscillatorNode.prototype,"type",{get:function(){return this._oscillator.type},set:function(e){this._oscillator.type=e}}),t.OscillatorNode.prototype.dispose=function(){return this.context.clearTimeout(this._timeout),t.AudioNode.prototype.dispose.call(this),this.onended=null,this._oscillator.disconnect(),this._oscillator=null,this._gainNode.dispose(),this._gainNode=null,this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this},t.OscillatorNode}),e(function(c){return c.Oscillator=function(){var e=c.defaults(arguments,["frequency","type"],c.Oscillator);c.Source.call(this,e),this._oscillator=null,this.frequency=new c.Signal(e.frequency,c.Type.Frequency),this.detune=new c.Signal(e.detune,c.Type.Cents),this._wave=null,this._partials=c.defaultArg(e.partials,[1]),this._phase=e.phase,this._type=null,this.type=e.type,this.phase=this._phase,this._readOnly(["frequency","detune"])},c.extend(c.Oscillator,c.Source),c.Oscillator.defaults={type:"sine",frequency:440,detune:0,phase:0,partials:[]},c.Oscillator.Type={Sine:"sine",Triangle:"triangle",Sawtooth:"sawtooth",Square:"square",Custom:"custom"},c.Oscillator.prototype._start=function(e){this._oscillator=new c.OscillatorNode,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),e=this.toSeconds(e),this._oscillator.start(e)},c.Oscillator.prototype._stop=function(e){return this._oscillator&&(e=this.toSeconds(e),this._oscillator.stop(e)),this},c.Oscillator.prototype.restart=function(e){return this._oscillator.cancelStop(),this._state.cancel(this.toSeconds(e)),this},c.Oscillator.prototype.syncFrequency=function(){return c.Transport.syncSignal(this.frequency),this},c.Oscillator.prototype.unsyncFrequency=function(){return c.Transport.unsyncSignal(this.frequency),this},Object.defineProperty(c.Oscillator.prototype,"type",{get:function(){return this._type},set:function(e){var t=[c.Oscillator.Type.Sine,c.Oscillator.Type.Square,c.Oscillator.Type.Triangle,c.Oscillator.Type.Sawtooth].includes(e);if(0===this._phase&&t)(this._wave=null)!==this._oscillator&&this._oscillator.type;else{var n=this._getRealImaginary(e,this._phase),r=this.context.createPeriodicWave(n[0],n[1]);this._wave=r,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}this._type=e}}),c.Oscillator.prototype._getRealImaginary=function(e,t){var n=2048,r=new Float32Array(n),i=new Float32Array(n),o=1;if(e===c.Oscillator.Type.Custom)n=o=this._partials.length+1;else{var a=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);a&&(o=parseInt(a[2])+1,e=a[1],n=o=Math.max(o,2))}for(var s=1;s<n;++s){var u,l=2/(s*Math.PI);switch(e){case c.Oscillator.Type.Sine:u=s<=o?1:0;break;case c.Oscillator.Type.Square:u=1&s?2*l:0;break;case c.Oscillator.Type.Sawtooth:u=l*(1&s?1:-1);break;case c.Oscillator.Type.Triangle:u=1&s?l*l*2*(s-1>>1&1?-1:1):0;break;case c.Oscillator.Type.Custom:u=this._partials[s-1];break;default:throw new TypeError("Tone.Oscillator: invalid type: "+e)}0!==u?(r[s]=-u*Math.sin(t*s),i[s]=u*Math.cos(t*s)):(r[s]=0,i[s]=0)}return[r,i]},c.Oscillator.prototype._inverseFFT=function(e,t,n){for(var r=0,i=e.length,o=0;o<i;o++)r+=e[o]*Math.cos(o*n)+t[o]*Math.sin(o*n);return r},c.Oscillator.prototype._getInitialValue=function(){for(var e=this._getRealImaginary(this._type,0),t=e[0],n=e[1],r=0,i=2*Math.PI,o=0;o<8;o++)r=Math.max(this._inverseFFT(t,n,o/8*i),r);return-this._inverseFFT(t,n,this._phase)/r},Object.defineProperty(c.Oscillator.prototype,"partials",{get:function(){return this._type!==c.Oscillator.Type.Custom?[]:this._partials},set:function(e){this._partials=e,this.type=c.Oscillator.Type.Custom}}),Object.defineProperty(c.Oscillator.prototype,"phase",{get:function(){return this._phase*(180/Math.PI)},set:function(e){this._phase=e*Math.PI/180,this.type=this._type}}),c.Oscillator.prototype.dispose=function(){return c.Source.prototype.dispose.call(this),null!==this._oscillator&&(this._oscillator.dispose(),this._oscillator=null),this._wave=null,this._writable(["frequency","detune"]),this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this._partials=null,this},c.Oscillator}),e(function(e){return e.AudioToGain=function(){e.SignalBase.call(this),this._norm=this.input=this.output=new e.WaveShaper(function(e){return(e+1)/2})},e.extend(e.AudioToGain,e.SignalBase),e.AudioToGain.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},e.AudioToGain}),e(function(e){return e.Zero=function(){e.SignalBase.call(this),this._gain=this.input=this.output=new e.Gain,this.context.getConstant(0).connect(this._gain)},e.extend(e.Zero,e.SignalBase),e.Zero.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._gain.dispose(),this._gain=null,this},e.Zero}),e(function(t){return t.LFO=function(){var e=t.defaults(arguments,["frequency","min","max"],t.LFO);t.AudioNode.call(this),this._oscillator=new t.Oscillator({frequency:e.frequency,type:e.type}),this.frequency=this._oscillator.frequency,this.amplitude=this._oscillator.volume,this.amplitude.units=t.Type.NormalRange,this.amplitude.value=e.amplitude,this._stoppedSignal=new t.Signal(0,t.Type.AudioRange),this._zeros=new t.Zero,this._stoppedValue=0,this._a2g=new t.AudioToGain,this._scaler=this.output=new t.Scale(e.min,e.max),this._units=t.Type.Default,this.units=e.units,this._oscillator.chain(this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),this._readOnly(["amplitude","frequency"]),this.phase=e.phase},t.extend(t.LFO,t.AudioNode),t.LFO.defaults={type:"sine",min:0,max:1,phase:0,frequency:"4n",amplitude:1,units:t.Type.Default},t.LFO.prototype.start=function(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(0,e),this._oscillator.start(e),this},t.LFO.prototype.stop=function(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(this._stoppedValue,e),this._oscillator.stop(e),this},t.LFO.prototype.sync=function(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this},t.LFO.prototype.unsync=function(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this},Object.defineProperty(t.LFO.prototype,"min",{get:function(){return this._toUnits(this._scaler.min)},set:function(e){e=this._fromUnits(e),this._scaler.min=e}}),Object.defineProperty(t.LFO.prototype,"max",{get:function(){return this._toUnits(this._scaler.max)},set:function(e){e=this._fromUnits(e),this._scaler.max=e}}),Object.defineProperty(t.LFO.prototype,"type",{get:function(){return this._oscillator.type},set:function(e){this._oscillator.type=e,this._stoppedValue=this._oscillator._getInitialValue(),this._stoppedSignal.value=this._stoppedValue}}),Object.defineProperty(t.LFO.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(e){this._oscillator.phase=e,this._stoppedValue=this._oscillator._getInitialValue(),this._stoppedSignal.value=this._stoppedValue}}),Object.defineProperty(t.LFO.prototype,"units",{get:function(){return this._units},set:function(e){var t=this.min,n=this.max;this._units=e,this.min=t,this.max=n}}),Object.defineProperty(t.LFO.prototype,"mute",{get:function(){return this._oscillator.mute},set:function(e){this._oscillator.mute=e}}),Object.defineProperty(t.LFO.prototype,"state",{get:function(){return this._oscillator.state}}),t.LFO.prototype.connect=function(e){return e.constructor!==t.Signal&&e.constructor!==t.Param||(this.convert=e.convert,this.units=e.units),t.SignalBase.prototype.connect.apply(this,arguments),this},t.LFO.prototype._fromUnits=t.Param.prototype._fromUnits,t.LFO.prototype._toUnits=t.Param.prototype._toUnits,t.LFO.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["amplitude","frequency"]),this._oscillator.dispose(),this._oscillator=null,this._stoppedSignal.dispose(),this._stoppedSignal=null,this._zeros.dispose(),this._zeros=null,this._scaler.dispose(),this._scaler=null,this._a2g.dispose(),this._a2g=null,this.frequency=null,this.amplitude=null,this},t.LFO}),e(function(t){return t.Limiter=function(){var e=t.defaults(arguments,["threshold"],t.Limiter);t.AudioNode.call(this),this._compressor=this.input=this.output=new t.Compressor({attack:.001,decay:.001,threshold:e.threshold}),this.threshold=this._compressor.threshold,this._readOnly("threshold")},t.extend(t.Limiter,t.AudioNode),t.Limiter.defaults={threshold:-12},t.Limiter.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._compressor.dispose(),this._compressor=null,this._writable("threshold"),this.threshold=null,this},t.Limiter}),e(function(t){return t.LowpassCombFilter=function(){var e=t.defaults(arguments,["delayTime","resonance","dampening"],t.LowpassCombFilter);t.AudioNode.call(this),this.createInsOuts(1,1),this._delay=this.input=new t.Delay(e.delayTime),this.delayTime=this._delay.delayTime,this._lowpass=this.output=this.context.createBiquadFilter(),this._lowpass.Q.value=-3.0102999566398125,this._lowpass.type="lowpass",this.dampening=new t.Param({param:this._lowpass.frequency,units:t.Type.Frequency,value:e.dampening}),this._feedback=new t.Gain(e.resonance,t.Type.NormalRange),this.resonance=this._feedback.gain,this._delay.chain(this._lowpass,this._feedback,this._delay),this._readOnly(["dampening","resonance","delayTime"])},t.extend(t.LowpassCombFilter,t.AudioNode),t.LowpassCombFilter.defaults={delayTime:.1,resonance:.5,dampening:3e3},t.LowpassCombFilter.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["dampening","resonance","delayTime"]),this.dampening.dispose(),this.dampening=null,this.resonance.dispose(),this.resonance=null,this._delay.dispose(),this._delay=null,this.delayTime=null,this._lowpass.disconnect(),this._lowpass=null,this._feedback.disconnect(),this._feedback=null,this},t.LowpassCombFilter}),e(function(e){return e.Merge=function(){e.AudioNode.call(this),this.createInsOuts(2,0),this.left=this.input[0]=new e.Gain,this.right=this.input[1]=new e.Gain,this._merger=this.output=this.context.createChannelMerger(2),this.left.connect(this._merger,0,0),this.right.connect(this._merger,0,1),this.left.channelCount=1,this.right.channelCount=1,this.left.channelCountMode="explicit",this.right.channelCountMode="explicit"},e.extend(e.Merge,e.AudioNode),e.Merge.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this.left.dispose(),this.left=null,this.right.dispose(),this.right=null,this._merger.disconnect(),this._merger=null,this},e.Merge}),e(function(t){return t.Meter=function(){var e=t.defaults(arguments,["smoothing"],t.Meter);t.AudioNode.call(this),this.input=this.output=this._analyser=new t.Analyser("waveform",1024),this.smoothing=e.smoothing},t.extend(t.Meter,t.AudioNode),t.Meter.defaults={smoothing:.8},t.Meter.prototype.getLevel=function(){this._analyser.type="fft";var e=this._analyser.getValue();return Math.max.apply(this,e)+28},t.Meter.prototype.getValue=function(){return this._analyser.type="waveform",this._analyser.getValue()[0]},Object.defineProperty(t.Meter.prototype,"smoothing",{get:function(){return this._analyser.smoothing},set:function(e){this._analyser.smoothing=e}}),t.Meter.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._analyser.dispose(),this._analyser=null,this},t.Meter}),e(function(e){return e.Split=function(){e.AudioNode.call(this),this.createInsOuts(0,2),this._splitter=this.input=this.context.createChannelSplitter(2),this._splitter.channelCount=2,this._splitter.channelCountMode="explicit",this.left=this.output[0]=new e.Gain,this.right=this.output[1]=new e.Gain,this._splitter.connect(this.left,0,0),this._splitter.connect(this.right,1,0)},e.extend(e.Split,e.AudioNode),e.Split.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._splitter.disconnect(),this.left.dispose(),this.left=null,this.right.dispose(),this.right=null,this._splitter=null,this},e.Split}),e(function(e){return e.MidSideSplit=function(){e.AudioNode.call(this),this.createInsOuts(0,2),this._split=this.input=new e.Split,this._midAdd=new e.Add,this.mid=this.output[0]=new e.Multiply(Math.SQRT1_2),this._sideSubtract=new e.Subtract,this.side=this.output[1]=new e.Multiply(Math.SQRT1_2),this._split.connect(this._midAdd,0,0),this._split.connect(this._midAdd,1,1),this._split.connect(this._sideSubtract,0,0),this._split.connect(this._sideSubtract,1,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)},e.extend(e.MidSideSplit,e.AudioNode),e.MidSideSplit.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._midAdd.dispose(),this._midAdd=null,this._sideSubtract.dispose(),this._sideSubtract=null,this._split.dispose(),this._split=null,this},e.MidSideSplit}),e(function(e){return e.MidSideMerge=function(){e.AudioNode.call(this),this.createInsOuts(2,0),this.mid=this.input[0]=new e.Gain,this._left=new e.Add,this._timesTwoLeft=new e.Multiply(Math.SQRT1_2),this.side=this.input[1]=new e.Gain,this._right=new e.Subtract,this._timesTwoRight=new e.Multiply(Math.SQRT1_2),this._merge=this.output=new e.Merge,this.mid.connect(this._left,0,0),this.side.connect(this._left,0,1),this.mid.connect(this._right,0,0),this.side.connect(this._right,0,1),this._left.connect(this._timesTwoLeft),this._right.connect(this._timesTwoRight),this._timesTwoLeft.connect(this._merge,0,0),this._timesTwoRight.connect(this._merge,0,1)},e.extend(e.MidSideMerge,e.AudioNode),e.MidSideMerge.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._left.dispose(),this._left=null,this._timesTwoLeft.dispose(),this._timesTwoLeft=null,this._right.dispose(),this._right=null,this._timesTwoRight.dispose(),this._timesTwoRight=null,this._merge.dispose(),this._merge=null,this},e.MidSideMerge}),e(function(t){return t.MidSideCompressor=function(e){t.AudioNode.call(this),e=t.defaultArg(e,t.MidSideCompressor.defaults),this._midSideSplit=this.input=new t.MidSideSplit,this._midSideMerge=this.output=new t.MidSideMerge,this.mid=new t.Compressor(e.mid),this.side=new t.Compressor(e.side),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),this._readOnly(["mid","side"])},t.extend(t.MidSideCompressor,t.AudioNode),t.MidSideCompressor.defaults={mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}},t.MidSideCompressor.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["mid","side"]),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._midSideSplit.dispose(),this._midSideSplit=null,this._midSideMerge.dispose(),this._midSideMerge=null,this},t.MidSideCompressor}),e(function(e){return e.Mono=function(){e.AudioNode.call(this),this.createInsOuts(1,0),this._merge=this.output=new e.Merge,this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1)},e.extend(e.Mono,e.AudioNode),e.Mono.prototype.dispose=function(){return e.AudioNode.prototype.dispose.call(this),this._merge.dispose(),this._merge=null,this},e.Mono}),e(function(t){return t.MultibandCompressor=function(e){t.AudioNode.call(this),e=t.defaultArg(arguments,t.MultibandCompressor.defaults),this._splitter=this.input=new t.MultibandSplit({lowFrequency:e.lowFrequency,highFrequency:e.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new t.Gain,this.low=new t.Compressor(e.low),this.mid=new t.Compressor(e.mid),this.high=new t.Compressor(e.high),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),this._readOnly(["high","mid","low","highFrequency","lowFrequency"])},t.extend(t.MultibandCompressor,t.AudioNode),t.MultibandCompressor.defaults={low:t.Compressor.defaults,mid:t.Compressor.defaults,high:t.Compressor.defaults,lowFrequency:250,highFrequency:2e3},t.MultibandCompressor.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._splitter.dispose(),this._writable(["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this._splitter=null,this.low=null,this.mid=null,this.high=null,this.lowFrequency=null,this.highFrequency=null,this},t.MultibandCompressor}),e(function(s){if(s.supported&&!window.StereoPannerNode){var e=function(e){this.context=e,this.pan=new s.Signal(0,s.Type.AudioRange);var t=new s.WaveShaper(function(e){return s.equalPowerScale((e+1)/2)},4096),n=new s.WaveShaper(function(e){return s.equalPowerScale(1-(e+1)/2)},4096),r=new s.Gain,i=new s.Gain,o=this.input=new s.Split;(new s.Zero).fan(t,n);var a=this.output=new s.Merge;o.left.chain(r,a.left),o.right.chain(i,a.right),this.pan.chain(n,r.gain),this.pan.chain(t,i.gain)};e.prototype.disconnect=function(){this.output.disconnect.apply(this.output,arguments)},e.prototype.connect=function(){this.output.connect.apply(this.output,arguments)},AudioContext.prototype.createStereoPanner=function(){return new e(this)},s.Context.prototype.createStereoPanner=function(){return new e(this)}}}),e(function(t){return t.Panner=function(e){t.AudioNode.call(this),this._panner=this.input=this.output=this.context.createStereoPanner(),this.pan=this._panner.pan,this.pan.value=t.defaultArg(e,0),this._readOnly("pan")},t.extend(t.Panner,t.AudioNode),t.Panner.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable("pan"),this._panner.disconnect(),this._panner=null,this.pan=null,this},t.Panner}),e(function(n){return n.Panner3D=function(){var e=n.defaults(arguments,["positionX","positionY","positionZ"],n.Panner3D);n.AudioNode.call(this),this._panner=this.input=this.output=this.context.createPanner(),this._panner.panningModel=e.panningModel,this._panner.maxDistance=e.maxDistance,this._panner.distanceModel=e.distanceModel,this._panner.coneOuterGain=e.coneOuterGain,this._panner.coneOuterAngle=e.coneOuterAngle,this._panner.coneInnerAngle=e.coneInnerAngle,this._panner.refDistance=e.refDistance,this._panner.rolloffFactor=e.rolloffFactor,this._orientation=[e.orientationX,e.orientationY,e.orientationZ],this._position=[e.positionX,e.positionY,e.positionZ],this.orientationX=e.orientationX,this.orientationY=e.orientationY,this.orientationZ=e.orientationZ,this.positionX=e.positionX,this.positionY=e.positionY,this.positionZ=e.positionZ},n.extend(n.Panner3D,n.AudioNode),n.Panner3D.defaults={positionX:0,positionY:0,positionZ:0,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",maxDistance:1e4,distanceModel:"inverse",coneOuterGain:0,coneOuterAngle:360,coneInnerAngle:360,refDistance:1,rolloffFactor:1},n.Panner3D.prototype._rampTimeConstant=.01,n.Panner3D.prototype.setPosition=function(e,t,n){if(this._panner.positionX){var r=this.now();this._panner.positionX.setTargetAtTime(e,r,this._rampTimeConstant),this._panner.positionY.setTargetAtTime(t,r,this._rampTimeConstant),this._panner.positionZ.setTargetAtTime(n,r,this._rampTimeConstant)}else this._panner.setPosition(e,t,n);return this._position=Array.prototype.slice.call(arguments),this},n.Panner3D.prototype.setOrientation=function(e,t,n){if(this._panner.orientationX){var r=this.now();this._panner.orientationX.setTargetAtTime(e,r,this._rampTimeConstant),this._panner.orientationY.setTargetAtTime(t,r,this._rampTimeConstant),this._panner.orientationZ.setTargetAtTime(n,r,this._rampTimeConstant)}else this._panner.setOrientation(e,t,n);return this._orientation=Array.prototype.slice.call(arguments),this},Object.defineProperty(n.Panner3D.prototype,"positionX",{set:function(e){this._position[0]=e,this.setPosition.apply(this,this._position)},get:function(){return this._position[0]}}),Object.defineProperty(n.Panner3D.prototype,"positionY",{set:function(e){this._position[1]=e,this.setPosition.apply(this,this._position)},get:function(){return this._position[1]}}),Object.defineProperty(n.Panner3D.prototype,"positionZ",{set:function(e){this._position[2]=e,this.setPosition.apply(this,this._position)},get:function(){return this._position[2]}}),Object.defineProperty(n.Panner3D.prototype,"orientationX",{set:function(e){this._orientation[0]=e,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[0]}}),Object.defineProperty(n.Panner3D.prototype,"orientationY",{set:function(e){this._orientation[1]=e,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[1]}}),Object.defineProperty(n.Panner3D.prototype,"orientationZ",{set:function(e){this._orientation[2]=e,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[2]}}),n.Panner3D._aliasProperty=function(t){Object.defineProperty(n.Panner3D.prototype,t,{set:function(e){this._panner[t]=e},get:function(){return this._panner[t]}})},n.Panner3D._aliasProperty("panningModel"),n.Panner3D._aliasProperty("refDistance"),n.Panner3D._aliasProperty("rolloffFactor"),n.Panner3D._aliasProperty("distanceModel"),n.Panner3D._aliasProperty("coneInnerAngle"),n.Panner3D._aliasProperty("coneOuterAngle"),n.Panner3D._aliasProperty("coneOuterGain"),n.Panner3D._aliasProperty("maxDistance"),n.Panner3D.prototype.dispose=function(){return n.AudioNode.prototype.dispose.call(this),this._panner.disconnect(),this._panner=null,this._orientation=null,this._position=null,this},n.Panner3D}),e(function(t){return t.PanVol=function(){var e=t.defaults(arguments,["pan","volume"],t.PanVol);t.AudioNode.call(this),this._panner=this.input=new t.Panner(e.pan),this.pan=this._panner.pan,this._volume=this.output=new t.Volume(e.volume),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,this._readOnly(["pan","volume"])},t.extend(t.PanVol,t.AudioNode),t.PanVol.defaults={pan:0,volume:0,mute:!1},Object.defineProperty(t.PanVol.prototype,"mute",{get:function(){return this._volume.mute},set:function(e){this._volume.mute=e}}),t.PanVol.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["pan","volume"]),this._panner.dispose(),this._panner=null,this.pan=null,this._volume.dispose(),this._volume=null,this.volume=null,this},t.PanVol}),e(function(t){return t.Solo=function(){var e=t.defaults(arguments,["solo"],t.Solo);t.AudioNode.call(this),this.input=this.output=new t.Gain,this._soloBind=this._soloed.bind(this),this.context.on("solo",this._soloBind),this.solo=e.solo},t.extend(t.Solo,t.AudioNode),t.Solo.defaults={solo:!1},Object.defineProperty(t.Solo.prototype,"solo",{get:function(){return this._isSoloed()},set:function(e){e?this._addSolo():this._removeSolo(),this.context.emit("solo",this)}}),Object.defineProperty(t.Solo.prototype,"muted",{get:function(){return 0===this.input.gain.value}}),t.Solo.prototype._addSolo=function(){t.isArray(this.context._currentSolo)||(this.context._currentSolo=[]),this._isSoloed()||this.context._currentSolo.push(this)},t.Solo.prototype._removeSolo=function(){if(this._isSoloed()){var e=this.context._currentSolo.indexOf(this);this.context._currentSolo.splice(e,1)}},t.Solo.prototype._isSoloed=function(){return!!t.isArray(this.context._currentSolo)&&(0!==this.context._currentSolo.length&&-1!==this.context._currentSolo.indexOf(this))},t.Solo.prototype._noSolos=function(){return!t.isArray(this.context._currentSolo)||0===this.context._currentSolo.length},t.Solo.prototype._soloed=function(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0},t.Solo.prototype.dispose=function(){return this.context.off("solo",this._soloBind),this._removeSolo(),this._soloBind=null,t.AudioNode.prototype.dispose.call(this),this},t.Solo}),e(function(t){return t.Waveform=function(){var e=t.defaults(arguments,["size"],t.Waveform);e.type=t.Analyser.Type.Waveform,t.AudioNode.call(this),this._analyser=this.input=this.output=new t.Analyser(e)},t.extend(t.Waveform,t.AudioNode),t.Waveform.defaults={size:1024},t.Waveform.prototype.getValue=function(){return this._analyser.getValue()},Object.defineProperty(t.Waveform.prototype,"size",{get:function(){return this._analyser.size},set:function(e){this._analyser.size=e}}),t.Waveform.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this),this._analyser.dispose(),this._analyser=null},t.Waveform}),e(function(s){return s.CtrlInterpolate=function(){var e=s.defaults(arguments,["values","index"],s.CtrlInterpolate);s.call(this),this.values=e.values,this.index=e.index},s.extend(s.CtrlInterpolate),s.CtrlInterpolate.defaults={index:0,values:[]},Object.defineProperty(s.CtrlInterpolate.prototype,"value",{get:function(){var e=this.index;e=Math.min(e,this.values.length-1);var t=Math.floor(e),n=this.values[t],r=this.values[Math.ceil(e)];return this._interpolate(e-t,n,r)}}),s.CtrlInterpolate.prototype._interpolate=function(e,t,n){if(s.isArray(t)){for(var r=[],i=0;i<t.length;i++)r[i]=this._interpolate(e,t[i],n[i]);return r}if(s.isObject(t)){var o={};for(var a in t)o[a]=this._interpolate(e,t[a],n[a]);return o}return(1-e)*(t=this._toNumber(t))+e*(n=this._toNumber(n))},s.CtrlInterpolate.prototype._toNumber=function(e){return s.isNumber(e)?e:this.toSeconds(e)},s.CtrlInterpolate.prototype.dispose=function(){this.values=null},s.CtrlInterpolate}),e(function(s){return s.CtrlMarkov=function(e,t){s.call(this),this.values=s.defaultArg(e,{}),this.value=s.defaultArg(t,Object.keys(this.values)[0])},s.extend(s.CtrlMarkov),s.CtrlMarkov.prototype.next=function(){if(this.values.hasOwnProperty(this.value)){var e=this.values[this.value];if(s.isArray(e))for(var t=this._getProbDistribution(e),n=Math.random(),r=0,i=0;i<t.length;i++){var o=t[i];if(r<n&&n<r+o){var a=e[i];s.isObject(a)?this.value=a.value:this.value=a}r+=o}else this.value=e}return this.value},s.CtrlMarkov.prototype._getProbDistribution=function(e){for(var t=[],n=0,r=!1,i=0;i<e.length;i++){var o=e[i];s.isObject(o)?(r=!0,t[i]=o.probability):t[i]=1/e.length,n+=t[i]}if(r)for(var a=0;a<t.length;a++)t[a]=t[a]/n;return t},s.CtrlMarkov.prototype.dispose=function(){this.values=null},s.CtrlMarkov}),e(function(t){return t.CtrlPattern=function(){var e=t.defaults(arguments,["values","type"],t.CtrlPattern);t.call(this),this.values=e.values,this.index=0,this._type=null,this._shuffled=null,this._direction=null,this.type=e.type},t.extend(t.CtrlPattern),t.CtrlPattern.Type={Up:"up",Down:"down",UpDown:"upDown",DownUp:"downUp",AlternateUp:"alternateUp",AlternateDown:"alternateDown",Random:"random",RandomWalk:"randomWalk",RandomOnce:"randomOnce"},t.CtrlPattern.defaults={type:t.CtrlPattern.Type.Up,values:[]},Object.defineProperty(t.CtrlPattern.prototype,"value",{get:function(){if(0!==this.values.length){if(1===this.values.length)return this.values[0];this.index=Math.min(this.index,this.values.length-1);var e=this.values[this.index];return this.type===t.CtrlPattern.Type.RandomOnce&&(this.values.length!==this._shuffled.length&&this._shuffleValues(),e=this.values[this._shuffled[this.index]]),e}}}),Object.defineProperty(t.CtrlPattern.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e,this._shuffled=null,this._type===t.CtrlPattern.Type.Up||this._type===t.CtrlPattern.Type.UpDown||this._type===t.CtrlPattern.Type.RandomOnce||this._type===t.CtrlPattern.Type.AlternateUp?this.index=0:this._type!==t.CtrlPattern.Type.Down&&this._type!==t.CtrlPattern.Type.DownUp&&this._type!==t.CtrlPattern.Type.AlternateDown||(this.index=this.values.length-1),this._type===t.CtrlPattern.Type.UpDown||this._type===t.CtrlPattern.Type.AlternateUp?this._direction=t.CtrlPattern.Type.Up:this._type!==t.CtrlPattern.Type.DownUp&&this._type!==t.CtrlPattern.Type.AlternateDown||(this._direction=t.CtrlPattern.Type.Down),this._type===t.CtrlPattern.Type.RandomOnce?this._shuffleValues():this._type===t.CtrlPattern.Random&&(this.index=Math.floor(Math.random()*this.values.length))}}),t.CtrlPattern.prototype.next=function(){var e=this.type;return e===t.CtrlPattern.Type.Up?(this.index++,this.index>=this.values.length&&(this.index=0)):e===t.CtrlPattern.Type.Down?(this.index--,this.index<0&&(this.index=this.values.length-1)):e===t.CtrlPattern.Type.UpDown||e===t.CtrlPattern.Type.DownUp?(this._direction===t.CtrlPattern.Type.Up?this.index++:this.index--,this.index<0?(this.index=1,this._direction=t.CtrlPattern.Type.Up):this.index>=this.values.length&&(this.index=this.values.length-2,this._direction=t.CtrlPattern.Type.Down)):e===t.CtrlPattern.Type.Random?this.index=Math.floor(Math.random()*this.values.length):e===t.CtrlPattern.Type.RandomWalk?Math.random()<.5?(this.index--,this.index=Math.max(this.index,0)):(this.index++,this.index=Math.min(this.index,this.values.length-1)):e===t.CtrlPattern.Type.RandomOnce?(this.index++,this.index>=this.values.length&&(this.index=0,this._shuffleValues())):e===t.CtrlPattern.Type.AlternateUp?(this._direction===t.CtrlPattern.Type.Up?(this.index+=2,this._direction=t.CtrlPattern.Type.Down):(this.index-=1,this._direction=t.CtrlPattern.Type.Up),this.index>=this.values.length&&(this.index=0,this._direction=t.CtrlPattern.Type.Up)):e===t.CtrlPattern.Type.AlternateDown&&(this._direction===t.CtrlPattern.Type.Up?(this.index+=1,this._direction=t.CtrlPattern.Type.Down):(this.index-=2,this._direction=t.CtrlPattern.Type.Up),this.index<0&&(this.index=this.values.length-1,this._direction=t.CtrlPattern.Type.Down)),this.value},t.CtrlPattern.prototype._shuffleValues=function(){var e=[];this._shuffled=[];for(var t=0;t<this.values.length;t++)e[t]=t;for(;0<e.length;){var n=e.splice(Math.floor(e.length*Math.random()),1);this._shuffled.push(n[0])}},t.CtrlPattern.prototype.dispose=function(){this._shuffled=null,this.values=null},t.CtrlPattern}),e(function(t){return t.CtrlRandom=function(){var e=t.defaults(arguments,["min","max"],t.CtrlRandom);t.call(this),this.min=e.min,this.max=e.max,this.integer=e.integer},t.extend(t.CtrlRandom),t.CtrlRandom.defaults={min:0,max:1,integer:!1},Object.defineProperty(t.CtrlRandom.prototype,"value",{get:function(){var e=this.toSeconds(this.min),t=this.toSeconds(this.max),n=Math.random(),r=n*e+(1-n)*t;return this.integer&&(r=Math.floor(r)),r}}),t.CtrlRandom}),e(function(i){return i.Buffers=function(e){var t=Array.prototype.slice.call(arguments);t.shift();var n=i.defaults(t,["onload","baseUrl"],i.Buffers);for(var r in i.call(this),this._buffers={},this.baseUrl=n.baseUrl,this._loadingCount=0,e)this._loadingCount++,this.add(r,e[r],this._bufferLoaded.bind(this,n.onload))},i.extend(i.Buffers),i.Buffers.defaults={onload:i.noOp,baseUrl:""},i.Buffers.prototype.has=function(e){return this._buffers.hasOwnProperty(e)},i.Buffers.prototype.get=function(e){if(this.has(e))return this._buffers[e];throw new Error("Tone.Buffers: no buffer named "+e)},i.Buffers.prototype._bufferLoaded=function(e){this._loadingCount--,0===this._loadingCount&&e&&e(this)},Object.defineProperty(i.Buffers.prototype,"loaded",{get:function(){var e=!0;for(var t in this._buffers){var n=this.get(t);e=e&&n.loaded}return e}}),i.Buffers.prototype.add=function(e,t,n){return n=i.defaultArg(n,i.noOp),t instanceof i.Buffer?(this._buffers[e]=t,n(this)):t instanceof AudioBuffer?(this._buffers[e]=new i.Buffer(t),n(this)):i.isString(t)&&(this._buffers[e]=new i.Buffer(this.baseUrl+t,n)),this},i.Buffers.prototype.dispose=function(){for(var e in i.prototype.dispose.call(this),this._buffers)this._buffers[e].dispose();return this._buffers=null,this},i.Buffers}),e(function(r){var i={};return r.prototype.send=function(e,t){i.hasOwnProperty(e)||(i[e]=this.context.createGain()),t=r.defaultArg(t,0);var n=new r.Gain(t,r.Type.Decibels);return this.connect(n),n.connect(i[e]),n},r.prototype.receive=function(e,t){return i.hasOwnProperty(e)||(i[e]=this.context.createGain()),i[e].connect(this,0,t),this},r.Context.on("init",function(e){e.Buses?i=e.Buses:(i={},e.Buses=i)}),r}),e(function(n){return n.Draw=function(){n.call(this),this._events=new n.Timeline,this.expiration=.25,this.anticipation=.008,this._boundDrawLoop=this._drawLoop.bind(this)},n.extend(n.Draw),n.Draw.prototype.schedule=function(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),1===this._events.length&&requestAnimationFrame(this._boundDrawLoop),this},n.Draw.prototype.cancel=function(e){return this._events.cancel(this.toSeconds(e)),this},n.Draw.prototype._drawLoop=function(){for(var e=n.now();this._events.length&&this._events.peek().time-this.anticipation<=e;){var t=this._events.shift();e-t.time<=this.expiration&&t.callback()}0<this._events.length&&requestAnimationFrame(this._boundDrawLoop)},n.Draw=new n.Draw,n.Draw}),e(function(t){t.Listener=function(){t.call(this),this._orientation=[0,0,0,0,0,0],this._position=[0,0,0],t.getContext(function(){this.set(n.defaults)}.bind(this))},t.extend(t.Listener),t.Listener.defaults={positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:1,upX:0,upY:1,upZ:0},t.Listener.prototype._rampTimeConstant=.01,t.Listener.prototype.setPosition=function(e,t,n){if(this.context.listener.positionX){var r=this.now();this.context.listener.positionX.setTargetAtTime(e,r,this._rampTimeConstant),this.context.listener.positionY.setTargetAtTime(t,r,this._rampTimeConstant),this.context.listener.positionZ.setTargetAtTime(n,r,this._rampTimeConstant)}else this.context.listener.setPosition(e,t,n);return this._position=Array.prototype.slice.call(arguments),this},t.Listener.prototype.setOrientation=function(e,t,n,r,i,o){if(this.context.listener.forwardX){var a=this.now();this.context.listener.forwardX.setTargetAtTime(e,a,this._rampTimeConstant),this.context.listener.forwardY.setTargetAtTime(t,a,this._rampTimeConstant),this.context.listener.forwardZ.setTargetAtTime(n,a,this._rampTimeConstant),this.context.listener.upX.setTargetAtTime(r,a,this._rampTimeConstant),this.context.listener.upY.setTargetAtTime(i,a,this._rampTimeConstant),this.context.listener.upZ.setTargetAtTime(o,a,this._rampTimeConstant)}else this.context.listener.setOrientation(e,t,n,r,i,o);return this._orientation=Array.prototype.slice.call(arguments),this},Object.defineProperty(t.Listener.prototype,"positionX",{set:function(e){this._position[0]=e,this.setPosition.apply(this,this._position)},get:function(){return this._position[0]}}),Object.defineProperty(t.Listener.prototype,"positionY",{set:function(e){this._position[1]=e,this.setPosition.apply(this,this._position)},get:function(){return this._position[1]}}),Object.defineProperty(t.Listener.prototype,"positionZ",{set:function(e){this._position[2]=e,this.setPosition.apply(this,this._position)},get:function(){return this._position[2]}}),Object.defineProperty(t.Listener.prototype,"forwardX",{set:function(e){this._orientation[0]=e,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[0]}}),Object.defineProperty(t.Listener.prototype,"forwardY",{set:function(e){this._orientation[1]=e,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[1]}}),Object.defineProperty(t.Listener.prototype,"forwardZ",{set:function(e){this._orientation[2]=e,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[2]}}),Object.defineProperty(t.Listener.prototype,"upX",{set:function(e){this._orientation[3]=e,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[3]}}),Object.defineProperty(t.Listener.prototype,"upY",{set:function(e){this._orientation[4]=e,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[4]}}),Object.defineProperty(t.Listener.prototype,"upZ",{set:function(e){this._orientation[5]=e,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[5]}}),t.Listener.prototype.dispose=function(){return this._orientation=null,this._position=null,this};var n=t.Listener;return t.Listener=new n,t.Context.on("init",function(e){e.Listener instanceof n?t.Listener=e.Listener:t.Listener=new n,e.Listener=t.Listener}),t.Listener}),e(function(u){return u.Offline=function(e,t){var n,r=u.context.sampleRate,i=u.context,o=function e(t,n,r,i){i=u.defaultArg(i,0);var o=new u.OfflineContext(2,n,r);u.context=o;var a=t(u.Transport);return 0<o.currentTime&&i<1e3?e(t,n,r,++i):{response:a,context:o}}(e,t,r),a=o.response,s=o.context;return n=a instanceof Promise?a.then(function(){return s.render()}):s.render(),u.context=i,n.then(function(e){return new u.Buffer(e)})},u.Offline}),e(function(t){return t.Effect=function(){var e=t.defaults(arguments,["wet"],t.Effect);t.AudioNode.call(this),this.createInsOuts(1,1),this._dryWet=new t.CrossFade(e.wet),this.wet=this._dryWet.fade,this.effectSend=new t.Gain,this.effectReturn=new t.Gain,this.input.connect(this._dryWet.a),this.input.connect(this.effectSend),this.effectReturn.connect(this._dryWet.b),this._dryWet.connect(this.output),this._readOnly(["wet"])},t.extend(t.Effect,t.AudioNode),t.Effect.defaults={wet:1},t.Effect.prototype.connectEffect=function(e){return this.effectSend.chain(e,this.effectReturn),this},t.Effect.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._dryWet.dispose(),this._dryWet=null,this.effectSend.dispose(),this.effectSend=null,this.effectReturn.dispose(),this.effectReturn=null,this._writable(["wet"]),this.wet=null,this},t.Effect}),e(function(t){return t.AutoFilter=function(){var e=t.defaults(arguments,["frequency","baseFrequency","octaves"],t.AutoFilter);t.Effect.call(this,e),this._lfo=new t.LFO({frequency:e.frequency,amplitude:e.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.filter=new t.Filter(e.filter),this._octaves=0,this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.type=e.type,this._readOnly(["frequency","depth"]),this.octaves=e.octaves,this.baseFrequency=e.baseFrequency},t.extend(t.AutoFilter,t.Effect),t.AutoFilter.defaults={frequency:1,type:"sine",depth:1,baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}},t.AutoFilter.prototype.start=function(e){return this._lfo.start(e),this},t.AutoFilter.prototype.stop=function(e){return this._lfo.stop(e),this},t.AutoFilter.prototype.sync=function(e){return this._lfo.sync(e),this},t.AutoFilter.prototype.unsync=function(){return this._lfo.unsync(),this},Object.defineProperty(t.AutoFilter.prototype,"type",{get:function(){return this._lfo.type},set:function(e){this._lfo.type=e}}),Object.defineProperty(t.AutoFilter.prototype,"baseFrequency",{get:function(){return this._lfo.min},set:function(e){this._lfo.min=this.toFrequency(e),this.octaves=this._octaves}}),Object.defineProperty(t.AutoFilter.prototype,"octaves",{get:function(){return this._octaves},set:function(e){this._octaves=e,this._lfo.max=this.baseFrequency*Math.pow(2,e)}}),t.AutoFilter.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._lfo.dispose(),this._lfo=null,this.filter.dispose(),this.filter=null,this._writable(["frequency","depth"]),this.frequency=null,this.depth=null,this},t.AutoFilter}),e(function(t){return t.AutoPanner=function(){var e=t.defaults(arguments,["frequency"],t.AutoPanner);t.Effect.call(this,e),this._lfo=new t.LFO({frequency:e.frequency,amplitude:e.depth,min:-1,max:1}),this.depth=this._lfo.amplitude,this._panner=new t.Panner,this.frequency=this._lfo.frequency,this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this.type=e.type,this._readOnly(["depth","frequency"])},t.extend(t.AutoPanner,t.Effect),t.AutoPanner.defaults={frequency:1,type:"sine",depth:1},t.AutoPanner.prototype.start=function(e){return this._lfo.start(e),this},t.AutoPanner.prototype.stop=function(e){return this._lfo.stop(e),this},t.AutoPanner.prototype.sync=function(e){return this._lfo.sync(e),this},t.AutoPanner.prototype.unsync=function(){return this._lfo.unsync(),this},Object.defineProperty(t.AutoPanner.prototype,"type",{get:function(){return this._lfo.type},set:function(e){this._lfo.type=e}}),t.AutoPanner.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._lfo.dispose(),this._lfo=null,this._panner.dispose(),this._panner=null,this._writable(["depth","frequency"]),this.frequency=null,this.depth=null,this},t.AutoPanner}),e(function(t){return t.AutoWah=function(){var e=t.defaults(arguments,["baseFrequency","octaves","sensitivity"],t.AutoWah);t.Effect.call(this,e),this.follower=new t.Follower(e.follower),this._sweepRange=new t.ScaleExp(0,1,.5),this._baseFrequency=e.baseFrequency,this._octaves=e.octaves,this._inputBoost=new t.Gain,this._bandpass=new t.Filter({rolloff:-48,frequency:0,Q:e.Q}),this._peaking=new t.Filter(0,"peaking"),this._peaking.gain.value=e.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this.follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=e.sensitivity,this._readOnly(["gain","Q"])},t.extend(t.AutoWah,t.Effect),t.AutoWah.defaults={baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:{attack:.3,release:.5}},Object.defineProperty(t.AutoWah.prototype,"octaves",{get:function(){return this._octaves},set:function(e){this._octaves=e,this._setSweepRange()}}),Object.defineProperty(t.AutoWah.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(e){this._baseFrequency=e,this._setSweepRange()}}),Object.defineProperty(t.AutoWah.prototype,"sensitivity",{get:function(){return t.gainToDb(1/this._inputBoost.gain.value)},set:function(e){this._inputBoost.gain.value=1/t.dbToGain(e)}}),t.AutoWah.prototype._setSweepRange=function(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)},t.AutoWah.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this.follower.dispose(),this.follower=null,this._sweepRange.dispose(),this._sweepRange=null,this._bandpass.dispose(),this._bandpass=null,this._peaking.dispose(),this._peaking=null,this._inputBoost.dispose(),this._inputBoost=null,this._writable(["gain","Q"]),this.gain=null,this.Q=null,this},t.AutoWah}),e(function(t){return t.Modulo=function(e){t.SignalBase.call(this),this.createInsOuts(1,0),this._shaper=new t.WaveShaper(Math.pow(2,16)),this._multiply=new t.Multiply,this._subtract=this.output=new t.Subtract,this._modSignal=new t.Signal(e),this.input.fan(this._shaper,this._subtract),this._modSignal.connect(this._multiply,0,0),this._shaper.connect(this._multiply,0,1),this._multiply.connect(this._subtract,0,1),this._setWaveShaper(e)},t.extend(t.Modulo,t.SignalBase),t.Modulo.prototype._setWaveShaper=function(t){this._shaper.setMap(function(e){return Math.floor((e+1e-4)/t)})},Object.defineProperty(t.Modulo.prototype,"value",{get:function(){return this._modSignal.value},set:function(e){this._modSignal.value=e,this._setWaveShaper(e)}}),t.Modulo.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this._multiply.dispose(),this._multiply=null,this._subtract.dispose(),this._subtract=null,this._modSignal.dispose(),this._modSignal=null,this},t.Modulo}),e(function(n){return n.BitCrusher=function(){var e=n.defaults(arguments,["bits"],n.BitCrusher);n.Effect.call(this,e);var t=1/Math.pow(2,e.bits-1);this._subtract=new n.Subtract,this._modulo=new n.Modulo(t),this._bits=e.bits,this.effectSend.fan(this._subtract,this._modulo),this._modulo.connect(this._subtract,0,1),this._subtract.connect(this.effectReturn)},n.extend(n.BitCrusher,n.Effect),n.BitCrusher.defaults={bits:4},Object.defineProperty(n.BitCrusher.prototype,"bits",{get:function(){return this._bits},set:function(e){this._bits=e;var t=1/Math.pow(2,e-1);this._modulo.value=t}}),n.BitCrusher.prototype.dispose=function(){return n.Effect.prototype.dispose.call(this),this._subtract.dispose(),this._subtract=null,this._modulo.dispose(),this._modulo=null,this},n.BitCrusher}),e(function(t){return t.Chebyshev=function(){var e=t.defaults(arguments,["order"],t.Chebyshev);t.Effect.call(this,e),this._shaper=new t.WaveShaper(4096),this._order=e.order,this.connectEffect(this._shaper),this.order=e.order,this.oversample=e.oversample},t.extend(t.Chebyshev,t.Effect),t.Chebyshev.defaults={order:1,oversample:"none"},t.Chebyshev.prototype._getCoefficient=function(e,t,n){return n.hasOwnProperty(t)||(n[t]=0===t?0:1===t?e:2*e*this._getCoefficient(e,t-1,n)-this._getCoefficient(e,t-2,n)),n[t]},Object.defineProperty(t.Chebyshev.prototype,"order",{get:function(){return this._order},set:function(e){this._order=e;for(var t=new Array(4096),n=t.length,r=0;r<n;++r){var i=2*r/n-1;t[r]=0===i?0:this._getCoefficient(i,e,{})}this._shaper.curve=t}}),Object.defineProperty(t.Chebyshev.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(e){this._shaper.oversample=e}}),t.Chebyshev.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this},t.Chebyshev}),e(function(t){return t.StereoEffect=function(){t.AudioNode.call(this);var e=t.defaults(arguments,["wet"],t.Effect);this.createInsOuts(1,1),this._dryWet=new t.CrossFade(e.wet),this.wet=this._dryWet.fade,this._split=new t.Split,this.effectSendL=this._split.left,this.effectSendR=this._split.right,this._merge=new t.Merge,this.effectReturnL=this._merge.left,this.effectReturnR=this._merge.right,this.input.connect(this._split),this.input.connect(this._dryWet,0,0),this._merge.connect(this._dryWet,0,1),this._dryWet.connect(this.output),this._readOnly(["wet"])},t.extend(t.StereoEffect,t.Effect),t.StereoEffect.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._dryWet.dispose(),this._dryWet=null,this._split.dispose(),this._split=null,this._merge.dispose(),this._merge=null,this.effectSendL=null,this.effectSendR=null,this.effectReturnL=null,this.effectReturnR=null,this._writable(["wet"]),this.wet=null,this},t.StereoEffect}),e(function(t){return t.Chorus=function(){var e=t.defaults(arguments,["frequency","delayTime","depth"],t.Chorus);t.StereoEffect.call(this,e),this._depth=e.depth,this._delayTime=e.delayTime/1e3,this._lfoL=new t.LFO({frequency:e.frequency,min:0,max:1}),this._lfoR=new t.LFO({frequency:e.frequency,min:0,max:1,phase:180}),this._delayNodeL=new t.Delay,this._delayNodeR=new t.Delay,this.frequency=this._lfoL.frequency,this.effectSendL.chain(this._delayNodeL,this.effectReturnL),this.effectSendR.chain(this._delayNodeR,this.effectReturnR),this.effectSendL.connect(this.effectReturnL),this.effectSendR.connect(this.effectReturnR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this._lfoL.start(),this._lfoR.start(),this._lfoL.frequency.connect(this._lfoR.frequency),this.depth=this._depth,this.frequency.value=e.frequency,this.type=e.type,this._readOnly(["frequency"]),this.spread=e.spread},t.extend(t.Chorus,t.StereoEffect),t.Chorus.defaults={frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180},Object.defineProperty(t.Chorus.prototype,"depth",{get:function(){return this._depth},set:function(e){this._depth=e;var t=this._delayTime*e;this._lfoL.min=Math.max(this._delayTime-t,0),this._lfoL.max=this._delayTime+t,this._lfoR.min=Math.max(this._delayTime-t,0),this._lfoR.max=this._delayTime+t}}),Object.defineProperty(t.Chorus.prototype,"delayTime",{get:function(){return 1e3*this._delayTime},set:function(e){this._delayTime=e/1e3,this.depth=this._depth}}),Object.defineProperty(t.Chorus.prototype,"type",{get:function(){return this._lfoL.type},set:function(e){this._lfoL.type=e,this._lfoR.type=e}}),Object.defineProperty(t.Chorus.prototype,"spread",{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(e){this._lfoL.phase=90-e/2,this._lfoR.phase=e/2+90}}),t.Chorus.prototype.dispose=function(){return t.StereoEffect.prototype.dispose.call(this),this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null,this._delayNodeL.dispose(),this._delayNodeL=null,this._delayNodeR.dispose(),this._delayNodeR=null,this._writable("frequency"),this.frequency=null,this},t.Chorus}),e(function(e){return e.Convolver=function(){var t=e.defaults(arguments,["url","onload"],e.Convolver);e.Effect.call(this,t),this._convolver=this.context.createConvolver(),this._buffer=new e.Buffer(t.url,function(e){this._convolver.buffer=e.get(),t.onload()}.bind(this)),this.connectEffect(this._convolver)},e.extend(e.Convolver,e.Effect),e.Convolver.defaults={onload:e.noOp},Object.defineProperty(e.Convolver.prototype,"buffer",{get:function(){return this._buffer.get()},set:function(e){this._buffer.set(e),this._convolver.buffer=this._buffer.get()}}),e.Convolver.prototype.load=function(e,t){return this._buffer.load(e,function(e){this.buffer=e,t&&t()}.bind(this))},e.Convolver.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this._convolver.disconnect(),this._convolver=null,this._buffer.dispose(),this._buffer=null,this},e.Convolver}),e(function(t){return t.Distortion=function(){var e=t.defaults(arguments,["distortion"],t.Distortion);t.Effect.call(this,e),this._shaper=new t.WaveShaper(4096),this._distortion=e.distortion,this.connectEffect(this._shaper),this.distortion=e.distortion,this.oversample=e.oversample},t.extend(t.Distortion,t.Effect),t.Distortion.defaults={distortion:.4,oversample:"none"},Object.defineProperty(t.Distortion.prototype,"distortion",{get:function(){return this._distortion},set:function(e){var t=100*(this._distortion=e),n=Math.PI/180;this._shaper.setMap(function(e){return Math.abs(e)<.001?0:(3+t)*e*20*n/(Math.PI+t*Math.abs(e))})}}),Object.defineProperty(t.Distortion.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(e){this._shaper.oversample=e}}),t.Distortion.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this},t.Distortion}),e(function(t){return t.FeedbackEffect=function(){var e=t.defaults(arguments,["feedback"],t.FeedbackEffect);t.Effect.call(this,e),this._feedbackGain=new t.Gain(e.feedback,t.Type.NormalRange),this.feedback=this._feedbackGain.gain,this.effectReturn.chain(this._feedbackGain,this.effectSend),this._readOnly(["feedback"])},t.extend(t.FeedbackEffect,t.Effect),t.FeedbackEffect.defaults={feedback:.125},t.FeedbackEffect.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._writable(["feedback"]),this._feedbackGain.dispose(),this._feedbackGain=null,this.feedback=null,this},t.FeedbackEffect}),e(function(t){return t.FeedbackDelay=function(){var e=t.defaults(arguments,["delayTime","feedback"],t.FeedbackDelay);t.FeedbackEffect.call(this,e),this._delayNode=new t.Delay(e.delayTime,e.maxDelay),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),this._readOnly(["delayTime"])},t.extend(t.FeedbackDelay,t.FeedbackEffect),t.FeedbackDelay.defaults={delayTime:.25,maxDelay:1},t.FeedbackDelay.prototype.dispose=function(){return t.FeedbackEffect.prototype.dispose.call(this),this._delayNode.dispose(),this._delayNode=null,this._writable(["delayTime"]),this.delayTime=null,this},t.FeedbackDelay}),e(function(s){var u=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],l=[225,556,441,341];return s.Freeverb=function(){var e=s.defaults(arguments,["roomSize","dampening"],s.Freeverb);s.StereoEffect.call(this,e),this.roomSize=new s.Signal(e.roomSize,s.Type.NormalRange),this.dampening=new s.Signal(e.dampening,s.Type.Frequency),this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[];for(var t=0;t<l.length;t++){var n=this.context.createBiquadFilter();n.type="allpass",n.frequency.value=l[t],this._allpassFiltersL.push(n)}for(var r=0;r<l.length;r++){var i=this.context.createBiquadFilter();i.type="allpass",i.frequency.value=l[r],this._allpassFiltersR.push(i)}for(var o=0;o<u.length;o++){var a=new s.LowpassCombFilter(u[o]);o<u.length/2?this.effectSendL.chain(a,this._allpassFiltersL[0]):this.effectSendR.chain(a,this._allpassFiltersR[0]),this.roomSize.connect(a.resonance),this.dampening.connect(a.dampening),this._combFilters.push(a)}s.connectSeries.apply(s,this._allpassFiltersL),s.connectSeries.apply(s,this._allpassFiltersR),this._allpassFiltersL[this._allpassFiltersL.length-1].connect(this.effectReturnL),this._allpassFiltersR[this._allpassFiltersR.length-1].connect(this.effectReturnR),this._readOnly(["roomSize","dampening"])},s.extend(s.Freeverb,s.StereoEffect),s.Freeverb.defaults={roomSize:.7,dampening:3e3},s.Freeverb.prototype.dispose=function(){s.StereoEffect.prototype.dispose.call(this);for(var e=0;e<this._allpassFiltersL.length;e++)this._allpassFiltersL[e].disconnect(),this._allpassFiltersL[e]=null;this._allpassFiltersL=null;for(var t=0;t<this._allpassFiltersR.length;t++)this._allpassFiltersR[t].disconnect(),this._allpassFiltersR[t]=null;this._allpassFiltersR=null;for(var n=0;n<this._combFilters.length;n++)this._combFilters[n].dispose(),this._combFilters[n]=null;return this._combFilters=null,this._writable(["roomSize","dampening"]),this.roomSize.dispose(),this.roomSize=null,this.dampening.dispose(),this.dampening=null,this},s.Freeverb}),e(function(o){var a=[.06748,.06404,.08212,.09004],s=[.773,.802,.753,.733],u=[347,113,37];return o.JCReverb=function(){var e=o.defaults(arguments,["roomSize"],o.JCReverb);o.StereoEffect.call(this,e),this.roomSize=new o.Signal(e.roomSize,o.Type.NormalRange),this._scaleRoomSize=new o.Scale(-.733,.197),this._allpassFilters=[],this._feedbackCombFilters=[];for(var t=0;t<u.length;t++){var n=this.context.createBiquadFilter();n.type="allpass",n.frequency.value=u[t],this._allpassFilters.push(n)}for(var r=0;r<a.length;r++){var i=new o.FeedbackCombFilter(a[r],.1);this._scaleRoomSize.connect(i.resonance),i.resonance.value=s[r],this._allpassFilters[this._allpassFilters.length-1].connect(i),r<a.length/2?i.connect(this.effectReturnL):i.connect(this.effectReturnR),this._feedbackCombFilters.push(i)}this.roomSize.connect(this._scaleRoomSize),o.connectSeries.apply(o,this._allpassFilters),this.effectSendL.connect(this._allpassFilters[0]),this.effectSendR.connect(this._allpassFilters[0]),this._readOnly(["roomSize"])},o.extend(o.JCReverb,o.StereoEffect),o.JCReverb.defaults={roomSize:.5},o.JCReverb.prototype.dispose=function(){o.StereoEffect.prototype.dispose.call(this);for(var e=0;e<this._allpassFilters.length;e++)this._allpassFilters[e].disconnect(),this._allpassFilters[e]=null;this._allpassFilters=null;for(var t=0;t<this._feedbackCombFilters.length;t++)this._feedbackCombFilters[t].dispose(),this._feedbackCombFilters[t]=null;return this._feedbackCombFilters=null,this._writable(["roomSize"]),this.roomSize.dispose(),this.roomSize=null,this._scaleRoomSize.dispose(),this._scaleRoomSize=null,this},o.JCReverb}),e(function(e){return e.MidSideEffect=function(){e.Effect.apply(this,arguments),this._midSideSplit=new e.MidSideSplit,this._midSideMerge=new e.MidSideMerge,this.midSend=this._midSideSplit.mid,this.sideSend=this._midSideSplit.side,this.midReturn=this._midSideMerge.mid,this.sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)},e.extend(e.MidSideEffect,e.Effect),e.MidSideEffect.prototype.dispose=function(){return e.Effect.prototype.dispose.call(this),this._midSideSplit.dispose(),this._midSideSplit=null,this._midSideMerge.dispose(),this._midSideMerge=null,this.midSend=null,this.sideSend=null,this.midReturn=null,this.sideReturn=null,this},e.MidSideEffect}),e(function(a){return a.Phaser=function(){var e=a.defaults(arguments,["frequency","octaves","baseFrequency"],a.Phaser);a.StereoEffect.call(this,e),this._lfoL=new a.LFO(e.frequency,0,1),this._lfoR=new a.LFO(e.frequency,0,1),this._lfoR.phase=180,this._baseFrequency=e.baseFrequency,this._octaves=e.octaves,this.Q=new a.Signal(e.Q,a.Type.Positive),this._filtersL=this._makeFilters(e.stages,this._lfoL,this.Q),this._filtersR=this._makeFilters(e.stages,this._lfoR,this.Q),this.frequency=this._lfoL.frequency,this.frequency.value=e.frequency,this.effectSendL.connect(this._filtersL[0]),this.effectSendR.connect(this._filtersR[0]),this._filtersL[e.stages-1].connect(this.effectReturnL),this._filtersR[e.stages-1].connect(this.effectReturnR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=e.baseFrequency,this.octaves=e.octaves,this._lfoL.start(),this._lfoR.start(),this._readOnly(["frequency","Q"])},a.extend(a.Phaser,a.StereoEffect),a.Phaser.defaults={frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350},a.Phaser.prototype._makeFilters=function(e,t,n){for(var r=new Array(e),i=0;i<e;i++){var o=this.context.createBiquadFilter();o.type="allpass",n.connect(o.Q),t.connect(o.frequency),r[i]=o}return a.connectSeries.apply(a,r),r},Object.defineProperty(a.Phaser.prototype,"octaves",{get:function(){return this._octaves},set:function(e){this._octaves=e;var t=this._baseFrequency*Math.pow(2,e);this._lfoL.max=t,this._lfoR.max=t}}),Object.defineProperty(a.Phaser.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(e){this._baseFrequency=e,this._lfoL.min=e,this._lfoR.min=e,this.octaves=this._octaves}}),a.Phaser.prototype.dispose=function(){a.StereoEffect.prototype.dispose.call(this),this._writable(["frequency","Q"]),this.Q.dispose(),this.Q=null,this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null;for(var e=0;e<this._filtersL.length;e++)this._filtersL[e].disconnect(),this._filtersL[e]=null;this._filtersL=null;for(var t=0;t<this._filtersR.length;t++)this._filtersR[t].disconnect(),this._filtersR[t]=null;return this._filtersR=null,this.frequency=null,this},a.Phaser}),e(function(t){return t.StereoXFeedbackEffect=function(){var e=t.defaults(arguments,["feedback"],t.FeedbackEffect);t.StereoEffect.call(this,e),this.feedback=new t.Signal(e.feedback,t.Type.NormalRange),this._feedbackLR=new t.Gain,this._feedbackRL=new t.Gain,this.effectReturnL.chain(this._feedbackLR,this.effectSendR),this.effectReturnR.chain(this._feedbackRL,this.effectSendL),this.feedback.fan(this._feedbackLR.gain,this._feedbackRL.gain),this._readOnly(["feedback"])},t.extend(t.StereoXFeedbackEffect,t.StereoEffect),t.StereoXFeedbackEffect.prototype.dispose=function(){return t.StereoEffect.prototype.dispose.call(this),this._writable(["feedback"]),this.feedback.dispose(),this.feedback=null,this._feedbackLR.dispose(),this._feedbackLR=null,this._feedbackRL.dispose(),this._feedbackRL=null,this},t.StereoXFeedbackEffect}),e(function(t){return t.PingPongDelay=function(){var e=t.defaults(arguments,["delayTime","feedback"],t.PingPongDelay);t.StereoXFeedbackEffect.call(this,e),this._leftDelay=new t.Delay(0,e.maxDelayTime),this._rightDelay=new t.Delay(0,e.maxDelayTime),this._rightPreDelay=new t.Delay(0,e.maxDelayTime),this.delayTime=new t.Signal(e.delayTime,t.Type.Time),this.effectSendL.chain(this._leftDelay,this.effectReturnL),this.effectSendR.chain(this._rightPreDelay,this._rightDelay,this.effectReturnR),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackLR.disconnect(),this._feedbackLR.connect(this._rightDelay),this._readOnly(["delayTime"])},t.extend(t.PingPongDelay,t.StereoXFeedbackEffect),t.PingPongDelay.defaults={delayTime:.25,maxDelayTime:1},t.PingPongDelay.prototype.dispose=function(){return t.StereoXFeedbackEffect.prototype.dispose.call(this),this._leftDelay.dispose(),this._leftDelay=null,this._rightDelay.dispose(),this._rightDelay=null,this._rightPreDelay.dispose(),this._rightPreDelay=null,this._writable(["delayTime"]),this.delayTime.dispose(),this.delayTime=null,this},t.PingPongDelay}),e(function(n){return n.PitchShift=function(){var e=n.defaults(arguments,["pitch"],n.PitchShift);n.FeedbackEffect.call(this,e),this._frequency=new n.Signal(0),this._delayA=new n.Delay(0,1),this._lfoA=new n.LFO({min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new n.Delay(0,1),this._lfoB=new n.LFO({min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new n.CrossFade,this._crossFadeLFO=new n.LFO({min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new n.Delay(e.delayTime),this.delayTime=this._feedbackDelay.delayTime,this._readOnly("delayTime"),this._pitch=e.pitch,this._windowSize=e.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);var t=this.now();this._lfoA.start(t),this._lfoB.start(t),this._crossFadeLFO.start(t),this.windowSize=this._windowSize},n.extend(n.PitchShift,n.FeedbackEffect),n.PitchShift.defaults={pitch:0,windowSize:.1,delayTime:0,feedback:0},Object.defineProperty(n.PitchShift.prototype,"pitch",{get:function(){return this._pitch},set:function(e){var t=0;(this._pitch=e)<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,t=n.intervalToFrequencyRatio(e-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,t=n.intervalToFrequencyRatio(e)-1),this._frequency.value=t*(1.2/this._windowSize)}}),Object.defineProperty(n.PitchShift.prototype,"windowSize",{get:function(){return this._windowSize},set:function(e){this._windowSize=this.toSeconds(e),this.pitch=this._pitch}}),n.PitchShift.prototype.dispose=function(){return n.FeedbackEffect.prototype.dispose.call(this),this._frequency.dispose(),this._frequency=null,this._delayA.disconnect(),this._delayA=null,this._delayB.disconnect(),this._delayB=null,this._lfoA.dispose(),this._lfoA=null,this._lfoB.dispose(),this._lfoB=null,this._crossFade.dispose(),this._crossFade=null,this._crossFadeLFO.dispose(),this._crossFadeLFO=null,this._writable("delayTime"),this._feedbackDelay.dispose(),this._feedbackDelay=null,this.delayTime=null,this},n.PitchShift}),e(function(u){return u.BufferSource=function(){var e=u.defaults(arguments,["buffer","onload"],u.BufferSource);u.AudioNode.call(this,e),this.onended=e.onended,this._startTime=-1,this._sourceStarted=!1,this._sourceStopped=!1,this._stopTime=-1,this._gainNode=this.output=new u.Gain,this._source=this.context.createBufferSource(),this._source.connect(this._gainNode),this._source.onended=this._onended.bind(this),this._buffer=new u.Buffer(e.buffer,e.onload),this.playbackRate=new u.Param(this._source.playbackRate,u.Type.Positive),this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut,this.curve=e.curve,this._gain=1,this._onendedTimeout=-1,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.playbackRate.value=e.playbackRate},u.extend(u.BufferSource,u.AudioNode),u.BufferSource.defaults={onended:u.noOp,onload:u.noOp,loop:!1,loopStart:0,loopEnd:0,fadeIn:0,fadeOut:0,curve:"linear",playbackRate:1},Object.defineProperty(u.BufferSource.prototype,"state",{get:function(){return this.getStateAtTime(this.now())}}),u.BufferSource.prototype.getStateAtTime=function(e){return e=this.toSeconds(e),-1!==this._startTime&&e>=this._startTime&&!this._sourceStopped?u.State.Started:u.State.Stopped},u.BufferSource.prototype.start=function(e,t,n,r,i){if(-1!==this._startTime)throw new Error("Tone.BufferSource can only be started once.");if(!this.buffer.loaded)throw new Error("Tone.BufferSource: buffer is either not set or not loaded.");e=this.toSeconds(e),t=this.loop?u.defaultArg(t,this.loopStart):u.defaultArg(t,0),t=this.toSeconds(t),r=u.defaultArg(r,1),this._gain=r,i=this.toSeconds(u.defaultArg(i,this.fadeIn)),0<(this.fadeIn=i)?(this._gainNode.gain.setValueAtTime(0,e),"linear"===this.curve?this._gainNode.gain.linearRampToValueAtTime(this._gain,e+i):this._gainNode.gain.exponentialApproachValueAtTime(this._gain,e,i)):this._gainNode.gain.setValueAtTime(r,e),this._startTime=e;var o=this.toSeconds(u.defaultArg(n,this.buffer.duration-t%this.buffer.duration));if(o=Math.max(o,0),u.isDefined(n)&&(this.loop||(o=Math.min(o,this.buffer.duration-t%this.buffer.duration)),this.stop(e+o,this.fadeOut)),this.loop){var a=this.loopEnd||this.buffer.duration,s=this.loopStart;a<=t&&(t=(t-s)%(a-s)+s)}return this._source.buffer=this.buffer.get(),this._source.loopEnd=this.loopEnd||this.buffer.duration,t<this.buffer.duration&&(this._sourceStarted=!0,this._source.start(e,t)),this},u.BufferSource.prototype.stop=function(e,t){if(!this.buffer.loaded)throw new Error("Tone.BufferSource: buffer is either not set or not loaded.");if(!this._sourceStopped){if(e=this.toSeconds(e),-1!==this._stopTime&&this.cancelStop(),e<=this._startTime)return this._gainNode.gain.cancelScheduledValues(e),this._gainNode.gain.value=0,this;e=Math.max(this._startTime+this.fadeIn+this.sampleTime,e),this._gainNode.gain.cancelScheduledValues(e),this._stopTime=e,t=this.toSeconds(u.defaultArg(t,this.fadeOut));var n=e-this._startTime-this.fadeIn-this.sampleTime;this.loop||(n=Math.min(n,this.buffer.duration));var r=e-(t=Math.min(n,t));return t>this.sampleTime?(this._gainNode.gain.setValueAtTime(this._gain,r),"linear"===this.curve?this._gainNode.gain.linearRampToValueAtTime(0,e):this._gainNode.gain.exponentialApproachValueAtTime(0,r,t)):this._gainNode.gain.setValueAtTime(0,e),u.context.clearTimeout(this._onendedTimeout),this._onendedTimeout=u.context.setTimeout(this._onended.bind(this),this._stopTime-this.now()),this}},u.BufferSource.prototype.cancelStop=function(){if(-1!==this._startTime&&!this._sourceStopped){var e=this.toSeconds(this.fadeIn);this._gainNode.gain.cancelScheduledValues(this._startTime+e+this.sampleTime),this._gainNode.gain.setValueAtTime(1,Math.max(this.now(),this._startTime+e+this.sampleTime)),this.context.clearTimeout(this._onendedTimeout),this._stopTime=-1}return this},u.BufferSource.prototype._onended=function(){if(!this._sourceStopped){this._sourceStopped=!0;var e="exponential"===this.curve?2*this.fadeOut:0;this._sourceStarted&&-1!==this._stopTime&&this._source.stop(this._stopTime+e),this.onended(this)}},Object.defineProperty(u.BufferSource.prototype,"loopStart",{get:function(){return this._source.loopStart},set:function(e){this._source.loopStart=this.toSeconds(e)}}),Object.defineProperty(u.BufferSource.prototype,"loopEnd",{get:function(){return this._source.loopEnd},set:function(e){this._source.loopEnd=this.toSeconds(e)}}),Object.defineProperty(u.BufferSource.prototype,"buffer",{get:function(){return this._buffer},set:function(e){this._buffer.set(e)}}),Object.defineProperty(u.BufferSource.prototype,"loop",{get:function(){return this._source.loop},set:function(e){this._source.loop=e,this.cancelStop()}}),u.BufferSource.prototype.dispose=function(){return u.AudioNode.prototype.dispose.call(this),this.onended=null,this._source.onended=null,this._source.disconnect(),this._source=null,this._gainNode.dispose(),this._gainNode=null,this._buffer.dispose(),this._buffer=null,this._startTime=-1,this.playbackRate=null,u.context.clearTimeout(this._onendedTimeout),this},u.BufferSource}),e(function(n){n.Noise=function(){var e=n.defaults(arguments,["type"],n.Noise);n.Source.call(this,e),this._source=null,this._type=e.type,this._playbackRate=e.playbackRate},n.extend(n.Noise,n.Source),n.Noise.defaults={type:"white",playbackRate:1},Object.defineProperty(n.Noise.prototype,"type",{get:function(){return this._type},set:function(e){if(this._type!==e){if(!(e in r))throw new TypeError("Tone.Noise: invalid type: "+e);if(this._type=e,this.state===n.State.Started){var t=this.now();this._stop(t),this._start(t)}}}}),Object.defineProperty(n.Noise.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}}),n.Noise.prototype._start=function(e){var t=r[this._type];this._source=new n.BufferSource(t).connect(this.output),this._source.loop=!0,this._source.playbackRate.value=this._playbackRate,this._source.start(this.toSeconds(e),Math.random()*(t.duration-.001))},n.Noise.prototype._stop=function(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)},n.Noise.prototype.restart=function(e){this._stop(e),this._start(e)},n.Noise.prototype.dispose=function(){return n.Source.prototype.dispose.call(this),null!==this._source&&(this._source.disconnect(),this._source=null),this._buffer=null,this};var h=220500,t={pink:function(){for(var e=[],t=0;t<2;t++){var n,r,i,o,a,s,u,l=new Float32Array(h);e[t]=l,n=r=i=o=a=s=u=0;for(var c=0;c<h;c++){var p=2*Math.random()-1;n=.99886*n+.0555179*p,r=.99332*r+.0750759*p,i=.969*i+.153852*p,o=.8665*o+.3104856*p,a=.55*a+.5329522*p,s=-.7616*s-.016898*p,l[c]=n+r+i+o+a+s+u+.5362*p,l[c]*=.11,u=.115926*p}}return e}(),brown:function(){for(var e=[],t=0;t<2;t++){var n=new Float32Array(h);e[t]=n;for(var r=0,i=0;i<h;i++){var o=2*Math.random()-1;n[i]=(r+.02*o)/1.02,r=n[i],n[i]*=3.5}}return e}(),white:function(){for(var e=[],t=0;t<2;t++){var n=new Float32Array(h);e[t]=n;for(var r=0;r<h;r++)n[r]=2*Math.random()-1}return e}()},r={};function e(){for(var e in t)r[e]=(new n.Buffer).fromArray(t[e])}return n.getContext(e),n.Context.on("init",e),n.Noise}),e(function(i){return i.Reverb=function(){var e=i.defaults(arguments,["decay"],i.Reverb);i.Effect.call(this,e),this._convolver=this.context.createConvolver(),this.decay=e.decay,this.preDelay=e.preDelay,this.connectEffect(this._convolver)},i.extend(i.Reverb,i.Effect),i.Reverb.defaults={decay:1.5,preDelay:.01},i.Reverb.prototype.generate=function(){return i.Offline(function(){var e=new i.Noise,t=new i.Noise,n=new i.Merge;e.connect(n.left),t.connect(n.right);var r=(new i.Gain).toMaster();n.connect(r),e.start(0),t.start(0),r.gain.setValueAtTime(0,0),r.gain.linearRampToValueAtTime(1,this.preDelay),r.gain.exponentialApproachValueAtTime(0,this.preDelay,this.decay-this.preDelay)}.bind(this),this.decay).then(function(e){return this._convolver.buffer=e.get(),this}.bind(this))},i.Reverb.prototype.dispose=function(){return i.Effect.prototype.dispose.call(this),this._convolver.disconnect(),this._convolver=null,this},i.Reverb}),e(function(t){return t.StereoFeedbackEffect=function(){var e=t.defaults(arguments,["feedback"],t.FeedbackEffect);t.StereoEffect.call(this,e),this.feedback=new t.Signal(e.feedback,t.Type.NormalRange),this._feedbackL=new t.Gain,this._feedbackR=new t.Gain,this.effectReturnL.chain(this._feedbackL,this.effectSendL),this.effectReturnR.chain(this._feedbackR,this.effectSendR),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),this._readOnly(["feedback"])},t.extend(t.StereoFeedbackEffect,t.StereoEffect),t.StereoFeedbackEffect.prototype.dispose=function(){return t.StereoEffect.prototype.dispose.call(this),this._writable(["feedback"]),this.feedback.dispose(),this.feedback=null,this._feedbackL.dispose(),this._feedbackL=null,this._feedbackR.dispose(),this._feedbackR=null,this},t.StereoFeedbackEffect}),e(function(t){return t.StereoWidener=function(){var e=t.defaults(arguments,["width"],t.StereoWidener);t.MidSideEffect.call(this,e),this.width=new t.Signal(e.width,t.Type.NormalRange),this._readOnly(["width"]),this._twoTimesWidthMid=new t.Multiply(2),this._twoTimesWidthSide=new t.Multiply(2),this._midMult=new t.Multiply,this._twoTimesWidthMid.connect(this._midMult,0,1),this.midSend.chain(this._midMult,this.midReturn),this._oneMinusWidth=new t.Subtract,this._oneMinusWidth.connect(this._twoTimesWidthMid),this.context.getConstant(1).connect(this._oneMinusWidth,0,0),this.width.connect(this._oneMinusWidth,0,1),this._sideMult=new t.Multiply,this.width.connect(this._twoTimesWidthSide),this._twoTimesWidthSide.connect(this._sideMult,0,1),this.sideSend.chain(this._sideMult,this.sideReturn)},t.extend(t.StereoWidener,t.MidSideEffect),t.StereoWidener.defaults={width:.5},t.StereoWidener.prototype.dispose=function(){return t.MidSideEffect.prototype.dispose.call(this),this._writable(["width"]),this.width.dispose(),this.width=null,this._midMult.dispose(),this._midMult=null,this._sideMult.dispose(),this._sideMult=null,this._twoTimesWidthMid.dispose(),this._twoTimesWidthMid=null,this._twoTimesWidthSide.dispose(),this._twoTimesWidthSide=null,this._oneMinusWidth.dispose(),this._oneMinusWidth=null,this},t.StereoWidener}),e(function(t){return t.Tremolo=function(){var e=t.defaults(arguments,["frequency","depth"],t.Tremolo);t.StereoEffect.call(this,e),this._lfoL=new t.LFO({phase:e.spread,min:1,max:0}),this._lfoR=new t.LFO({phase:e.spread,min:1,max:0}),this._amplitudeL=new t.Gain,this._amplitudeR=new t.Gain,this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.depth=new t.Signal(e.depth,t.Type.NormalRange),this._readOnly(["frequency","depth"]),this.effectSendL.chain(this._amplitudeL,this.effectReturnL),this.effectSendR.chain(this._amplitudeR,this.effectReturnR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.type=e.type,this.spread=e.spread},t.extend(t.Tremolo,t.StereoEffect),t.Tremolo.defaults={frequency:10,type:"sine",depth:.5,spread:180},t.Tremolo.prototype.start=function(e){return this._lfoL.start(e),this._lfoR.start(e),this},t.Tremolo.prototype.stop=function(e){return this._lfoL.stop(e),this._lfoR.stop(e),this},t.Tremolo.prototype.sync=function(e){return this._lfoL.sync(e),this._lfoR.sync(e),t.Transport.syncSignal(this.frequency),this},t.Tremolo.prototype.unsync=function(){return this._lfoL.unsync(),this._lfoR.unsync(),t.Transport.unsyncSignal(this.frequency),this},Object.defineProperty(t.Tremolo.prototype,"type",{get:function(){return this._lfoL.type},set:function(e){this._lfoL.type=e,this._lfoR.type=e}}),Object.defineProperty(t.Tremolo.prototype,"spread",{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(e){this._lfoL.phase=90-e/2,this._lfoR.phase=e/2+90}}),t.Tremolo.prototype.dispose=function(){return t.StereoEffect.prototype.dispose.call(this),this._writable(["frequency","depth"]),this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null,this._amplitudeL.dispose(),this._amplitudeL=null,this._amplitudeR.dispose(),this._amplitudeR=null,this.frequency=null,this.depth=null,this},t.Tremolo}),e(function(t){return t.Vibrato=function(){var e=t.defaults(arguments,["frequency","depth"],t.Vibrato);t.Effect.call(this,e),this._delayNode=new t.Delay(0,e.maxDelay),this._lfo=new t.LFO({type:e.type,min:0,max:e.maxDelay,frequency:e.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=e.depth,this._readOnly(["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)},t.extend(t.Vibrato,t.Effect),t.Vibrato.defaults={maxDelay:.005,frequency:5,depth:.1,type:"sine"},Object.defineProperty(t.Vibrato.prototype,"type",{get:function(){return this._lfo.type},set:function(e){this._lfo.type=e}}),t.Vibrato.prototype.dispose=function(){t.Effect.prototype.dispose.call(this),this._delayNode.dispose(),this._delayNode=null,this._lfo.dispose(),this._lfo=null,this._writable(["frequency","depth"]),this.frequency=null,this.depth=null},t.Vibrato}),e(function(o){return o.Event=function(){var e=o.defaults(arguments,["callback","value"],o.Event);o.call(this),this._loop=e.loop,this.callback=e.callback,this.value=e.value,this._loopStart=this.toTicks(e.loopStart),this._loopEnd=this.toTicks(e.loopEnd),this._state=new o.TimelineState(o.State.Stopped),this._playbackRate=1,this._startOffset=0,this._probability=e.probability,this._humanize=e.humanize,this.mute=e.mute,this.playbackRate=e.playbackRate},o.extend(o.Event),o.Event.defaults={callback:o.noOp,loop:!1,loopEnd:"1m",loopStart:0,playbackRate:1,value:null,probability:1,mute:!1,humanize:!1},o.Event.prototype._rescheduleEvents=function(e){return e=o.defaultArg(e,-1),this._state.forEachFrom(e,function(e){var t;if(e.state===o.State.Started){o.isDefined(e.id)&&o.Transport.clear(e.id);var n=e.time+Math.round(this.startOffset/this._playbackRate);if(this._loop){t=1/0,o.isNumber(this._loop)&&(t=this._loop*this._getLoopDuration());var r=this._state.getAfter(n);null!==r&&(t=Math.min(t,r.time-n)),t!==1/0&&(this._state.setStateAtTime(o.State.Stopped,n+t+1),t=o.Ticks(t));var i=o.Ticks(this._getLoopDuration());e.id=o.Transport.scheduleRepeat(this._tick.bind(this),i,o.Ticks(n),t)}else e.id=o.Transport.schedule(this._tick.bind(this),o.Ticks(n))}}.bind(this)),this},Object.defineProperty(o.Event.prototype,"state",{get:function(){return this._state.getValueAtTime(o.Transport.ticks)}}),Object.defineProperty(o.Event.prototype,"startOffset",{get:function(){return this._startOffset},set:function(e){this._startOffset=e}}),Object.defineProperty(o.Event.prototype,"probability",{get:function(){return this._probability},set:function(e){this._probability=e}}),Object.defineProperty(o.Event.prototype,"humanize",{get:function(){return this._humanize},set:function(e){this._humanize=e}}),o.Event.prototype.start=function(e){return e=this.toTicks(e),this._state.getValueAtTime(e)===o.State.Stopped&&(this._state.add({state:o.State.Started,time:e,id:void 0}),this._rescheduleEvents(e)),this},o.Event.prototype.stop=function(e){if(this.cancel(e),e=this.toTicks(e),this._state.getValueAtTime(e)===o.State.Started){this._state.setStateAtTime(o.State.Stopped,e);var t=this._state.getBefore(e),n=e;null!==t&&(n=t.time),this._rescheduleEvents(n)}return this},o.Event.prototype.cancel=function(e){return e=o.defaultArg(e,-1/0),e=this.toTicks(e),this._state.forEachFrom(e,function(e){o.Transport.clear(e.id)}),this._state.cancel(e),this},o.Event.prototype._tick=function(e){var t=o.Transport.getTicksAtTime(e);if(!this.mute&&this._state.getValueAtTime(t)===o.State.Started){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){var n=.02;o.isBoolean(this.humanize)||(n=this.toSeconds(this.humanize)),e+=(2*Math.random()-1)*n}this.callback(e,this.value)}},o.Event.prototype._getLoopDuration=function(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)},Object.defineProperty(o.Event.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=e,this._rescheduleEvents()}}),Object.defineProperty(o.Event.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(e){this._playbackRate=e,this._rescheduleEvents()}}),Object.defineProperty(o.Event.prototype,"loopEnd",{get:function(){return o.Ticks(this._loopEnd).toSeconds()},set:function(e){this._loopEnd=this.toTicks(e),this._loop&&this._rescheduleEvents()}}),Object.defineProperty(o.Event.prototype,"loopStart",{get:function(){return o.Ticks(this._loopStart).toSeconds()},set:function(e){this._loopStart=this.toTicks(e),this._loop&&this._rescheduleEvents()}}),Object.defineProperty(o.Event.prototype,"progress",{get:function(){if(this._loop){var e=o.Transport.ticks,t=this._state.get(e);if(null!==t&&t.state===o.State.Started){var n=this._getLoopDuration();return(e-t.time)%n/n}return 0}return 0}}),o.Event.prototype.dispose=function(){this.cancel(),this._state.dispose(),this._state=null,this.callback=null,this.value=null},o.Event}),e(function(t){return t.Loop=function(){var e=t.defaults(arguments,["callback","interval"],t.Loop);t.call(this),this._event=new t.Event({callback:this._tick.bind(this),loop:!0,loopEnd:e.interval,playbackRate:e.playbackRate,probability:e.probability}),this.callback=e.callback,this.iterations=e.iterations},t.extend(t.Loop),t.Loop.defaults={interval:"4n",callback:t.noOp,playbackRate:1,iterations:1/0,probability:!0,mute:!1},t.Loop.prototype.start=function(e){return this._event.start(e),this},t.Loop.prototype.stop=function(e){return this._event.stop(e),this},t.Loop.prototype.cancel=function(e){return this._event.cancel(e),this},t.Loop.prototype._tick=function(e){this.callback(e)},Object.defineProperty(t.Loop.prototype,"state",{get:function(){return this._event.state}}),Object.defineProperty(t.Loop.prototype,"progress",{get:function(){return this._event.progress}}),Object.defineProperty(t.Loop.prototype,"interval",{get:function(){return this._event.loopEnd},set:function(e){this._event.loopEnd=e}}),Object.defineProperty(t.Loop.prototype,"playbackRate",{get:function(){return this._event.playbackRate},set:function(e){this._event.playbackRate=e}}),Object.defineProperty(t.Loop.prototype,"humanize",{get:function(){return this._event.humanize},set:function(e){this._event.humanize=e}}),Object.defineProperty(t.Loop.prototype,"probability",{get:function(){return this._event.probability},set:function(e){this._event.probability=e}}),Object.defineProperty(t.Loop.prototype,"mute",{get:function(){return this._event.mute},set:function(e){this._event.mute=e}}),Object.defineProperty(t.Loop.prototype,"iterations",{get:function(){return!0===this._event.loop?1/0:this._event.loop},set:function(e){this._event.loop=e===1/0||e}}),t.Loop.prototype.dispose=function(){this._event.dispose(),this._event=null,this.callback=null},t.Loop}),e(function(o){return o.Part=function(){var e=o.defaults(arguments,["callback","events"],o.Part);o.Event.call(this,e),this._events=[];for(var t=0;t<e.events.length;t++)Array.isArray(e.events[t])?this.add(e.events[t][0],e.events[t][1]):this.add(e.events[t])},o.extend(o.Part,o.Event),o.Part.defaults={callback:o.noOp,loop:!1,loopEnd:"1m",loopStart:0,playbackRate:1,probability:1,humanize:!1,mute:!1,events:[]},o.Part.prototype.start=function(e,t){var n=this.toTicks(e);return this._state.getValueAtTime(n)!==o.State.Started&&(t=this._loop?o.defaultArg(t,this._loopStart):o.defaultArg(t,0),t=this.toTicks(t),this._state.add({state:o.State.Started,time:n,offset:t}),this._forEach(function(e){this._startNote(e,n,t)})),this},o.Part.prototype._startNote=function(e,t,n){t-=n,this._loop?e.startOffset>=this._loopStart&&e.startOffset<this._loopEnd?(e.startOffset<n&&(t+=this._getLoopDuration()),e.start(o.Ticks(t))):e.startOffset<this._loopStart&&e.startOffset>=n&&(e.loop=!1,e.start(o.Ticks(t))):e.startOffset>=n&&e.start(o.Ticks(t))},Object.defineProperty(o.Part.prototype,"startOffset",{get:function(){return this._startOffset},set:function(e){this._startOffset=e,this._forEach(function(e){e.startOffset+=this._startOffset})}}),o.Part.prototype.stop=function(t){var e=this.toTicks(t);return this._state.cancel(e),this._state.setStateAtTime(o.State.Stopped,e),this._forEach(function(e){e.stop(t)}),this},o.Part.prototype.at=function(e,t){e=o.TransportTime(e);for(var n=o.Ticks(1).toSeconds(),r=0;r<this._events.length;r++){var i=this._events[r];if(Math.abs(e.toTicks()-i.startOffset)<n)return o.isDefined(t)&&(i.value=t),i}return o.isDefined(t)?(this.add(e,t),this._events[this._events.length-1]):null},o.Part.prototype.add=function(e,t){var n;return e.hasOwnProperty("time")&&(e=(t=e).time),e=this.toTicks(e),t instanceof o.Event?(n=t).callback=this._tick.bind(this):n=new o.Event({callback:this._tick.bind(this),value:t}),n.startOffset=e,n.set({loopEnd:this.loopEnd,loopStart:this.loopStart,loop:this.loop,humanize:this.humanize,playbackRate:this.playbackRate,probability:this.probability}),this._events.push(n),this._restartEvent(n),this},o.Part.prototype._restartEvent=function(t){this._state.forEach(function(e){e.state===o.State.Started?this._startNote(t,e.time,e.offset):t.stop(o.Ticks(e.time))}.bind(this))},o.Part.prototype.remove=function(e,t){e.hasOwnProperty("time")&&(e=(t=e).time),e=this.toTicks(e);for(var n=this._events.length-1;0<=n;n--){var r=this._events[n];r instanceof o.Part?r.remove(e,t):r.startOffset===e&&(o.isUndef(t)||o.isDefined(t)&&r.value===t)&&(this._events.splice(n,1),r.dispose())}return this},o.Part.prototype.removeAll=function(){return this._forEach(function(e){e.dispose()}),this._events=[],this},o.Part.prototype.cancel=function(t){return this._forEach(function(e){e.cancel(t)}),this._state.cancel(this.toTicks(t)),this},o.Part.prototype._forEach=function(e,t){if(this._events){t=o.defaultArg(t,this);for(var n=this._events.length-1;0<=n;n--){var r=this._events[n];r instanceof o.Part?r._forEach(e,t):e.call(t,r)}}return this},o.Part.prototype._setAll=function(t,n){this._forEach(function(e){e[t]=n})},o.Part.prototype._tick=function(e,t){this.mute||this.callback(e,t)},o.Part.prototype._testLoopBoundries=function(e){e.startOffset<this._loopStart||e.startOffset>=this._loopEnd?e.cancel(0):e.state===o.State.Stopped&&this._restartEvent(e)},Object.defineProperty(o.Part.prototype,"probability",{get:function(){return this._probability},set:function(e){this._probability=e,this._setAll("probability",e)}}),Object.defineProperty(o.Part.prototype,"humanize",{get:function(){return this._humanize},set:function(e){this._humanize=e,this._setAll("humanize",e)}}),Object.defineProperty(o.Part.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this._forEach(function(e){e._loopStart=this._loopStart,e._loopEnd=this._loopEnd,e.loop=t,this._testLoopBoundries(e)})}}),Object.defineProperty(o.Part.prototype,"loopEnd",{get:function(){return o.Ticks(this._loopEnd).toSeconds()},set:function(t){this._loopEnd=this.toTicks(t),this._loop&&this._forEach(function(e){e.loopEnd=t,this._testLoopBoundries(e)})}}),Object.defineProperty(o.Part.prototype,"loopStart",{get:function(){return o.Ticks(this._loopStart).toSeconds()},set:function(e){this._loopStart=this.toTicks(e),this._loop&&this._forEach(function(e){e.loopStart=this.loopStart,this._testLoopBoundries(e)})}}),Object.defineProperty(o.Part.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(e){this._playbackRate=e,this._setAll("playbackRate",e)}}),Object.defineProperty(o.Part.prototype,"length",{get:function(){return this._events.length}}),o.Part.prototype.dispose=function(){return this.removeAll(),this._state.dispose(),this._state=null,this.callback=null,this._events=null,this},o.Part}),e(function(t){return t.Pattern=function(){var e=t.defaults(arguments,["callback","values","pattern"],t.Pattern);t.Loop.call(this,e),this._pattern=new t.CtrlPattern({values:e.values,type:e.pattern,index:e.index})},t.extend(t.Pattern,t.Loop),t.Pattern.defaults={pattern:t.CtrlPattern.Type.Up,callback:t.noOp,values:[]},t.Pattern.prototype._tick=function(e){this.callback(e,this._pattern.value),this._pattern.next()},Object.defineProperty(t.Pattern.prototype,"index",{get:function(){return this._pattern.index},set:function(e){this._pattern.index=e}}),Object.defineProperty(t.Pattern.prototype,"values",{get:function(){return this._pattern.values},set:function(e){this._pattern.values=e}}),Object.defineProperty(t.Pattern.prototype,"value",{get:function(){return this._pattern.value}}),Object.defineProperty(t.Pattern.prototype,"pattern",{get:function(){return this._pattern.type},set:function(e){this._pattern.type=e}}),t.Pattern.prototype.dispose=function(){t.Loop.prototype.dispose.call(this),this._pattern.dispose(),this._pattern=null},t.Pattern}),e(function(r){return r.Sequence=function(){var e=r.defaults(arguments,["callback","events","subdivision"],r.Sequence),t=e.events;if(delete e.events,r.Part.call(this,e),this._subdivision=this.toTicks(e.subdivision),r.isUndef(e.loopEnd)&&r.isDefined(t)&&(this._loopEnd=t.length*this._subdivision),this._loop=!0,r.isDefined(t))for(var n=0;n<t.length;n++)this.add(n,t[n])},r.extend(r.Sequence,r.Part),r.Sequence.defaults={subdivision:"4n"},Object.defineProperty(r.Sequence.prototype,"subdivision",{get:function(){return r.Ticks(this._subdivision).toSeconds()}}),r.Sequence.prototype.at=function(e,t){return r.isArray(t)&&this.remove(e),r.Part.prototype.at.call(this,this._indexTime(e),t)},r.Sequence.prototype.add=function(e,t){if(null===t)return this;if(r.isArray(t)){var n=Math.round(this._subdivision/t.length);t=new r.Sequence(this._tick.bind(this),t,r.Ticks(n))}return r.Part.prototype.add.call(this,this._indexTime(e),t),this},r.Sequence.prototype.remove=function(e,t){return r.Part.prototype.remove.call(this,this._indexTime(e),t),this},r.Sequence.prototype._indexTime=function(e){return e instanceof r.TransportTime?e:r.Ticks(e*this._subdivision+this.startOffset).toSeconds()},r.Sequence.prototype.dispose=function(){return r.Part.prototype.dispose.call(this),this},r.Sequence}),e(function(t){return t.PulseOscillator=function(){var e=t.defaults(arguments,["frequency","width"],t.Oscillator);t.Source.call(this,e),this.width=new t.Signal(e.width,t.Type.NormalRange),this._widthGate=new t.Gain,this._sawtooth=new t.Oscillator({frequency:e.frequency,detune:e.detune,type:"sawtooth",phase:e.phase}),this.frequency=this._sawtooth.frequency,this.detune=this._sawtooth.detune,this._thresh=new t.WaveShaper(function(e){return e<0?-1:1}),this._sawtooth.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),this._readOnly(["width","frequency","detune"])},t.extend(t.PulseOscillator,t.Source),t.PulseOscillator.defaults={frequency:440,detune:0,phase:0,width:.2},t.PulseOscillator.prototype._start=function(e){e=this.toSeconds(e),this._sawtooth.start(e),this._widthGate.gain.setValueAtTime(1,e)},t.PulseOscillator.prototype._stop=function(e){e=this.toSeconds(e),this._sawtooth.stop(e),this._widthGate.gain.setValueAtTime(0,e)},t.PulseOscillator.prototype.restart=function(e){this._sawtooth.restart(e)},Object.defineProperty(t.PulseOscillator.prototype,"phase",{get:function(){return this._sawtooth.phase},set:function(e){this._sawtooth.phase=e}}),Object.defineProperty(t.PulseOscillator.prototype,"type",{get:function(){return"pulse"}}),Object.defineProperty(t.PulseOscillator.prototype,"partials",{get:function(){return[]}}),t.PulseOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._sawtooth.dispose(),this._sawtooth=null,this._writable(["width","frequency","detune"]),this.width.dispose(),this.width=null,this._widthGate.dispose(),this._widthGate=null,this._thresh.dispose(),this._thresh=null,this.frequency=null,this.detune=null,this},t.PulseOscillator}),e(function(t){return t.PWMOscillator=function(){var e=t.defaults(arguments,["frequency","modulationFrequency"],t.PWMOscillator);t.Source.call(this,e),this._pulse=new t.PulseOscillator(e.modulationFrequency),this._pulse._sawtooth.type="sine",this._modulator=new t.Oscillator({frequency:e.frequency,detune:e.detune,phase:e.phase}),this._scale=new t.Multiply(2),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this.modulationFrequency=this._pulse.frequency,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),this._readOnly(["modulationFrequency","frequency","detune"])},t.extend(t.PWMOscillator,t.Source),t.PWMOscillator.defaults={frequency:440,detune:0,phase:0,modulationFrequency:.4},t.PWMOscillator.prototype._start=function(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)},t.PWMOscillator.prototype._stop=function(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)},t.PWMOscillator.prototype.restart=function(e){this._modulator.restart(e),this._pulse.restart(e)},Object.defineProperty(t.PWMOscillator.prototype,"type",{get:function(){return"pwm"}}),Object.defineProperty(t.PWMOscillator.prototype,"partials",{get:function(){return[]}}),Object.defineProperty(t.PWMOscillator.prototype,"phase",{get:function(){return this._modulator.phase},set:function(e){this._modulator.phase=e}}),t.PWMOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._pulse.dispose(),this._pulse=null,this._scale.dispose(),this._scale=null,this._modulator.dispose(),this._modulator=null,this._writable(["modulationFrequency","frequency","detune"]),this.frequency=null,this.detune=null,this.modulationFrequency=null,this},t.PWMOscillator}),e(function(t){return t.FMOscillator=function(){var e=t.defaults(arguments,["frequency","type","modulationType"],t.FMOscillator);t.Source.call(this,e),this._carrier=new t.Oscillator(e.frequency,e.type),this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.detune=this._carrier.detune,this.detune.value=e.detune,this.modulationIndex=new t.Multiply(e.modulationIndex),this.modulationIndex.units=t.Type.Positive,this._modulator=new t.Oscillator(e.frequency,e.modulationType),this.harmonicity=new t.Multiply(e.harmonicity),this.harmonicity.units=t.Type.Positive,this._modulationNode=new t.Gain(0),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),this.phase=e.phase,this._readOnly(["modulationIndex","frequency","detune","harmonicity"])},t.extend(t.FMOscillator,t.Source),t.FMOscillator.defaults={frequency:440,detune:0,phase:0,modulationIndex:2,modulationType:"square",harmonicity:1},t.FMOscillator.prototype._start=function(e){this._modulator.start(e),this._carrier.start(e)},t.FMOscillator.prototype._stop=function(e){this._modulator.stop(e),this._carrier.stop(e)},t.FMOscillator.prototype.restart=function(e){this._modulator.restart(e),this._carrier.restart(e)},Object.defineProperty(t.FMOscillator.prototype,"type",{get:function(){return this._carrier.type},set:function(e){this._carrier.type=e}}),Object.defineProperty(t.FMOscillator.prototype,"modulationType",{get:function(){return this._modulator.type},set:function(e){this._modulator.type=e}}),Object.defineProperty(t.FMOscillator.prototype,"phase",{get:function(){return this._carrier.phase},set:function(e){this._carrier.phase=e,this._modulator.phase=e}}),Object.defineProperty(t.FMOscillator.prototype,"partials",{get:function(){return this._carrier.partials},set:function(e){this._carrier.partials=e}}),t.FMOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._writable(["modulationIndex","frequency","detune","harmonicity"]),this.frequency.dispose(),this.frequency=null,this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this._modulationNode.dispose(),this._modulationNode=null,this.modulationIndex.dispose(),this.modulationIndex=null,this},t.FMOscillator}),e(function(t){return t.AMOscillator=function(){var e=t.defaults(arguments,["frequency","type","modulationType"],t.AMOscillator);t.Source.call(this,e),this._carrier=new t.Oscillator(e.frequency,e.type),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this.detune.value=e.detune,this._modulator=new t.Oscillator(e.frequency,e.modulationType),this._modulationScale=new t.AudioToGain,this.harmonicity=new t.Multiply(e.harmonicity),this.harmonicity.units=t.Type.Positive,this._modulationNode=new t.Gain(0),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.connect(this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),this.phase=e.phase,this._readOnly(["frequency","detune","harmonicity"])},t.extend(t.AMOscillator,t.Oscillator),t.AMOscillator.defaults={frequency:440,detune:0,phase:0,modulationType:"square",harmonicity:1},t.AMOscillator.prototype._start=function(e){this._modulator.start(e),this._carrier.start(e)},t.AMOscillator.prototype._stop=function(e){this._modulator.stop(e),this._carrier.stop(e)},t.AMOscillator.prototype.restart=function(e){this._modulator.restart(e),this._carrier.restart(e)},Object.defineProperty(t.AMOscillator.prototype,"type",{get:function(){return this._carrier.type},set:function(e){this._carrier.type=e}}),Object.defineProperty(t.AMOscillator.prototype,"modulationType",{get:function(){return this._modulator.type},set:function(e){this._modulator.type=e}}),Object.defineProperty(t.AMOscillator.prototype,"phase",{get:function(){return this._carrier.phase},set:function(e){this._carrier.phase=e,this._modulator.phase=e}}),Object.defineProperty(t.AMOscillator.prototype,"partials",{get:function(){return this._carrier.partials},set:function(e){this._carrier.partials=e}}),t.AMOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._writable(["frequency","detune","harmonicity"]),this.frequency=null,this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this._modulationNode.dispose(),this._modulationNode=null,this._modulationScale.dispose(),this._modulationScale=null,this},t.AMOscillator}),e(function(r){return r.FatOscillator=function(){var e=r.defaults(arguments,["frequency","type","spread"],r.FatOscillator);r.Source.call(this,e),this.frequency=new r.Signal(e.frequency,r.Type.Frequency),this.detune=new r.Signal(e.detune,r.Type.Cents),this._oscillators=[],this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=r.defaultArg(e.partials,[]),this.count=e.count,this._readOnly(["frequency","detune"])},r.extend(r.FatOscillator,r.Source),r.FatOscillator.defaults={frequency:440,detune:0,phase:0,spread:20,count:3,type:"sawtooth"},r.FatOscillator.prototype._start=function(t){t=this.toSeconds(t),this._forEach(function(e){e.start(t)})},r.FatOscillator.prototype._stop=function(t){t=this.toSeconds(t),this._forEach(function(e){e.stop(t)})},r.FatOscillator.prototype.restart=function(t){t=this.toSeconds(t),this._forEach(function(e){e.restart(t)})},r.FatOscillator.prototype._forEach=function(e){for(var t=0;t<this._oscillators.length;t++)e.call(this,this._oscillators[t],t)},Object.defineProperty(r.FatOscillator.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t,this._forEach(function(e){e.type=t})}}),Object.defineProperty(r.FatOscillator.prototype,"spread",{get:function(){return this._spread},set:function(e){if(this._spread=e,1<this._oscillators.length){var n=-e/2,r=e/(this._oscillators.length-1);this._forEach(function(e,t){e.detune.value=n+r*t})}}}),Object.defineProperty(r.FatOscillator.prototype,"count",{get:function(){return this._oscillators.length},set:function(e){if(e=Math.max(e,1),this._oscillators.length!==e){this._forEach(function(e){e.dispose()}),this._oscillators=[];for(var t=0;t<e;t++){var n=new r.Oscillator;this.type===r.Oscillator.Type.Custom?n.partials=this._partials:n.type=this._type,n.phase=this._phase,n.volume.value=-6-1.1*e,this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.connect(this.output),this._oscillators[t]=n}this.spread=this._spread,this.state===r.State.Started&&this._forEach(function(e){e.start()})}}}),Object.defineProperty(r.FatOscillator.prototype,"phase",{get:function(){return this._phase},set:function(t){this._phase=t,this._forEach(function(e){e.phase=t})}}),Object.defineProperty(r.FatOscillator.prototype,"partials",{get:function(){return this._partials},set:function(t){this._partials=t,this._type=r.Oscillator.Type.Custom,this._forEach(function(e){e.partials=t})}}),r.FatOscillator.prototype.dispose=function(){return r.Source.prototype.dispose.call(this),this._writable(["frequency","detune"]),this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this._forEach(function(e){e.dispose()}),this._oscillators=null,this._partials=null,this},r.FatOscillator}),e(function(i){i.OmniOscillator=function(){var e=i.defaults(arguments,["frequency","type"],i.OmniOscillator);i.Source.call(this,e),this.frequency=new i.Signal(e.frequency,i.Type.Frequency),this.detune=new i.Signal(e.detune,i.Type.Cents),this._sourceType=void 0,this._oscillator=null,this.type=e.type,this._readOnly(["frequency","detune"]),this.set(e)},i.extend(i.OmniOscillator,i.Source),i.OmniOscillator.defaults={frequency:440,detune:0,type:"sine",phase:0};var t="PulseOscillator",n="PWMOscillator",r="Oscillator",o="FMOscillator",a="AMOscillator",s="FatOscillator";return i.OmniOscillator.prototype._start=function(e){this._oscillator.start(e)},i.OmniOscillator.prototype._stop=function(e){this._oscillator.stop(e)},i.OmniOscillator.prototype.restart=function(e){this._oscillator.restart(e)},Object.defineProperty(i.OmniOscillator.prototype,"type",{get:function(){var e="";return this._sourceType===o?e="fm":this._sourceType===a?e="am":this._sourceType===s&&(e="fat"),e+this._oscillator.type},set:function(e){"fm"===e.substr(0,2)?(this._createNewOscillator(o),this._oscillator.type=e.substr(2)):"am"===e.substr(0,2)?(this._createNewOscillator(a),this._oscillator.type=e.substr(2)):"fat"===e.substr(0,3)?(this._createNewOscillator(s),this._oscillator.type=e.substr(3)):"pwm"===e?this._createNewOscillator(n):"pulse"===e?this._createNewOscillator(t):(this._createNewOscillator(r),this._oscillator.type=e)}}),Object.defineProperty(i.OmniOscillator.prototype,"partials",{get:function(){return this._oscillator.partials},set:function(e){this._oscillator.partials=e}}),i.OmniOscillator.prototype.set=function(e,t){return"type"===e?this.type=t:i.isObject(e)&&e.hasOwnProperty("type")&&(this.type=e.type),i.prototype.set.apply(this,arguments),this},i.OmniOscillator.prototype._createNewOscillator=function(e){if(e!==this._sourceType){this._sourceType=e;var t=i[e],n=this.now();if(null!==this._oscillator){var r=this._oscillator;r.stop(n),this.context.setTimeout(function(){r.dispose(),r=null},this.blockTime)}this._oscillator=new t,this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this.state===i.State.Started&&this._oscillator.start(n)}},Object.defineProperty(i.OmniOscillator.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(e){this._oscillator.phase=e}}),Object.defineProperty(i.OmniOscillator.prototype,"width",{get:function(){if(this._sourceType===t)return this._oscillator.width}}),Object.defineProperty(i.OmniOscillator.prototype,"count",{get:function(){if(this._sourceType===s)return this._oscillator.count},set:function(e){this._sourceType===s&&(this._oscillator.count=e)}}),Object.defineProperty(i.OmniOscillator.prototype,"spread",{get:function(){if(this._sourceType===s)return this._oscillator.spread},set:function(e){this._sourceType===s&&(this._oscillator.spread=e)}}),Object.defineProperty(i.OmniOscillator.prototype,"modulationType",{get:function(){if(this._sourceType===o||this._sourceType===a)return this._oscillator.modulationType},set:function(e){this._sourceType!==o&&this._sourceType!==a||(this._oscillator.modulationType=e)}}),Object.defineProperty(i.OmniOscillator.prototype,"modulationIndex",{get:function(){if(this._sourceType===o)return this._oscillator.modulationIndex}}),Object.defineProperty(i.OmniOscillator.prototype,"harmonicity",{get:function(){if(this._sourceType===o||this._sourceType===a)return this._oscillator.harmonicity}}),Object.defineProperty(i.OmniOscillator.prototype,"modulationFrequency",{get:function(){if(this._sourceType===n)return this._oscillator.modulationFrequency}}),i.OmniOscillator.prototype.dispose=function(){return i.Source.prototype.dispose.call(this),this._writable(["frequency","detune"]),this.detune.dispose(),this.detune=null,this.frequency.dispose(),this.frequency=null,this._oscillator.dispose(),this._oscillator=null,this._sourceType=null,this},i.OmniOscillator}),e(function(o){return o.Instrument=function(e){e=o.defaultArg(e,o.Instrument.defaults),o.AudioNode.call(this),this._volume=this.output=new o.Volume(e.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._scheduledEvents=[]},o.extend(o.Instrument,o.AudioNode),o.Instrument.defaults={volume:0},o.Instrument.prototype.triggerAttack=o.noOp,o.Instrument.prototype.triggerRelease=o.noOp,o.Instrument.prototype.sync=function(){return this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this},o.Instrument.prototype._syncMethod=function(e,r){var i=this["_original_"+e]=this[e];this[e]=function(){var t=Array.prototype.slice.call(arguments),e=t[r],n=o.Transport.schedule(function(e){t[r]=e,i.apply(this,t)}.bind(this),e);this._scheduledEvents.push(n)}.bind(this)},o.Instrument.prototype.unsync=function(){return this._scheduledEvents.forEach(function(e){o.Transport.clear(e)}),this._scheduledEvents=[],this._original_triggerAttack&&(this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this},o.Instrument.prototype.triggerAttackRelease=function(e,t,n,r){return n=this.toSeconds(n),t=this.toSeconds(t),this.triggerAttack(e,n,r),this.triggerRelease(n+t),this},o.Instrument.prototype.dispose=function(){return o.AudioNode.prototype.dispose.call(this),this._volume.dispose(),this._volume=null,this._writable(["volume"]),this.volume=null,this.unsync(),this._scheduledEvents=null,this},o.Instrument}),e(function(t){return t.Monophonic=function(e){e=t.defaultArg(e,t.Monophonic.defaults),t.Instrument.call(this,e),this.portamento=e.portamento},t.extend(t.Monophonic,t.Instrument),t.Monophonic.defaults={portamento:0},t.Monophonic.prototype.triggerAttack=function(e,t,n){return t=this.toSeconds(t),this._triggerEnvelopeAttack(t,n),this.setNote(e,t),this},t.Monophonic.prototype.triggerRelease=function(e){return e=this.toSeconds(e),this._triggerEnvelopeRelease(e),this},t.Monophonic.prototype._triggerEnvelopeAttack=function(){},t.Monophonic.prototype._triggerEnvelopeRelease=function(){},t.Monophonic.prototype.getLevelAtTime=function(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)},t.Monophonic.prototype.setNote=function(e,t){if(t=this.toSeconds(t),0<this.portamento&&.05<this.getLevelAtTime(t)){var n=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(e,n,t)}else this.frequency.setValueAtTime(e,t);return this},t.Monophonic}),e(function(t){return t.Synth=function(e){e=t.defaultArg(e,t.Synth.defaults),t.Monophonic.call(this,e),this.oscillator=new t.OmniOscillator(e.oscillator),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new t.AmplitudeEnvelope(e.envelope),this.oscillator.chain(this.envelope,this.output),this._readOnly(["oscillator","frequency","detune","envelope"])},t.extend(t.Synth,t.Monophonic),t.Synth.defaults={oscillator:{type:"triangle"},envelope:{attack:.005,decay:.1,sustain:.3,release:1}},t.Synth.prototype._triggerEnvelopeAttack=function(e,t){return this.envelope.triggerAttack(e,t),this.oscillator.start(e),0===this.envelope.sustain&&this.oscillator.stop(e+this.envelope.attack+this.envelope.decay),this},t.Synth.prototype._triggerEnvelopeRelease=function(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.oscillator.stop(e+this.envelope.release),this},t.Synth.prototype.dispose=function(){return t.Monophonic.prototype.dispose.call(this),this._writable(["oscillator","frequency","detune","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this.frequency=null,this.detune=null,this},t.Synth}),e(function(t){return t.AMSynth=function(e){e=t.defaultArg(e,t.AMSynth.defaults),t.Monophonic.call(this,e),this._carrier=new t.Synth,this._carrier.volume.value=-10,this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope.set(e.envelope),this._modulator=new t.Synth,this._modulator.volume.value=-10,this.modulation=this._modulator.oscillator.set(e.modulation),this.modulationEnvelope=this._modulator.envelope.set(e.modulationEnvelope),this.frequency=new t.Signal(440,t.Type.Frequency),this.detune=new t.Signal(e.detune,t.Type.Cents),this.harmonicity=new t.Multiply(e.harmonicity),this.harmonicity.units=t.Type.Positive,this._modulationScale=new t.AudioToGain,this._modulationNode=new t.Gain,this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),this._readOnly(["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])},t.extend(t.AMSynth,t.Monophonic),t.AMSynth.defaults={harmonicity:3,detune:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},modulation:{type:"square"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}},t.AMSynth.prototype._triggerEnvelopeAttack=function(e,t){return e=this.toSeconds(e),this._carrier._triggerEnvelopeAttack(e,t),this._modulator._triggerEnvelopeAttack(e),this},t.AMSynth.prototype._triggerEnvelopeRelease=function(e){return this._carrier._triggerEnvelopeRelease(e),this._modulator._triggerEnvelopeRelease(e),this},t.AMSynth.prototype.dispose=function(){return t.Monophonic.prototype.dispose.call(this),this._writable(["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"]),this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._modulationScale.dispose(),this._modulationScale=null,this._modulationNode.dispose(),this._modulationNode=null,this.oscillator=null,this.envelope=null,this.modulationEnvelope=null,this.modulation=null,this},t.AMSynth}),e(function(t){return t.MonoSynth=function(e){e=t.defaultArg(e,t.MonoSynth.defaults),t.Monophonic.call(this,e),this.oscillator=new t.OmniOscillator(e.oscillator),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new t.Filter(e.filter),this.filterEnvelope=new t.FrequencyEnvelope(e.filterEnvelope),this.envelope=new t.AmplitudeEnvelope(e.envelope),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),this._readOnly(["oscillator","frequency","detune","filter","filterEnvelope","envelope"])},t.extend(t.MonoSynth,t.Monophonic),t.MonoSynth.defaults={frequency:"C4",detune:0,oscillator:{type:"square"},filter:{Q:6,type:"lowpass",rolloff:-24},envelope:{attack:.005,decay:.1,sustain:.9,release:1},filterEnvelope:{attack:.06,decay:.2,sustain:.5,release:2,baseFrequency:200,octaves:7,exponent:2}},t.MonoSynth.prototype._triggerEnvelopeAttack=function(e,t){return e=this.toSeconds(e),this.envelope.triggerAttack(e,t),this.filterEnvelope.triggerAttack(e),this.oscillator.start(e),0===this.envelope.sustain&&this.oscillator.stop(e+this.envelope.attack+this.envelope.decay),this},t.MonoSynth.prototype._triggerEnvelopeRelease=function(e){return this.envelope.triggerRelease(e),this.filterEnvelope.triggerRelease(e),this.oscillator.stop(e+this.envelope.release),this},t.MonoSynth.prototype.dispose=function(){return t.Monophonic.prototype.dispose.call(this),this._writable(["oscillator","frequency","detune","filter","filterEnvelope","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this.filterEnvelope.dispose(),this.filterEnvelope=null,this.filter.dispose(),this.filter=null,this.frequency=null,this.detune=null,this},t.MonoSynth}),e(function(t){return t.DuoSynth=function(e){e=t.defaultArg(e,t.DuoSynth.defaults),t.Monophonic.call(this,e),this.voice0=new t.MonoSynth(e.voice0),this.voice0.volume.value=-10,this.voice1=new t.MonoSynth(e.voice1),this.voice1.volume.value=-10,this._vibrato=new t.LFO(e.vibratoRate,-50,50),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new t.Gain(e.vibratoAmount,t.Type.Positive),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new t.Signal(440,t.Type.Frequency),this.harmonicity=new t.Multiply(e.harmonicity),this.harmonicity.units=t.Type.Positive,this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),this._readOnly(["voice0","voice1","frequency","vibratoAmount","vibratoRate"])},t.extend(t.DuoSynth,t.Monophonic),t.DuoSynth.defaults={vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}},voice1:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}},t.DuoSynth.prototype._triggerEnvelopeAttack=function(e,t){return e=this.toSeconds(e),this.voice0._triggerEnvelopeAttack(e,t),this.voice1._triggerEnvelopeAttack(e,t),this},t.DuoSynth.prototype._triggerEnvelopeRelease=function(e){return this.voice0._triggerEnvelopeRelease(e),this.voice1._triggerEnvelopeRelease(e),this},t.DuoSynth.prototype.getLevelAtTime=function(e){return(this.voice0.getLevelAtTime(e)+this.voice1.getLevelAtTime(e))/2},t.DuoSynth.prototype.dispose=function(){return t.Monophonic.prototype.dispose.call(this),this._writable(["voice0","voice1","frequency","vibratoAmount","vibratoRate"]),this.voice0.dispose(),this.voice0=null,this.voice1.dispose(),this.voice1=null,this.frequency.dispose(),this.frequency=null,this._vibratoGain.dispose(),this._vibratoGain=null,this._vibrato=null,this.harmonicity.dispose(),this.harmonicity=null,this.vibratoAmount.dispose(),this.vibratoAmount=null,this.vibratoRate=null,this},t.DuoSynth}),e(function(t){return t.FMSynth=function(e){e=t.defaultArg(e,t.FMSynth.defaults),t.Monophonic.call(this,e),this._carrier=new t.Synth(e.carrier),this._carrier.volume.value=-10,this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope.set(e.envelope),this._modulator=new t.Synth(e.modulator),this._modulator.volume.value=-10,this.modulation=this._modulator.oscillator.set(e.modulation),this.modulationEnvelope=this._modulator.envelope.set(e.modulationEnvelope),this.frequency=new t.Signal(440,t.Type.Frequency),this.detune=new t.Signal(e.detune,t.Type.Cents),this.harmonicity=new t.Multiply(e.harmonicity),this.harmonicity.units=t.Type.Positive,this.modulationIndex=new t.Multiply(e.modulationIndex),this.modulationIndex.units=t.Type.Positive,this._modulationNode=new t.Gain(0),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this._readOnly(["frequency","harmonicity","modulationIndex","oscillator","envelope","modulation","modulationEnvelope","detune"])},t.extend(t.FMSynth,t.Monophonic),t.FMSynth.defaults={harmonicity:3,modulationIndex:10,detune:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},modulation:{type:"square"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}},t.FMSynth.prototype._triggerEnvelopeAttack=function(e,t){return e=this.toSeconds(e),this._carrier._triggerEnvelopeAttack(e,t),this._modulator._triggerEnvelopeAttack(e),this},t.FMSynth.prototype._triggerEnvelopeRelease=function(e){return e=this.toSeconds(e),this._carrier._triggerEnvelopeRelease(e),this._modulator._triggerEnvelopeRelease(e),this},t.FMSynth.prototype.dispose=function(){return t.Monophonic.prototype.dispose.call(this),this._writable(["frequency","harmonicity","modulationIndex","oscillator","envelope","modulation","modulationEnvelope","detune"]),this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this.modulationIndex.dispose(),this.modulationIndex=null,this.harmonicity.dispose(),this.harmonicity=null,this._modulationNode.dispose(),this._modulationNode=null,this.oscillator=null,this.envelope=null,this.modulationEnvelope=null,this.modulation=null,this},t.FMSynth}),e(function(t){return t.MembraneSynth=function(e){e=t.defaultArg(e,t.MembraneSynth.defaults),t.Instrument.call(this,e),this.oscillator=new t.OmniOscillator(e.oscillator),this.envelope=new t.AmplitudeEnvelope(e.envelope),this.octaves=e.octaves,this.pitchDecay=e.pitchDecay,this.oscillator.chain(this.envelope,this.output),this._readOnly(["oscillator","envelope"])},t.extend(t.MembraneSynth,t.Instrument),t.MembraneSynth.defaults={pitchDecay:.05,octaves:10,oscillator:{type:"sine"},envelope:{attack:.001,decay:.4,sustain:.01,release:1.4,attackCurve:"exponential"}},t.MembraneSynth.prototype.triggerAttack=function(e,t,n){t=this.toSeconds(t);var r=(e=this.toFrequency(e))*this.octaves;return this.oscillator.frequency.setValueAtTime(r,t),this.oscillator.frequency.exponentialRampToValueAtTime(e,t+this.toSeconds(this.pitchDecay)),this.envelope.triggerAttack(t,n),this.oscillator.start(t),this},t.MembraneSynth.prototype.triggerRelease=function(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.oscillator.stop(e+this.envelope.release),this},t.MembraneSynth.prototype.dispose=function(){return t.Instrument.prototype.dispose.call(this),this._writable(["oscillator","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this},t.MembraneSynth}),e(function(i){var o=[1,1.483,1.932,2.546,2.63,3.897];return i.MetalSynth=function(e){e=i.defaultArg(e,i.MetalSynth.defaults),i.Instrument.call(this,e),this.frequency=new i.Signal(e.frequency,i.Type.Frequency),this._oscillators=[],this._freqMultipliers=[],this._amplitue=new i.Gain(0).connect(this.output),this._highpass=new i.Filter({type:"highpass",Q:-3.0102999566398125}).connect(this._amplitue),this._octaves=e.octaves,this._filterFreqScaler=new i.Scale(e.resonance,7e3),this.envelope=new i.Envelope({attack:e.envelope.attack,attackCurve:"linear",decay:e.envelope.decay,sustain:0,release:e.envelope.release}).chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitue.gain);for(var t=0;t<o.length;t++){var n=new i.FMOscillator({type:"square",modulationType:"square",harmonicity:e.harmonicity,modulationIndex:e.modulationIndex});n.connect(this._highpass),this._oscillators[t]=n;var r=new i.Multiply(o[t]);this._freqMultipliers[t]=r,this.frequency.chain(r,n.frequency)}this.octaves=e.octaves},i.extend(i.MetalSynth,i.Instrument),i.MetalSynth.defaults={frequency:200,envelope:{attack:.001,decay:1.4,release:.2},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1.5},i.MetalSynth.prototype.triggerAttack=function(t,e){return t=this.toSeconds(t),e=i.defaultArg(e,1),this.envelope.triggerAttack(t,e),this._oscillators.forEach(function(e){e.start(t)}),0===this.envelope.sustain&&this._oscillators.forEach(function(e){e.stop(t+this.envelope.attack+this.envelope.decay)}.bind(this)),this},i.MetalSynth.prototype.triggerRelease=function(t){return t=this.toSeconds(t),this.envelope.triggerRelease(t),this._oscillators.forEach(function(e){e.stop(t+this.envelope.release)}.bind(this)),this},i.MetalSynth.prototype.sync=function(){return this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0),this},i.MetalSynth.prototype.triggerAttackRelease=function(e,t,n){return t=this.toSeconds(t),e=this.toSeconds(e),this.triggerAttack(t,n),this.triggerRelease(t+e),this},Object.defineProperty(i.MetalSynth.prototype,"modulationIndex",{get:function(){return this._oscillators[0].modulationIndex.value},set:function(e){for(var t=0;t<this._oscillators.length;t++)this._oscillators[t].modulationIndex.value=e}}),Object.defineProperty(i.MetalSynth.prototype,"harmonicity",{get:function(){return this._oscillators[0].harmonicity.value},set:function(e){for(var t=0;t<this._oscillators.length;t++)this._oscillators[t].harmonicity.value=e}}),Object.defineProperty(i.MetalSynth.prototype,"resonance",{get:function(){return this._filterFreqScaler.min},set:function(e){this._filterFreqScaler.min=e,this.octaves=this._octaves}}),Object.defineProperty(i.MetalSynth.prototype,"octaves",{get:function(){return this._octaves},set:function(e){this._octaves=e,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,e)}}),i.MetalSynth.prototype.dispose=function(){i.Instrument.prototype.dispose.call(this);for(var e=0;e<this._oscillators.length;e++)this._oscillators[e].dispose(),this._freqMultipliers[e].dispose();this._oscillators=null,this._freqMultipliers=null,this.frequency.dispose(),this.frequency=null,this._filterFreqScaler.dispose(),this._filterFreqScaler=null,this._amplitue.dispose(),this._amplitue=null,this.envelope.dispose(),this.envelope=null,this._highpass.dispose(),this._highpass=null},i.MetalSynth}),e(function(t){return t.NoiseSynth=function(e){e=t.defaultArg(e,t.NoiseSynth.defaults),t.Instrument.call(this,e),this.noise=new t.Noise,this.envelope=new t.AmplitudeEnvelope(e.envelope),this.noise.chain(this.envelope,this.output),this._readOnly(["noise","envelope"])},t.extend(t.NoiseSynth,t.Instrument),t.NoiseSynth.defaults={noise:{type:"white"},envelope:{attack:.005,decay:.1,sustain:0}},t.NoiseSynth.prototype.triggerAttack=function(e,t){return this.envelope.triggerAttack(e,t),this.noise.start(e),0===this.envelope.sustain&&this.noise.stop(e=this.envelope.attack+this.envelope.decay),this},t.NoiseSynth.prototype.triggerRelease=function(e){return this.envelope.triggerRelease(e),this.noise.stop(e+this.envelope.release),this},t.NoiseSynth.prototype.sync=function(){return this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0),this},t.NoiseSynth.prototype.triggerAttackRelease=function(e,t,n){return t=this.toSeconds(t),e=this.toSeconds(e),this.triggerAttack(t,n),this.triggerRelease(t+e),this},t.NoiseSynth.prototype.dispose=function(){return t.Instrument.prototype.dispose.call(this),this._writable(["noise","envelope"]),this.noise.dispose(),this.noise=null,this.envelope.dispose(),this.envelope=null,this},t.NoiseSynth}),e(function(t){return t.PluckSynth=function(e){e=t.defaultArg(e,t.PluckSynth.defaults),t.Instrument.call(this,e),this._noise=new t.Noise("pink"),this.attackNoise=e.attackNoise,this._lfcf=new t.LowpassCombFilter({resonance:e.resonance,dampening:e.dampening}),this.resonance=this._lfcf.resonance,this.dampening=this._lfcf.dampening,this._noise.connect(this._lfcf),this._lfcf.connect(this.output),this._readOnly(["resonance","dampening"])},t.extend(t.PluckSynth,t.Instrument),t.PluckSynth.defaults={attackNoise:1,dampening:4e3,resonance:.7},t.PluckSynth.prototype.triggerAttack=function(e,t){e=this.toFrequency(e),t=this.toSeconds(t);var n=1/e;return this._lfcf.delayTime.setValueAtTime(n,t),this._noise.start(t),this._noise.stop(t+n*this.attackNoise),this},t.PluckSynth.prototype.dispose=function(){return t.Instrument.prototype.dispose.call(this),this._noise.dispose(),this._lfcf.dispose(),this._noise=null,this._lfcf=null,this._writable(["resonance","dampening"]),this.dampening=null,this.resonance=null,this},t.PluckSynth}),e(function(a){return a.PolySynth=function(){var e=a.defaults(arguments,["polyphony","voice"],a.PolySynth);a.Instrument.call(this,e),(e=a.defaultArg(e,a.Instrument.defaults)).polyphony=Math.min(a.PolySynth.MAX_POLYPHONY,e.polyphony),this.voices=new Array(e.polyphony),this._triggers=new Array(e.polyphony),this.detune=new a.Signal(e.detune,a.Type.Cents),this._readOnly("detune");for(var t=0;t<e.polyphony;t++){var n=new e.voice(arguments[2],arguments[3]);if(!(n instanceof a.Monophonic))throw new Error("Synth constructor must be instance of Tone.Monophonic");(this.voices[t]=n).connect(this.output),n.hasOwnProperty("detune")&&this.detune.connect(n.detune),this._triggers[t]={release:-1,note:null,voice:n}}},a.extend(a.PolySynth,a.Instrument),a.PolySynth.defaults={polyphony:4,volume:0,detune:0,voice:a.Synth},a.PolySynth.prototype.triggerAttack=function(e,t,n){Array.isArray(e)||(e=[e]),t=this.toSeconds(t);for(var r=0;r<e.length;r++){for(var i=e[r],o=this._triggers[0],a=1;a<this._triggers.length;a++)this._triggers[a].release<o.release&&(o=this._triggers[a]);o.release=1/0,o.note=JSON.stringify(i),o.voice.triggerAttack(i,t,n)}return this},a.PolySynth.prototype.triggerAttackRelease=function(e,t,n,r){if(n=this.toSeconds(n),this.triggerAttack(e,n,r),a.isArray(t)&&a.isArray(e))for(var i=0;i<e.length;i++){var o=t[Math.min(i,t.length-1)];this.triggerRelease(e[i],n+this.toSeconds(o))}else this.triggerRelease(e,n+this.toSeconds(t));return this},a.PolySynth.prototype.triggerRelease=function(e,t){Array.isArray(e)||(e=[e]),t=this.toSeconds(t);for(var n=0;n<e.length;n++)for(var r=JSON.stringify(e[n]),i=0;i<this._triggers.length;i++){var o=this._triggers[i];o.note===r&&o.release>t&&(o.voice.triggerRelease(t),o.release=t)}return this},a.PolySynth.prototype.sync=function(){return this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this},a.PolySynth.prototype.set=function(e,t,n){for(var r=0;r<this.voices.length;r++)this.voices[r].set(e,t,n);return this},a.PolySynth.prototype.get=function(e){return this.voices[0].get(e)},a.PolySynth.prototype.releaseAll=function(e){e=this.toSeconds(e);for(var t=0;t<this._triggers.length;t++){var n=this._triggers[t];n.release>e&&(n.release=e,n.voice.triggerRelease(e))}return this},a.PolySynth.prototype.dispose=function(){a.Instrument.prototype.dispose.call(this);for(var e=0;e<this.voices.length;e++)this.voices[e].dispose(),this.voices[e]=null;return this._writable("detune"),this.detune.dispose(),this.detune=null,this.voices=null,this._triggers=null,this},a.PolySynth.MAX_POLYPHONY=20,a.PolySynth}),e(function(u){return u.Sampler=function(e){var t=Array.prototype.slice.call(arguments);t.shift();var n=u.defaults(t,["onload","baseUrl"],u.Sampler);u.Instrument.call(this,n);var r={};for(var i in e)if(u.isNote(i)){r[u.Frequency(i).toMidi()]=e[i]}else{if(isNaN(parseFloat(i)))throw new Error("Tone.Sampler: url keys must be the note's pitch");r[i]=e[i]}this._buffers=new u.Buffers(r,n.onload,n.baseUrl),this._activeSources={},this.attack=n.attack,this.release=n.release},u.extend(u.Sampler,u.Instrument),u.Sampler.defaults={attack:0,release:.1,onload:u.noOp,baseUrl:""},u.Sampler.prototype._findClosest=function(e){for(var t=0;t<96;){if(this._buffers.has(e+t))return-t;if(this._buffers.has(e-t))return t;t++}return null},u.Sampler.prototype.triggerAttack=function(e,t,n){var r=u.Frequency(e).toMidi(),i=this._findClosest(r);if(null!==i){var o=r-i,a=this._buffers.get(o),s=new u.BufferSource({buffer:a,playbackRate:u.intervalToFrequencyRatio(i),fadeIn:this.attack,fadeOut:this.release,curve:"exponential"}).connect(this.output);s.start(t,0,a.duration,n),u.isArray(this._activeSources[r])||(this._activeSources[r]=[]),this._activeSources[r].push({note:r,source:s})}return this},u.Sampler.prototype.triggerRelease=function(e,t){var n=u.Frequency(e).toMidi();if(this._activeSources[n]&&this._activeSources[n].length){var r=this._activeSources[n].shift().source;t=this.toSeconds(t),r.stop(t+this.release,this.release)}return this},u.Sampler.prototype.releaseAll=function(e){for(var t in e=this.toSeconds(e),this._activeSources)for(var n=this._activeSources[t];n.length;){n.shift().source.stop(e+this.release,this.release)}return this},u.Sampler.prototype.sync=function(){return this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this},u.Sampler.prototype.triggerAttackRelease=function(e,t,n,r){return n=this.toSeconds(n),t=this.toSeconds(t),this.triggerAttack(e,n,r),this.triggerRelease(e,n+t),this},u.Sampler.prototype.add=function(e,t,n){if(u.isNote(e)){var r=u.Frequency(e).toMidi();this._buffers.add(r,t,n)}else{if(isNaN(parseFloat(e)))throw new Error("Tone.Sampler: note must be the note's pitch. Instead got "+e);this._buffers.add(e,t,n)}},Object.defineProperty(u.Sampler.prototype,"loaded",{get:function(){return this._buffers.loaded}}),u.Sampler.prototype.dispose=function(){for(var e in u.Instrument.prototype.dispose.call(this),this._buffers.dispose(),this._buffers=null,this._activeSources)this._activeSources[e].forEach(function(e){e.source.dispose()});return this._activeSources=null,this},u.Sampler}),e(function(e){e.supported&&(OscillatorNode.prototype.setPeriodicWave||(OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable),AudioContext.prototype.createPeriodicWave||(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable))}),e(function(e){return e.GainToAudio=function(){e.SignalBase.call(this),this._norm=this.input=this.output=new e.WaveShaper(function(e){return 2*Math.abs(e)-1})},e.extend(e.GainToAudio,e.SignalBase),e.GainToAudio.prototype.dispose=function(){return e.SignalBase.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},e.GainToAudio}),e(function(n){return n.Normalize=function(e,t){n.SignalBase.call(this),this._inputMin=n.defaultArg(e,0),this._inputMax=n.defaultArg(t,1),this._sub=this.input=new n.Add(0),this._div=this.output=new n.Multiply(1),this._sub.connect(this._div),this._setRange()},n.extend(n.Normalize,n.SignalBase),Object.defineProperty(n.Normalize.prototype,"min",{get:function(){return this._inputMin},set:function(e){this._inputMin=e,this._setRange()}}),Object.defineProperty(n.Normalize.prototype,"max",{get:function(){return this._inputMax},set:function(e){this._inputMax=e,this._setRange()}}),n.Normalize.prototype._setRange=function(){this._sub.value=-this._inputMin,this._div.value=1/(this._inputMax-this._inputMin)},n.Normalize.prototype.dispose=function(){return n.SignalBase.prototype.dispose.call(this),this._sub.dispose(),this._sub=null,this._div.dispose(),this._div=null,this},n.Normalize}),e(function(i){return i.TransportTimelineSignal=function(){i.Signal.apply(this,arguments),this.output=this._outputSig=new i.Signal(this._initialValue),this._lastVal=this.value,this._synced=i.Transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._bindAnchorValue=this._anchorValue.bind(this),i.Transport.on("start stop pause",this._bindAnchorValue),this._events.memory=1/0},i.extend(i.TransportTimelineSignal,i.Signal),i.TransportTimelineSignal.prototype._onTick=function(e){var t=this.getValueAtTime(i.Transport.seconds);this._lastVal!==t&&(this._lastVal=t,this._outputSig.linearRampToValueAtTime(t,e))},i.TransportTimelineSignal.prototype._anchorValue=function(e){var t=this.getValueAtTime(i.Transport.seconds);return this._lastVal=t,this._outputSig.cancelScheduledValues(e),this._outputSig.setValueAtTime(t,e),this},i.TransportTimelineSignal.prototype.getValueAtTime=function(e){return e=i.TransportTime(e),i.Signal.prototype.getValueAtTime.call(this,e)},i.TransportTimelineSignal.prototype.setValueAtTime=function(e,t){return t=i.TransportTime(t),i.Signal.prototype.setValueAtTime.call(this,e,t),this},i.TransportTimelineSignal.prototype.linearRampToValueAtTime=function(e,t){return t=i.TransportTime(t),i.Signal.prototype.linearRampToValueAtTime.call(this,e,t),this},i.TransportTimelineSignal.prototype.exponentialRampToValueAtTime=function(e,t){return t=i.TransportTime(t),i.Signal.prototype.exponentialRampToValueAtTime.call(this,e,t),this},i.TransportTimelineSignal.prototype.setTargetAtTime=function(e,t,n){return t=i.TransportTime(t),i.Signal.prototype.setTargetAtTime.call(this,e,t,n),this},i.TransportTimelineSignal.prototype.cancelScheduledValues=function(e){return e=i.TransportTime(e),i.Signal.prototype.cancelScheduledValues.call(this,e),this},i.TransportTimelineSignal.prototype.setValueCurveAtTime=function(e,t,n,r){return t=i.TransportTime(t),n=i.TransportTime(n),i.Signal.prototype.setValueCurveAtTime.call(this,e,t,n,r),this},i.TransportTimelineSignal.prototype.cancelAndHoldAtTime=function(e){return i.Signal.prototype.cancelAndHoldAtTime.call(this,i.TransportTime(e))},i.TransportTimelineSignal.prototype.dispose=function(){i.Transport.clear(this._synced),i.Transport.off("start stop pause",this._syncedCallback),this._events.cancel(0),i.Signal.prototype.dispose.call(this),this._outputSig.dispose(),this._outputSig=null},i.TransportTimelineSignal}),e(function(r){return r.GrainPlayer=function(){var e=r.defaults(arguments,["url","onload"],r.GrainPlayer);r.Source.call(this,e),this.buffer=new r.Buffer(e.url,e.onload),this._clock=new r.Clock(this._tick.bind(this),e.grainSize),this._loopStart=0,this._loopEnd=0,this._activeSources=[],this._playbackRate=e.playbackRate,this._grainSize=e.grainSize,this._overlap=e.overlap,this.detune=e.detune,this.overlap=e.overlap,this.loop=e.loop,this.playbackRate=e.playbackRate,this.grainSize=e.grainSize,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.reverse=e.reverse,this._clock.on("stop",this._onstop.bind(this))},r.extend(r.GrainPlayer,r.Source),r.GrainPlayer.defaults={onload:r.noOp,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1},r.GrainPlayer.prototype._start=function(e,t,n){t=r.defaultArg(t,0),t=this.toSeconds(t),e=this.toSeconds(e),this._offset=t,this._clock.start(e),n&&this.stop(e+this.toSeconds(n))},r.GrainPlayer.prototype._stop=function(e){this._clock.stop(e)},r.GrainPlayer.prototype._onstop=function(t){this._activeSources.forEach(function(e){e.stop(t,0)})},r.GrainPlayer.prototype._tick=function(e){var t=this._offset<this._overlap?0:this._overlap,n=new r.BufferSource({buffer:this.buffer,fadeIn:t,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:r.intervalToFrequencyRatio(this.detune/100)}).connect(this.output);n.start(e,this._offset),this._offset+=this.grainSize,n.stop(e+this.grainSize),this._activeSources.push(n),n.onended=function(){var e=this._activeSources.indexOf(n);-1!==e&&this._activeSources.splice(e,1)}.bind(this)},r.GrainPlayer.prototype.seek=function(e,t){return this._offset=this.toSeconds(e),this._tick(this.toSeconds(t)),this},Object.defineProperty(r.GrainPlayer.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(e){this._playbackRate=e,this.grainSize=this._grainSize}}),Object.defineProperty(r.GrainPlayer.prototype,"loopStart",{get:function(){return this._loopStart},set:function(e){this._loopStart=this.toSeconds(e)}}),Object.defineProperty(r.GrainPlayer.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(e){this._loopEnd=this.toSeconds(e)}}),Object.defineProperty(r.GrainPlayer.prototype,"reverse",{get:function(){return this.buffer.reverse},set:function(e){this.buffer.reverse=e}}),Object.defineProperty(r.GrainPlayer.prototype,"grainSize",{get:function(){return this._grainSize},set:function(e){this._grainSize=this.toSeconds(e),this._clock.frequency.value=this._playbackRate/this._grainSize}}),Object.defineProperty(r.GrainPlayer.prototype,"overlap",{get:function(){return this._overlap},set:function(e){this._overlap=this.toSeconds(e)}}),r.GrainPlayer.prototype.dispose=function(){return r.Source.prototype.dispose.call(this),this.buffer.dispose(),this.buffer=null,this._clock.dispose(),this._clock=null,this._activeSources.forEach(function(e){e.dispose()}),this._activeSources=null,this},r.GrainPlayer}),e(function(o){return o.Player=function(e){var t;e instanceof o.Buffer&&e.loaded?(e=e.get(),t=o.Player.defaults):t=o.defaults(arguments,["url","onload"],o.Player),o.Source.call(this,t),this.autostart=t.autostart,this._buffer=new o.Buffer({url:t.url,onload:this._onload.bind(this,t.onload),reverse:t.reverse}),e instanceof AudioBuffer&&this._buffer.set(e),this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this._activeSources=[],this._elapsedTime=new o.TickSource(t.playbackRate),this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut},o.extend(o.Player,o.Source),o.Player.defaults={onload:o.noOp,playbackRate:1,loop:!1,autostart:!1,loopStart:0,loopEnd:0,retrigger:!1,reverse:!1,fadeIn:0,fadeOut:0},o.Player.prototype.load=function(e,t){return this._buffer.load(e,this._onload.bind(this,t))},o.Player.prototype._onload=function(e){(e=o.defaultArg(e,o.noOp))(this),this.autostart&&this.start()},o.Player.prototype._onSourceEnd=function(e){var t=this._activeSources.indexOf(e);this._activeSources.splice(t,1)},o.Player.prototype._start=function(e,t,n){t=this._loop?o.defaultArg(t,this._loopStart):o.defaultArg(t,0),t=this.toSeconds(t);var r=o.defaultArg(n,Math.max(this._buffer.duration-t,0));r=this.toSeconds(r),e=this.toSeconds(e),this._elapsedTime.start(e,t);var i=new o.BufferSource({buffer:this._buffer,loop:this._loop,loopStart:this._loopStart,loopEnd:this._loopEnd,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate,fadeIn:this.fadeIn,fadeOut:this.fadeOut}).connect(this.output);return this._loop||this._synced||this._state.setStateAtTime(o.State.Stopped,e+r/this._playbackRate),this._activeSources.push(i),this._loop&&o.isUndef(n)?i.start(e,t):i.start(e,t,r),this},o.Player.prototype._stop=function(t){return t=this.toSeconds(t),this._elapsedTime.stop(t),this._activeSources.forEach(function(e){e.stop(t)}),this},o.Player.prototype.restart=function(e,t,n){return this._stop(e),this._start(e,t,n),this},o.Player.prototype.seek=function(e,t){return t=this.toSeconds(t),this._state.getValueAtTime(t)===o.State.Started&&(e=this.toSeconds(e),this._stop(t),this._start(t,e)),this},o.Player.prototype.setLoopPoints=function(e,t){return this.loopStart=e,this.loopEnd=t,this},Object.defineProperty(o.Player.prototype,"loopStart",{get:function(){return this._loopStart},set:function(t){this._loopStart=t,this._activeSources.forEach(function(e){e.loopStart=t})}}),Object.defineProperty(o.Player.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(t){this._loopEnd=t,this._activeSources.forEach(function(e){e.loopEnd=t})}}),Object.defineProperty(o.Player.prototype,"buffer",{get:function(){return this._buffer},set:function(e){this._buffer.set(e)}}),Object.defineProperty(o.Player.prototype,"loop",{get:function(){return this._loop},set:function(t){if(this._loop!==t){this._loop=t;var e=this.now();if(t){var n=this._state.getNextState(o.State.Stopped,e);n&&(this._activeSources.forEach(function(e){e.loop=t}),this._state.cancel(n.time),this._elapsedTime.cancel(n.time))}else this._stopAtNextIteration(e)}}}),o.Player.prototype._stopAtNextIteration=function(e){if(this._state.getValueAtTime(e)===o.State.Started){var t=this._state.getNextState(o.State.Stopped,e),n=this._elapsedTime.getTicksAtTime(e),r=Math.max(Math.ceil(n/this.buffer.duration),1),i=this._elapsedTime.getTimeOfTick(r*this.buffer.duration,t?t.time-this.sampleTime:1/0);this.stop(i)}},Object.defineProperty(o.Player.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t;var n=this.now();this._elapsedTime.frequency.setValueAtTime(t,n),this._loop||this._stopAtNextIteration(n),this._activeSources.forEach(function(e){e.playbackRate.setValueAtTime(t,n)})}}),Object.defineProperty(o.Player.prototype,"position",{get:function(){var e=this.now();if(this._state.getValueAtTime(e)===o.State.Started&&this.loaded){var t=this.buffer.duration;return this._elapsedTime.getTicksAtTime(e)%t}return 0}}),Object.defineProperty(o.Player.prototype,"reverse",{get:function(){return this._buffer.reverse},set:function(e){this._buffer.reverse=e}}),Object.defineProperty(o.Player.prototype,"loaded",{get:function(){return this._buffer.loaded}}),o.Player.prototype.dispose=function(){return this._activeSources.forEach(function(e){e.dispose()}),this._activeSources=null,o.Source.prototype.dispose.call(this),this._buffer.dispose(),this._buffer=null,this._elapsedTime.dispose(),this._elapsedTime=null,this},o.Player}),e(function(i){return i.Players=function(e){var t=Array.prototype.slice.call(arguments);t.shift();var n=i.defaults(t,["onload"],i.Players);for(var r in i.call(this),this._volume=this.output=new i.Volume(n.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._volume.output.output.channelCount=2,this._volume.output.output.channelCountMode="explicit",this.mute=n.mute,this._players={},this._loadingCount=0,this._fadeIn=n.fadeIn,this._fadeOut=n.fadeOut,e)this._loadingCount++,this.add(r,e[r],this._bufferLoaded.bind(this,n.onload))},i.extend(i.Players,i.AudioNode),i.Players.defaults={volume:0,mute:!1,onload:i.noOp,fadeIn:0,fadeOut:0},i.Players.prototype._bufferLoaded=function(e){this._loadingCount--,0===this._loadingCount&&e&&e(this)},Object.defineProperty(i.Players.prototype,"mute",{get:function(){return this._volume.mute},set:function(e){this._volume.mute=e}}),Object.defineProperty(i.Players.prototype,"fadeIn",{get:function(){return this._fadeIn},set:function(t){this._fadeIn=t,this._forEach(function(e){e.fadeIn=t})}}),Object.defineProperty(i.Players.prototype,"fadeOut",{get:function(){return this._fadeOut},set:function(t){this._fadeOut=t,this._forEach(function(e){e.fadeOut=t})}}),Object.defineProperty(i.Players.prototype,"state",{get:function(){var t=!1;return this._forEach(function(e){t=t||e.state===i.State.Started}),t?i.State.Started:i.State.Stopped}}),i.Players.prototype.has=function(e){return this._players.hasOwnProperty(e)},i.Players.prototype.get=function(e){if(this.has(e))return this._players[e];throw new Error("Tone.Players: no player named "+e)},i.Players.prototype._forEach=function(e){for(var t in this._players)e(this._players[t],t);return this},Object.defineProperty(i.Players.prototype,"loaded",{get:function(){var t=!0;return this._forEach(function(e){t=t&&e.loaded}),t}}),i.Players.prototype.add=function(e,t,n){return this._players[e]=new i.Player(t,n).connect(this.output),this._players[e].fadeIn=this._fadeIn,this._players[e].fadeOut=this._fadeOut,this},i.Players.prototype.stopAll=function(t){this._forEach(function(e){e.stop(t)})},i.Players.prototype.dispose=function(){return i.AudioNode.prototype.dispose.call(this),this._volume.dispose(),this._volume=null,this._writable("volume"),this.volume=null,this.output=null,this._forEach(function(e){e.dispose()}),this._players=null,this},i.Players}),e(function(i){return i.UserMedia=function(){var e=i.defaults(arguments,["volume"],i.UserMedia);i.AudioNode.call(this),this._mediaStream=null,this._stream=null,this._device=null,this._volume=this.output=new i.Volume(e.volume),this.volume=this._volume.volume,this._readOnly("volume"),this.mute=e.mute},i.extend(i.UserMedia,i.AudioNode),i.UserMedia.defaults={volume:0,mute:!1},i.UserMedia.prototype.open=function(r){return i.UserMedia.enumerateDevices().then(function(e){var t;if(i.isNumber(r))t=e[r];else if(!(t=e.find(function(e){return e.label===r||e.deviceId===r}))&&0<e.length)t=e[0];else if(!t&&i.isDefined(r))throw new Error("Tone.UserMedia: no matching device: "+r);this._device=t;var n={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate}};return t&&(n.audio.deviceId=t.deviceId),navigator.mediaDevices.getUserMedia(n).then(function(e){return this._stream||(this._stream=e,this._mediaStream=this.context.createMediaStreamSource(e),this._mediaStream.connect(this.output)),this}.bind(this))}.bind(this))},i.UserMedia.prototype.close=function(){return this._stream&&(this._stream.getAudioTracks().forEach(function(e){e.stop()}),this._stream=null,this._mediaStream.disconnect(),this._mediaStream=null),this._device=null,this},i.UserMedia.enumerateDevices=function(){return navigator.mediaDevices.enumerateDevices().then(function(e){return e.filter(function(e){return"audioinput"===e.kind})})},Object.defineProperty(i.UserMedia.prototype,"state",{get:function(){return this._stream&&this._stream.active?i.State.Started:i.State.Stopped}}),Object.defineProperty(i.UserMedia.prototype,"deviceId",{get:function(){if(this._device)return this._device.deviceId}}),Object.defineProperty(i.UserMedia.prototype,"groupId",{get:function(){if(this._device)return this._device.groupId}}),Object.defineProperty(i.UserMedia.prototype,"label",{get:function(){if(this._device)return this._device.label}}),Object.defineProperty(i.UserMedia.prototype,"mute",{get:function(){return this._volume.mute},set:function(e){this._volume.mute=e}}),i.UserMedia.prototype.dispose=function(){return i.AudioNode.prototype.dispose.call(this),this.close(),this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null,this},Object.defineProperty(i.UserMedia,"supported",{get:function(){return i.isDefined(navigator.mediaDevices)&&i.isFunction(navigator.mediaDevices.getUserMedia)}}),i.UserMedia}),e(function(n){return n.Midi=function(e,t){if(!(this instanceof n.Midi))return new n.Midi(e,t);n.Frequency.call(this,e,t)},n.extend(n.Midi,n.Frequency),n.Midi.prototype._defaultUnits="midi",n.Midi.prototype._frequencyToUnits=function(e){return n.Frequency.ftom(n.Frequency.prototype._frequencyToUnits.call(this,e))},n.Midi.prototype._ticksToUnits=function(e){return n.Frequency.ftom(n.Frequency.prototype._ticksToUnits.call(this,e))},n.Midi.prototype._beatsToUnits=function(e){return n.Frequency.ftom(n.Frequency.prototype._beatsToUnits.call(this,e))},n.Midi.prototype._secondsToUnits=function(e){return n.Frequency.ftom(n.Frequency.prototype._secondsToUnits.call(this,e))},n.Midi.prototype.toMidi=function(){return this.valueOf()},n.Midi.prototype.toFrequency=function(){return n.Frequency.mtof(this.toMidi())},n.Midi.prototype.transpose=function(e){return new this.constructor(this.toMidi()+e)},n.Midi}),t},"function"==typeof define&&define.amd?define(function(){return i()}):"object"==typeof t?t.exports=i():r.Tone=i()},{}],276:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("@tensorflow/tfjs-core");n.auxiliaryInputFromSpec=function(e){switch(e.type){case"BinaryCounter":return new s(e.args);default:throw new Error("Unknown auxiliary input: "+e)}};var a=function(e){this.depth=e},s=function(t){function e(e){return t.call(this,e.numBits)||this}return i(e,t),e.prototype.getTensors=function(e){for(var t=o.buffer([e,this.depth]),n=0;n<e;++n)for(var r=0;r<this.depth;++r)t.set(Math.floor((n+1)/Math.pow(2,r))%2?1:-1,n,r);return t.toTensor().as2D(e,this.depth)},e}(n.AuxiliaryInput=a);n.BinaryCounter=s},{"@tensorflow/tfjs-core":66}],277:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o,a,s=e("@tensorflow/tfjs-core"),u=e("tonal"),l=e("./constants"),c=[["1P","3M","5P"],["1P","3m","5P"],["1P","3M","5A"],["1P","3m","5d"]];(a=o=n.ChordQuality||(n.ChordQuality={}))[a.Major=0]="Major",a[a.Minor=1]="Minor",a[a.Augmented=2]="Augmented",a[a.Diminished=3]="Diminished",a[a.Other=4]="Other";var p=function(r){function e(e){var t=this.constructor,n=r.call(this,e)||this;return Object.setPrototypeOf(n,t.prototype),n}return i(e,r),e}(Error);n.ChordSymbolException=p;var h=function(r){function e(e){var t=this.constructor,n=r.call(this,e)||this;return Object.setPrototypeOf(n,t.prototype),n}return i(e,r),e}(Error);n.ChordEncodingException=h;var f=function(){function e(){}return e.pitches=function(e){if(!u.Chord.exists(e))throw new p("Unrecognized chord symbol: "+e);return u.Chord.notes(e).map(u.Note.chroma)},e.root=function(e){var t=u.Chord.tokenize(e)[0];if(!t)throw new p("Chord symbol has unknown root: "+e);return u.Note.chroma(t)},e.quality=function(e){if(!u.Chord.exists(e))throw new p("Unrecognized chord symbol: "+e);var t=u.Chord.intervals(e),n=c.map(function(e){return e.every(function(e){return t.includes(e)})}),r=n.indexOf(!0),i=n.lastIndexOf(!0);return 0<=r&&r===i?r:o.Other},e}();n.ChordSymbols=f;var d=function(){function e(){}return e.prototype.encodeProgression=function(e,t){var n=this,r=e.map(function(e){return n.encode(e)}),i=Array.from(Array(t).keys()).map(function(e){return Math.floor(e*r.length/t)});return s.stack(i.map(function(e){return r[e]}))},e}();n.ChordEncoder=d,n.chordEncoderFromType=function(e){switch(e){case"MajorMinorChordEncoder":return new m;case"TriadChordEncoder":return new y;case"PitchChordEncoder":return new g;default:throw new Error("Unknown chord encoder type: "+e)}};var m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.depth=1+2*l.NUM_PITCH_CLASSES,e}return i(e,t),e.prototype.index=function(e){if(e===l.NO_CHORD)return 0;var t=f.root(e),n=1+f.quality(e)*l.NUM_PITCH_CLASSES+t;if(n>=this.depth)throw new h("Chord is neither major nor minor: "+e);return n},e.prototype.encode=function(e){var t=this;return s.tidy(function(){return s.oneHot(s.tensor1d([t.index(e)],"int32"),t.depth).as1D()})},e}(d);n.MajorMinorChordEncoder=m;var y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.depth=1+4*l.NUM_PITCH_CLASSES,e}return i(e,t),e.prototype.index=function(e){if(e===l.NO_CHORD)return 0;var t=f.root(e),n=1+f.quality(e)*l.NUM_PITCH_CLASSES+t;if(n>=this.depth)throw new h("Chord is not a standard triad: "+e);return n},e.prototype.encode=function(e){var t=this;return s.tidy(function(){return s.oneHot(s.tensor1d([t.index(e)],"int32"),t.depth).as1D()})},e}(d);n.TriadChordEncoder=y;var g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.depth=1+3*l.NUM_PITCH_CLASSES,e}return i(e,t),e.prototype.encode=function(o){var a=this;return s.tidy(function(){if(o===l.NO_CHORD)return s.oneHot(s.tensor1d([0],"int32"),a.depth).as1D();var e=f.root(o),t=s.oneHot(s.tensor1d([e],"int32"),l.NUM_PITCH_CLASSES).as1D(),n=s.buffer([l.NUM_PITCH_CLASSES]);f.pitches(o).forEach(function(e){return n.set(1,e)});var r=n.toTensor().as1D(),i=t;return s.concat1d([s.tensor1d([0]),t,r,i])})},e}(d);n.PitchChordEncoder=g},{"./constants":278,"@tensorflow/tfjs-core":66,tonal:274}],278:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DEFAULT_QUARTERS_PER_MINUTE=120,n.DEFAULT_STEPS_PER_BAR=16,n.DEFAULT_STEPS_PER_QUARTER=4,n.DEFAULT_STEPS_PER_SECOND=100,n.DEFAULT_VELOCITY=80,n.DEFAULT_PROGRAM=0,n.DEFAULT_TICKS_PER_QUARTER=220,n.DEFAULT_CHANNEL=0,n.DRUM_CHANNEL=9,n.MIN_MIDI_VELOCITY=0,n.MAX_MIDI_VELOCITY=127,n.MIDI_VELOCITIES=n.MAX_MIDI_VELOCITY-n.MIN_MIDI_VELOCITY+1,n.NO_CHORD="N.C.",n.NUM_PITCH_CLASSES=12,n.MIN_MIDI_PITCH=0,n.MAX_MIDI_PITCH=127,n.MIDI_PITCHES=n.MAX_MIDI_PITCH-n.MIN_MIDI_PITCH+1,n.MIN_MIDI_PROGRAM=0,n.MAX_MIDI_PROGRAM=127,n.LO_CLICK_PITCH=89,n.HI_CLICK_PITCH=90,n.LO_CLICK_CLASS=9,n.HI_CLICK_CLASS=10},{}],279:[function(e,t,a){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),c=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},p=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(a,"__esModule",{value:!0});var h=e("@tensorflow/tfjs-core"),l=e("../protobuf/index"),f=e("./constants"),d=e("./performance"),m=e("./sequences");a.DEFAULT_DRUM_PITCH_CLASSES=[[36,35],[38,27,28,31,32,33,34,37,39,40,56,65,66,75,85],[42,44,54,68,69,70,71,73,78,80],[46,67,72,74,79,81],[45,29,41,61,64,84],[48,47,60,63,77,86,87],[50,30,43,62,76,83],[49,55,57,58],[51,52,53,59,82]],a.converterFromSpec=function(e){switch(e.type){case"MelodyConverter":return new y(e.args);case"DrumsConverter":return new o(e.args);case"DrumRollConverter":return new s(e.args);case"TrioConverter":return new g(e.args);case"DrumsOneHotConverter":return new u(e.args);case"MultitrackConverter":return new v(e.args);default:throw new Error("Unknown DataConverter type: "+e)}};var n=function(){function e(e){this.numSteps=e.numSteps,this.numSegments=e.numSegments}return e.prototype.tensorSteps=function(e){return h.scalar(e.shape[0],"int32")},e}(),o=function(o){function e(e){var n=o.call(this,e)||this;n.NUM_SPLITS=0,n.SEGMENTED_BY_TRACK=!1,n.pitchClasses=e.pitchClasses||a.DEFAULT_DRUM_PITCH_CLASSES,n.pitchToClass=new Map;for(var t=function(t){r.pitchClasses[t].forEach(function(e){n.pitchToClass.set(e,t)})},r=this,i=0;i<n.pitchClasses.length;++i)t(i);return n.depth=n.pitchClasses.length,n}return i(e,o),e.prototype.toTensor=function(e){var t=this;m.assertIsQuantizedSequence(e);for(var n=this.numSteps||e.totalQuantizedSteps,r=h.buffer([n,this.pitchClasses.length+1]),i=0;i<n;++i)r.set(1,i,-1);return e.notes.forEach(function(e){r.set(1,e.quantizedStartStep,t.pitchToClass.get(e.pitch)),r.set(0,e.quantizedStartStep,-1)}),r.toTensor()},e.prototype.toNoteSequence=function(a,s){return void 0===s&&(s=f.DEFAULT_QUARTERS_PER_MINUTE),c(this,void 0,void 0,function(){var t,n,r,i,o;return p(this,function(e){switch(e.label){case 0:return(t=l.NoteSequence.create()).quantizationInfo=l.NoteSequence.QuantizationInfo.create({stepsPerQuarter:s}),[4,(n=a.argMax(1)).data()];case 1:for(r=e.sent(),n.dispose(),i=0;i<r.length;++i)for(o=0;o<this.pitchClasses.length;o++)r[i]>>o&1&&t.notes.push(l.NoteSequence.Note.create({pitch:this.pitchClasses[o][0],quantizedStartStep:i,quantizedEndStep:i+1,isDrum:!0}));return t.totalQuantizedSteps=r.length,[2,t]}})})},e}(a.DataConverter=n),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.toNoteSequence=function(a,s){return void 0===s&&(s=f.DEFAULT_QUARTERS_PER_MINUTE),c(this,void 0,void 0,function(){var t,n,r,i,o;return p(this,function(e){switch(e.label){case 0:(t=l.NoteSequence.create()).quantizationInfo=l.NoteSequence.QuantizationInfo.create({stepsPerQuarter:s}),n=h.split(a,a.shape[0]),r=0,e.label=1;case 1:return r<a.shape[0]?[4,n[r].data()]:[3,4];case 2:for(i=e.sent(),n[r].dispose(),o=0;o<i.length;++o)i[o]&&t.notes.push(l.NoteSequence.Note.create({pitch:this.pitchClasses[o][0],quantizedStartStep:r,quantizedEndStep:r+1,isDrum:!0}));e.label=3;case 3:return++r,[3,1];case 4:return t.totalQuantizedSteps=a.shape[0],[2,t]}})})},t}(a.DrumsConverter=o);a.DrumRollConverter=s;var u=function(n){function e(e){var t=n.call(this,e)||this;return t.depth=Math.pow(2,t.pitchClasses.length),t}return i(e,n),e.prototype.toTensor=function(e){var t=this;m.assertIsRelativeQuantizedSequence(e);for(var n=this.numSteps||e.totalQuantizedSteps,r=Array(n).fill(0),i=0,o=e.notes;i<o.length;i++){var a=o[i],s=a.pitch,u=a.quantizedStartStep;r[u]+=Math.pow(2,this.pitchToClass.get(s))}return h.tidy(function(){return h.oneHot(h.tensor1d(r,"int32"),t.depth)})},e}(o);a.DrumsOneHotConverter=u;var y=function(n){function e(e){var t=n.call(this,e)||this;return t.NUM_SPLITS=0,t.SEGMENTED_BY_TRACK=!1,t.NOTE_OFF=1,t.FIRST_PITCH=2,t.minPitch=e.minPitch,t.maxPitch=e.maxPitch,t.depth=e.maxPitch-e.minPitch+1+t.FIRST_PITCH,t}return i(e,n),e.prototype.toTensor=function(e){var t=this;m.assertIsQuantizedSequence(e);var n=this.numSteps||e.totalQuantizedSteps,r=e.notes.sort(function(e,t){return e.quantizedStartStep-t.quantizedStartStep}),i=h.buffer([n],"int32"),o=-1;return r.forEach(function(e){if(e.quantizedStartStep<o)throw new Error("`NoteSequence` is not monophonic.");if(e.pitch<t.minPitch||e.pitch>t.maxPitch)throw Error("`NoteSequence` has a pitch outside of the valid range: "+e.pitch);i.set(e.pitch-t.minPitch+t.FIRST_PITCH,e.quantizedStartStep),i.set(t.NOTE_OFF,e.quantizedEndStep),o=e.quantizedEndStep}),h.tidy(function(){return h.oneHot(i.toTensor(),t.depth)})},e.prototype.toNoteSequence=function(s,u){return void 0===u&&(u=f.DEFAULT_QUARTERS_PER_MINUTE),c(this,void 0,void 0,function(){var t,n,r,i,o,a;return p(this,function(e){switch(e.label){case 0:return(t=l.NoteSequence.create()).quantizationInfo=l.NoteSequence.QuantizationInfo.create({stepsPerQuarter:u}),[4,(n=s.argMax(1)).data()];case 1:for(r=e.sent(),n.dispose(),i=null,o=0;o<r.length;++o)switch(a=r[o]){case 0:break;case 1:i&&(i.quantizedEndStep=o,t.notes.push(i),i=null);break;default:i&&(i.quantizedEndStep=o,t.notes.push(i)),i=l.NoteSequence.Note.create({pitch:a-this.FIRST_PITCH+this.minPitch,quantizedStartStep:o})}return i&&(i.quantizedEndStep=r.length,t.notes.push(i)),t.totalQuantizedSteps=r.length,[2,t]}})})},e}(n);a.MelodyConverter=y;var g=function(n){function e(e){var t=n.call(this,e)||this;return t.NUM_SPLITS=3,t.SEGMENTED_BY_TRACK=!1,t.MEL_PROG_RANGE=[0,31],t.BASS_PROG_RANGE=[32,39],e.melArgs.numSteps=e.numSteps,e.bassArgs.numSteps=e.numSteps,e.drumsArgs.numSteps=e.numSteps,t.melConverter=new y(e.melArgs),t.bassConverter=new y(e.bassArgs),t.drumsConverter=new u(e.drumsArgs),t.depth=t.melConverter.depth+t.bassConverter.depth+t.drumsConverter.depth,t}return i(e,n),e.prototype.toTensor=function(e){var t=this;m.assertIsQuantizedSequence(e);var n=m.clone(e),r=m.clone(e),i=m.clone(e);return n.notes=e.notes.filter(function(e){return!e.isDrum&&e.program>=t.MEL_PROG_RANGE[0]&&e.program<=t.MEL_PROG_RANGE[1]}),r.notes=e.notes.filter(function(e){return!e.isDrum&&e.program>=t.BASS_PROG_RANGE[0]&&e.program<=t.BASS_PROG_RANGE[1]}),i.notes=e.notes.filter(function(e){return e.isDrum}),h.tidy(function(){return h.concat([t.melConverter.toTensor(n),t.bassConverter.toTensor(r),t.drumsConverter.toTensor(i)],-1)})},e.prototype.toNoteSequence=function(u,l){return void 0===l&&(l=f.DEFAULT_QUARTERS_PER_MINUTE),c(this,void 0,void 0,function(){var t,n,r,i,o,a,s=this;return p(this,function(e){switch(e.label){case 0:return r=h.split(u,[this.melConverter.depth,this.bassConverter.depth,this.drumsConverter.depth],-1),[4,this.melConverter.toNoteSequence(r[0],l)];case 1:return(i=e.sent()).notes.forEach(function(e){e.instrument=0,e.program=0}),[4,this.bassConverter.toNoteSequence(r[1])];case 2:return o=e.sent(),(t=i.notes).push.apply(t,o.notes.map(function(e){return e.instrument=1,e.program=s.BASS_PROG_RANGE[0],e})),[4,this.drumsConverter.toNoteSequence(r[2])];case 3:return a=e.sent(),(n=i.notes).push.apply(n,a.notes.map(function(e){return e.instrument=2,e})),r.forEach(function(e){return e.dispose()}),[2,i]}})})},e}(n);a.TrioConverter=g;var v=function(n){function e(e){var t=n.call(this,e)||this;return t.NUM_SPLITS=0,t.SEGMENTED_BY_TRACK=!0,t.stepsPerQuarter=e.stepsPerQuarter,t.totalSteps=e.totalSteps,t.numVelocityBins=e.numVelocityBins,t.minPitch=e.minPitch?e.minPitch:f.MIN_MIDI_PITCH,t.maxPitch=e.maxPitch?e.maxPitch:f.MAX_MIDI_PITCH,t.numPitches=t.maxPitch-t.minPitch+1,t.performanceEventDepth=2*t.numPitches+t.totalSteps+t.numVelocityBins,t.numPrograms=f.MAX_MIDI_PROGRAM-f.MIN_MIDI_PROGRAM+2,t.endToken=t.performanceEventDepth+t.numPrograms,t.depth=t.endToken+1,t.endTensor=h.tidy(function(){return h.oneHot(h.tensor1d([t.endToken],"int32"),t.depth).as1D()}),t}return i(e,n),e.prototype.trackToTensor=function(e){var n=this,t=this.numSteps/this.numSegments,r=void 0;if(e){for(;e.events.length>t-2;)e.events.pop();(r=h.buffer([e.events.length+2],"int32")).set(this.performanceEventDepth+(e.isDrum?this.numPrograms-1:e.program),0),e.events.forEach(function(e,t){switch(e.type){case"note-on":r.set(e.pitch-n.minPitch,t+1);break;case"note-off":r.set(n.numPitches+e.pitch-n.minPitch,t+1);break;case"time-shift":r.set(2*n.numPitches+e.steps-1,t+1);break;case"velocity-change":r.set(2*n.numPitches+n.totalSteps+e.velocityBin-1,t+1);break;default:throw new Error("Unrecognized performance event: "+e)}}),r.set(this.endToken,e.events.length+1)}else r=h.buffer([1],"int32",new Int32Array([this.endToken]));return h.tidy(function(){var e=h.oneHot(r.toTensor(),n.depth);return e.pad([[0,t-e.shape[0]],[0,0]])})},e.prototype.toTensor=function(e){var t=this;if(m.assertIsRelativeQuantizedSequence(e),e.quantizationInfo.stepsPerQuarter!==this.stepsPerQuarter)throw new Error("Steps per quarter note mismatch: "+e.quantizationInfo.stepsPerQuarter+" != "+this.stepsPerQuarter);var n=m.clone(e);n.notes=e.notes.filter(function(e){return e.pitch>=t.minPitch&&e.pitch<=t.maxPitch});for(var r=new Set(n.notes.map(function(e){return e.instrument})),i=Array.from(r).map(function(e){return d.Performance.fromNoteSequence(n,t.totalSteps,t.numVelocityBins,e)}).sort(function(e,t){return t.isDrum?-1:e.isDrum?1:e.program-t.program});i.length>this.numSegments;)i.pop();for(i.forEach(function(e){return e.setNumSteps(t.totalSteps)});i.length<this.numSegments;)i.push(void 0);return h.tidy(function(){return h.concat(i.map(function(e){return t.trackToTensor(e)}),0)})},e.prototype.tokensToTrack=function(e){var t=this,n=e.indexOf(this.endToken),r=0<=n?n:e.length,i=e.slice(0,r),o=i.filter(function(e){return e<t.performanceEventDepth}),a=i.filter(function(e){return e>=t.performanceEventDepth}),s=a.length?a[0]-this.performanceEventDepth<this.numPrograms-1?[a[0]-this.performanceEventDepth,!1]:[0,!0]:[0,!1],u=s[0],l=s[1],c=Array.from(o).map(function(e){if(e<t.numPitches)return{type:"note-on",pitch:t.minPitch+e};if(e<2*t.numPitches)return{type:"note-off",pitch:t.minPitch+e-t.numPitches};if(e<2*t.numPitches+t.totalSteps)return{type:"time-shift",steps:e-2*t.numPitches+1};if(e<2*t.numPitches+t.totalSteps+t.numVelocityBins)return{type:"velocity-change",velocityBin:e-2*t.numPitches-t.totalSteps+1};throw new Error("Invalid performance event token: "+e)});return new d.Performance(c,this.totalSteps,this.numVelocityBins,u,l)},e.prototype.toNoteSequence=function(n,o){return void 0===o&&(o=this.stepsPerQuarter),c(this,void 0,void 0,function(){var r,t,i=this;return p(this,function(e){switch(e.label){case 0:return(r=l.NoteSequence.create()).quantizationInfo=l.NoteSequence.QuantizationInfo.create({stepsPerQuarter:o}),r.totalQuantizedSteps=this.totalSteps,t=h.tidy(function(){return h.split(n.argMax(1),i.numSegments)}),[4,Promise.all(t.map(function(r){return c(i,void 0,void 0,function(){var t,n;return p(this,function(e){switch(e.label){case 0:return[4,r.data()];case 1:return t=e.sent(),n=this.tokensToTrack(t),r.dispose(),[2,n]}})})}))];case 1:return e.sent().forEach(function(e,t){var n;e.setNumSteps(i.totalSteps),(n=r.notes).push.apply(n,e.toNoteSequence(t).notes)}),[2,r]}})})},e}(n);a.MultitrackConverter=v},{"../protobuf/index":294,"./constants":278,"./performance":282,"./sequences":285,"@tensorflow/tfjs-core":66}],280:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./aux_inputs");n.aux_inputs=i;var o=e("./chords");n.chords=o;var a=e("./constants");n.constants=a;var s=e("./data");n.data=s;var u=e("./sequences");n.sequences=u,r(e("./midi_io")),r(e("./player")),r(e("./recorder")),r(e("./visualizer"))},{"./aux_inputs":276,"./chords":277,"./constants":278,"./data":279,"./midi_io":281,"./player":283,"./recorder":284,"./sequences":285,"./visualizer":287}],281:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var h=e("midiconvert"),f=e("../protobuf"),d=e("./constants"),p=e("./sequences"),m=function(r){function e(e){var t=this.constructor,n=r.call(this,e)||this;return Object.setPrototypeOf(n,t.prototype),n}return i(e,r),e}(Error);n.MidiConversionError=m,n.midiToSequenceProto=function(e){var t=h.parse(e),n=f.NoteSequence.create();n.ticksPerQuarter=t.header.PPQ,n.sourceInfo=f.NoteSequence.SourceInfo.create({parser:f.NoteSequence.SourceInfo.Parser.TONEJS_MIDI_CONVERT,encodingType:f.NoteSequence.SourceInfo.EncodingType.MIDI}),t.header.timeSignature?n.timeSignatures.push(f.NoteSequence.TimeSignature.create({time:0,numerator:t.header.timeSignature[0],denominator:t.header.timeSignature[1]})):n.timeSignatures.push(f.NoteSequence.TimeSignature.create({time:0,numerator:4,denominator:4})),n.tempos.push(f.NoteSequence.Tempo.create({time:0,qpm:t.header.bpm}));for(var r=-1,i=0,o=t.tracks;i<o.length;i++){var a=o[i];0<a.notes.length&&(r+=1);for(var s=0,u=a.notes;s<u.length;s++){var l=u[s],c=l.time,p=c+l.duration;n.notes.push(f.NoteSequence.Note.create({instrument:r,program:a.instrumentNumber,startTime:c,endTime:p,pitch:l.midi,velocity:Math.floor(l.velocity*d.MIDI_VELOCITIES),isDrum:a.isPercussion})),p>n.totalTime&&(n.totalTime=p)}}return n},n.sequenceProtoToMidi=function(e){if(p.isQuantizedSequence(e)&&(e=p.unquantizeSequence(e)),e.tempos&&0!==e.tempos.length||(e.tempos=[{time:0,qpm:d.DEFAULT_QUARTERS_PER_MINUTE}]),e.timeSignatures&&0!==e.timeSignatures.length||(e.timeSignatures=[{time:0,numerator:4,denominator:4}]),1!==e.tempos.length||0!==e.tempos[0].time)throw new m("NoteSequence must have exactly 1 tempo at time 0");if(1!==e.timeSignatures.length||0!==e.timeSignatures[0].time)throw new m("NoteSequence must have exactly 1 time signature at time 0");for(var t={header:{bpm:e.tempos[0].qpm,PPQ:e.ticksPerQuarter?e.ticksPerQuarter:d.DEFAULT_TICKS_PER_QUARTER,timeSignature:[e.timeSignatures[0].numerator,e.timeSignatures[0].denominator]},tracks:[]},n=new Map,r=0,i=e.notes;r<i.length;r++){var o=i[r],a=o.instrument?o.instrument:0;n.has(a)||n.set(a,[]),n.get(a).push(o)}for(var s=Array.from(n.keys()).sort(function(e,t){return e-t}),u=0;u<s.length;u++){if(u!==s[u])throw new m("Instrument list must be continuous and start at 0");var l=n.get(u),c={id:u,notes:[],isPercussion:void 0!==l[0].isDrum&&l[0].isDrum,channelNumber:l[0].isDrum?d.DRUM_CHANNEL:d.DEFAULT_CHANNEL,instrumentNumber:void 0===l[0].program?d.DEFAULT_PROGRAM:l[0].program};c.notes=l.map(function(e){var t=void 0===e.velocity?d.DEFAULT_VELOCITY:e.velocity;return{midi:e.pitch,time:e.startTime,duration:e.endTime-e.startTime,velocity:(t+1)/d.MIDI_VELOCITIES}}),t.tracks.push(c)}return new Uint8Array(h.fromJSON(t).toArray())}},{"../protobuf":294,"./constants":278,"./sequences":285,midiconvert:245}],282:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var m=e("../protobuf/index"),w=e("./constants"),S=e("./sequences"),r=function(){function _(e,t,n,r,i){this.events=e,this.maxShiftSteps=t,this.numVelocityBins=n,this.program=r,this.isDrum=i}return _.fromNoteSequence=function(e,t,n,r){S.assertIsQuantizedSequence(e);for(var i=e.notes.filter(function(e,t){return void 0===r||e.instrument===r}),o=i.sort(function(e,t){return e.startTime===t.startTime?e.pitch-t.pitch:e.startTime-t.startTime}),a=o.map(function(e,t){return{step:e.quantizedStartStep,index:t,isOffset:0}}),s=o.map(function(e,t){return{step:e.quantizedEndStep,index:t,isOffset:1}}),u=a.concat(s).sort(function(e,t){return e.step===t.step?e.index===t.index?e.isOffset-t.isOffset:e.index-t.index:e.step-t.step}),l=n?Math.ceil((w.MIDI_VELOCITIES-1)/n):void 0,c=[],p=0,h=n,f=0,d=u;f<d.length;f++){var m=d[f];if(m.step>p){for(;m.step>p+t;)c.push({type:"time-shift",steps:t}),p+=t;c.push({type:"time-shift",steps:m.step-p}),p=m.step}if(m.isOffset)c.push({type:"note-off",pitch:o[m.index].pitch});else{if(l){var y=Math.floor((o[m.index].velocity-w.MIN_MIDI_VELOCITY-1)/l)+1;y!==h&&(c.push({type:"velocity-change",velocityBin:y}),h=y)}c.push({type:"note-on",pitch:o[m.index].pitch})}}var g=!!i.some(function(e){return e.isDrum})&&(!i.some(function(e){return!e.isDrum})||void 0),v=Array.from(new Set(i.map(function(e){return e.program}))),b=new _(c,t,n,g||1!==v.length?void 0:v[0],g);return b.setNumSteps(e.totalQuantizedSteps),b},_.prototype.getNumSteps=function(){return this.events.filter(function(e){return"time-shift"===e.type}).map(function(e){return e.steps}).reduce(function(e,t){return e+t},0)},_.prototype.setNumSteps=function(e){var t=this.getNumSteps();if(t<e){if(this.events.length){var n=this.events[this.events.length-1];if("time-shift"===n.type){var r=Math.min(e-t,this.maxShiftSteps-n.steps);n.steps+=r,t+=r}}for(;t<e;)t+this.maxShiftSteps>e?(this.events.push({type:"time-shift",steps:e-t}),t=e):(this.events.push({type:"time-shift",steps:this.maxShiftSteps}),t+=this.maxShiftSteps)}else if(e<t)for(;this.events.length&&e<t;){var i=this.events[this.events.length-1];"time-shift"===i.type?t-i.steps<e?(i.steps-=t-e,t=e):(this.events.pop(),t-=i.steps):this.events.pop()}},_.prototype.toNoteSequence=function(s){for(var u=this,e=this.numVelocityBins?Math.ceil((w.MIDI_VELOCITIES-1)/this.numVelocityBins):void 0,l=m.NoteSequence.create(),c=0,t=void 0,n=new Map,r=w.MIN_MIDI_PITCH;r<=w.MAX_MIDI_PITCH;++r)n.set(r,[]);for(var i=0,o=this.events;i<o.length;i++){var a=o[i];switch(a.type){case"note-on":n.get(a.pitch).push([c,t]);break;case"note-off":var p=n.get(a.pitch);if(p.length){var h=p.shift(),f=h[0],d=h[1];f<c?l.notes.push(m.NoteSequence.Note.create({pitch:a.pitch,velocity:d,instrument:s,quantizedStartStep:f,quantizedEndStep:c,program:this.program,isDrum:this.isDrum})):console.log("Ignoring zero-length note: (pitch = "+a.pitch+", step = "+c+")")}else console.log("Ignoring note-off with no previous note-on:(pitch = "+a.pitch+", step = "+c+")");break;case"time-shift":c+=a.steps;break;case"velocity-change":if(!e)throw new Error("Unexpected velocity change event: "+a);t=w.MIN_MIDI_VELOCITY+(a.velocityBin-1)*e+1;break;default:throw new Error("Unrecognized performance event: "+a)}}return n.forEach(function(e,t){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],a=i[1];o<c?l.notes.push(m.NoteSequence.Note.create({pitch:t,velocity:a,instrument:s,quantizedStartStep:o,quantizedEndStep:c,program:u.program,isDrum:u.isDrum})):console.log("Ignoring zero-length note: (pitch = "+t+", step = "+c+")")}}),l.totalQuantizedSteps=c,l},_}();n.Performance=r},{"../protobuf/index":294,"./constants":278,"./sequences":285}],283:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},s=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var u=e("tone"),l=e("."),c=e("./constants"),o=e("./data"),p=e("./soundfont");function h(e,t){return e.quantizedStartStep<t.quantizedStartStep?-1:e.quantizedStartStep>t.quantizedStartStep?1:e.pitch<t.pitch?-1:1}var f=function(){};n.BasePlayerCallback=f;var d=function(){function e(e,t){void 0===e&&(e=!1),this.playClick=e,this.callbackObject=t,this.desiredQPM=void 0}return e.prototype.setTempo=function(e){this.desiredQPM=e,"started"===u.Transport.state&&(u.Transport.bpm.value=e)},e.prototype.makeClickSequence=function(e){for(var t=l.sequences.clone(e),n=t.notes.map(function(e){return e.quantizedEndStep}),r=Math.max.apply(Math,n),i=0;i<r;i+=4){var o={pitch:i%16==0?c.LO_CLICK_PITCH:c.HI_CLICK_PITCH,quantizedStartStep:i,isDrum:!0,quantizedEndStep:i+1};t.notes.push(o)}return t.notes.sort(h),t},e.prototype.start=function(t,e){var n=this,r=l.sequences.isQuantizedSequence(t);if(this.playClick&&r&&(t=this.makeClickSequence(t)),e?u.Transport.bpm.value=e:t.tempos&&0<t.tempos.length&&0<t.tempos[0].qpm?u.Transport.bpm.value=t.tempos[0].qpm:u.Transport.bpm.value=c.DEFAULT_QUARTERS_PER_MINUTE,r)t=l.sequences.unquantizeSequence(t,e);else if(e)throw new Error("Cannot specify a `qpm` for a non-quantized sequence.");return this.currentPart=new u.Part(function(e,t){(n.playClick||t.pitch!==c.LO_CLICK_PITCH&&t.pitch!==c.HI_CLICK_PITCH)&&n.playNote(e,t),n.callbackObject&&u.Draw.schedule(function(){n.callbackObject.run(t,e)},e)},t.notes.map(function(e){return[e.startTime,e]})),this.desiredQPM&&(u.Transport.bpm.value=this.desiredQPM),this.currentPart.start(),"started"!==u.Transport.state&&u.Transport.start(),new Promise(function(e){n.scheduledStop=u.Transport.schedule(function(){n.stop(),e(),n.callbackObject&&n.callbackObject.stop()},"+"+t.totalTime)})},e.prototype.stop=function(){this.currentPart&&(this.currentPart.stop(),this.currentPart=null),u.Transport.clear(this.scheduledStop),this.scheduledStop=void 0,this.desiredQPM=void 0},e.prototype.isPlaying=function(){return!!this.currentPart},e}();n.BasePlayer=d;var m=function(){function e(){var n=this;this.DRUM_PITCH_TO_CLASS=new Map,this.kick=(new u.MembraneSynth).toMaster(),this.tomLow=new u.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toMaster(),this.tomMid=new u.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toMaster(),this.tomHigh=new u.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toMaster(),this.closedHihat=new u.MetalSynth({frequency:400,envelope:{attack:.001,decay:.1,release:.8},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toMaster(),this.openHihat=new u.MetalSynth({frequency:400,envelope:{attack:.001,decay:.5,release:.8,sustain:1},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toMaster(),this.ride=(new u.MetalSynth).toMaster(),this.crash=new u.MetalSynth({frequency:300,envelope:{attack:.001,decay:1,release:3},harmonicity:5.1,modulationIndex:64,resonance:4e3,octaves:1.5}).toMaster(),this.snare=new u.NoiseSynth({noise:{type:"white"},envelope:{attack:.005,decay:.05,sustain:.1,release:.4}}).toMaster(),this.loClick=new u.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toMaster(),this.hiClick=new u.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toMaster(),this.pitchPlayers=[function(e){return n.kick.triggerAttackRelease("C2","8n",e)},function(e){return n.snare.triggerAttackRelease("16n",e)},function(e){return n.closedHihat.triggerAttack(e,.3)},function(e){return n.openHihat.triggerAttack(e,.3)},function(e){return n.tomLow.triggerAttack("G3",e,.5)},function(e){return n.tomMid.triggerAttack("C4",e,.5)},function(e){return n.tomHigh.triggerAttack("F4",e,.5)},function(e){return n.crash.triggerAttack(e,1)},function(e){return n.ride.triggerAttack(e,.5)},function(e){return n.loClick.triggerAttack("G5",e,.5)},function(e){return n.hiClick.triggerAttack("C6",e,.5)}];for(var e=function(t){o.DEFAULT_DRUM_PITCH_CLASSES[t].forEach(function(e){n.DRUM_PITCH_TO_CLASS.set(e,t)})},t=0;t<o.DEFAULT_DRUM_PITCH_CLASSES.length;++t)e(t);this.DRUM_PITCH_TO_CLASS.set(c.LO_CLICK_PITCH,c.LO_CLICK_CLASS),this.DRUM_PITCH_TO_CLASS.set(c.HI_CLICK_PITCH,c.HI_CLICK_CLASS)}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.playNote=function(e,t){this.pitchPlayers[this.DRUM_PITCH_TO_CLASS.get(e)](t)},e}(),y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.synths=new Map,e.drumKit=m.getInstance(),e}return i(e,t),e.prototype.playNote=function(e,t){if(t.isDrum)this.drumKit.playNote(t.pitch,e);else{var n=new u.Frequency(t.pitch,"midi"),r=t.endTime-t.startTime;this.getSynth(t.instrument,t.program).triggerAttackRelease(n,r,e)}},e.prototype.getSynth=function(e,t){if(this.synths.has(e))return this.synths.get(e);if(void 0!==t&&32<=t&&t<=39){var n=new u.Synth({oscillator:{type:"triangle"}}).toMaster();n.volume.value=5,this.synths.set(e,n)}else this.synths.set(e,new u.PolySynth(10).toMaster());return this.synths.get(e)},e.tone=u,e}(d);n.Player=y;var g=function(o){function e(e,t,n,r){void 0===t&&(t=u.Master);var i=o.call(this)||this;return i.soundFont=new p.SoundFont(e),i.output=t,i.programOutputs=n,i.drumOutputs=r,i}return i(e,o),e.prototype.loadSamples=function(t){return a(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.soundFont.loadSamples(t.notes.map(function(e){return{pitch:e.pitch,velocity:e.velocity,program:e.program,isDrum:e.isDrum}}))];case 1:return e.sent(),[2]}})})},e.prototype.start=function(e,t){var n=this;return this.loadSamples(e).then(function(){return o.prototype.start.call(n,e,t)})},e.prototype.playNote=function(e,t){var n=this.output;this.programOutputs&&!t.isDrum?this.programOutputs.has(t.program)&&(n=this.programOutputs.get(t.program)):this.drumOutputs&&t.isDrum&&this.drumOutputs.has(t.pitch)&&(n=this.drumOutputs.get(t.pitch)),this.soundFont.playNote(t.pitch,t.velocity,e,t.endTime-t.startTime,t.program,t.isDrum,n)},e}(d);n.SoundFontPlayer=g;var v=function(t){function e(e){return t.call(this,!0,e)||this}return i(e,t),e}(y);n.PlayerWithClick=v},{".":280,"./constants":278,"./data":279,"./soundfont":286,tone:275}],284:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},i=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("../protobuf"),a=function(){};n.BaseRecorderCallback=a;var s=function(){function e(e){this.notes=[],this.midiInputs=[],this.callbackObject=e,this.recording=!1}return e.prototype.initialize=function(){return r(this,void 0,void 0,function(){var t=this;return i(this,function(e){switch(e.label){case 0:return[4,navigator.requestMIDIAccess().then(function(e){return t.midiReady(e)},function(e){return console.log("Something went wrong",e)})];case 1:return e.sent(),[2]}})})},e.prototype.midiReady=function(e){console.log("Initialized Recorder");for(var t=e.inputs.values(),n=t.next();n&&!n.done;n=t.next())this.midiInputs.push(n.value)},e.prototype.isRecording=function(){return this.recording},e.prototype.getMIDIInputs=function(){return this.midiInputs},e.prototype.start=function(e){for(var t=this,n=0,r=e||this.midiInputs;n<r.length;n++){r[n].onmidimessage=function(e){t.midiMessageReceived(e)}}this.recording=!0,this.firstNoteTimestamp=void 0,this.notes=[],this.onNotes=new Map},e.prototype.stop=function(){var n=this;this.recording=!1;var r=Date.now();this.onNotes.forEach(function(e,t){n.noteOff(t,r)});for(var e=0,t=this.midiInputs;e<t.length;e++){t[e].onmidimessage=null}return 0===this.notes.length?null:this.getNoteSequence()},e.prototype.getNoteSequence=function(){return 0===this.notes.length?null:o.NoteSequence.create({notes:this.notes,totalTime:this.notes[this.notes.length-1].endTime})},e.prototype.midiMessageReceived=function(e){if(this.recording){var t=e.timeStamp||Date.now();void 0===this.firstNoteTimestamp&&(this.firstNoteTimestamp=t);var n=e.data[0]>>4,r=e.data[1],i=2<e.data.length?e.data[2]:1;9===n?this.noteOn(r,i,t):8===n&&(this.noteOff(r,t),this.callbackObject&&this.callbackObject.run(this.getNoteSequence()))}},e.prototype.noteOn=function(e,t,n){var r=new o.NoteSequence.Note;r.pitch=e,r.startTime=(n-this.firstNoteTimestamp)/1e3,r.velocity=t,this.onNotes.set(e,r)},e.prototype.noteOff=function(e,t){var n=this.onNotes.get(e);n&&(n.endTime=(t-this.firstNoteTimestamp)/1e3,this.notes.push(n)),this.onNotes.delete(e)},e}();n.Recorder=s},{"../protobuf":294}],285:[function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var l=e("../protobuf/index"),c=e("./constants"),o=.5,p=function(r){function e(e){var t=this.constructor,n=r.call(this,e)||this;return Object.setPrototypeOf(n,t.prototype),n}return i(e,r),e}(Error);n.MultipleTimeSignatureException=p;var h=function(r){function e(e){var t=this.constructor,n=r.call(this,e)||this;return Object.setPrototypeOf(n,t.prototype),n}return i(e,r),e}(Error);n.BadTimeSignatureException=h;var f=function(r){function e(e){var t=this.constructor,n=r.call(this,e)||this;return Object.setPrototypeOf(n,t.prototype),n}return i(e,r),e}(Error);n.NegativeTimeException=f;var a=function(r){function e(e){var t=this.constructor,n=r.call(this,e)||this;return Object.setPrototypeOf(n,t.prototype),n}return i(e,r),e}(Error);n.MultipleTempoException=a;var s=function(r){function e(e){var t=this.constructor,n=r.call(this,e)||this;return Object.setPrototypeOf(n,t.prototype),n}return i(e,r),e}(Error);function d(e){return l.NoteSequence.decode(l.NoteSequence.encode(e).finish())}function m(e,t){return e*t/60}function y(e,t,n){void 0===n&&(n=o);var r=e*t;return Math.floor(r+(1-n))}function g(e){return e.controlChanges.concat(e.textAnnotations)}function v(e){if(e.tempos&&0!==e.tempos.length){if(e.tempos.sort(function(e,t){return e.time-t.time}),0!==e.tempos[0].time&&e.tempos[0].qpm!==c.DEFAULT_QUARTERS_PER_MINUTE)throw new a("NoteSequence has an implicit tempo change from initial "+c.DEFAULT_QUARTERS_PER_MINUTE+" qpm to "+e.tempos[0].qpm+" qpm at "+e.tempos[0].time+" seconds.");for(var t=1;t<e.tempos.length;t++)if(e.tempos[t].qpm!==e.tempos[0].qpm)throw new a("NoteSequence has at least one tempo change from "+e.tempos[0].qpm+" qpm to "+e.tempos[t].qpm+"qpm at "+e.tempos[t].time+" seconds.")}}function u(e){return e.quantizationInfo&&(0<e.quantizationInfo.stepsPerQuarter||0<e.quantizationInfo.stepsPerSecond)}function b(e){return e.quantizationInfo&&0<e.quantizationInfo.stepsPerQuarter}function _(e){if(!b(e))throw new s("NoteSequence "+e.id+" is not quantized or is quantized based on absolute timing")}function w(e){return e.quantizationInfo&&0<e.quantizationInfo.stepsPerSecond}n.QuantizationStatusException=s,n.clone=d,n.stepsPerQuarterToStepsPerSecond=m,n.quantizeToStep=y,n.quantizeNoteSequence=function(e,t){var n=d(e);if(n.quantizationInfo=l.NoteSequence.QuantizationInfo.create({stepsPerQuarter:t}),0<n.timeSignatures.length){if(n.timeSignatures.sort(function(e,t){return e.time-t.time}),0!==n.timeSignatures[0].time&&(4!==n.timeSignatures[0].numerator||4!==n.timeSignatures[0].denominator))throw new p("NoteSequence has an implicit change from initial 4/4 time signature to "+n.timeSignatures[0].numerator+"/"+n.timeSignatures[0].denominator+" at "+n.timeSignatures[0].time+" seconds.");for(var r=1;r<n.timeSignatures.length;r++)if((i=n.timeSignatures[r]).numerator!==n.timeSignatures[0].numerator||i.denominator!==n.timeSignatures[0].denominator)throw new p("NoteSequence has at least one time signature change from "+n.timeSignatures[0].numerator+"/"+n.timeSignatures[0].denominator+" to "+i.numerator+"/"+i.denominator+" at "+i.time+" seconds");n.timeSignatures[0].time=0,n.timeSignatures=[n.timeSignatures[0]]}else{var i=l.NoteSequence.TimeSignature.create({numerator:4,denominator:4,time:0});n.timeSignatures.push(i)}var o,a=n.timeSignatures[0];if(!(o=a.denominator)||0!=(o&o-1))throw new h("Denominator is not a power of 2. Time signature: "+a.numerator+"/"+a.denominator);if(0===a.numerator)throw new h("Numerator is 0. Time signature: "+a.numerator+"/"+a.denominator);if(0<n.tempos.length)v(n),n.tempos[0].time=0,n.tempos=[n.tempos[0]];else{var s=l.NoteSequence.Tempo.create({qpm:c.DEFAULT_QUARTERS_PER_MINUTE,time:0});n.tempos.push(s)}var u=m(t,n.tempos[0].qpm);return n.totalQuantizedSteps=y(e.totalTime,u),function(e,t){for(var n=0,r=e.notes;n<r.length;n++){var i=r[n];if(i.quantizedStartStep=y(i.startTime,t),i.quantizedEndStep=y(i.endTime,t),i.quantizedEndStep===i.quantizedStartStep&&(i.quantizedEndStep+=1),i.quantizedStartStep<0||i.quantizedEndStep<0)throw new f("Got negative note time: start_step = "+i.quantizedStartStep+", end_step = "+i.quantizedEndStep);i.quantizedEndStep>e.totalQuantizedSteps&&(e.totalQuantizedSteps=i.quantizedEndStep)}g(e).forEach(function(e){if(e.quantizedStep=y(e.time,t),e.quantizedStep<0)throw new f("Got negative event time: step = "+e.quantizedStep)})}(n,u),n},n.isQuantizedSequence=u,n.assertIsQuantizedSequence=function(e){if(!u(e))throw new s("NoteSequence "+e.id+" is not quantized (missing quantizationInfo)")},n.isRelativeQuantizedSequence=b,n.assertIsRelativeQuantizedSequence=_,n.isAbsoluteQuantizedSequence=w,n.assertIsAbsoluteQuantizedSequence=function(e){if(!w(e))throw new s("NoteSequence "+e.id+" is not quantized or is quantized based on relative timing")},n.unquantizeSequence=function(e,t){_(e),v(e);var n=d(e);t?n.tempos&&0<n.tempos.length?n.tempos[0].qpm=t:n.tempos.push(l.NoteSequence.Tempo.create({time:0,qpm:t})):t=e.tempos&&0<e.tempos.length?n.tempos[0].qpm:c.DEFAULT_QUARTERS_PER_MINUTE;var r=function(e){return e/n.quantizationInfo.stepsPerQuarter*(60/t)};return n.totalTime=r(n.totalQuantizedSteps),n.notes.forEach(function(e){e.startTime=r(e.quantizedStartStep),e.endTime=r(e.quantizedEndStep),n.totalTime=Math.max(n.totalTime,e.endTime)}),g(n).forEach(function(e){e.time=r(e.time)}),n},n.mergeInstruments=function(e){var t=d(e),n=t.notes.concat(t.pitchBends).concat(t.controlChanges),r=Array.from(new Set(n.filter(function(e){return!e.isDrum}).map(function(e){return e.program})));return n.forEach(function(e){e.isDrum?(e.program=0,e.instrument=r.length):e.instrument=r.indexOf(e.program)}),t}},{"../protobuf/index":294,"./constants":278}],286:[function(e,t,n){"use strict";var r=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},a=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var l=e("tone"),o=e("./constants"),i=function(){function e(e){this.FADE_SECONDS=.1,this.baseURL=e,this.buffers=new l.Buffers([]),this.initialized=!1}return e.prototype.initialize=function(){return r(this,void 0,void 0,function(){var t=this;return a(this,function(e){switch(e.label){case 0:return[4,fetch(this.baseURL+"/instrument.json").then(function(e){return e.json()}).then(function(e){t.name=e.name,t.minPitch=e.minPitch,t.maxPitch=e.maxPitch,t.durationSeconds=e.durationSeconds,t.releaseSeconds=e.releaseSeconds,t.percussive=e.percussive,t.velocities=e.velocities,t.initialized=!0})];case 1:return e.sent(),[2]}})})},e.prototype.sampleInfoToName=function(e){return this.velocities?"p"+e.pitch+"_v"+e.velocity:"p"+e.pitch},e.prototype.sampleNameToURL=function(e){return this.baseURL+"/"+e+".mp3"},e.prototype.nearestVelocity=function(n){if(!this.velocities)return n;n||(n=o.DEFAULT_VELOCITY);var r=void 0,i=o.MIDI_VELOCITIES;return this.velocities.forEach(function(e){var t=Math.abs(e-n);t<i&&(r=e,i=t)}),r},e.prototype.loadSamples=function(o){return r(this,void 0,void 0,function(){var t,n,r,i=this;return a(this,function(e){switch(e.label){case 0:return this.initialized?[3,2]:[4,this.initialize()];case 1:e.sent(),e.label=2;case 2:return t=o.filter(function(e){return!(e.pitch<i.minPitch||e.pitch>i.maxPitch)||(console.log("Pitch "+e.pitch+" is outside the valid range for "+i.name+", ignoring."),!1)}).map(function(e){return i.sampleInfoToName({pitch:e.pitch,velocity:i.nearestVelocity(e.velocity)})}),n=Array.from(new Set(t)).filter(function(e){return!i.buffers.has(e)}),0<(r=n.map(function(e){return{name:e,url:i.sampleNameToURL(e)}})).length?(r.forEach(function(e){return i.buffers.add(e.name,e.url)}),[4,new Promise(function(e){return l.Buffer.on("load",e)})]):[3,4];case 3:e.sent(),console.log("Loaded samples for "+this.name+"."),e.label=4;case 4:return[2]}})})},e.prototype.playNote=function(e,t,n,r,i){if(!this.initialized)throw new Error("Instrument is not initialized.");if(e<this.minPitch||e>this.maxPitch)console.log("Pitch "+e+" is outside the valid range for "+this.name+" ("+this.minPitch+"-"+this.maxPitch+")");else{var o=this.sampleInfoToName({pitch:e,velocity:this.nearestVelocity(t)});if(!this.buffers.has(o))throw new Error("Buffer not found for "+this.name+": "+o);var a=this.buffers.get(o);if(!a.loaded)throw new Error("Buffer not loaded for "+this.name+": "+o);r>this.durationSeconds&&console.log("Requested note duration longer than sample duration: "+r+" > "+this.durationSeconds);var s=new l.BufferSource(a).connect(i);if(s.start(n,0,void 0,1,0),!this.percussive&&r<this.durationSeconds){var u=new l.BufferSource(a).connect(i);s.stop(n+r+this.FADE_SECONDS,this.FADE_SECONDS),u.start(n+r,this.durationSeconds,void 0,1,this.FADE_SECONDS)}}},e}();n.Instrument=i;var s=function(){function e(e){this.baseURL=e,this.instruments=new Map,this.initialized=!1}return e.prototype.initialize=function(){return r(this,void 0,void 0,function(){var r=this;return a(this,function(e){switch(e.label){case 0:return[4,fetch(this.baseURL+"/soundfont.json").then(function(e){return e.json()}).then(function(e){for(var t in r.name=e.name,e.instruments){var n=r.baseURL+"/"+e.instruments[t];r.instruments.set("drums"===t?"drums":+t,new i(n))}r.initialized=!0})];case 1:return e.sent(),[2]}})})},e.prototype.loadSamples=function(t){return r(this,void 0,void 0,function(){var r,i=this;return a(this,function(e){switch(e.label){case 0:return this.initialized?[3,2]:[4,this.initialize()];case 1:e.sent(),e.label=2;case 2:return r=new Map,t.forEach(function(e){var t=e.isDrum?"drums":e.program,n={pitch:e.pitch,velocity:e.velocity};r.has(t)?r.get(t).push(n):i.instruments.has(t)?r.set(t,[n]):console.log("No instrument in "+i.name+" for: program="+e.program+", isDrum="+e.isDrum)}),[4,Promise.all(Array.from(r.keys()).map(function(e){return i.instruments.get(e).loadSamples(r.get(e))}))];case 3:return e.sent(),[2]}})})},e.prototype.playNote=function(e,t,n,r,i,o,a){var s=o?"drums":i;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(s)?this.instruments.get(s).playNote(e,t,n,r,a):console.log("No instrument in "+this.name+" for: program="+i+", isDrum="+o)},e}();n.SoundFont=s},{"./constants":278,tone:275}],287:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("."),a=e("./constants"),r=function(){function e(e,t,n){void 0===n&&(n={}),this.config={noteHeight:n.noteHeight||6,noteSpacing:n.noteSpacing||1,pixelsPerTimeStep:n.pixelsPerTimeStep||30,noteRGB:n.noteRGB||"8, 41, 64",activeNoteRGB:n.activeNoteRGB||"240, 84, 119",minPitch:n.minPitch,maxPitch:n.maxPitch},this.noteSequence=e,this.sequenceIsQuantized=i.sequences.isQuantizedSequence(this.noteSequence),this.ctx=t.getContext("2d");var r=this.getCanvasSize();this.height=r.height,this.ctx.canvas.width=r.width,this.ctx.canvas.height=r.height,this.redraw()}return e.prototype.redraw=function(e){var t;this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);for(var n=0;n<this.noteSequence.notes.length;n++){var r=this.noteSequence.notes[n],i=this.config.noteSpacing*(n+1),o=this.getNoteStartTime(r)*this.config.pixelsPerTimeStep+i,a=(this.getNoteEndTime(r)-this.getNoteStartTime(r))*this.config.pixelsPerTimeStep,s=this.height-(r.pitch-this.config.minPitch)*this.config.noteHeight,u=r.velocity?r.velocity/100+.2:1,l=e&&this.isPaintingActiveNote(r,e);this.ctx.fillStyle="rgba("+(l?this.config.activeNoteRGB:this.config.noteRGB)+",\n          "+u+")",this.ctx.fillRect(o,s,a,this.config.noteHeight),l&&(t=o)}return t},e.prototype.getCanvasSize=function(){if(void 0===this.config.minPitch||void 0===this.config.maxPitch){this.config.minPitch=a.MAX_MIDI_PITCH,this.config.maxPitch=a.MIN_MIDI_PITCH;for(var e=0,t=this.noteSequence.notes;e<t.length;e++){var n=t[e];this.config.minPitch=Math.min(n.pitch,this.config.minPitch),this.config.maxPitch=Math.max(n.pitch,this.config.maxPitch)}this.config.minPitch-=2,this.config.maxPitch+=2}var r=(this.config.maxPitch-this.config.minPitch)*this.config.noteHeight,i=this.noteSequence.notes.length,o=this.sequenceIsQuantized?this.noteSequence.totalQuantizedSteps:this.noteSequence.totalTime;return{width:i*this.config.noteSpacing+o*this.config.pixelsPerTimeStep,height:r}},e.prototype.getNoteStartTime=function(e){return this.sequenceIsQuantized?e.quantizedStartStep:e.startTime},e.prototype.getNoteEndTime=function(e){return this.sequenceIsQuantized?e.quantizedEndStep:e.endTime},e.prototype.isPaintingActiveNote=function(e,t){var n=this.getNoteStartTime(e)===this.getNoteStartTime(t),r=this.getNoteStartTime(e)<=this.getNoteStartTime(t)&&this.getNoteEndTime(e)>=this.getNoteEndTime(t);return n||r},e}();n.Visualizer=r},{".":280,"./constants":278}],288:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0});var i=e("@tensorflow/tfjs");n.tf=i,r(e("./core")),r(e("./music_rnn")),r(e("./music_vae")),r(e("./protobuf")),r(e("./transcription"))},{"./core":280,"./music_rnn":290,"./music_vae":292,"./protobuf":294,"./transcription":296,"@tensorflow/tfjs":239}],289:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var w=e("@tensorflow/tfjs-core");n.ATTENTION_PREFIX="attention_cell_wrapper/";var r=function(){function e(e,t,n){this.cells=e,this.attnLength=t,this.attnSize=n}return e.isWrapped=function(e){return"rnn/"+n.ATTENTION_PREFIX+"kernel"in e},e.prototype.initialize=function(e){var t="rnn/"+n.ATTENTION_PREFIX;this.attnInputMatrix=e[t+"kernel"],this.attnInputBias=e[t+"bias"],this.attnW=e[t+"attention/attn_w"],this.attnV=e[t+"attention/attn_v"],this.attnMatrix=e[t+"attention/kernel"],this.attnBias=e[t+"attention/bias"],this.attnOutputMatrix=e[t+"attention_output_projection/kernel"],this.attnOutputBias=e[t+"attention_output_projection/bias"]},e.prototype.initState=function(){return{attention:w.zeros([this.attnSize]),attentionState:w.zeros([1,this.attnSize*this.attnLength])}},e.prototype.call=function(e,t,n,r){var i,o=w.concat([e,r.attention.as2D(1,-1)],1),a=w.add(w.matMul(o,this.attnInputMatrix),this.attnInputBias.as2D(1,-1));t=(i=w.multiRNNCell(this.cells,a,t,n))[0],n=i[1];for(var s=w.reshape(r.attentionState,[-1,this.attnLength,1,this.attnSize]),u=w.conv2d(s,this.attnW,[1,1],"same"),l=[],c=0;c<t.length;c++)l.push(t[c]),l.push(n[c]);var p=w.concat(l,1),h=w.matMul(p,this.attnMatrix).reshape([-1,1,1,this.attnSize]),f=w.sum(w.mul(this.attnV,w.tanh(w.add(u,h))),[2,3]),d=w.softmax(f),m=w.sum(w.mul(w.reshape(d,[-1,this.attnLength,1,1]),s),[1,2]).reshape([-1,this.attnSize]),y=r.attentionState.reshape([-1,this.attnLength,this.attnSize]),g=w.slice(y,[0,1,0],[y.shape[0],y.shape[1]-1,y.shape[2]]),v=w.add(w.matMul(w.concat([n[2],m],1),this.attnOutputMatrix),this.attnOutputBias),b=m.flatten(),_=w.concat([g,v.as3D(v.shape[0],1,v.shape[1])],1).reshape([-1,this.attnLength*this.attnSize]);return{output:v,c:t,h:n,attentionState:{attention:b,attentionState:_}}},e}();n.AttentionWrapper=r},{"@tensorflow/tfjs-core":66}],290:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./model");n.MusicRNN=r.MusicRNN},{"./model":291}],291:[function(e,t,n){"use strict";var o=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},d=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var T=e("@tensorflow/tfjs-core"),r=e("../core/aux_inputs"),i=e("../core/chords"),a=e("../core/data"),m=e("../core/sequences"),u=e("./attention"),s=function(){function e(e,t){this.checkpointURL=e,this.spec=t,this.initialized=!1,this.rawVars={},this.biasShapes=[],this.lstmCells=[]}return e.prototype.isInitialized=function(){return this.initialized},e.prototype.instantiateFromSpec=function(){this.dataConverter=a.converterFromSpec(this.spec.dataConverter),this.attentionLength=this.spec.attentionLength,this.chordEncoder=this.spec.chordEncoder?i.chordEncoderFromType(this.spec.chordEncoder):void 0,this.auxInputs=this.spec.auxInputs?this.spec.auxInputs.map(function(e){return r.auxiliaryInputFromSpec(e)}):void 0},e.prototype.initialize=function(){return o(this,void 0,void 0,function(){var i,t,n,o,r,a,s=this;return d(this,function(e){switch(e.label){case 0:return this.dispose(),this.spec?[3,2]:[4,fetch(this.checkpointURL+"/config.json").then(function(e){return e.json()}).then(function(e){if("MusicRNN"!==e.type)throw new Error("Attempted to instantiate MusicRNN model with incorrect type:\n                  "+e.type);s.spec=e})];case 1:e.sent(),e.label=2;case 2:return this.instantiateFromSpec(),[4,fetch(this.checkpointURL+"/weights_manifest.json").then(function(e){return e.json()}).then(function(e){return T.io.loadWeights(e,s.checkpointURL)})];case 3:for(i=e.sent(),t=u.AttentionWrapper.isWrapped(i),n=t?"rnn/"+u.ATTENTION_PREFIX:"rnn/",this.forgetBias=T.scalar(1),this.lstmCells.length=0,this.biasShapes.length=0,o=0,r=function(){var r=n+"multi_rnn_cell/cell_%d/basic_lstm_cell/".replace("%d",o.toString());if(!(r+"kernel"in i))return"break";a.lstmCells.push(function(e,t,n){return T.basicLSTMCell(s.forgetBias,i[r+"kernel"],i[r+"bias"],e,t,n)}),a.biasShapes.push(i[r+"bias"].shape[0]),++o},a=this;"break"!==r(););return this.lstmFcW=i["fully_connected/weights"],this.lstmFcB=i["fully_connected/biases"],t&&(this.attentionWrapper=new u.AttentionWrapper(this.lstmCells,this.attentionLength,this.biasShapes[0]/4),this.attentionWrapper.initialize(i)),this.rawVars=i,this.initialized=!0,console.log("Initialized MusicRNN."),[2]}})})},e.prototype.dispose=function(){var t=this;Object.keys(this.rawVars).forEach(function(e){return t.rawVars[e].dispose()}),this.rawVars={},this.forgetBias&&(this.forgetBias.dispose(),this.forgetBias=void 0),this.initialized=!1},e.prototype.continueSequence=function(t,n,r,i){return o(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,this.continueSequenceImpl(t,n,r,i,!1)];case 1:return[2,e.sent().sequence]}})})},e.prototype.continueSequenceAndReturnProbabilities=function(t,n,r,i){return o(this,void 0,void 0,function(){return d(this,function(e){return[2,this.continueSequenceImpl(t,n,r,i,!0)]})})},e.prototype.continueSequenceImpl=function(l,c,p,h,f){return o(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u=this;return d(this,function(e){switch(e.label){case 0:if(m.assertIsRelativeQuantizedSequence(l),this.chordEncoder&&!h)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&h)throw new Error("Unexpected chord progression provided.");return this.initialized?[3,2]:[4,this.initialize()];case 1:e.sent(),e.label=2;case 2:return[4,t=T.tidy(function(){var e=u.dataConverter.toTensor(l),t=e.shape[0],n=e.shape[1],r=u.chordEncoder?u.chordEncoder.encodeProgression(h,t+c):void 0,i=u.auxInputs?T.concat(u.auxInputs.map(function(e){return e.getTensors(t+c)}),1):void 0,o=u.sampleRnn(e,c,p,r,i,f),a=o.samples;return{samples:T.stack(a).as2D(a.length,n),probs:o.probs}})];case 3:if(n=e.sent(),r=this.dataConverter.toNoteSequence(n.samples,l.quantizationInfo.stepsPerQuarter),i=[],!f)return[3,7];o=0,e.label=4;case 4:return o<n.probs.length?(s=(a=i).push,[4,n.probs[o].data()]):[3,7];case 5:s.apply(a,[e.sent()]),n.probs[o].dispose(),e.label=6;case 6:return o++,[3,4];case 7:return t.samples.dispose(),[2,{sequence:r,probs:i}]}})})},e.prototype.sampleRnn=function(e,t,n,r,i,o){for(var a,s=e.shape[0],u=e.shape[1],l=[],c=[],p=0;p<this.biasShapes.length;p++)l.push(T.zeros([1,this.biasShapes[p]/4])),c.push(T.zeros([1,this.biasShapes[p]/4]));var h,f=this.attentionWrapper?this.attentionWrapper.initState():null;e=e.toFloat();var d=[],m=[],y=T.split(e.toFloat(),s),g=r?T.split(r,r.shape[0]):void 0,v=i?T.split(i,i.shape[0]):void 0;for(p=0;p<s+t;p++){var b=void 0;if(p<s)b=y[p];else{var _=h.matMul(this.lstmFcW).add(this.lstmFcB).as1D(),w=void 0;n?(_=_.div(T.scalar(n)),w=T.multinomial(_,1).as1D()):w=_.argMax().as1D(),o&&m.push(T.softmax(_)),b=T.oneHot(w,u).toFloat(),d.push(b.as1D().toBool())}if(p===s+t-1)break;var S=[];if(g&&S.push(g[p+1]),S.push(b),v&&S.push(v[p]),b=T.concat(S,1),this.attentionWrapper){var x=this.attentionWrapper.call(b,l,c,f);l=x.c,c=x.h,f=x.attentionState,h=x.output}else l=(a=T.multiRNNCell(this.lstmCells,b,l,c))[0],h=(c=a[1])[c.length-1]}return{samples:d,probs:m}},e}();n.MusicRNN=s},{"../core/aux_inputs":276,"../core/chords":277,"../core/data":279,"../core/sequences":285,"./attention":289,"@tensorflow/tfjs-core":66}],292:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./model");n.Decoder=r.Decoder,n.Encoder=r.Encoder,n.MusicVAE=r.MusicVAE},{"./model":293}],293:[function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),l=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},w=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(n,"__esModule",{value:!0});var S=e("@tensorflow/tfjs-core"),i=e("../core/chords"),u=e("../core/constants"),o=e("../core/data"),x=function(e,t){if(void 0===e)throw Error("`kernel` is undefined.");if(void 0===t)throw Error("`bias` is undefined.");this.kernel=e,this.bias=t};function _(e,t){return t.matMul(e.kernel).add(e.bias)}n.LayerVars=x;var s=function(){},T=function(i){function e(e,t,n){var r=i.call(this)||this;return r.lstmFwVars=e,r.lstmBwVars=t,r.muVars=n,r.zDims=n?r.muVars.bias.shape[0]:null,r}return a(e,i),e.prototype.encode=function(r,e){var i=this;if(e)throw new Error("Variable-length segments not supported in flat encoder");return S.tidy(function(){var e=i.singleDirection(r,!0),t=i.singleDirection(r,!1),n=S.concat([e[1],t[1]],1);return i.muVars?_(i.muVars,n):n})},e.prototype.singleDirection=function(e,t){for(var n,r,i=e.shape[0],o=e.shape[1],a=t?this.lstmFwVars:this.lstmBwVars,s=[S.zeros([i,a.bias.shape[0]/4]),S.zeros([i,a.bias.shape[0]/4])],u=S.scalar(1),l=S.split(e.toFloat(),o,1),c=0,p=t?l:l.reverse();c<p.length;c++){var h=p[c];n=h.squeeze([1]),r=s,s=S.basicLSTMCell(u,a.kernel,a.bias,n,r[0],r[1])}return s},e}(n.Encoder=s),P=function(i){function e(e,t,n){var r=i.call(this)||this;return r.baseEncoders=e,r.numSteps=t,r.muVars=n,r.zDims=r.muVars.bias.shape[0],r}return a(e,i),e.prototype.encode=function(a,s){var u=this;if(s){if(1!==a.shape[0])throw new Error("When using variable-length segments, batch size must be 1.");if(s.length!==this.numSteps[0])throw new Error("Must provide length for all variable-length segments.")}return S.tidy(function(){for(var e=a,t=0;t<u.baseEncoders.length;++t){for(var n=u.numSteps[t],r=S.split(e,n,1),i=[],o=0;o<n;++o)i.push(u.baseEncoders[t].encode(0===t&&s?S.slice3d(r[o],[0,0,0],[1,s[o],-1]):r[o]));e=S.stack(i,1)}return _(u.muVars,e.squeeze([1]))})},e}(s);function N(e,t,n){for(var o=[],a=[],s=[],u=S.split(_(n,e).tanh(),2*t.length,1),r=function(e){var r=t[e],i=S.scalar(1);o.push(function(e,t,n){return S.basicLSTMCell(i,r.kernel,r.bias,e,t,n)}),a.push(u[2*e]),s.push(u[2*e+1])},i=0;i<t.length;++i)r(i);return{cell:o,c:a,h:s}}var c=function(){},A=function(o){function e(e,t,n,r){var i=o.call(this)||this;return i.lstmCellVars=e,i.zToInitStateVars=t,i.outputProjectVars=n,i.zDims=i.zToInitStateVars.kernel.shape[0],i.outputDims=r?r.numDims:n.bias.shape[0],i.nade=r,i}return a(e,o),e.prototype.decode=function(f,d,m,y,g){var v=this,b=f.shape[0];return S.tidy(function(){for(var e,t=N(f,v.lstmCellVars,v.zToInitStateVars),n=[],r=m||S.zeros([b,v.outputDims]),i=g?S.split(S.tile(g,[b,1]),g.shape[0]):void 0,o=0;o<d;++o){var a=i?[r,f,i[o]]:[r,f];e=S.multiRNNCell(t.cell,S.concat(a,1),t.c,t.h),t.c=e[0],t.h=e[1];var s=_(v.outputProjectVars,t.h[t.h.length-1]),u=void 0;if(null==v.nade){var l=y?S.multinomial(s.div(S.scalar(y)),1).as1D():s.argMax(1).as1D();u=(r=S.oneHot(l,v.outputDims).toFloat()).toBool()}else{var c=S.split(s,[v.nade.numHidden,v.nade.numDims],1),p=c[0],h=c[1];u=(r=v.nade.sample(p,h)).toBool()}n.push(u)}return S.stack(n,1)})},e}(n.Decoder=c),O=function(o){function e(e,t,n,r){var i=o.call(this)||this;return i.coreDecoders=e,i.lstmCellVars=t,i.zToInitStateVars=n,i.numSteps=r,i.zDims=i.zToInitStateVars.kernel.shape[0],i.outputDims=i.coreDecoders.reduce(function(e,t){return e+t.outputDims},0),i}return a(e,o),e.prototype.decode=function(l,c,e,p,h){var f=this,d=l.shape[0];return S.tidy(function(){for(var e,t=N(l,f.lstmCellVars,f.zToInitStateVars),n=[],r=f.coreDecoders.map(function(e){}),i=S.zeros([d,1]),o=h?S.split(h,f.numSteps):void 0,a=0;a<f.numSteps;++a){e=S.multiRNNCell(t.cell,i,t.c,t.h),t.c=e[0],t.h=e[1];for(var s=[],u=0;u<f.coreDecoders.length;++u)s.push(f.coreDecoders[u].decode(t.h[t.h.length-1],c/f.numSteps,r[u],p,o?o[a]:void 0));n.push(S.concat(s,-1)),r=s.map(function(e){return e.slice([0,-1,0],[d,1,e.shape[e.rank-1]]).squeeze([1]).toFloat()})}return S.concat(n,1)})},e}(c),k=function(){function e(e,t){this.numDims=e.shape[0],this.numHidden=e.shape[2],this.encWeights=e.as2D(this.numDims,this.numHidden),this.decWeightsT=t.as2D(this.numDims,this.numHidden)}return e.prototype.sample=function(s,u){var l=this,c=s.shape[0];return S.tidy(function(){for(var e=[],t=s.clone(),n=0;n<l.numDims;n++){var r=S.sigmoid(t),i=l.encWeights.slice([n,0],[1,l.numHidden]).as1D(),o=l.decWeightsT.slice([n,0],[1,l.numHidden]),a=u.slice([0,n],[c,1]).add(S.matMul(r,o,!1,!0)).sigmoid().greaterEqual(S.scalar(.5)).toFloat().as1D();n<l.numDims-1&&(t=t.add(S.outerProduct(a.toFloat(),i))),e.push(a)}return S.stack(e,1)})},e}();n.Nade=k;var p=function(){function e(e,t){this.initialized=!1,this.checkpointURL=e,this.spec=t}return e.prototype.instantiateFromSpec=function(){this.dataConverter=o.converterFromSpec(this.spec.dataConverter),this.chordEncoder=this.spec.chordEncoder?i.chordEncoderFromType(this.spec.chordEncoder):void 0},e.prototype.dispose=function(){var t=this;void 0!==this.rawVars&&Object.keys(this.rawVars).forEach(function(e){return t.rawVars[e].dispose()}),this.encoder=void 0,this.decoder=void 0,this.initialized=!1},e.prototype.getLstmLayers=function(e,t){for(var n=[],r=0;;){var i=e.replace("%d",r.toString());if(!(i+"kernel"in t))break;n.push(new x(t[i+"kernel"],t[i+"bias"])),++r}return n},e.prototype.initialize=function(){return l(this,void 0,void 0,function(){var t,o,n,r,i,a,s,u,l,c,p,h,f,d,m,y,g,v,b,_=this;return w(this,function(e){switch(e.label){case 0:return this.dispose(),this.spec?[3,2]:[4,fetch(this.checkpointURL+"/config.json").then(function(e){return e.json()}).then(function(e){if("MusicVAE"!==e.type)throw new Error("Attempted to instantiate MusicVAE model with incorrect type:\n                  "+e.type);_.spec=e})];case 1:e.sent(),e.label=2;case 2:return this.instantiateFromSpec(),o="multi_rnn_cell/"+(t="cell_%d/lstm_cell/"),n="decoder/hierarchical_level_0/",i="encoder/"+(r="cell_%d/bidirectional_rnn/%s/multi_rnn_cell/cell_0/lstm_cell/"),a="encoder/hierarchical_level_%d/"+r.replace("%d","0"),[4,fetch(this.checkpointURL+"/weights_manifest.json").then(function(e){return e.json()}).then(function(e){return S.io.loadWeights(e,_.checkpointURL)})];case 3:if(s=e.sent(),this.rawVars=s,u=new x(s["encoder/mu/kernel"],s["encoder/mu/bias"]),this.dataConverter.numSegments){if(l=this.getLstmLayers(a.replace("%s","fw"),s),c=this.getLstmLayers(a.replace("%s","bw"),s),l.length!==c.length||2!==l.length)throw Error("Only 2 hierarchical encoder levels are supported. Got "+l.length+" forward and "+c.length+" backward.");p=[0,1].map(function(e){return new T(l[e],c[e])}),this.encoder=new P(p,[this.dataConverter.numSegments,1],u)}else{if(h=this.getLstmLayers(i.replace("%s","fw"),s),f=this.getLstmLayers(i.replace("%s","bw"),s),h.length!==f.length||1!==h.length)throw Error("Only single-layer bidirectional encoders are supported. Got "+h.length+" forward and "+f.length+" backward.");this.encoder=new T(h[0],f[0],u)}if(d=this.dataConverter.numSegments?"core_decoder/":"",m=[],this.dataConverter.NUM_SPLITS)for(y=0;y<this.dataConverter.NUM_SPLITS;++y)m.push(d+"core_decoder_"+y+"/decoder/");else m.push(d+"decoder/");if(g=m.map(function(e){var t=_.getLstmLayers(e+o,s),n=new x(s[e+"z_to_initial_state/kernel"],s[e+"z_to_initial_state/bias"]),r=new x(s[e+"output_projection/kernel"],s[e+"output_projection/bias"]),i=e+"nade/w_enc"in s?new k(s[e+"nade/w_enc"],s[e+"nade/w_dec_t"]):null;return new A(t,n,r,i)}),this.dataConverter.numSegments)v=this.getLstmLayers(n+t,s),b=new x(s[n+"initial_state/kernel"],s[n+"initial_state/bias"]),this.decoder=new O(g,v,b,this.dataConverter.numSegments);else{if(1!==g.length)throw Error("Unexpected number of base decoders without conductor: "+g.length);this.decoder=g[0]}return this.initialized=!0,console.log("Initialized MusicVAE."),[2]}})})},e.prototype.isInitialized=function(){return this.initialized},e.prototype.interpolate=function(o,a,s,u){return l(this,void 0,void 0,function(){var t,n,r,i=this;return w(this,function(e){switch(e.label){case 0:if(this.chordEncoder&&!u)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&u)throw new Error("Unexpected chord progression provided.");return this.initialized?[3,2]:[4,this.initialize()];case 1:e.sent(),e.label=2;case 2:return[4,this.encode(o,u)];case 3:return t=e.sent(),n=S.tidy(function(){return i.getInterpolatedZs(t,a)}),t.dispose(),r=this.decode(n,s,u),n.dispose(),[2,r]}})})},e.prototype.getSegmentLengths=function(c){return l(this,void 0,void 0,function(){var t,n,r,i,o,a,s,u,l=this;return w(this,function(e){switch(e.label){case 0:if(1<c.shape[0])throw new Error("Variable-length segments not supported for batch size > 1.");return t=this.dataConverter.numSteps,n=this.dataConverter.numSegments,[4,(r=S.tidy(function(){return S.min(S.equal(c.squeeze([0]),l.dataConverter.endTensor.expandDims(0)),1)})).data()];case 1:for(i=e.sent(),r.dispose(),o=t/n,a=[],s=0,u=i.indexOf(1);-1!==u;)a.push(u-s+1),s+=o,u=i.indexOf(1,s);if(a.length!==n)throw new Error("Incorrect number of segments: "+a.length+" != "+n);return[2,a]}})})},e.prototype.encodeChordProgression=function(e){var t=this.dataConverter.numSteps,n=this.dataConverter.numSegments,r=this.dataConverter.SEGMENTED_BY_TRACK?t/n:t,i=this.dataConverter.SEGMENTED_BY_TRACK?S.concat2d([this.chordEncoder.encode(u.NO_CHORD).expandDims(0),this.chordEncoder.encodeProgression(e,r-1)],0):this.chordEncoder.encodeProgression(e,r);return this.dataConverter.SEGMENTED_BY_TRACK?S.tile(i,[n,1]):i},e.prototype.encode=function(s,u){return l(this,void 0,void 0,function(){var n,t,r,i,o,a=this;return w(this,function(e){switch(e.label){case 0:if(this.chordEncoder&&!u)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&u)throw new Error("Unexpected chord progression provided.");if(this.chordEncoder&&this.dataConverter.endTensor&&1<u.length)throw new Error("Multiple chords not supported when using variable-length segments.");return this.initialized?[3,2]:[4,this.initialize()];case 1:e.sent(),e.label=2;case 2:return n=S.tidy(function(){return S.stack(s.map(function(e){return a.dataConverter.toTensor(e)}))}),this.dataConverter.endTensor?[4,this.getSegmentLengths(n)]:[3,4];case 3:return r=e.sent(),[3,5];case 4:r=void 0,e.label=5;case 5:return t=r,this.chordEncoder&&(i=S.tidy(function(){var e=a.encodeChordProgression(u),t=S.tile(S.expandDims(e,0),[s.length,1,1]);return n.concat(t,2)}),n.dispose(),n=i),o=this.encoder.encode(n,t),n.dispose(),[2,o]}})})},e.prototype.decode=function(c,p,h,f){return void 0===f&&(f=4),l(this,void 0,void 0,function(){var n,t,r,i,o,a,s,u,l=this;return w(this,function(e){switch(e.label){case 0:if(this.chordEncoder&&!h)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&h)throw new Error("Unexpected chord progression provided.");if(this.chordEncoder&&this.dataConverter.endTensor&&1<h.length)throw new Error("Multiple chords not supported when using variable-length segments.");return this.initialized?[3,2]:[4,this.initialize()];case 1:e.sent(),e.label=2;case 2:n=this.dataConverter.numSteps,t=S.tidy(function(){var e=l.chordEncoder?l.encodeChordProgression(h):void 0,t=l.decoder.decode(c,n,void 0,p,e);return S.split(t,t.shape[0]).map(function(e){return e.squeeze([0])})}),r=[],i=0,o=t,e.label=3;case 3:return i<o.length?(a=o[i],u=(s=r).push,[4,this.dataConverter.toNoteSequence(a,f)]):[3,6];case 4:u.apply(s,[e.sent()]),a.dispose(),e.label=5;case 5:return i++,[3,3];case 6:return[2,r]}})})},e.prototype.getInterpolatedZs=function(c,e){if("number"==typeof e&&(e=[e]),2!==c.shape[0]&&4!==c.shape[0])throw new Error("Invalid number of input sequences. Requires length 2, or 4");if(1!==e.length&&2!==e.length)throw new Error("Invalid number of dimensions. Requires length 1, or 2.");var p=e[0],h=2===e.length?e[1]:p;return S.tidy(function(){var e=S.linspace(0,1,p),t=c.slice([0,0],[1,c.shape[1]]).as1D(),n=c.slice([1,0],[1,c.shape[1]]).as1D();if(2===c.shape[0]){var r=n.sub(t);return S.outerProduct(e,r).add(t)}if(4===c.shape[0]){var i=S.linspace(0,1,h),o=c.slice([2,0],[1,c.shape[1]]).as1D(),a=c.slice([3,0],[1,c.shape[1]]).as1D(),s=S.scalar(1).sub(e),u=S.scalar(1).sub(i),l=t.mul(S.outerProduct(u,s).as3D(h,p,1));return l=S.addStrict(l,n.mul(S.outerProduct(i,s).as3D(h,p,1))),l=S.addStrict(l,o.mul(S.outerProduct(u,e).as3D(h,p,1))),(l=S.addStrict(l,a.mul(S.outerProduct(i,e).as3D(h,p,1)))).as2D(p*h,c.shape[1])}throw new Error("Invalid number of note sequences. Requires length 2, or 4")})},e.prototype.sample=function(i,o,a,s){return void 0===o&&(o=.5),void 0===s&&(s=u.DEFAULT_STEPS_PER_QUARTER),l(this,void 0,void 0,function(){var t,n,r=this;return w(this,function(e){switch(e.label){case 0:if(this.chordEncoder&&!a)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&a)throw new Error("Unexpected chord progression provided.");return this.initialized?[3,2]:[4,this.initialize()];case 1:e.sent(),e.label=2;case 2:return t=S.tidy(function(){return S.randomNormal([i,r.decoder.zDims])}),n=this.decode(t,o,a,s),t.dispose(),[2,n]}})})},e}();n.MusicVAE=p},{"../core/chords":277,"../core/constants":278,"../core/data":279,"@tensorflow/tfjs-core":66}],294:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./proto").tensorflow.magenta.NoteSequence;n.NoteSequence=r},{"./proto":295}],295:[function(e,t,n){"use strict";var r,i,s=e("protobufjs/minimal"),u=s.Reader,l=s.Writer,o=s.util,c=s.roots.default||(s.roots.default={});c.tensorflow=((i={}).magenta=((r={}).NoteSequence=function(){function t(e){if(this.timeSignatures=[],this.keySignatures=[],this.tempos=[],this.notes=[],this.pitchBends=[],this.controlChanges=[],this.partInfos=[],this.textAnnotations=[],this.sectionAnnotations=[],this.sectionGroups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var e,n;return t.prototype.id="",t.prototype.filename="",t.prototype.referenceNumber=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.collectionName="",t.prototype.ticksPerQuarter=0,t.prototype.timeSignatures=o.emptyArray,t.prototype.keySignatures=o.emptyArray,t.prototype.tempos=o.emptyArray,t.prototype.notes=o.emptyArray,t.prototype.totalTime=0,t.prototype.totalQuantizedSteps=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.pitchBends=o.emptyArray,t.prototype.controlChanges=o.emptyArray,t.prototype.partInfos=o.emptyArray,t.prototype.sourceInfo=null,t.prototype.textAnnotations=o.emptyArray,t.prototype.sectionAnnotations=o.emptyArray,t.prototype.sectionGroups=o.emptyArray,t.prototype.quantizationInfo=null,t.prototype.subsequenceInfo=null,t.prototype.sequenceMetadata=null,t.create=function(e){return new t(e)},t.encode=function(e,t){if(t||(t=l.create()),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(10).string(e.id),null!=e.filename&&e.hasOwnProperty("filename")&&t.uint32(18).string(e.filename),null!=e.collectionName&&e.hasOwnProperty("collectionName")&&t.uint32(26).string(e.collectionName),null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&t.uint32(32).int32(e.ticksPerQuarter),null!=e.timeSignatures&&e.timeSignatures.length)for(var n=0;n<e.timeSignatures.length;++n)c.tensorflow.magenta.NoteSequence.TimeSignature.encode(e.timeSignatures[n],t.uint32(42).fork()).ldelim();if(null!=e.keySignatures&&e.keySignatures.length)for(n=0;n<e.keySignatures.length;++n)c.tensorflow.magenta.NoteSequence.KeySignature.encode(e.keySignatures[n],t.uint32(50).fork()).ldelim();if(null!=e.tempos&&e.tempos.length)for(n=0;n<e.tempos.length;++n)c.tensorflow.magenta.NoteSequence.Tempo.encode(e.tempos[n],t.uint32(58).fork()).ldelim();if(null!=e.notes&&e.notes.length)for(n=0;n<e.notes.length;++n)c.tensorflow.magenta.NoteSequence.Note.encode(e.notes[n],t.uint32(66).fork()).ldelim();if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&t.uint32(73).double(e.totalTime),null!=e.pitchBends&&e.pitchBends.length)for(n=0;n<e.pitchBends.length;++n)c.tensorflow.magenta.NoteSequence.PitchBend.encode(e.pitchBends[n],t.uint32(82).fork()).ldelim();if(null!=e.controlChanges&&e.controlChanges.length)for(n=0;n<e.controlChanges.length;++n)c.tensorflow.magenta.NoteSequence.ControlChange.encode(e.controlChanges[n],t.uint32(90).fork()).ldelim();if(null!=e.partInfos&&e.partInfos.length)for(n=0;n<e.partInfos.length;++n)c.tensorflow.magenta.NoteSequence.PartInfo.encode(e.partInfos[n],t.uint32(98).fork()).ldelim();if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&c.tensorflow.magenta.NoteSequence.SourceInfo.encode(e.sourceInfo,t.uint32(106).fork()).ldelim(),null!=e.textAnnotations&&e.textAnnotations.length)for(n=0;n<e.textAnnotations.length;++n)c.tensorflow.magenta.NoteSequence.TextAnnotation.encode(e.textAnnotations[n],t.uint32(114).fork()).ldelim();if(null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&c.tensorflow.magenta.NoteSequence.QuantizationInfo.encode(e.quantizationInfo,t.uint32(122).fork()).ldelim(),null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&t.uint32(128).int64(e.totalQuantizedSteps),null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&c.tensorflow.magenta.NoteSequence.SubsequenceInfo.encode(e.subsequenceInfo,t.uint32(138).fork()).ldelim(),null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&t.uint32(144).int64(e.referenceNumber),null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&c.tensorflow.magenta.SequenceMetadata.encode(e.sequenceMetadata,t.uint32(154).fork()).ldelim(),null!=e.sectionAnnotations&&e.sectionAnnotations.length)for(n=0;n<e.sectionAnnotations.length;++n)c.tensorflow.magenta.NoteSequence.SectionAnnotation.encode(e.sectionAnnotations[n],t.uint32(162).fork()).ldelim();if(null!=e.sectionGroups&&e.sectionGroups.length)for(n=0;n<e.sectionGroups.length;++n)c.tensorflow.magenta.NoteSequence.SectionGroup.encode(e.sectionGroups[n],t.uint32(170).fork()).ldelim();return t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.id=e.string();break;case 2:r.filename=e.string();break;case 18:r.referenceNumber=e.int64();break;case 3:r.collectionName=e.string();break;case 4:r.ticksPerQuarter=e.int32();break;case 5:r.timeSignatures&&r.timeSignatures.length||(r.timeSignatures=[]),r.timeSignatures.push(c.tensorflow.magenta.NoteSequence.TimeSignature.decode(e,e.uint32()));break;case 6:r.keySignatures&&r.keySignatures.length||(r.keySignatures=[]),r.keySignatures.push(c.tensorflow.magenta.NoteSequence.KeySignature.decode(e,e.uint32()));break;case 7:r.tempos&&r.tempos.length||(r.tempos=[]),r.tempos.push(c.tensorflow.magenta.NoteSequence.Tempo.decode(e,e.uint32()));break;case 8:r.notes&&r.notes.length||(r.notes=[]),r.notes.push(c.tensorflow.magenta.NoteSequence.Note.decode(e,e.uint32()));break;case 9:r.totalTime=e.double();break;case 16:r.totalQuantizedSteps=e.int64();break;case 10:r.pitchBends&&r.pitchBends.length||(r.pitchBends=[]),r.pitchBends.push(c.tensorflow.magenta.NoteSequence.PitchBend.decode(e,e.uint32()));break;case 11:r.controlChanges&&r.controlChanges.length||(r.controlChanges=[]),r.controlChanges.push(c.tensorflow.magenta.NoteSequence.ControlChange.decode(e,e.uint32()));break;case 12:r.partInfos&&r.partInfos.length||(r.partInfos=[]),r.partInfos.push(c.tensorflow.magenta.NoteSequence.PartInfo.decode(e,e.uint32()));break;case 13:r.sourceInfo=c.tensorflow.magenta.NoteSequence.SourceInfo.decode(e,e.uint32());break;case 14:r.textAnnotations&&r.textAnnotations.length||(r.textAnnotations=[]),r.textAnnotations.push(c.tensorflow.magenta.NoteSequence.TextAnnotation.decode(e,e.uint32()));break;case 20:r.sectionAnnotations&&r.sectionAnnotations.length||(r.sectionAnnotations=[]),r.sectionAnnotations.push(c.tensorflow.magenta.NoteSequence.SectionAnnotation.decode(e,e.uint32()));break;case 21:r.sectionGroups&&r.sectionGroups.length||(r.sectionGroups=[]),r.sectionGroups.push(c.tensorflow.magenta.NoteSequence.SectionGroup.decode(e,e.uint32()));break;case 15:r.quantizationInfo=c.tensorflow.magenta.NoteSequence.QuantizationInfo.decode(e,e.uint32());break;case 17:r.subsequenceInfo=c.tensorflow.magenta.NoteSequence.SubsequenceInfo.decode(e,e.uint32());break;case 19:r.sequenceMetadata=c.tensorflow.magenta.SequenceMetadata.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!o.isString(e.id))return"id: string expected";if(null!=e.filename&&e.hasOwnProperty("filename")&&!o.isString(e.filename))return"filename: string expected";if(null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&!(o.isInteger(e.referenceNumber)||e.referenceNumber&&o.isInteger(e.referenceNumber.low)&&o.isInteger(e.referenceNumber.high)))return"referenceNumber: integer|Long expected";if(null!=e.collectionName&&e.hasOwnProperty("collectionName")&&!o.isString(e.collectionName))return"collectionName: string expected";if(null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&!o.isInteger(e.ticksPerQuarter))return"ticksPerQuarter: integer expected";if(null!=e.timeSignatures&&e.hasOwnProperty("timeSignatures")){if(!Array.isArray(e.timeSignatures))return"timeSignatures: array expected";for(var t=0;t<e.timeSignatures.length;++t)if(n=c.tensorflow.magenta.NoteSequence.TimeSignature.verify(e.timeSignatures[t]))return"timeSignatures."+n}if(null!=e.keySignatures&&e.hasOwnProperty("keySignatures")){if(!Array.isArray(e.keySignatures))return"keySignatures: array expected";for(t=0;t<e.keySignatures.length;++t)if(n=c.tensorflow.magenta.NoteSequence.KeySignature.verify(e.keySignatures[t]))return"keySignatures."+n}if(null!=e.tempos&&e.hasOwnProperty("tempos")){if(!Array.isArray(e.tempos))return"tempos: array expected";for(t=0;t<e.tempos.length;++t)if(n=c.tensorflow.magenta.NoteSequence.Tempo.verify(e.tempos[t]))return"tempos."+n}if(null!=e.notes&&e.hasOwnProperty("notes")){if(!Array.isArray(e.notes))return"notes: array expected";for(t=0;t<e.notes.length;++t)if(n=c.tensorflow.magenta.NoteSequence.Note.verify(e.notes[t]))return"notes."+n}if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&"number"!=typeof e.totalTime)return"totalTime: number expected";if(null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&!(o.isInteger(e.totalQuantizedSteps)||e.totalQuantizedSteps&&o.isInteger(e.totalQuantizedSteps.low)&&o.isInteger(e.totalQuantizedSteps.high)))return"totalQuantizedSteps: integer|Long expected";if(null!=e.pitchBends&&e.hasOwnProperty("pitchBends")){if(!Array.isArray(e.pitchBends))return"pitchBends: array expected";for(t=0;t<e.pitchBends.length;++t)if(n=c.tensorflow.magenta.NoteSequence.PitchBend.verify(e.pitchBends[t]))return"pitchBends."+n}if(null!=e.controlChanges&&e.hasOwnProperty("controlChanges")){if(!Array.isArray(e.controlChanges))return"controlChanges: array expected";for(t=0;t<e.controlChanges.length;++t)if(n=c.tensorflow.magenta.NoteSequence.ControlChange.verify(e.controlChanges[t]))return"controlChanges."+n}if(null!=e.partInfos&&e.hasOwnProperty("partInfos")){if(!Array.isArray(e.partInfos))return"partInfos: array expected";for(t=0;t<e.partInfos.length;++t)if(n=c.tensorflow.magenta.NoteSequence.PartInfo.verify(e.partInfos[t]))return"partInfos."+n}if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&(n=c.tensorflow.magenta.NoteSequence.SourceInfo.verify(e.sourceInfo)))return"sourceInfo."+n;if(null!=e.textAnnotations&&e.hasOwnProperty("textAnnotations")){if(!Array.isArray(e.textAnnotations))return"textAnnotations: array expected";for(t=0;t<e.textAnnotations.length;++t)if(n=c.tensorflow.magenta.NoteSequence.TextAnnotation.verify(e.textAnnotations[t]))return"textAnnotations."+n}if(null!=e.sectionAnnotations&&e.hasOwnProperty("sectionAnnotations")){if(!Array.isArray(e.sectionAnnotations))return"sectionAnnotations: array expected";for(t=0;t<e.sectionAnnotations.length;++t)if(n=c.tensorflow.magenta.NoteSequence.SectionAnnotation.verify(e.sectionAnnotations[t]))return"sectionAnnotations."+n}if(null!=e.sectionGroups&&e.hasOwnProperty("sectionGroups")){if(!Array.isArray(e.sectionGroups))return"sectionGroups: array expected";for(t=0;t<e.sectionGroups.length;++t){var n;if(n=c.tensorflow.magenta.NoteSequence.SectionGroup.verify(e.sectionGroups[t]))return"sectionGroups."+n}}return null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&(n=c.tensorflow.magenta.NoteSequence.QuantizationInfo.verify(e.quantizationInfo))?"quantizationInfo."+n:null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&(n=c.tensorflow.magenta.NoteSequence.SubsequenceInfo.verify(e.subsequenceInfo))?"subsequenceInfo."+n:null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&(n=c.tensorflow.magenta.SequenceMetadata.verify(e.sequenceMetadata))?"sequenceMetadata."+n:null},t.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence)return e;var t=new c.tensorflow.magenta.NoteSequence;if(null!=e.id&&(t.id=String(e.id)),null!=e.filename&&(t.filename=String(e.filename)),null!=e.referenceNumber&&(o.Long?(t.referenceNumber=o.Long.fromValue(e.referenceNumber)).unsigned=!1:"string"==typeof e.referenceNumber?t.referenceNumber=parseInt(e.referenceNumber,10):"number"==typeof e.referenceNumber?t.referenceNumber=e.referenceNumber:"object"==typeof e.referenceNumber&&(t.referenceNumber=new o.LongBits(e.referenceNumber.low>>>0,e.referenceNumber.high>>>0).toNumber())),null!=e.collectionName&&(t.collectionName=String(e.collectionName)),null!=e.ticksPerQuarter&&(t.ticksPerQuarter=0|e.ticksPerQuarter),e.timeSignatures){if(!Array.isArray(e.timeSignatures))throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: array expected");t.timeSignatures=[];for(var n=0;n<e.timeSignatures.length;++n){if("object"!=typeof e.timeSignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: object expected");t.timeSignatures[n]=c.tensorflow.magenta.NoteSequence.TimeSignature.fromObject(e.timeSignatures[n])}}if(e.keySignatures){if(!Array.isArray(e.keySignatures))throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: array expected");for(t.keySignatures=[],n=0;n<e.keySignatures.length;++n){if("object"!=typeof e.keySignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: object expected");t.keySignatures[n]=c.tensorflow.magenta.NoteSequence.KeySignature.fromObject(e.keySignatures[n])}}if(e.tempos){if(!Array.isArray(e.tempos))throw TypeError(".tensorflow.magenta.NoteSequence.tempos: array expected");for(t.tempos=[],n=0;n<e.tempos.length;++n){if("object"!=typeof e.tempos[n])throw TypeError(".tensorflow.magenta.NoteSequence.tempos: object expected");t.tempos[n]=c.tensorflow.magenta.NoteSequence.Tempo.fromObject(e.tempos[n])}}if(e.notes){if(!Array.isArray(e.notes))throw TypeError(".tensorflow.magenta.NoteSequence.notes: array expected");for(t.notes=[],n=0;n<e.notes.length;++n){if("object"!=typeof e.notes[n])throw TypeError(".tensorflow.magenta.NoteSequence.notes: object expected");t.notes[n]=c.tensorflow.magenta.NoteSequence.Note.fromObject(e.notes[n])}}if(null!=e.totalTime&&(t.totalTime=Number(e.totalTime)),null!=e.totalQuantizedSteps&&(o.Long?(t.totalQuantizedSteps=o.Long.fromValue(e.totalQuantizedSteps)).unsigned=!1:"string"==typeof e.totalQuantizedSteps?t.totalQuantizedSteps=parseInt(e.totalQuantizedSteps,10):"number"==typeof e.totalQuantizedSteps?t.totalQuantizedSteps=e.totalQuantizedSteps:"object"==typeof e.totalQuantizedSteps&&(t.totalQuantizedSteps=new o.LongBits(e.totalQuantizedSteps.low>>>0,e.totalQuantizedSteps.high>>>0).toNumber())),e.pitchBends){if(!Array.isArray(e.pitchBends))throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: array expected");for(t.pitchBends=[],n=0;n<e.pitchBends.length;++n){if("object"!=typeof e.pitchBends[n])throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: object expected");t.pitchBends[n]=c.tensorflow.magenta.NoteSequence.PitchBend.fromObject(e.pitchBends[n])}}if(e.controlChanges){if(!Array.isArray(e.controlChanges))throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: array expected");for(t.controlChanges=[],n=0;n<e.controlChanges.length;++n){if("object"!=typeof e.controlChanges[n])throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: object expected");t.controlChanges[n]=c.tensorflow.magenta.NoteSequence.ControlChange.fromObject(e.controlChanges[n])}}if(e.partInfos){if(!Array.isArray(e.partInfos))throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: array expected");for(t.partInfos=[],n=0;n<e.partInfos.length;++n){if("object"!=typeof e.partInfos[n])throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: object expected");t.partInfos[n]=c.tensorflow.magenta.NoteSequence.PartInfo.fromObject(e.partInfos[n])}}if(null!=e.sourceInfo){if("object"!=typeof e.sourceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.sourceInfo: object expected");t.sourceInfo=c.tensorflow.magenta.NoteSequence.SourceInfo.fromObject(e.sourceInfo)}if(e.textAnnotations){if(!Array.isArray(e.textAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: array expected");for(t.textAnnotations=[],n=0;n<e.textAnnotations.length;++n){if("object"!=typeof e.textAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: object expected");t.textAnnotations[n]=c.tensorflow.magenta.NoteSequence.TextAnnotation.fromObject(e.textAnnotations[n])}}if(e.sectionAnnotations){if(!Array.isArray(e.sectionAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: array expected");for(t.sectionAnnotations=[],n=0;n<e.sectionAnnotations.length;++n){if("object"!=typeof e.sectionAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: object expected");t.sectionAnnotations[n]=c.tensorflow.magenta.NoteSequence.SectionAnnotation.fromObject(e.sectionAnnotations[n])}}if(e.sectionGroups){if(!Array.isArray(e.sectionGroups))throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: array expected");for(t.sectionGroups=[],n=0;n<e.sectionGroups.length;++n){if("object"!=typeof e.sectionGroups[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: object expected");t.sectionGroups[n]=c.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(e.sectionGroups[n])}}if(null!=e.quantizationInfo){if("object"!=typeof e.quantizationInfo)throw TypeError(".tensorflow.magenta.NoteSequence.quantizationInfo: object expected");t.quantizationInfo=c.tensorflow.magenta.NoteSequence.QuantizationInfo.fromObject(e.quantizationInfo)}if(null!=e.subsequenceInfo){if("object"!=typeof e.subsequenceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.subsequenceInfo: object expected");t.subsequenceInfo=c.tensorflow.magenta.NoteSequence.SubsequenceInfo.fromObject(e.subsequenceInfo)}if(null!=e.sequenceMetadata){if("object"!=typeof e.sequenceMetadata)throw TypeError(".tensorflow.magenta.NoteSequence.sequenceMetadata: object expected");t.sequenceMetadata=c.tensorflow.magenta.SequenceMetadata.fromObject(e.sequenceMetadata)}return t},t.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.timeSignatures=[],n.keySignatures=[],n.tempos=[],n.notes=[],n.pitchBends=[],n.controlChanges=[],n.partInfos=[],n.textAnnotations=[],n.sectionAnnotations=[],n.sectionGroups=[]),t.defaults){if(n.id="",n.filename="",n.collectionName="",n.ticksPerQuarter=0,n.totalTime=0,n.sourceInfo=null,n.quantizationInfo=null,o.Long){var r=new o.Long(0,0,!1);n.totalQuantizedSteps=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.totalQuantizedSteps=t.longs===String?"0":0;n.subsequenceInfo=null,o.Long?(r=new o.Long(0,0,!1),n.referenceNumber=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.referenceNumber=t.longs===String?"0":0,n.sequenceMetadata=null}if(null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.filename&&e.hasOwnProperty("filename")&&(n.filename=e.filename),null!=e.collectionName&&e.hasOwnProperty("collectionName")&&(n.collectionName=e.collectionName),null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&(n.ticksPerQuarter=e.ticksPerQuarter),e.timeSignatures&&e.timeSignatures.length){n.timeSignatures=[];for(var i=0;i<e.timeSignatures.length;++i)n.timeSignatures[i]=c.tensorflow.magenta.NoteSequence.TimeSignature.toObject(e.timeSignatures[i],t)}if(e.keySignatures&&e.keySignatures.length)for(n.keySignatures=[],i=0;i<e.keySignatures.length;++i)n.keySignatures[i]=c.tensorflow.magenta.NoteSequence.KeySignature.toObject(e.keySignatures[i],t);if(e.tempos&&e.tempos.length)for(n.tempos=[],i=0;i<e.tempos.length;++i)n.tempos[i]=c.tensorflow.magenta.NoteSequence.Tempo.toObject(e.tempos[i],t);if(e.notes&&e.notes.length)for(n.notes=[],i=0;i<e.notes.length;++i)n.notes[i]=c.tensorflow.magenta.NoteSequence.Note.toObject(e.notes[i],t);if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&(n.totalTime=t.json&&!isFinite(e.totalTime)?String(e.totalTime):e.totalTime),e.pitchBends&&e.pitchBends.length)for(n.pitchBends=[],i=0;i<e.pitchBends.length;++i)n.pitchBends[i]=c.tensorflow.magenta.NoteSequence.PitchBend.toObject(e.pitchBends[i],t);if(e.controlChanges&&e.controlChanges.length)for(n.controlChanges=[],i=0;i<e.controlChanges.length;++i)n.controlChanges[i]=c.tensorflow.magenta.NoteSequence.ControlChange.toObject(e.controlChanges[i],t);if(e.partInfos&&e.partInfos.length)for(n.partInfos=[],i=0;i<e.partInfos.length;++i)n.partInfos[i]=c.tensorflow.magenta.NoteSequence.PartInfo.toObject(e.partInfos[i],t);if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&(n.sourceInfo=c.tensorflow.magenta.NoteSequence.SourceInfo.toObject(e.sourceInfo,t)),e.textAnnotations&&e.textAnnotations.length)for(n.textAnnotations=[],i=0;i<e.textAnnotations.length;++i)n.textAnnotations[i]=c.tensorflow.magenta.NoteSequence.TextAnnotation.toObject(e.textAnnotations[i],t);if(null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&(n.quantizationInfo=c.tensorflow.magenta.NoteSequence.QuantizationInfo.toObject(e.quantizationInfo,t)),null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&("number"==typeof e.totalQuantizedSteps?n.totalQuantizedSteps=t.longs===String?String(e.totalQuantizedSteps):e.totalQuantizedSteps:n.totalQuantizedSteps=t.longs===String?o.Long.prototype.toString.call(e.totalQuantizedSteps):t.longs===Number?new o.LongBits(e.totalQuantizedSteps.low>>>0,e.totalQuantizedSteps.high>>>0).toNumber():e.totalQuantizedSteps),null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&(n.subsequenceInfo=c.tensorflow.magenta.NoteSequence.SubsequenceInfo.toObject(e.subsequenceInfo,t)),null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&("number"==typeof e.referenceNumber?n.referenceNumber=t.longs===String?String(e.referenceNumber):e.referenceNumber:n.referenceNumber=t.longs===String?o.Long.prototype.toString.call(e.referenceNumber):t.longs===Number?new o.LongBits(e.referenceNumber.low>>>0,e.referenceNumber.high>>>0).toNumber():e.referenceNumber),null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&(n.sequenceMetadata=c.tensorflow.magenta.SequenceMetadata.toObject(e.sequenceMetadata,t)),e.sectionAnnotations&&e.sectionAnnotations.length)for(n.sectionAnnotations=[],i=0;i<e.sectionAnnotations.length;++i)n.sectionAnnotations[i]=c.tensorflow.magenta.NoteSequence.SectionAnnotation.toObject(e.sectionAnnotations[i],t);if(e.sectionGroups&&e.sectionGroups.length)for(n.sectionGroups=[],i=0;i<e.sectionGroups.length;++i)n.sectionGroups[i]=c.tensorflow.magenta.NoteSequence.SectionGroup.toObject(e.sectionGroups[i],t);return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.Note=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.pitch=0,t.prototype.pitchName=0,t.prototype.velocity=0,t.prototype.startTime=0,t.prototype.quantizedStartStep=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.endTime=0,t.prototype.quantizedEndStep=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.numerator=0,t.prototype.denominator=0,t.prototype.instrument=0,t.prototype.program=0,t.prototype.isDrum=!1,t.prototype.part=0,t.prototype.voice=0,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=l.create()),null!=e.pitch&&e.hasOwnProperty("pitch")&&t.uint32(8).int32(e.pitch),null!=e.velocity&&e.hasOwnProperty("velocity")&&t.uint32(16).int32(e.velocity),null!=e.startTime&&e.hasOwnProperty("startTime")&&t.uint32(25).double(e.startTime),null!=e.endTime&&e.hasOwnProperty("endTime")&&t.uint32(33).double(e.endTime),null!=e.numerator&&e.hasOwnProperty("numerator")&&t.uint32(40).int32(e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&t.uint32(48).int32(e.denominator),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(56).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(64).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(72).bool(e.isDrum),null!=e.part&&e.hasOwnProperty("part")&&t.uint32(80).int32(e.part),null!=e.pitchName&&e.hasOwnProperty("pitchName")&&t.uint32(88).int32(e.pitchName),null!=e.voice&&e.hasOwnProperty("voice")&&t.uint32(96).int32(e.voice),null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&t.uint32(104).int64(e.quantizedStartStep),null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&t.uint32(112).int64(e.quantizedEndStep),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.Note;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.pitch=e.int32();break;case 11:r.pitchName=e.int32();break;case 2:r.velocity=e.int32();break;case 3:r.startTime=e.double();break;case 13:r.quantizedStartStep=e.int64();break;case 4:r.endTime=e.double();break;case 14:r.quantizedEndStep=e.int64();break;case 5:r.numerator=e.int32();break;case 6:r.denominator=e.int32();break;case 7:r.instrument=e.int32();break;case 8:r.program=e.int32();break;case 9:r.isDrum=e.bool();break;case 10:r.part=e.int32();break;case 12:r.voice=e.int32();break;default:e.skipType(7&i)}}return r},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.pitch&&e.hasOwnProperty("pitch")&&!o.isInteger(e.pitch))return"pitch: integer expected";if(null!=e.pitchName&&e.hasOwnProperty("pitchName"))switch(e.pitchName){default:return"pitchName: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 32:case 33:case 34:case 35:}return null!=e.velocity&&e.hasOwnProperty("velocity")&&!o.isInteger(e.velocity)?"velocity: integer expected":null!=e.startTime&&e.hasOwnProperty("startTime")&&"number"!=typeof e.startTime?"startTime: number expected":null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&!(o.isInteger(e.quantizedStartStep)||e.quantizedStartStep&&o.isInteger(e.quantizedStartStep.low)&&o.isInteger(e.quantizedStartStep.high))?"quantizedStartStep: integer|Long expected":null!=e.endTime&&e.hasOwnProperty("endTime")&&"number"!=typeof e.endTime?"endTime: number expected":null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&!(o.isInteger(e.quantizedEndStep)||e.quantizedEndStep&&o.isInteger(e.quantizedEndStep.low)&&o.isInteger(e.quantizedEndStep.high))?"quantizedEndStep: integer|Long expected":null!=e.numerator&&e.hasOwnProperty("numerator")&&!o.isInteger(e.numerator)?"numerator: integer expected":null!=e.denominator&&e.hasOwnProperty("denominator")&&!o.isInteger(e.denominator)?"denominator: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!o.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!o.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!=typeof e.isDrum?"isDrum: boolean expected":null!=e.part&&e.hasOwnProperty("part")&&!o.isInteger(e.part)?"part: integer expected":null!=e.voice&&e.hasOwnProperty("voice")&&!o.isInteger(e.voice)?"voice: integer expected":null},t.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.Note)return e;var t=new c.tensorflow.magenta.NoteSequence.Note;switch(null!=e.pitch&&(t.pitch=0|e.pitch),e.pitchName){case"UNKNOWN_PITCH_NAME":case 0:t.pitchName=0;break;case"F_FLAT_FLAT":case 1:t.pitchName=1;break;case"C_FLAT_FLAT":case 2:t.pitchName=2;break;case"G_FLAT_FLAT":case 3:t.pitchName=3;break;case"D_FLAT_FLAT":case 4:t.pitchName=4;break;case"A_FLAT_FLAT":case 5:t.pitchName=5;break;case"E_FLAT_FLAT":case 6:t.pitchName=6;break;case"B_FLAT_FLAT":case 7:t.pitchName=7;break;case"F_FLAT":case 8:t.pitchName=8;break;case"C_FLAT":case 9:t.pitchName=9;break;case"G_FLAT":case 10:t.pitchName=10;break;case"D_FLAT":case 11:t.pitchName=11;break;case"A_FLAT":case 12:t.pitchName=12;break;case"E_FLAT":case 13:t.pitchName=13;break;case"B_FLAT":case 14:t.pitchName=14;break;case"F":case 15:t.pitchName=15;break;case"C":case 16:t.pitchName=16;break;case"G":case 17:t.pitchName=17;break;case"D":case 18:t.pitchName=18;break;case"A":case 19:t.pitchName=19;break;case"E":case 20:t.pitchName=20;break;case"B":case 21:t.pitchName=21;break;case"F_SHARP":case 22:t.pitchName=22;break;case"C_SHARP":case 23:t.pitchName=23;break;case"G_SHARP":case 24:t.pitchName=24;break;case"D_SHARP":case 25:t.pitchName=25;break;case"A_SHARP":case 26:t.pitchName=26;break;case"E_SHARP":case 27:t.pitchName=27;break;case"B_SHARP":case 28:t.pitchName=28;break;case"F_SHARP_SHARP":case 29:t.pitchName=29;break;case"C_SHARP_SHARP":case 30:t.pitchName=30;break;case"G_SHARP_SHARP":case 31:t.pitchName=31;break;case"D_SHARP_SHARP":case 32:t.pitchName=32;break;case"A_SHARP_SHARP":case 33:t.pitchName=33;break;case"E_SHARP_SHARP":case 34:t.pitchName=34;break;case"B_SHARP_SHARP":case 35:t.pitchName=35}return null!=e.velocity&&(t.velocity=0|e.velocity),null!=e.startTime&&(t.startTime=Number(e.startTime)),null!=e.quantizedStartStep&&(o.Long?(t.quantizedStartStep=o.Long.fromValue(e.quantizedStartStep)).unsigned=!1:"string"==typeof e.quantizedStartStep?t.quantizedStartStep=parseInt(e.quantizedStartStep,10):"number"==typeof e.quantizedStartStep?t.quantizedStartStep=e.quantizedStartStep:"object"==typeof e.quantizedStartStep&&(t.quantizedStartStep=new o.LongBits(e.quantizedStartStep.low>>>0,e.quantizedStartStep.high>>>0).toNumber())),null!=e.endTime&&(t.endTime=Number(e.endTime)),null!=e.quantizedEndStep&&(o.Long?(t.quantizedEndStep=o.Long.fromValue(e.quantizedEndStep)).unsigned=!1:"string"==typeof e.quantizedEndStep?t.quantizedEndStep=parseInt(e.quantizedEndStep,10):"number"==typeof e.quantizedEndStep?t.quantizedEndStep=e.quantizedEndStep:"object"==typeof e.quantizedEndStep&&(t.quantizedEndStep=new o.LongBits(e.quantizedEndStep.low>>>0,e.quantizedEndStep.high>>>0).toNumber())),null!=e.numerator&&(t.numerator=0|e.numerator),null!=e.denominator&&(t.denominator=0|e.denominator),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),null!=e.part&&(t.part=0|e.part),null!=e.voice&&(t.voice=0|e.voice),t},t.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(n.pitch=0,n.velocity=0,n.startTime=0,n.endTime=0,n.numerator=0,n.denominator=0,n.instrument=0,n.program=0,n.isDrum=!1,n.part=0,n.pitchName=t.enums===String?"UNKNOWN_PITCH_NAME":0,n.voice=0,o.Long){var r=new o.Long(0,0,!1);n.quantizedStartStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStartStep=t.longs===String?"0":0;o.Long?(r=new o.Long(0,0,!1),n.quantizedEndStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.quantizedEndStep=t.longs===String?"0":0}return null!=e.pitch&&e.hasOwnProperty("pitch")&&(n.pitch=e.pitch),null!=e.velocity&&e.hasOwnProperty("velocity")&&(n.velocity=e.velocity),null!=e.startTime&&e.hasOwnProperty("startTime")&&(n.startTime=t.json&&!isFinite(e.startTime)?String(e.startTime):e.startTime),null!=e.endTime&&e.hasOwnProperty("endTime")&&(n.endTime=t.json&&!isFinite(e.endTime)?String(e.endTime):e.endTime),null!=e.numerator&&e.hasOwnProperty("numerator")&&(n.numerator=e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&(n.denominator=e.denominator),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),null!=e.part&&e.hasOwnProperty("part")&&(n.part=e.part),null!=e.pitchName&&e.hasOwnProperty("pitchName")&&(n.pitchName=t.enums===String?c.tensorflow.magenta.NoteSequence.PitchName[e.pitchName]:e.pitchName),null!=e.voice&&e.hasOwnProperty("voice")&&(n.voice=e.voice),null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&("number"==typeof e.quantizedStartStep?n.quantizedStartStep=t.longs===String?String(e.quantizedStartStep):e.quantizedStartStep:n.quantizedStartStep=t.longs===String?o.Long.prototype.toString.call(e.quantizedStartStep):t.longs===Number?new o.LongBits(e.quantizedStartStep.low>>>0,e.quantizedStartStep.high>>>0).toNumber():e.quantizedStartStep),null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&("number"==typeof e.quantizedEndStep?n.quantizedEndStep=t.longs===String?String(e.quantizedEndStep):e.quantizedEndStep:n.quantizedEndStep=t.longs===String?o.Long.prototype.toString.call(e.quantizedEndStep):t.longs===Number?new o.LongBits(e.quantizedEndStep.low>>>0,e.quantizedEndStep.high>>>0).toNumber():e.quantizedEndStep),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.PitchName=(e={},(n=Object.create(e))[e[0]="UNKNOWN_PITCH_NAME"]=0,n[e[1]="F_FLAT_FLAT"]=1,n[e[2]="C_FLAT_FLAT"]=2,n[e[3]="G_FLAT_FLAT"]=3,n[e[4]="D_FLAT_FLAT"]=4,n[e[5]="A_FLAT_FLAT"]=5,n[e[6]="E_FLAT_FLAT"]=6,n[e[7]="B_FLAT_FLAT"]=7,n[e[8]="F_FLAT"]=8,n[e[9]="C_FLAT"]=9,n[e[10]="G_FLAT"]=10,n[e[11]="D_FLAT"]=11,n[e[12]="A_FLAT"]=12,n[e[13]="E_FLAT"]=13,n[e[14]="B_FLAT"]=14,n[e[15]="F"]=15,n[e[16]="C"]=16,n[e[17]="G"]=17,n[e[18]="D"]=18,n[e[19]="A"]=19,n[e[20]="E"]=20,n[e[21]="B"]=21,n[e[22]="F_SHARP"]=22,n[e[23]="C_SHARP"]=23,n[e[24]="G_SHARP"]=24,n[e[25]="D_SHARP"]=25,n[e[26]="A_SHARP"]=26,n[e[27]="E_SHARP"]=27,n[e[28]="B_SHARP"]=28,n[e[29]="F_SHARP_SHARP"]=29,n[e[30]="C_SHARP_SHARP"]=30,n[e[31]="G_SHARP_SHARP"]=31,n[e[32]="D_SHARP_SHARP"]=32,n[e[33]="A_SHARP_SHARP"]=33,n[e[34]="E_SHARP_SHARP"]=34,n[e[35]="B_SHARP_SHARP"]=35,n),t.TimeSignature=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.time=0,t.prototype.numerator=0,t.prototype.denominator=0,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=l.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.numerator&&e.hasOwnProperty("numerator")&&t.uint32(16).int32(e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&t.uint32(24).int32(e.denominator),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.TimeSignature;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 2:r.numerator=e.int32();break;case 3:r.denominator=e.int32();break;default:e.skipType(7&i)}}return r},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.numerator&&e.hasOwnProperty("numerator")&&!o.isInteger(e.numerator)?"numerator: integer expected":null!=e.denominator&&e.hasOwnProperty("denominator")&&!o.isInteger(e.denominator)?"denominator: integer expected":null},t.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.TimeSignature)return e;var t=new c.tensorflow.magenta.NoteSequence.TimeSignature;return null!=e.time&&(t.time=Number(e.time)),null!=e.numerator&&(t.numerator=0|e.numerator),null!=e.denominator&&(t.denominator=0|e.denominator),t},t.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.numerator=0,n.denominator=0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.numerator&&e.hasOwnProperty("numerator")&&(n.numerator=e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&(n.denominator=e.denominator),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.KeySignature=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var e,n,r,i;return t.prototype.time=0,t.prototype.key=0,t.prototype.mode=0,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=l.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.key&&e.hasOwnProperty("key")&&t.uint32(16).int32(e.key),null!=e.mode&&e.hasOwnProperty("mode")&&t.uint32(24).int32(e.mode),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.KeySignature;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 2:r.key=e.int32();break;case 3:r.mode=e.int32();break;default:e.skipType(7&i)}}return r},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time)return"time: number expected";if(null!=e.key&&e.hasOwnProperty("key"))switch(e.key){default:return"key: enum value expected";case 0:case 1:case 1:case 2:case 3:case 3:case 4:case 5:case 6:case 6:case 7:case 8:case 8:case 9:case 10:case 10:case 11:}if(null!=e.mode&&e.hasOwnProperty("mode"))switch(e.mode){default:return"mode: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:}return null},t.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.KeySignature)return e;var t=new c.tensorflow.magenta.NoteSequence.KeySignature;switch(null!=e.time&&(t.time=Number(e.time)),e.key){case"C":case 0:t.key=0;break;case"C_SHARP":case 1:t.key=1;break;case"D_FLAT":case 1:t.key=1;break;case"D":case 2:t.key=2;break;case"D_SHARP":case 3:t.key=3;break;case"E_FLAT":case 3:t.key=3;break;case"E":case 4:t.key=4;break;case"F":case 5:t.key=5;break;case"F_SHARP":case 6:t.key=6;break;case"G_FLAT":case 6:t.key=6;break;case"G":case 7:t.key=7;break;case"G_SHARP":case 8:t.key=8;break;case"A_FLAT":case 8:t.key=8;break;case"A":case 9:t.key=9;break;case"A_SHARP":case 10:t.key=10;break;case"B_FLAT":case 10:t.key=10;break;case"B":case 11:t.key=11}switch(e.mode){case"MAJOR":case 0:t.mode=0;break;case"MINOR":case 1:t.mode=1;break;case"NOT_SPECIFIED":case 2:t.mode=2;break;case"MIXOLYDIAN":case 3:t.mode=3;break;case"DORIAN":case 4:t.mode=4;break;case"PHRYGIAN":case 5:t.mode=5;break;case"LYDIAN":case 6:t.mode=6;break;case"LOCRIAN":case 7:t.mode=7}return t},t.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.key=t.enums===String?"C":0,n.mode=t.enums===String?"MAJOR":0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.key&&e.hasOwnProperty("key")&&(n.key=t.enums===String?c.tensorflow.magenta.NoteSequence.KeySignature.Key[e.key]:e.key),null!=e.mode&&e.hasOwnProperty("mode")&&(n.mode=t.enums===String?c.tensorflow.magenta.NoteSequence.KeySignature.Mode[e.mode]:e.mode),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.Key=(e={},(n=Object.create(e))[e[0]="C"]=0,n[e[1]="C_SHARP"]=1,n.D_FLAT=1,n[e[2]="D"]=2,n[e[3]="D_SHARP"]=3,n.E_FLAT=3,n[e[4]="E"]=4,n[e[5]="F"]=5,n[e[6]="F_SHARP"]=6,n.G_FLAT=6,n[e[7]="G"]=7,n[e[8]="G_SHARP"]=8,n.A_FLAT=8,n[e[9]="A"]=9,n[e[10]="A_SHARP"]=10,n.B_FLAT=10,n[e[11]="B"]=11,n),t.Mode=(r={},(i=Object.create(r))[r[0]="MAJOR"]=0,i[r[1]="MINOR"]=1,i[r[2]="NOT_SPECIFIED"]=2,i[r[3]="MIXOLYDIAN"]=3,i[r[4]="DORIAN"]=4,i[r[5]="PHRYGIAN"]=5,i[r[6]="LYDIAN"]=6,i[r[7]="LOCRIAN"]=7,i),t}(),t.Tempo=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.time=0,t.prototype.qpm=0,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=l.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.qpm&&e.hasOwnProperty("qpm")&&t.uint32(17).double(e.qpm),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.Tempo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 2:r.qpm=e.double();break;default:e.skipType(7&i)}}return r},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.qpm&&e.hasOwnProperty("qpm")&&"number"!=typeof e.qpm?"qpm: number expected":null},t.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.Tempo)return e;var t=new c.tensorflow.magenta.NoteSequence.Tempo;return null!=e.time&&(t.time=Number(e.time)),null!=e.qpm&&(t.qpm=Number(e.qpm)),t},t.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.qpm=0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.qpm&&e.hasOwnProperty("qpm")&&(n.qpm=t.json&&!isFinite(e.qpm)?String(e.qpm):e.qpm),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.PitchBend=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.time=0,t.prototype.bend=0,t.prototype.instrument=0,t.prototype.program=0,t.prototype.isDrum=!1,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=l.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.bend&&e.hasOwnProperty("bend")&&t.uint32(16).int32(e.bend),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(24).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(32).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(40).bool(e.isDrum),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.PitchBend;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 2:r.bend=e.int32();break;case 3:r.instrument=e.int32();break;case 4:r.program=e.int32();break;case 5:r.isDrum=e.bool();break;default:e.skipType(7&i)}}return r},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.bend&&e.hasOwnProperty("bend")&&!o.isInteger(e.bend)?"bend: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!o.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!o.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!=typeof e.isDrum?"isDrum: boolean expected":null},t.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.PitchBend)return e;var t=new c.tensorflow.magenta.NoteSequence.PitchBend;return null!=e.time&&(t.time=Number(e.time)),null!=e.bend&&(t.bend=0|e.bend),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),t},t.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.bend=0,n.instrument=0,n.program=0,n.isDrum=!1),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.bend&&e.hasOwnProperty("bend")&&(n.bend=e.bend),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.ControlChange=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.time=0,t.prototype.quantizedStep=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.controlNumber=0,t.prototype.controlValue=0,t.prototype.instrument=0,t.prototype.program=0,t.prototype.isDrum=!1,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=l.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&t.uint32(16).int32(e.controlNumber),null!=e.controlValue&&e.hasOwnProperty("controlValue")&&t.uint32(24).int32(e.controlValue),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(32).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(40).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(48).bool(e.isDrum),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&t.uint32(56).int64(e.quantizedStep),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.ControlChange;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 7:r.quantizedStep=e.int64();break;case 2:r.controlNumber=e.int32();break;case 3:r.controlValue=e.int32();break;case 4:r.instrument=e.int32();break;case 5:r.program=e.int32();break;case 6:r.isDrum=e.bool();break;default:e.skipType(7&i)}}return r},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&!(o.isInteger(e.quantizedStep)||e.quantizedStep&&o.isInteger(e.quantizedStep.low)&&o.isInteger(e.quantizedStep.high))?"quantizedStep: integer|Long expected":null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&!o.isInteger(e.controlNumber)?"controlNumber: integer expected":null!=e.controlValue&&e.hasOwnProperty("controlValue")&&!o.isInteger(e.controlValue)?"controlValue: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!o.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!o.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!=typeof e.isDrum?"isDrum: boolean expected":null},t.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.ControlChange)return e;var t=new c.tensorflow.magenta.NoteSequence.ControlChange;return null!=e.time&&(t.time=Number(e.time)),null!=e.quantizedStep&&(o.Long?(t.quantizedStep=o.Long.fromValue(e.quantizedStep)).unsigned=!1:"string"==typeof e.quantizedStep?t.quantizedStep=parseInt(e.quantizedStep,10):"number"==typeof e.quantizedStep?t.quantizedStep=e.quantizedStep:"object"==typeof e.quantizedStep&&(t.quantizedStep=new o.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber())),null!=e.controlNumber&&(t.controlNumber=0|e.controlNumber),null!=e.controlValue&&(t.controlValue=0|e.controlValue),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),t},t.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,n.controlNumber=0,n.controlValue=0,n.instrument=0,n.program=0,n.isDrum=!1,o.Long){var r=new o.Long(0,0,!1);n.quantizedStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStep=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&(n.controlNumber=e.controlNumber),null!=e.controlValue&&e.hasOwnProperty("controlValue")&&(n.controlValue=e.controlValue),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&("number"==typeof e.quantizedStep?n.quantizedStep=t.longs===String?String(e.quantizedStep):e.quantizedStep:n.quantizedStep=t.longs===String?o.Long.prototype.toString.call(e.quantizedStep):t.longs===Number?new o.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber():e.quantizedStep),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.PartInfo=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.part=0,t.prototype.name="",t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=l.create()),null!=e.part&&e.hasOwnProperty("part")&&t.uint32(8).int32(e.part),null!=e.name&&e.hasOwnProperty("name")&&t.uint32(18).string(e.name),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.PartInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.part=e.int32();break;case 2:r.name=e.string();break;default:e.skipType(7&i)}}return r},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.part&&e.hasOwnProperty("part")&&!o.isInteger(e.part)?"part: integer expected":null!=e.name&&e.hasOwnProperty("name")&&!o.isString(e.name)?"name: string expected":null},t.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.PartInfo)return e;var t=new c.tensorflow.magenta.NoteSequence.PartInfo;return null!=e.part&&(t.part=0|e.part),null!=e.name&&(t.name=String(e.name)),t},t.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.part=0,n.name=""),null!=e.part&&e.hasOwnProperty("part")&&(n.part=e.part),null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.SourceInfo=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var e,n,r,i,o,a;return t.prototype.sourceType=0,t.prototype.encodingType=0,t.prototype.parser=0,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=l.create()),null!=e.sourceType&&e.hasOwnProperty("sourceType")&&t.uint32(8).int32(e.sourceType),null!=e.encodingType&&e.hasOwnProperty("encodingType")&&t.uint32(16).int32(e.encodingType),null!=e.parser&&e.hasOwnProperty("parser")&&t.uint32(24).int32(e.parser),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.SourceInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.sourceType=e.int32();break;case 2:r.encodingType=e.int32();break;case 3:r.parser=e.int32();break;default:e.skipType(7&i)}}return r},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.sourceType&&e.hasOwnProperty("sourceType"))switch(e.sourceType){default:return"sourceType: enum value expected";case 0:case 1:case 2:}if(null!=e.encodingType&&e.hasOwnProperty("encodingType"))switch(e.encodingType){default:return"encodingType: enum value expected";case 0:case 1:case 2:case 3:case 4:}if(null!=e.parser&&e.hasOwnProperty("parser"))switch(e.parser){default:return"parser: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:}return null},t.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.SourceInfo)return e;var t=new c.tensorflow.magenta.NoteSequence.SourceInfo;switch(e.sourceType){case"UNKNOWN_SOURCE_TYPE":case 0:t.sourceType=0;break;case"SCORE_BASED":case 1:t.sourceType=1;break;case"PERFORMANCE_BASED":case 2:t.sourceType=2}switch(e.encodingType){case"UNKNOWN_ENCODING_TYPE":case 0:t.encodingType=0;break;case"MUSIC_XML":case 1:t.encodingType=1;break;case"ABC":case 2:t.encodingType=2;break;case"MIDI":case 3:t.encodingType=3;break;case"MUSICNET":case 4:t.encodingType=4}switch(e.parser){case"UNKNOWN_PARSER":case 0:t.parser=0;break;case"MUSIC21":case 1:t.parser=1;break;case"PRETTY_MIDI":case 2:t.parser=2;break;case"MAGENTA_MUSIC_XML":case 3:t.parser=3;break;case"MAGENTA_MUSICNET":case 4:t.parser=4;break;case"MAGENTA_ABC":case 5:t.parser=5;break;case"TONEJS_MIDI_CONVERT":case 6:t.parser=6}return t},t.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.sourceType=t.enums===String?"UNKNOWN_SOURCE_TYPE":0,n.encodingType=t.enums===String?"UNKNOWN_ENCODING_TYPE":0,n.parser=t.enums===String?"UNKNOWN_PARSER":0),null!=e.sourceType&&e.hasOwnProperty("sourceType")&&(n.sourceType=t.enums===String?c.tensorflow.magenta.NoteSequence.SourceInfo.SourceType[e.sourceType]:e.sourceType),null!=e.encodingType&&e.hasOwnProperty("encodingType")&&(n.encodingType=t.enums===String?c.tensorflow.magenta.NoteSequence.SourceInfo.EncodingType[e.encodingType]:e.encodingType),null!=e.parser&&e.hasOwnProperty("parser")&&(n.parser=t.enums===String?c.tensorflow.magenta.NoteSequence.SourceInfo.Parser[e.parser]:e.parser),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.SourceType=(e={},(n=Object.create(e))[e[0]="UNKNOWN_SOURCE_TYPE"]=0,n[e[1]="SCORE_BASED"]=1,n[e[2]="PERFORMANCE_BASED"]=2,n),t.EncodingType=(r={},(i=Object.create(r))[r[0]="UNKNOWN_ENCODING_TYPE"]=0,i[r[1]="MUSIC_XML"]=1,i[r[2]="ABC"]=2,i[r[3]="MIDI"]=3,i[r[4]="MUSICNET"]=4,i),t.Parser=(o={},(a=Object.create(o))[o[0]="UNKNOWN_PARSER"]=0,a[o[1]="MUSIC21"]=1,a[o[2]="PRETTY_MIDI"]=2,a[o[3]="MAGENTA_MUSIC_XML"]=3,a[o[4]="MAGENTA_MUSICNET"]=4,a[o[5]="MAGENTA_ABC"]=5,a[o[6]="TONEJS_MIDI_CONVERT"]=6,a),t}(),t.TextAnnotation=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var e,n;return t.prototype.time=0,t.prototype.quantizedStep=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.text="",t.prototype.annotationType=0,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=l.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.text&&e.hasOwnProperty("text")&&t.uint32(18).string(e.text),null!=e.annotationType&&e.hasOwnProperty("annotationType")&&t.uint32(24).int32(e.annotationType),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&t.uint32(32).int64(e.quantizedStep),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.TextAnnotation;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 4:r.quantizedStep=e.int64();break;case 2:r.text=e.string();break;case 3:r.annotationType=e.int32();break;default:e.skipType(7&i)}}return r},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time)return"time: number expected";if(null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&!(o.isInteger(e.quantizedStep)||e.quantizedStep&&o.isInteger(e.quantizedStep.low)&&o.isInteger(e.quantizedStep.high)))return"quantizedStep: integer|Long expected";if(null!=e.text&&e.hasOwnProperty("text")&&!o.isString(e.text))return"text: string expected";if(null!=e.annotationType&&e.hasOwnProperty("annotationType"))switch(e.annotationType){default:return"annotationType: enum value expected";case 0:case 1:}return null},t.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.TextAnnotation)return e;var t=new c.tensorflow.magenta.NoteSequence.TextAnnotation;switch(null!=e.time&&(t.time=Number(e.time)),null!=e.quantizedStep&&(o.Long?(t.quantizedStep=o.Long.fromValue(e.quantizedStep)).unsigned=!1:"string"==typeof e.quantizedStep?t.quantizedStep=parseInt(e.quantizedStep,10):"number"==typeof e.quantizedStep?t.quantizedStep=e.quantizedStep:"object"==typeof e.quantizedStep&&(t.quantizedStep=new o.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber())),null!=e.text&&(t.text=String(e.text)),e.annotationType){case"UNKNOWN":case 0:t.annotationType=0;break;case"CHORD_SYMBOL":case 1:t.annotationType=1}return t},t.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,n.text="",n.annotationType=t.enums===String?"UNKNOWN":0,o.Long){var r=new o.Long(0,0,!1);n.quantizedStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStep=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.text&&e.hasOwnProperty("text")&&(n.text=e.text),null!=e.annotationType&&e.hasOwnProperty("annotationType")&&(n.annotationType=t.enums===String?c.tensorflow.magenta.NoteSequence.TextAnnotation.TextAnnotationType[e.annotationType]:e.annotationType),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&("number"==typeof e.quantizedStep?n.quantizedStep=t.longs===String?String(e.quantizedStep):e.quantizedStep:n.quantizedStep=t.longs===String?o.Long.prototype.toString.call(e.quantizedStep):t.longs===Number?new o.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber():e.quantizedStep),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.TextAnnotationType=(e={},(n=Object.create(e))[e[0]="UNKNOWN"]=0,n[e[1]="CHORD_SYMBOL"]=1,n),t}(),t.QuantizationInfo=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var e;return t.prototype.stepsPerQuarter=0,t.prototype.stepsPerSecond=0,Object.defineProperty(t.prototype,"resolution",{get:o.oneOfGetter(e=["stepsPerQuarter","stepsPerSecond"]),set:o.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=l.create()),null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&t.uint32(8).int32(e.stepsPerQuarter),null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")&&t.uint32(16).int32(e.stepsPerSecond),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.QuantizationInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.stepsPerQuarter=e.int32();break;case 2:r.stepsPerSecond=e.int32();break;default:e.skipType(7&i)}}return r},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t={};if(null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&(t.resolution=1,!o.isInteger(e.stepsPerQuarter)))return"stepsPerQuarter: integer expected";if(null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")){if(1===t.resolution)return"resolution: multiple values";if(t.resolution=1,!o.isInteger(e.stepsPerSecond))return"stepsPerSecond: integer expected"}return null},t.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.QuantizationInfo)return e;var t=new c.tensorflow.magenta.NoteSequence.QuantizationInfo;return null!=e.stepsPerQuarter&&(t.stepsPerQuarter=0|e.stepsPerQuarter),null!=e.stepsPerSecond&&(t.stepsPerSecond=0|e.stepsPerSecond),t},t.toObject=function(e,t){t||(t={});var n={};return null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&(n.stepsPerQuarter=e.stepsPerQuarter,t.oneofs&&(n.resolution="stepsPerQuarter")),null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")&&(n.stepsPerSecond=e.stepsPerSecond,t.oneofs&&(n.resolution="stepsPerSecond")),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.SubsequenceInfo=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.startTimeOffset=0,t.prototype.endTimeOffset=0,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=l.create()),null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&t.uint32(9).double(e.startTimeOffset),null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&t.uint32(17).double(e.endTimeOffset),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.SubsequenceInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.startTimeOffset=e.double();break;case 2:r.endTimeOffset=e.double();break;default:e.skipType(7&i)}}return r},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&"number"!=typeof e.startTimeOffset?"startTimeOffset: number expected":null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&"number"!=typeof e.endTimeOffset?"endTimeOffset: number expected":null},t.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.SubsequenceInfo)return e;var t=new c.tensorflow.magenta.NoteSequence.SubsequenceInfo;return null!=e.startTimeOffset&&(t.startTimeOffset=Number(e.startTimeOffset)),null!=e.endTimeOffset&&(t.endTimeOffset=Number(e.endTimeOffset)),t},t.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.startTimeOffset=0,n.endTimeOffset=0),null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&(n.startTimeOffset=t.json&&!isFinite(e.startTimeOffset)?String(e.startTimeOffset):e.startTimeOffset),null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&(n.endTimeOffset=t.json&&!isFinite(e.endTimeOffset)?String(e.endTimeOffset):e.endTimeOffset),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.SectionAnnotation=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.time=0,t.prototype.sectionId=o.Long?o.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=l.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&t.uint32(32).int64(e.sectionId),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.SectionAnnotation;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 4:r.sectionId=e.int64();break;default:e.skipType(7&i)}}return r},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.sectionId&&e.hasOwnProperty("sectionId")&&!(o.isInteger(e.sectionId)||e.sectionId&&o.isInteger(e.sectionId.low)&&o.isInteger(e.sectionId.high))?"sectionId: integer|Long expected":null},t.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.SectionAnnotation)return e;var t=new c.tensorflow.magenta.NoteSequence.SectionAnnotation;return null!=e.time&&(t.time=Number(e.time)),null!=e.sectionId&&(o.Long?(t.sectionId=o.Long.fromValue(e.sectionId)).unsigned=!1:"string"==typeof e.sectionId?t.sectionId=parseInt(e.sectionId,10):"number"==typeof e.sectionId?t.sectionId=e.sectionId:"object"==typeof e.sectionId&&(t.sectionId=new o.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber())),t},t.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,o.Long){var r=new o.Long(0,0,!1);n.sectionId=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.sectionId=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&("number"==typeof e.sectionId?n.sectionId=t.longs===String?String(e.sectionId):e.sectionId:n.sectionId=t.longs===String?o.Long.prototype.toString.call(e.sectionId):t.longs===Number?new o.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber():e.sectionId),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.Section=function(){function t(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var e;return t.prototype.sectionId=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.sectionGroup=null,Object.defineProperty(t.prototype,"sectionType",{get:o.oneOfGetter(e=["sectionId","sectionGroup"]),set:o.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(e,t){return t||(t=l.create()),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&t.uint32(8).int64(e.sectionId),null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")&&c.tensorflow.magenta.NoteSequence.SectionGroup.encode(e.sectionGroup,t.uint32(18).fork()).ldelim(),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.Section;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.sectionId=e.int64();break;case 2:r.sectionGroup=c.tensorflow.magenta.NoteSequence.SectionGroup.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t={};if(null!=e.sectionId&&e.hasOwnProperty("sectionId")&&(t.sectionType=1,!(o.isInteger(e.sectionId)||e.sectionId&&o.isInteger(e.sectionId.low)&&o.isInteger(e.sectionId.high))))return"sectionId: integer|Long expected";if(null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")){if(1===t.sectionType)return"sectionType: multiple values";t.sectionType=1;var n=c.tensorflow.magenta.NoteSequence.SectionGroup.verify(e.sectionGroup);if(n)return"sectionGroup."+n}return null},t.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.Section)return e;var t=new c.tensorflow.magenta.NoteSequence.Section;if(null!=e.sectionId&&(o.Long?(t.sectionId=o.Long.fromValue(e.sectionId)).unsigned=!1:"string"==typeof e.sectionId?t.sectionId=parseInt(e.sectionId,10):"number"==typeof e.sectionId?t.sectionId=e.sectionId:"object"==typeof e.sectionId&&(t.sectionId=new o.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber())),null!=e.sectionGroup){if("object"!=typeof e.sectionGroup)throw TypeError(".tensorflow.magenta.NoteSequence.Section.sectionGroup: object expected");t.sectionGroup=c.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(e.sectionGroup)}return t},t.toObject=function(e,t){t||(t={});var n={};return null!=e.sectionId&&e.hasOwnProperty("sectionId")&&("number"==typeof e.sectionId?n.sectionId=t.longs===String?String(e.sectionId):e.sectionId:n.sectionId=t.longs===String?o.Long.prototype.toString.call(e.sectionId):t.longs===Number?new o.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber():e.sectionId,t.oneofs&&(n.sectionType="sectionId")),null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")&&(n.sectionGroup=c.tensorflow.magenta.NoteSequence.SectionGroup.toObject(e.sectionGroup,t),t.oneofs&&(n.sectionType="sectionGroup")),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.SectionGroup=function(){function t(e){if(this.sections=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.sections=o.emptyArray,t.prototype.numTimes=0,t.create=function(e){return new t(e)},t.encode=function(e,t){if(t||(t=l.create()),null!=e.sections&&e.sections.length)for(var n=0;n<e.sections.length;++n)c.tensorflow.magenta.NoteSequence.Section.encode(e.sections[n],t.uint32(10).fork()).ldelim();return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&t.uint32(16).int32(e.numTimes),t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.SectionGroup;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.sections&&r.sections.length||(r.sections=[]),r.sections.push(c.tensorflow.magenta.NoteSequence.Section.decode(e,e.uint32()));break;case 2:r.numTimes=e.int32();break;default:e.skipType(7&i)}}return r},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.sections&&e.hasOwnProperty("sections")){if(!Array.isArray(e.sections))return"sections: array expected";for(var t=0;t<e.sections.length;++t){var n=c.tensorflow.magenta.NoteSequence.Section.verify(e.sections[t]);if(n)return"sections."+n}}return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&!o.isInteger(e.numTimes)?"numTimes: integer expected":null},t.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.SectionGroup)return e;var t=new c.tensorflow.magenta.NoteSequence.SectionGroup;if(e.sections){if(!Array.isArray(e.sections))throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: array expected");t.sections=[];for(var n=0;n<e.sections.length;++n){if("object"!=typeof e.sections[n])throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: object expected");t.sections[n]=c.tensorflow.magenta.NoteSequence.Section.fromObject(e.sections[n])}}return null!=e.numTimes&&(t.numTimes=0|e.numTimes),t},t.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.sections=[]),t.defaults&&(n.numTimes=0),e.sections&&e.sections.length){n.sections=[];for(var r=0;r<e.sections.length;++r)n.sections[r]=c.tensorflow.magenta.NoteSequence.Section.toObject(e.sections[r],t)}return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&(n.numTimes=e.numTimes),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t}(),r.SequenceMetadata=function(){function t(e){if(this.genre=[],this.composers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return t.prototype.title="",t.prototype.artist="",t.prototype.genre=o.emptyArray,t.prototype.composers=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(e,t){if(t||(t=l.create()),null!=e.title&&e.hasOwnProperty("title")&&t.uint32(10).string(e.title),null!=e.artist&&e.hasOwnProperty("artist")&&t.uint32(18).string(e.artist),null!=e.genre&&e.genre.length)for(var n=0;n<e.genre.length;++n)t.uint32(26).string(e.genre[n]);if(null!=e.composers&&e.composers.length)for(n=0;n<e.composers.length;++n)t.uint32(34).string(e.composers[n]);return t},t.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},t.decode=function(e,t){e instanceof u||(e=u.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.SequenceMetadata;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.title=e.string();break;case 2:r.artist=e.string();break;case 3:r.genre&&r.genre.length||(r.genre=[]),r.genre.push(e.string());break;case 4:r.composers&&r.composers.length||(r.composers=[]),r.composers.push(e.string());break;default:e.skipType(7&i)}}return r},t.decodeDelimited=function(e){return e instanceof u||(e=new u(e)),this.decode(e,e.uint32())},t.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.title&&e.hasOwnProperty("title")&&!o.isString(e.title))return"title: string expected";if(null!=e.artist&&e.hasOwnProperty("artist")&&!o.isString(e.artist))return"artist: string expected";if(null!=e.genre&&e.hasOwnProperty("genre")){if(!Array.isArray(e.genre))return"genre: array expected";for(var t=0;t<e.genre.length;++t)if(!o.isString(e.genre[t]))return"genre: string[] expected"}if(null!=e.composers&&e.hasOwnProperty("composers")){if(!Array.isArray(e.composers))return"composers: array expected";for(t=0;t<e.composers.length;++t)if(!o.isString(e.composers[t]))return"composers: string[] expected"}return null},t.fromObject=function(e){if(e instanceof c.tensorflow.magenta.SequenceMetadata)return e;var t=new c.tensorflow.magenta.SequenceMetadata;if(null!=e.title&&(t.title=String(e.title)),null!=e.artist&&(t.artist=String(e.artist)),e.genre){if(!Array.isArray(e.genre))throw TypeError(".tensorflow.magenta.SequenceMetadata.genre: array expected");t.genre=[];for(var n=0;n<e.genre.length;++n)t.genre[n]=String(e.genre[n])}if(e.composers){if(!Array.isArray(e.composers))throw TypeError(".tensorflow.magenta.SequenceMetadata.composers: array expected");for(t.composers=[],n=0;n<e.composers.length;++n)t.composers[n]=String(e.composers[n])}return t},t.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.genre=[],n.composers=[]),t.defaults&&(n.title="",n.artist=""),null!=e.title&&e.hasOwnProperty("title")&&(n.title=e.title),null!=e.artist&&e.hasOwnProperty("artist")&&(n.artist=e.artist),e.genre&&e.genre.length){n.genre=[];for(var r=0;r<e.genre.length;++r)n.genre[r]=e.genre[r]}if(e.composers&&e.composers.length)for(n.composers=[],r=0;r<e.composers.length;++r)n.composers[r]=e.composers[r];return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),r),i),t.exports=c},{"protobufjs/minimal":247}],296:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./model");n.OnsetsAndFrames=r.OnsetsAndFrames},{"./model":297}],297:[function(e,t,x){"use strict";var n=this&&this.__awaiter||function(o,a,s,u){return new(s||(s=Promise))(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})},T=this&&this.__generator||function(n,r){var i,o,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(n,s)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(x,"__esModule",{value:!0});var P=e("@tensorflow/tfjs"),N=e("../protobuf");x.MIN_MIDI_PITCH=21,x.MAX_MIDI_PITCH=108,x.MIDI_PITCHES=x.MAX_MIDI_PITCH-x.MIN_MIDI_PITCH+1;x.FRAME_LENGTH_SECONDS=.032;var h=128;function f(){var e=P.layers.lstm({units:h,returnSequences:!0,recurrentActivation:"sigmoid",trainable:!1});return P.layers.bidirectional({layer:e,mergeMode:"concat",trainable:!1})}var r=function(){function e(e){this.checkpointURL=e}return e.prototype.initialize=function(){return n(this,void 0,void 0,function(){var t,n=this;return T(this,function(e){switch(e.label){case 0:return this.dispose(),[4,fetch(this.checkpointURL+"/weights_manifest.json").then(function(e){return e.json()}).then(function(e){return P.io.loadWeights(e,n.checkpointURL)})];case 1:return t=e.sent(),this.build(t),Object.keys(t).map(function(e){return t[e].dispose()}),this.initialized=!0,console.log("Initialized OnsetsAndFrames."),[2]}})})},e.prototype.dispose=function(){this.initialized&&(this.onsetsModel.dispose(),this.velocityModel.dispose(),this.activationModel.dispose(),this.frameModel.dispose(),this.initialized=!1)},e.prototype.isInitialized=function(){return this.initialized},e.prototype.transcribeFromMelSpec=function(s){return n(this,void 0,void 0,function(){var t,n,r,i,o,a=this;return T(this,function(e){return this.isInitialized()||this.initialize(),t=P.tidy(function(){var e=P.tensor2d(s).expandDims(0).expandDims(-1),t=a.onsetsModel.predict(e),n=a.velocityModel.predict(e),r=P.clipByValue(n,0,1).mul(P.scalar(80)).add(P.scalar(10)).toInt(),i=a.activationModel.predict(e);return[a.frameModel.predict([t,i]).squeeze(),t.squeeze(),r.squeeze()]}),n=t[0],r=t[1],i=t[2],o=u(n,r,i),n.dispose(),r.dispose(),i.dispose(),[2,o]})})},e.prototype.build=function(n){var s=this;function l(e){var t=n[e];if(void 0===t)throw Error("Variable not found: "+e);return t}function u(e){return[l(e+"/conv1/weights"),l(e+"/conv1/BatchNorm/beta"),l(e+"/conv1/BatchNorm/moving_mean"),l(e+"/conv1/BatchNorm/moving_variance"),l(e+"/conv2/weights"),l(e+"/conv2/BatchNorm/beta"),l(e+"/conv2/BatchNorm/moving_mean"),l(e+"/conv2/BatchNorm/moving_variance"),l(e+"/conv3/weights"),l(e+"/conv3/BatchNorm/beta"),l(e+"/conv3/BatchNorm/moving_mean"),l(e+"/conv3/BatchNorm/moving_variance"),l(e+"/fc5/weights"),l(e+"/fc5/biases")]}function c(e){var t=function(e,t){void 0===t&&(t=0);var n=P.split(e,4,-1),r=n[0],i=n[1],o=n[2],a=n[3];return P.concat([r,o.add(P.scalar(t)),i,a],-1)},n=function(e){return P.split(t(e),[e.shape[0]-h,h])},r=n(l(e+"/bidirectional_rnn/fw/lstm_cell/kernel")),i=r[0],o=r[1],a=n(l(e+"/bidirectional_rnn/bw/lstm_cell/kernel")),s=a[0],u=a[1];return[i,o,t(l(e+"/bidirectional_rnn/fw/lstm_cell/bias"),1),s,u,t(l(e+"/bidirectional_rnn/bw/lstm_cell/bias"),1)]}function p(e){return[l(e+"/weights"),l(e+"/biases")]}P.tidy(function(){var e=s.getAcousticModel("sigmoid",!0);e.setWeights(u("onsets").concat(c("onsets"),p("onsets/onset_probs")));var t=s.getAcousticModel(void 0,!1);t.setWeights(u("velocity").concat(p("velocity/onset_velocities")));var n=s.getAcousticModel("sigmoid",!1);n.setWeights(u("frame").concat(p("frame/activation_probs")));var r=P.input({batchShape:e.outputShape}),i=P.input({batchShape:n.outputShape}),o=P.layers.concatenate().apply([r,i]);o=f().apply(o),o=P.layers.dense({units:x.MIDI_PITCHES,activation:"sigmoid",trainable:!1}).apply(o);var a=P.model({inputs:[r,i],outputs:o});a.trainable=!1,a.setWeights(c("frame").concat(p("frame/frame_probs"))),s.frameModel=a,s.onsetsModel=e,s.velocityModel=t,s.activationModel=n})},e.prototype.getAcousticModel=function(e,t){var n=P.sequential(),r={filters:32,kernelSize:[3,3],activation:"linear",useBias:!1,padding:"same",dilationRate:[1,1],inputShape:[null,229,1],trainable:!1},i={scale:!1,trainable:!1};n.add(P.layers.conv2d(r)),n.add(P.layers.batchNormalization(i)),n.add(P.layers.activation({activation:"relu"})),r.inputShape=null,n.add(P.layers.conv2d(r)),n.add(P.layers.batchNormalization(i)),n.add(P.layers.activation({activation:"relu"})),n.add(P.layers.maxPooling2d({poolSize:[1,2],strides:[1,2]})),r.filters=64,n.add(P.layers.conv2d(r)),n.add(P.layers.batchNormalization(i)),n.add(P.layers.activation({activation:"relu"})),n.add(P.layers.maxPooling2d({poolSize:[1,2],strides:[1,2]}));var o=n.outputShape;return n.add(P.layers.reshape({targetShape:[o[1],o[2]*o[3]]})),n.add(P.layers.dense({units:512,activation:"relu",trainable:!1})),t&&n.add(f()),n.add(P.layers.dense({units:x.MIDI_PITCHES,activation:e,trainable:!1})),n},e}();function u(v,b,_,w,S){return void 0===w&&(w=.5),void 0===S&&(S=.5),n(this,void 0,void 0,function(){function i(e,t){l.notes.push(N.NoteSequence.Note.create({pitch:e+x.MIN_MIDI_PITCH,startTime:(c[e]-1)*x.FRAME_LENGTH_SECONDS,endTime:t*x.FRAME_LENGTH_SECONDS,velocity:p[e]})),c[e]=0}var o,a,s,u,l,c,p,h,f,d,m,y,g;return T(this,function(e){switch(e.label){case 0:o=P.tidy(function(){var e=P.greater(b,w),t=P.greater(v,S);return e=e.pad([[0,1],[0,0]]),t=t.pad([[0,1],[0,0]]),_=_.pad([[0,1],[0,0]]),t=P.logicalOr(t,e),[P.unstack(t),P.unstack(e),P.unstack(_)]}),a=o[0],s=o[1],u=o[2],l=N.NoteSequence.create(),c=new Uint32Array(x.MIDI_PITCHES),p=new Uint8Array(x.MIDI_PITCHES),d=new Uint8Array(x.MIDI_PITCHES),m=0,e.label=1;case 1:return m<a.length?[4,a[m].data()]:[3,6];case 2:return h=e.sent(),[4,s[m].data()];case 3:return f=e.sent(),[4,u[m].data()];case 4:for(y=e.sent(),a[m].dispose(),s[m].dispose(),u[m].dispose(),g=0;g<h.length;++g)f[g]?(n=m,r=y[t=g],c[t]?d[t]||(i(t,n),c[t]=n+1,p[t]=r):(c[t]=n+1,p[t]=r)):!h[g]&&c[g]&&i(g,m);d=f,e.label=5;case 5:return++m,[3,1];case 6:return l.totalTime=a.length*x.FRAME_LENGTH_SECONDS,[2,l]}var t,n,r})})}x.OnsetsAndFrames=r,x.pianorollToNoteSequence=u},{"../protobuf":294,"@tensorflow/tfjs":239}]},{},[288])(288)});
//# sourceMappingURL=/sm/83ded041230923e243692afe4f4462a90bf8b6f13ddad2fc563ce7a44ac309be.map